RICE_setup_granada_flavor_pack_effect = {

	#########################################################################
	#
	# CULTURE AND RELIGION STUFF
	#
	#########################################################################

	RICE_change_andalusian_culture_features = yes

	#########################################################################
	#
	# HISTORY STUFF
	#
	#########################################################################
	# 1066 start date shenanigans
	if = {
		limit = {
			current_date > 1050.1.1
		}
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:RICE_granada_transfer_seat_of_power_done_flag
		}
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:RICE_granada_almeria_silk_industry_done
		}
		title:c_almeria = {
			add_county_modifier = {
				modifier = RICE_granada_almeria_silk_industry
			}
		}
		# title:c_granada = {
		# 	reset_title_name = yes
		# }
		# title:d_granada = {
		# 	reset_title_name = yes
		# }
	}

	if = {
		limit = {
			current_date > 1050.1.1
			current_date < 1067.1.1
		}
		title:c_granada = {
			add_county_modifier = {
				modifier = RICE_granada_garnata_al_yahud_tensions
			}
		}
		# Joseph ibn Naghrela tweaks and shenanigans
		character:3221 = {
			remove_trait = education_stewardship_4
			add_trait = education_learning_4
			add_trait = arrogant # Described by Jewish sources of the time as being capable but arrogant unlike his father
			add_trait = poet
			add_trait = scholar
			set_relation_friend = {
				reason = RICE_friend_reason_placeholder
				target = character:45016
			}
		}
		# Samuel ibn Naghrela should be smarter
		character:3220 = {
			RICE_remove_personality_traits_effect = yes
			remove_trait = education_stewardship_4
			add_trait = education_learning_4
			add_trait = intellect_good_3
			add_trait = poet
			add_trait = scholar
			add_trait = humble
			add_trait = diligent
			add_trait = brave
		}
		# Set Almeria to be independent
		title:c_almeria.holder = {
			create_title_and_vassal_change = {
				type = independency
				save_scope_as = indpendence_change
				add_claim_on_loss = no
			}
			becomes_independent = {
				change = scope:indpendence_change
			}
			resolve_title_and_vassal_change = scope:indpendence_change
		}
	}

	if = {
		limit = {
			current_date < 1050.1.1
		}
		title:c_granada = {
			set_title_name = GRANADA_ILBIRA
		}
		title:d_granada = {
			set_title_name = GRANADA_ILBIRA_DUCHY
		}
	}

	if = {
		limit = {
			game_start_date = 867.1.1
		}
		character:73805 = {
			RICE_remove_personality_traits_effect = yes
			add_trait = vengeful
			add_trait = ambitious
			add_trait = wrathful
		}
	}

	title:c_cadiz = {
		add_county_modifier = {
			modifier = RICE_granada_tower_of_cadiz
		}
	}

}




# RICE_granada_munya_group_vacation_finished_effect = {
# 	add_character_modifier = {
# 		modifier = RICE_granada_vacationed_at_a_munya
# 		years = 5
# 	}
# 	if = {
# 		limit = {
# 			var:RICE_munya_group_vacation_focus = flag:sightseeing
# 		}
# 		scope:activity = {
# 			every_attending_character = {
# 				limit = {
# 					NOT = { this = root }
# 					OR = {
# 						has_trait = shy
# 						has_trait = content
# 						has_trait = calm
# 						has_trait = zealous
# 						has_trait = patient
# 						has_trait = humble
# 						has_trait = lifestyle_gardener
# 					}
# 				}
# 				custom = RICE_every_guest_who_really_enjoyed_munya_vacation
# 				add_opinion = {
# 					target = root
# 					modifier = RICE_granada_enjoyed_munya_vacation_great
# 				}
# 				add_character_modifier = {
# 					modifier = RICE_granada_vacationed_at_a_munya
# 					years = 5
# 				}
# 			}
# 			every_attending_character = {
# 				limit = {
# 					NOT = { this = root }
# 					NOR = {
# 						has_trait = shy
# 						has_trait = content
# 						has_trait = calm
# 						has_trait = zealous
# 						has_trait = patient
# 						has_trait = humble
# 						has_trait = lifestyle_gardener
# 					}
# 				}
# 				custom = RICE_every_other_guest
# 				add_opinion = {
# 					target = root
# 					modifier = RICE_granada_enjoyed_munya_vacation
# 				}
# 				add_character_modifier = {
# 					modifier = RICE_granada_vacationed_at_a_munya
# 					years = 5
# 				}
# 			}
# 		}
# 	}
# 	else_if = {
# 		limit = {
# 			var:RICE_munya_group_vacation_focus = flag:intellectual
# 		}
# 		scope:activity = {
# 			every_attending_character = {
# 				limit = {
# 					NOT = { this = root }
# 					OR = {
# 						has_trait = diligent
# 						has_trait = scholar
# 						has_trait = theologian
# 						has_trait = education_learning_1
# 						has_trait = education_learning_2
# 						has_trait = education_learning_3
# 						has_trait = education_learning_4
# 						has_trait = gregarious
# 					}
# 				}
# 				custom = RICE_every_guest_who_really_enjoyed_munya_vacation
# 				add_opinion = {
# 					target = root
# 					modifier = RICE_granada_enjoyed_munya_vacation_great
# 				}
# 				add_character_modifier = {
# 					modifier = RICE_granada_vacationed_at_a_munya
# 					years = 5
# 				}
# 			}
# 			every_attending_character = {
# 				limit = {
# 					NOT = { this = root }
# 					NOR = {
# 						has_trait = diligent
# 						has_trait = scholar
# 						has_trait = theologian
# 						has_trait = education_learning_1
# 						has_trait = education_learning_2
# 						has_trait = education_learning_3
# 						has_trait = education_learning_4
# 						has_trait = gregarious
# 					}
# 				}
# 				custom = RICE_every_other_guest
# 				add_opinion = {
# 					target = root
# 					modifier = RICE_granada_enjoyed_munya_vacation
# 				}
# 				add_character_modifier = {
# 					modifier = RICE_granada_vacationed_at_a_munya
# 					years = 5
# 				}
# 			}
# 		}
# 	}
# 	else_if = {
# 		limit = {
# 			var:RICE_munya_group_vacation_focus = flag:partying
# 		}
# 		scope:activity = {
# 			every_attending_character = {
# 				limit = {
# 					NOT = { this = root }
# 					OR = {
# 						has_trait = lustful
# 						has_trait = gregarious
# 						has_trait = lazy
# 						has_trait = gluttonous
# 						has_trait = greedy
# 					}
# 				}
# 				custom = RICE_every_guest_who_really_enjoyed_munya_vacation
# 				add_opinion = {
# 					target = root
# 					modifier = RICE_granada_enjoyed_munya_vacation_great
# 				}
# 				add_character_modifier = {
# 					modifier = RICE_granada_vacationed_at_a_munya
# 					years = 5
# 				}
# 			}
# 			every_attending_character = {
# 				limit = {
# 					NOT = { this = root }
# 					NOR = {
# 						has_trait = lustful
# 						has_trait = gregarious
# 						has_trait = lazy
# 						has_trait = gluttonous
# 						has_trait = greedy
# 					}
# 				}
# 				custom = RICE_every_other_guest
# 				add_opinion = {
# 					target = root
# 					modifier = RICE_granada_enjoyed_munya_vacation
# 				}
# 				add_character_modifier = {
# 					modifier = RICE_granada_vacationed_at_a_munya
# 					years = 5
# 				}
# 			}
# 		}
# 	}
# }


RICE_granada_transfer_to_granada_effect = {
	custom_tooltip = {
		text = RICE_title_event_granada_name_change_county_tooltip
		title:c_granada = {
			reset_title_name = yes
		}
	}
	custom_tooltip = {
		text = RICE_title_event_granada_name_change_duchy_tooltip
		title:d_granada = {
			reset_title_name = yes
		}
	}
	add_prestige = 200
	dynasty = { add_dynasty_prestige = 200 }
	title:c_granada = {
		change_development_level = 3
		add_county_modifier = {
			modifier = RICE_granada_transferred_to_granada
			years = 30
		}
		add_county_modifier = {
			modifier = RICE_granada_garnata_al_yahud_tensions
		}
	}
}


RICE_granada_tensions_resolved_peacefully_effect = {
	add_prestige = 100
	add_piety = -100
	title:c_granada = {
		change_county_control = -25
		remove_county_modifier = RICE_granada_garnata_al_yahud_tensions
		add_county_modifier = {
			modifier = RICE_granada_lingering_tensions_light
			years = 20
		}
	}
	every_courtier_or_guest = {
		limit = {
			religion = { rice_religion_trigger_judaism_religion = yes }
		}
		custom = RICE_all_jewish_courtiers_and_guests
		add_opinion = {
			target = root
			modifier = RICE_opinion_saved_me_from_mob
		}
	}
	title:c_granada = {
		add_county_modifier = {
			modifier = RICE_granada_garnata_al_yahud_jews_accepted
		}
	}
}

RICE_granada_tensions_resolved_with_force_effect = {
	add_prestige = -300
	add_piety = -300
	title:c_granada = {
		change_county_control = -50
		remove_county_modifier = RICE_granada_garnata_al_yahud_tensions
		add_county_modifier = {
			modifier = RICE_granada_lingering_tensions_high
			years = 20
		}
		add_county_modifier = {
			modifier = RICE_granada_garnata_al_yahud_jews_accepted
		}
	}
}


RICE_granada_tensions_end_in_tragedy_effect = {
	set_global_variable = {
		name = RICE_granada_pogrom_happened_like_historically
		value = yes
	}
	title:c_granada = {
		change_development_progress_with_overflow = -50
		remove_county_modifier = RICE_granada_garnata_al_yahud_tensions
		add_county_modifier = {
			modifier = RICE_granada_pogrom_happened
			years = 20
		}
	}
	scope:yusuf = {
		death = {
			death_reason = death_beaten_by_mob
		}
	}
	hidden_effect = {
		every_courtier_or_guest = {
			limit = {
				religion = { rice_religion_trigger_judaism_religion = yes }
			}
			random_list = {
				60 = {				
					death = {
						death_reason = death_beaten_by_mob
					}
				}
				40 = {
					move_to_pool = yes
				}
			}
		}
	}
}


RICE_granada_alhambra_building_cleanup_effect = {

	# Purge them in case they're still around
	#every_in_global_list = {
	#	variable  = RICE_granada_alhambra_original_constructor
	#	remove_list_global_variable = {
	#		name = RICE_granada_alhambra_original_constructor
	#		target = scope:alhambra_original_builder
	#	}
	#}

	if = {
		limit = {
			has_character_flag = RICE_alhambra_decision_original_builder
		}
		remove_character_flag = RICE_alhambra_decision_original_builder
	}

	# if = {
	# 	limit = {
	# 		has_character_flag = RICE_granada_alhambra_expansion_finished_by_original
	# 	}
	# 	remove_character_flag = RICE_granada_alhambra_expansion_finished_by_original
	# }

	if = {
		limit = {
			has_character_flag = RICE_granada_alhambra_expansion_finished_by_other
		}
		remove_character_flag = RICE_granada_alhambra_expansion_finished_by_other
	}

	
	if = {
		limit = {
			has_global_variable = RICE_granada_alhambra_building_generalife
		}
		remove_global_variable = RICE_granada_alhambra_building_generalife
	}
	if = {
		limit = {
			has_global_variable = RICE_granada_alhambra_building_house_of_worship
		}
		remove_global_variable = RICE_granada_alhambra_building_house_of_worship
	}
	if = {
		limit = {
			has_global_variable = RICE_granada_alhambra_building_rawda
		}
		remove_global_variable = RICE_granada_alhambra_building_rawda
	}
	if = {
		limit = {
			has_global_variable = RICE_granada_alhambra_building_comares_palace
		}
		remove_global_variable = RICE_granada_alhambra_building_comares_palace
	}
	if = {
		limit = {
			has_global_variable = RICE_granada_alhambra_building_court_of_the_lions
		}
		remove_global_variable = RICE_granada_alhambra_building_court_of_the_lions
	}
	if = {
		limit = {
			has_global_variable = RICE_granada_alhambra_building_generic_palatial
		}
		remove_global_variable = RICE_granada_alhambra_building_generic_palatial
	}
	if = {
		limit = {
			has_global_variable = RICE_granada_alhambra_building_generic_recreational
		}
		remove_global_variable = RICE_granada_alhambra_building_generic_recreational
	}
	if = {
		limit = {
			has_global_variable = RICE_granada_alhambra_building_generic_military
		}
		remove_global_variable = RICE_granada_alhambra_building_generic_military
	}
}

RICE_granada_almeria_silk_industry_effect = {
	add_prestige = 100
	add_character_modifier = {
		modifier = RICE_granada_invested_in_almeria_silks
	}
	title:c_almeria = {
		change_development_level = 4
		add_county_modifier = {
			modifier = RICE_granada_almeria_silk_industry
		}
	}	
}



RICE_granada_alhambra_music_effect = {
	if = {
		limit = {
			NOT = { has_game_rule = RICE_music_off }
			OR = {
				has_game_rule = RICE_music_unrestricted
				culture = {
					has_cultural_pillar = heritage_iberian
				}
				capital_province = {
					geographical_region = world_europe_west_iberia
				}
			}				
		}
		random_list = {
			10 = { play_music_cue = mx_alhambra_1 }
			10 = { play_music_cue = mx_alhambra_2 }
		}
	}
}


RICE_granada_cadiz_demolish_idol_effect = {
	title:c_cadiz = {
		remove_county_modifier = RICE_granada_tower_of_cadiz
	}
	add_gold = 300
	hidden_effect = {
		random_list = {
			50 = {
				#show_chance = no
				#desc = RICE_demolish_cadiz_idol_nothing
				#custom_tooltip = RICE_demolish_cadiz_idol_nothing
				add_character_flag = RICE_cadiz_idol_nothing
			}
			20 = {
				#show_chance = no
				#desc = RICE_demolish_cadiz_idol_character_curse
				#custom_tooltip = RICE_demolish_cadiz_idol_character_curse
				add_character_flag = RICE_cadiz_idol_curse_character_only
				hidden_effect = {
					add_character_modifier = {
						modifier = RICE_granada_cadiz_idol_character_curse
						years = 10
					}
					add_piety = -150
					add_prestige = -150
					stress_impact = {
						base = minor_stress_impact_gain
						zealous = minor_stress_impact_gain
						paranoid = minor_stress_impact_gain
						craven = minor_stress_impact_gain
					}
				}
			}
			20 = {
				#show_chance = no
				#desc = RICE_demolish_cadiz_idol_county_curse
				#custom_tooltip = RICE_demolish_cadiz_idol_county_curse
				add_character_flag = RICE_cadiz_idol_curse_county_only
				hidden_effect = {
					title:c_cadiz = {
						add_county_modifier = {
							modifier = RICE_granada_cadiz_idol_county_curse
							years = 10
						}
					}
					add_piety = -150
					add_prestige = -150
					stress_impact = {
						base = minor_stress_impact_gain
						zealous = minor_stress_impact_gain
						paranoid = minor_stress_impact_gain
						craven = minor_stress_impact_gain
					}
				}
			}
			10 = {
				#show_chance = no
				#desc = RICE_demolish_cadiz_idol_both_curse
				#custom_tooltip = RICE_demolish_cadiz_idol_both_curse
				add_character_flag = RICE_cadiz_idol_curse_both
				hidden_effect = {
					add_character_modifier = {
						modifier = RICE_granada_cadiz_idol_character_curse
						years = 10
					}
					title:c_cadiz = {
						add_county_modifier = {
							modifier = RICE_granada_cadiz_idol_county_curse
							years = 10
						}
					}
					add_piety = -300
					add_prestige = -300
					stress_impact = {
						base = medium_stress_impact_gain
						zealous = minor_stress_impact_gain
						paranoid = minor_stress_impact_gain
						craven = minor_stress_impact_gain
					}
				}
			}
		}		
	}
}




RICE_granada_munya_vacation_private_completed_log_entry_effect = {
	scope:activity = {
		add_activity_log_entry = {
			key = RICE_granada_munya_vacation_private_completed_log
			tags = { completed }
			# this line below adds the entry to the Effects section of the conclusion UI
			show_in_conclusion = yes
			character = root
			scope:host = {
				if = {
					limit = {
						scope:activity = {
							has_activity_option = {
								category = special_type
								option = RICE_granada_munya_vacation_private_type_leisure
							}
						}
					}
					if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = RICE_granada_munya_vacation_private_length
									option = RICE_granada_munya_vacation_private_length_short
								}
							}
						}
						stress_impact = {
							base = minor_stress_impact_loss
						}
					}
					else_if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = RICE_granada_munya_vacation_private_length
									option = RICE_granada_munya_vacation_private_length_medium
								}
							}
						}
						stress_impact = {
							base = medium_stress_impact_loss
						}
					}
					else_if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = RICE_granada_munya_vacation_private_length
									option = RICE_granada_munya_vacation_private_length_long
								}
							}
						}
						stress_impact = {
							base = major_stress_impact_loss
						}
					}
				}
				else = {
					if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = RICE_granada_munya_vacation_private_length
									option = RICE_granada_munya_vacation_private_length_short
								}
							}
						}
						stress_impact = {
							base = miniscule_stress_impact_loss
						}
					}
					else_if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = RICE_granada_munya_vacation_private_length
									option = RICE_granada_munya_vacation_private_length_medium
								}
							}
						}
						stress_impact = {
							base = minor_stress_impact_loss
						}
					}
					else_if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = RICE_granada_munya_vacation_private_length
									option = RICE_granada_munya_vacation_private_length_long
								}
							}
						}
						stress_impact = {
							base = medium_stress_impact_loss
						}
					}
				}
				if = {
					limit = {
						scope:activity.activity_location = {
							has_holding = no
						}
					}
					stress_impact = {
						base = medium_stress_impact_loss
					}
				}
				if = {
					limit = {
						has_activity_intent = RICE_granada_munya_vacation_private_relaxation_intent
					}
					stress_impact = {
						base = minor_stress_impact_loss
						shy = miniscule_stress_impact_loss
						lazy = miniscule_stress_impact_loss
					}
				}
				else_if = {
					limit = {
						has_activity_intent = RICE_granada_munya_vacation_private_reflection_intent
					}
					RICE_major_lifestyle_experience_gain_effect = yes
					stress_impact = {
						diligent = miniscule_stress_impact_loss
					}
					random_list = {
						75 = { }
						5 = { add_diplomacy_skill = 1 }
						5 = { add_martial_skill = 1 }
						5 = { add_stewardship_skill = 1 }
						5 = { add_intrigue_skill = 1 }
						5 = { add_learning_skill = 1 }					
					}
				}
				else_if = {
					limit = {
						has_activity_intent = RICE_granada_munya_vacation_private_exploration_intent
					}
					add_prestige = 100
					stress_impact = {
						brave = miniscule_stress_impact_loss
					}
					add_character_modifier = {
						modifier = RICE_granada_explored_munya
						years = 10
					}
				}
				add_character_modifier = {
					modifier = RICE_granada_vacationed_at_a_munya
					years = 5
				}
			}
		}
	}
}


RICE_granada_munya_vacation_private_farms_log_entry_effect = {
	scope:activity = {
		add_activity_log_entry = {
			key = RICE_granada_munya_vacation_private_farms_log
			tags = { good }
			# this line below adds the entry to the Effects section of the conclusion UI
			show_in_conclusion = yes
			character = root
			scope:host = {			
				random_list = {
					15 = { add_stewardship_lifestyle_xp = minor_lifestyle_xp }
					30 = { add_stewardship_lifestyle_xp = medium_lifestyle_xp }
					15 = { add_stewardship_lifestyle_xp = major_lifestyle_xp }
					15 = { add_learning_lifestyle_xp = minor_lifestyle_xp }
					30 = { add_learning_lifestyle_xp = medium_lifestyle_xp }
					15 = { add_learning_lifestyle_xp = major_lifestyle_xp }
				}
				random = {
					chance = 20
					modifier = {
						stewardship >= mediocre_skill_rating
						add = 4
					}
					modifier = {
						stewardship >= medium_skill_rating
						add = 4
					}
					modifier = {
						stewardship >= decent_skill_rating
						add = 4
					}
					modifier = {
						stewardship >= high_skill_rating
						add = 4
					}
					modifier = {
						learning >= mediocre_skill_rating
						add = 4
					}
					modifier = {
						learning >= medium_skill_rating
						add = 4
					}
					modifier = {
						learning >= decent_skill_rating
						add = 4
					}
					modifier = {
						learning >= high_skill_rating
						add = 4
					}
					send_interface_toast = {
						left_icon = ROOT
						title = granada.0062.a.title
						every_held_title = {
							limit = {
								tier = tier_county
							}
							add_county_modifier = {
								modifier = RICE_granada_munya_insights_farmland
								years = 10
							}	
						}
					}
				}
			}
		}
	}
}

RICE_granada_munya_vacation_private_food_log_entry_effect = {
	scope:activity = {
		add_activity_log_entry = {
			key = RICE_granada_munya_vacation_private_food_log
			tags = { good }
			# this line below adds the entry to the Effects section of the conclusion UI
			show_in_conclusion = yes
			character = root
			scope:host = {
				random_list = {
					15 = { add_stewardship_lifestyle_xp = minor_lifestyle_xp }
					30 = { add_stewardship_lifestyle_xp = medium_lifestyle_xp }
					15 = { add_stewardship_lifestyle_xp = major_lifestyle_xp }
					15 = { add_learning_lifestyle_xp = minor_lifestyle_xp }
					30 = { add_learning_lifestyle_xp = medium_lifestyle_xp }
					15 = { add_learning_lifestyle_xp = major_lifestyle_xp }
				}
				random = {
					chance = 20
					modifier = {
						stewardship >= mediocre_skill_rating
						add = 4
					}
					modifier = {
						stewardship >= medium_skill_rating
						add = 4
					}
					modifier = {
						stewardship >= decent_skill_rating
						add = 4
					}
					modifier = {
						stewardship >= high_skill_rating
						add = 4
					}
					modifier = {
						learning >= mediocre_skill_rating
						add = 4
					}
					modifier = {
						learning >= medium_skill_rating
						add = 4
					}
					modifier = {
						learning >= decent_skill_rating
						add = 4
					}
					modifier = {
						learning >= high_skill_rating
						add = 4
					}
					send_interface_toast = {
						left_icon = ROOT
						title = granada.0062.b.title
						add_character_modifier = {
							modifier = RICE_granada_munya_insights_foodstuffs
							years = 10
						}
					}
				}
			}
		}
	}
}

RICE_granada_munya_vacation_private_plants_log_entry_effect = {
	scope:activity = {
		add_activity_log_entry = {
			key = RICE_granada_munya_vacation_private_plants_log
			tags = { good }
			# this line below adds the entry to the Effects section of the conclusion UI
			show_in_conclusion = yes
			character = root
			scope:host = {
				random_list = {
					15 = { add_diplomacy_lifestyle_xp = minor_lifestyle_xp }
					30 = { add_diplomacy_lifestyle_xp = medium_lifestyle_xp }
					15 = { add_diplomacy_lifestyle_xp = major_lifestyle_xp }
					15 = { add_intrigue_lifestyle_xp = minor_lifestyle_xp }
					30 = { add_intrigue_lifestyle_xp = medium_lifestyle_xp }
					15 = { add_intrigue_lifestyle_xp = major_lifestyle_xp }
				}
				random = {
					chance = 20
					modifier = {
						intrigue >= mediocre_skill_rating
						add = 4
					}
					modifier = {
						intrigue >= medium_skill_rating
						add = 4
					}
					modifier = {
						intrigue >= decent_skill_rating
						add = 4
					}
					modifier = {
						intrigue >= high_skill_rating
						add = 4
					}
					modifier = {
						diplomacy >= mediocre_skill_rating
						add = 4
					}
					modifier = {
						diplomacy >= medium_skill_rating
						add = 4
					}
					modifier = {
						diplomacy >= decent_skill_rating
						add = 4
					}
					modifier = {
						diplomacy >= high_skill_rating
						add = 4
					}
					send_interface_toast = {
						left_icon = ROOT
						title = granada.0063.a.title
						add_character_modifier = {
							modifier = RICE_granada_munya_insights_ornamental_plants
							years = 10
						}
					}
				}
			}
		}
	}
}

RICE_granada_munya_vacation_private_medicine_log_entry_effect = {
	scope:activity = {
		add_activity_log_entry = {
			key = RICE_granada_munya_vacation_private_medicine_log
			tags = { good }
			# this line below adds the entry to the Effects section of the conclusion UI
			show_in_conclusion = yes
			character = root
			scope:host = {
				random_list = {
					15 = { add_diplomacy_lifestyle_xp = minor_lifestyle_xp }
					30 = { add_diplomacy_lifestyle_xp = medium_lifestyle_xp }
					15 = { add_diplomacy_lifestyle_xp = major_lifestyle_xp }
					15 = { add_intrigue_lifestyle_xp = minor_lifestyle_xp }
					30 = { add_intrigue_lifestyle_xp = medium_lifestyle_xp }
					15 = { add_intrigue_lifestyle_xp = major_lifestyle_xp }
				}
				random = {
					chance = 20
					modifier = {
						intrigue >= mediocre_skill_rating
						add = 4
					}
					modifier = {
						intrigue >= medium_skill_rating
						add = 4
					}
					modifier = {
						intrigue >= decent_skill_rating
						add = 4
					}
					modifier = {
						intrigue >= high_skill_rating
						add = 4
					}
					modifier = {
						diplomacy >= mediocre_skill_rating
						add = 4
					}
					modifier = {
						diplomacy >= medium_skill_rating
						add = 4
					}
					modifier = {
						diplomacy >= decent_skill_rating
						add = 4
					}
					modifier = {
						diplomacy >= high_skill_rating
						add = 4
					}
					send_interface_toast = {
						left_icon = ROOT
						title = granada.0063.b.title
						add_character_modifier = {
							modifier = RICE_granada_munya_insights_medicine
							years = 10
						}
					}
				}
			}
		}
	}
}

RICE_granada_munya_vacation_private_chill_log_entry_effect = {
	scope:activity = {
		add_activity_log_entry = {
			key = RICE_granada_munya_vacation_private_chill_log
			tags = { good }
			# this line below adds the entry to the Effects section of the conclusion UI
			show_in_conclusion = yes
			character = root
			scope:host = {
				random = {
					chance = 20
					modifier = {
						has_trait = shy
						add = 5
					}
					modifier = {
						has_trait = content
						add = 5
					}
					modifier = {
						has_trait = lazy
						add = 5
					}
					modifier = {
						has_trait = patient
						add = 5
					}
					modifier = {
						has_trait = calm
						add = 5
					}
					send_interface_toast = {
						left_icon = ROOT
						title = granada.0064.a.title
						add_character_modifier = {
							modifier = RICE_granada_munya_well_rested
							years = 10
						}
					}
				}
			}
		}
	}
}


RICE_granada_munya_vacation_group_completed_log_entry_effect = {
	scope:activity = {
		add_activity_log_entry = {
			key = RICE_granada_munya_vacation_group_completed_log
			tags = { completed }
			# this line below adds the entry to the Effects section of the conclusion UI
			show_in_conclusion = yes
			character = root
			scope:host = {
				if = {
					limit = {						
						scope:activity = {
							has_activity_option = {
								category = RICE_granada_munya_vacation_group_length
								option = RICE_granada_munya_vacation_group_length_short
							}
						}
					}
					if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_party
								}
							}
						}
						add_prestige = 80
					}
					else_if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_gardens
								}
							}
						}
						add_prestige = 40
						add_piety = 40
					}
					else_if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_poetry
								}
							}
						}
						add_piety = 80
					}
					stress_impact = {
						base = miniscule_stress_impact_loss
					}
				}
				else_if = {
					limit = {						
						scope:activity = {
							has_activity_option = {
								category = RICE_granada_munya_vacation_group_length
								option = RICE_granada_munya_vacation_group_length_medium
							}
						}
					}
					
					if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_party
								}
							}
						}
						add_prestige = 160
					}
					else_if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_gardens
								}
							}
						}
						add_prestige = 80
						add_piety = 80
					}
					else_if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_poetry
								}
							}
						}
						add_piety = 160
					}
					stress_impact = {
						base = minor_stress_impact_loss
					}
				}
				else_if = {
					limit = {						
						scope:activity = {
							has_activity_option = {
								category = RICE_granada_munya_vacation_group_length
								option = RICE_granada_munya_vacation_group_length_long
							}
						}
					}
					
					if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_party
								}
							}
						}
						add_prestige = 240
					}
					else_if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_gardens
								}
							}
						}
						add_prestige = 120
						add_piety = 120
					}
					else_if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_poetry
								}
							}
						}
						add_piety = 240
					}
					stress_impact = {
						base = medium_stress_impact_loss
					}
				}
				add_character_modifier = {
					modifier = RICE_granada_vacationed_at_a_munya
					years = 5
				}
			}
			every_attending_character = {
				limit = { NOT = { this = scope:host } }
				custom = EVERY_ACTIVITY_PARTICIPANT_EFFECT
				if = {
					limit = {						
						scope:activity = {
							has_activity_option = {
								category = RICE_granada_munya_vacation_group_length
								option = RICE_granada_munya_vacation_group_length_short
							}
						}
					}					
					if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_party
								}
							}
						}
						add_prestige = 40
					}
					else_if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_gardens
								}
							}
						}
						add_prestige = 20
						add_piety = 20
					}
					else_if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_poetry
								}
							}
						}
						add_piety = 40
					}
					stress_impact = {
						base = miniscule_stress_impact_loss
					}
				}
				else_if = {
					limit = {						
						scope:activity = {
							has_activity_option = {
								category = RICE_granada_munya_vacation_group_length
								option = RICE_granada_munya_vacation_group_length_medium
							}
						}
					}
					
					if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_party
								}
							}
						}
						add_prestige = 80
					}
					else_if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_gardens
								}
							}
						}
						add_prestige = 40
						add_piety = 40
					}
					else_if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_poetry
								}
							}
						}
						add_piety = 80
					}
					stress_impact = {
						base = minor_stress_impact_loss
					}
				}
				else_if = {
					limit = {						
						scope:activity = {
							has_activity_option = {
								category = RICE_granada_munya_vacation_group_length
								option = RICE_granada_munya_vacation_group_length_long
							}
						}
					}
					
					if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_party
								}
							}
						}
						add_prestige = 120
					}
					else_if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_gardens
								}
							}
						}
						add_prestige = 60
						add_piety = 60
					}
					else_if = {
						limit = {						
							scope:activity = {
								has_activity_option = {
									category = special_type
									option = RICE_granada_munya_vacation_group_type_poetry
								}
							}
						}
						add_piety = 120
					}
					stress_impact = {
						base = medium_stress_impact_loss
					}
				}
				add_character_modifier = {
					modifier = RICE_granada_vacationed_at_a_munya
					years = 5
				}
			}
			every_attending_character = {
				#limit = { NOT = { this = scope:host } }
				custom = RICE_every_munya_group_vacation_merriment
				stress_impact = {
					base = miniscule_stress_impact_loss
					gluttonous = miniscule_stress_impact_loss
					lustful = miniscule_stress_impact_loss
				}
			}
			if = {
				limit = {
					scope:activity.activity_location = {
						has_holding = no
					}
				}
				scope:host = {
					stress_impact = {
						base = minor_stress_impact_loss
					}
				}
			}
			every_attending_character = {
				#limit = { NOT = { this = scope:host } }
				custom = RICE_every_munya_group_vacation_reputation
				if = {
					limit = {						
						scope:activity = {
							has_activity_option = {
								category = RICE_granada_munya_vacation_group_length
								option = RICE_granada_munya_vacation_group_length_short
							}
						}
					}
					add_prestige = 25
				}
				if = {
					limit = {						
						scope:activity = {
							has_activity_option = {
								category = RICE_granada_munya_vacation_group_length
								option = RICE_granada_munya_vacation_group_length_medium
							}
						}
					}
					add_prestige = 50
				}
				if = {
					limit = {						
						scope:activity = {
							has_activity_option = {
								category = RICE_granada_munya_vacation_group_length
								option = RICE_granada_munya_vacation_group_length_medium
							}
						}
					}
					add_prestige = 75
				}
				stress_impact = {
					ambitious = miniscule_stress_impact_loss
					arrogant = miniscule_stress_impact_loss
					diligent = miniscule_stress_impact_loss
				}
			}
			if = {
				limit = {
					scope:activity = {
						has_activity_option = {
							category = special_type
							option = RICE_granada_munya_vacation_group_type_party
						}
					}
				}
				scope:activity = {
					every_attending_character = {
						limit = {
							NOT = { this = scope:host }
							OR = {
								has_trait = lustful
								has_trait = gregarious
								has_trait = lazy
								has_trait = gluttonous
								has_trait = greedy
							}
						}
						custom = RICE_every_guest_who_really_enjoyed_munya_vacation
						add_opinion = {
							target = root
							modifier = RICE_granada_enjoyed_munya_vacation_great
						}
					}
					every_attending_character = {
						limit = {
							NOT = { this = scope:host }
							NOR = {
								has_trait = lustful
								has_trait = gregarious
								has_trait = lazy
								has_trait = gluttonous
								has_trait = greedy
							}
						}
						custom = RICE_every_other_guest
						add_opinion = {
							target = root
							modifier = RICE_granada_enjoyed_munya_vacation
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:activity = {
						has_activity_option = {
							category = special_type
							option = RICE_granada_munya_vacation_group_type_gardens
						}
					}
				}
				scope:activity = {
					every_attending_character = {
						limit = {
							NOT = { this = scope:host }
							OR = {
								has_trait = shy
								has_trait = content
								has_trait = calm
								has_trait = zealous
								has_trait = patient
								has_trait = humble
								has_trait = lifestyle_gardener
							}
						}
						custom = RICE_every_guest_who_really_enjoyed_munya_vacation
						add_opinion = {
							target = root
							modifier = RICE_granada_enjoyed_munya_vacation_great
						}
					}
					every_attending_character = {
						limit = {
							NOT = { this = scope:host }
							NOR = {
								has_trait = shy
								has_trait = content
								has_trait = calm
								has_trait = zealous
								has_trait = patient
								has_trait = humble
								has_trait = lifestyle_gardener
							}
						}
						custom = RICE_every_other_guest
						add_opinion = {
							target = root
							modifier = RICE_granada_enjoyed_munya_vacation
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:activity = {
						has_activity_option = {
							category = special_type
							option = RICE_granada_munya_vacation_group_type_poetry
						}
					}
				}
				scope:activity = {
					every_attending_character = {
						limit = {
							NOT = { this = scope:host }
							OR = {
								has_trait = diligent
								has_trait = scholar
								has_trait = theologian
								has_trait = education_learning_1
								has_trait = education_learning_2
								has_trait = education_learning_3
								has_trait = education_learning_4
								has_trait = gregarious
							}
						}
						custom = RICE_every_guest_who_really_enjoyed_munya_vacation
						add_opinion = {
							target = root
							modifier = RICE_granada_enjoyed_munya_vacation_great
						}
					}
					every_attending_character = {
						limit = {
							NOT = { this = scope:host }
							NOR = {
								has_trait = diligent
								has_trait = scholar
								has_trait = theologian
								has_trait = education_learning_1
								has_trait = education_learning_2
								has_trait = education_learning_3
								has_trait = education_learning_4
								has_trait = gregarious
							}
						}
						custom = RICE_every_other_guest
						add_opinion = {
							target = root
							modifier = RICE_granada_enjoyed_munya_vacation
						}
					}
				}
			}
		}
	}
}

##### RICE culture/faith/religion references #####
RICE_change_andalusian_culture_features = {
	# Only remove if player has the relevant DLCs, to prevent Andalusians from having too few traditions
	if = {
		limit = {
			# Has Royal Court
			has_dlc_feature = hybridize_culture
			# Has Fate of Iberia
			has_dlc_feature = the_fate_of_iberia
		}
		culture:andalusian = {
			remove_culture_tradition = tradition_hit_and_run
			remove_variable = tradition_cooldown
		}
	}
	culture:andalusian = {
		add_culture_tradition = tradition_RICE_munya_estates
		remove_variable = tradition_cooldown
	}
}