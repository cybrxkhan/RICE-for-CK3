


RICE_hangzhou_erect_embankment_on_qiantang_river = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_RICE_forest_river.dds" }
	decision_group_type = major
	ai_check_interval_by_tier = {
		barony = 0
		county = 64
		duchy = 64
		kingdom = 48
		empire = 48
		hegemony = 48
	}

	#cooldown = { days = 10 } #1825
	
	desc = RICE_hangzhou_erect_embankment_on_qiantang_river_desc
	
	is_shown = {
		is_playable_character = yes
		OR = {
			has_title = title:c_hangzhou
			title:c_hangzhou = {
				squared_distance = {
					target = root.capital_province
					value <= squared_distance_medium
				}
			}
		}
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:RICE_hangzhou_king_qian_seawall_built
			}
		}
	}
	
	is_valid = {
		has_title = title:c_hangzhou
	}
	
	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	effect = {
		#Can only happen once
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:RICE_hangzhou_king_qian_seawall_built
		}
		save_scope_as = seawall_builder
		custom_tooltip = RICE_hangzhou_erect_embankment_on_qiantang_river_effect_tooltip_1
		show_as_tooltip = {
			RICE_hangzhou_erect_embankment_on_qiantang_river_effect = yes
		}
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_hangzhou_erect_embankment_on_qiantang_river_context_tooltip
		}
		if = {
			limit = {
				any_knight = {
					count >= 1
				}				
			}
			random_knight = {
				save_scope_as = archer
			}
		}
		else_if = {
			limit = {
				exists = cp:councillor_marshal
			}
			cp:councillor_marshal = {
				save_scope_as = archer
			}
		}
		trigger_event = hangzhou.0020
	}

	cost = { 
		gold = {
			value = 0
			if = {
				limit = {
					has_treasury = no
				}
				add = massive_gold_value
			}
		}
		treasury = {
			value = 0
			if = {
				limit = {
					has_treasury = yes
				}
				add = massive_gold_value
			}
		}
	}	

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 25
		modifier = {
			add = 10
			has_trait = diligent
		}
		modifier = {
			add = 10
			has_trait = just
		}
		modifier = {
			add = 5
			has_trait = compassionate
		}
		modifier = {
			add = 5
			has_trait = ambitious
		}
		modifier = {
			add = 5
			has_trait = generous
		}
	}
}

RICE_hangzhou_build_su_causeway = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_RICE_east_asian_garden.dds" }
	decision_group_type = major
	ai_check_interval_by_tier = {
		barony = 0
		county = 64
		duchy = 64
		kingdom = 48
		empire = 48
		hegemony = 48
	}

	#cooldown = { days = 10 } #1825
	
	desc = RICE_hangzhou_build_su_causeway_desc
	
	is_shown = {
		is_playable_character = yes
		OR = {
			has_title = title:c_hangzhou
			title:c_hangzhou = {
				squared_distance = {
					target = root.capital_province
					value <= squared_distance_medium
				}
			}
		}
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:RICE_hangzhou_su_causeway_built
			}
		}
	}
	
	is_valid = {
		has_title = title:c_hangzhou
	}
	
	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	effect = {
		#Can only happen once
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:RICE_hangzhou_su_causeway_built
		}
		save_scope_as = causeway_builder
		custom_tooltip = RICE_hangzhou_build_su_causeway_effect_tooltip_1
		show_as_tooltip = {
			RICE_hangzhou_build_su_causeway_effect = yes
		}
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_hangzhou_build_su_causeway_context_tooltip
		}
		trigger_event = hangzhou.8888
	}

	cost = { 
		gold = {
			value = 0
			if = {
				limit = {
					has_treasury = no
				}
				add = massive_gold_value
			}
		}
		treasury = {
			value = 0
			if = {
				limit = {
					has_treasury = yes
				}
				add = massive_gold_value
			}
		}
	}	

	ai_potential = {
		short_term_gold > major_gold_value
	}

	ai_will_do = {
		base = 25
		modifier = {
			add = 10
			has_trait = diligent
		}
		modifier = {
			add = 10
			has_trait = just
		}
		modifier = {
			add = 5
			has_trait = compassionate
		}
		modifier = {
			add = 5
			has_trait = ambitious
		}
		modifier = {
			add = 5
			has_trait = generous
		}
	}
}

RICE_hangzhou_ten_scenes_west_lake_decision = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_RICE_east_asian_garden.dds" }
	decision_group_type = major
	ai_check_interval_by_tier = {
		barony = 0
		county = 64
		duchy = 64
		kingdom = 64
		empire = 64
		hegemony = 64
	}

	#cooldown = { days = 10 } #1825
	
	desc = RICE_hangzhou_ten_scenes_west_lake_decision_desc
	
	is_shown = {
		is_playable_character = yes
		OR = {
			root.capital_county ?= {
				title_province = { geographical_region = world_asia_china }
			}
			domicile.domicile_location ?= {
				geographical_region = world_asia_china
			}
		}
		is_target_in_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:RICE_hangzhou_su_causeway_built
		}
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:RICE_hangzho_ten_scenes_west_lake_done
			}
		}
	}
	
	is_valid = {
		# Error suppression
		trigger_if = {
			limit = {
				has_variable = RICE_num_times_west_lake_visit
			}
			custom_description = {
				text = "RICE_hangzhou_west_lake_visit"
				var:RICE_num_times_west_lake_visit >= 3
			}
		}
		trigger_else = {
			custom_description = {
				text = "RICE_hangzhou_west_lake_visit"
				has_variable = RICE_num_times_west_lake_visit
			}
		}
		OR = {
			has_trait = confucian_education
			has_trait = scholar
			has_trait = lifestyle_poet
			diplomacy >= average_skill_rating
			learning >= average_skill_rating
		}
		# Capital is in China
		OR = {
			custom_description = {
				text = "RICE_china_geographical_req"
				root.capital_county ?= {
					title_province = { geographical_region = world_asia_china }
				}
			}
			custom_description = {
				text = "RICE_china_domicile_geographical_req"	
				domicile.domicile_location ?= {
					geographical_region = world_asia_china
				}
			}
		}
	}
	
	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	effect = {
		#Can only happen once
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:RICE_hangzho_ten_scenes_west_lake_done
		}
		save_scope_as = ten_scenes_promoter
		custom_tooltip = RICE_hangzhou_ten_scenes_west_lake_decision_effect_tooltip_1
		custom_tooltip = RICE_hangzhou_ten_scenes_west_lake_decision_effect_tooltip_2
		show_as_tooltip = {
			RICE_hangzhou_ten_scenes_west_lake_decision_effect = yes
		}
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_hangzhou_ten_scenes_west_lake_decision_context_tooltip
		}
		trigger_event = hangzhou.0040
	}

	cost = { 
		gold = { value = major_gold_value }
	}	

	ai_potential = {
		short_term_gold > major_gold_value
	}

	ai_will_do = {
		base = 25
		modifier = {
			add = 10
			has_trait = diligent
		}
		modifier = {
			add = 10
			has_trait = just
		}
		modifier = {
			add = 5
			has_trait = compassionate
		}
		modifier = {
			add = 5
			has_trait = ambitious
		}
		modifier = {
			add = 5
			has_trait = generous
		}
	}
}


RICE_hangzhou_dedicate_temple_to_yue_fei = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_RICE_chinese_temple.dds" }
	decision_group_type = major
	ai_check_interval_by_tier = {
		barony = 0
		county = 0
		duchy = 64
		kingdom = 48
		empire = 48
		hegemony = 48
	}

	#cooldown = { days = 10 } #1825
	
	desc = RICE_hangzhou_dedicate_temple_to_yue_fei_desc
	
	is_shown = {
		is_playable_character = yes
		game_start_date >= 1162.1.1 # Year Yue Fei was rehabilitated
		top_liege = {
			OR = {
				has_title = title:c_hangzhou
				any_vassal_or_below = {
					has_title = title:c_hangzhou
				}
			}
		}
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:RICE_hangzhou_yue_fei_temple_built
			}
		}
	}
	
	is_valid = {
		has_title = title:c_hangzhou
		highest_held_title_tier >= tier_kingdom
		culture = { has_cultural_pillar = heritage_chinese }
		faith = { has_doctrine = special_doctrine_immaterial_harmony }
	}
	
	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	effect = {
		#Can only happen once
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:RICE_hangzhou_yue_fei_temple_built
		}
		save_scope_as = yue_fei_temple_builder
		custom_tooltip = RICE_hangzhou_dedicate_temple_to_yue_fei_effect_tooltip_1
		show_as_tooltip = {
			RICE_hangzhou_dedicate_temple_to_yue_fei_effect = yes
		}
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_hangzhou_dedicate_temple_to_yue_fei_context_tooltip
		}
		trigger_event = hangzhou.8888
	}

	cost = { 
		gold = { value = major_gold_value }
	}	

	ai_potential = {
		short_term_gold > major_gold_value
	}

	ai_will_do = {
		base = 25
		modifier = {
			add = 10
			has_trait = diligent
		}
		modifier = {
			add = 10
			has_trait = brave
		}
		modifier = {
			add = 10
			has_trait = ambitious
		}
	}
}







RICE_hangzhou_improve_west_lake = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_RICE_east_asian_garden.dds" }
	decision_group_type = RICE_regional
	desc = RICE_hangzhou_improve_west_lake_desc

	ai_check_interval_by_tier = {
		barony = 0
		county = 64
		duchy = 64
		kingdom = 48
		empire = 48
		hegemony = 48
	}
	
	cooldown = { days = 3650 }

	is_shown = {
		is_playable_character = yes
		OR = {
			has_title = title:c_hangzhou
			title:c_hangzhou = {
				squared_distance = {
					target = root.capital_province
					value <= squared_distance_medium
				}
			}
		}
	}

	is_valid = {
		has_title = title:c_hangzhou
		custom_description = {
			text = RICE_hangzhou_recently_improved_west_lake_req
			title:c_hangzhou = {
				NOR = {
					has_county_modifier = RICE_hangzhou_west_lake_dredging_modifier
					has_county_modifier = RICE_hangzhou_west_lake_patrols_modifier
					has_county_modifier = RICE_hangzhou_west_lake_repairs_modifier
					has_county_modifier = RICE_hangzhou_west_lake_landscaping_modifier
					has_county_modifier = RICE_hangzhou_west_lake_religious_structures_modifier
				}
			}
		}
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	cost = {
		gold = RICE_activity_cost
	}
	
	ai_potential = {
		short_term_gold > RICE_activity_cost
	}

	widget = {
		gui = "decision_view_widget_RICE_hangzhou_improve_west_lake"
		controller = decision_option_list_controller
		decision_to_second_step_button = "RICE_HANGZHOU_IMPROVE_WEST_LAKE_PICK_TYPE"
		show_from_start = yes
		
		### Dredge Silt (Basic upgrade)
		item = {
			value = RICE_hangzhou_improve_west_lake_dredge_silt
			current_description = RICE_hangzhou_improve_west_lake_dredge_silt_desc
			localization = RICE_hangzhou_improve_west_lake_dredge_silt_name
			icon = "gfx/interface/icons/widgets/RICE_portage_maintain_hauling_sites.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### Increase Patrols (Basic upgrade)
		item = {
			value = RICE_hangzhou_improve_west_lake_patrols
			current_description = RICE_hangzhou_improve_west_lake_patrols_desc
			localization = RICE_hangzhou_improve_west_lake_patrols_name
			icon = "gfx/interface/icons/court_position_types/grand_guardian_court_position.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### Repair Existing Infrastructure (Basic upgrade)
		item = {
			value = RICE_hangzhou_improve_west_lake_repairs
			current_description = RICE_hangzhou_improve_west_lake_repairs_desc
			localization = RICE_hangzhou_improve_west_lake_repairs_name
			icon = "gfx/interface/icons/message_feed/great_project.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### Landscaping
		item = {
			value = RICE_hangzhou_improve_west_lake_landscaping
			is_valid = {
				gold >= medium_gold_value				
			}
			current_description = RICE_hangzhou_improve_west_lake_landscaping_desc
			localization = RICE_hangzhou_improve_west_lake_landscaping_name
			icon = "gfx/interface/icons/court_position_types/court_gardener_court_position.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### Religious Structures
		item = {
			value = RICE_hangzhou_improve_west_lake_religious_structures
			is_valid = {
				gold >= medium_gold_value
			}
			current_description = RICE_hangzhou_improve_west_lake_religious_structures_desc
			localization = RICE_hangzhou_improve_west_lake_religious_structures_name
			icon = "gfx/interface/icons/great_projects/city_china.dds"
			ai_chance = {
				value = 10
			}
		}

	}

	effect = {

		custom_tooltip = RICE_hangzhou_improve_west_lake_effect_tooltip_1
		
		# Not sure why AI can't pick one option or another
		if = {
			limit = {
				is_ai = yes
			}
			random_list = {
				10 = {
					set_variable = {
						name = RICE_west_lake_improvement_type
						value = flag:dredge
						days = 1
					}
				}
				10 = {
					set_variable = {
						name = RICE_west_lake_improvement_type
						value = flag:patrols
						days = 1
					}
				}
				10 = {
					set_variable = {
						name = RICE_west_lake_improvement_type
						value = flag:repairs
						days = 1
					}
				}
				10 = {
					set_variable = {
						name = RICE_west_lake_improvement_type
						value = flag:landscaping
						days = 1
					}
				}
				10 = {
					set_variable = {
						name = RICE_west_lake_improvement_type
						value = flag:religious
						days = 1
					}
				}
			}
		}

		else_if = {
			limit = { scope:RICE_hangzhou_improve_west_lake_dredge_silt = yes }
			set_variable = {
				name = RICE_west_lake_improvement_type
				value = flag:dredge
				days = 1
			}
			show_as_tooltip = {
				RICE_hangzhou_improve_west_lake_dredging_effect = yes
			}
		}

		else_if = {
			limit = { scope:RICE_hangzhou_improve_west_lake_patrols = yes }
			set_variable = {
				name = RICE_west_lake_improvement_type
				value = flag:patrols
				days = 1
			}
			show_as_tooltip = {
				RICE_hangzhou_improve_west_lake_patrols_effect = yes
			}
		}

		else_if = {
			limit = { scope:RICE_hangzhou_improve_west_lake_repairs = yes }
			set_variable = {
				name = RICE_west_lake_improvement_type
				value = flag:repairs
				days = 1
			}
			show_as_tooltip = {
				RICE_hangzhou_improve_west_lake_repairs_effect = yes
			}
		}

		else_if = {
			limit = { scope:RICE_hangzhou_improve_west_lake_landscaping = yes }
			set_variable = {
				name = RICE_west_lake_improvement_type
				value = flag:landscaping
				days = 1
			}
			custom_tooltip = RICE_hangzhou_improve_west_lake_effect_tooltip_2
			show_as_tooltip = {
				RICE_hangzhou_improve_west_lake_landscaping_effect = yes
			}
		}

		else_if = {
			limit = { scope:RICE_hangzhou_improve_west_lake_religious_structures = yes }
			set_variable = {
				name = RICE_west_lake_improvement_type
				value = flag:religious
				days = 1
			}
			custom_tooltip = RICE_hangzhou_improve_west_lake_effect_tooltip_2
			show_as_tooltip = {
				RICE_hangzhou_improve_west_religious_structures_effect = yes
			}
		}
		

		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_hangzhou_improve_west_lake_context_tooltip
		}
		
		trigger_event = hangzhou.0021

		# add_to_list = notification_sent
	}

	minimum_cost = {
		gold = minor_gold_value
	}

	ai_potential = {
		short_term_gold > medium_gold_value
	}

	ai_will_do = {
		base = 50
		modifier = {
			add = 10
			has_trait = diligent
		}
		modifier = {
			add = -10
			has_trait = lazy
		}
		modifier = {
			add = 10
			has_trait = ambitious
		}
		modifier = {
			add = -10
			has_trait = callous
		}
		modifier = {
			add = 10
			has_trait = generous
		}
		modifier = {
			add = -10
			has_trait = greedy
		}
		modifier = {
			add = 10
			has_trait = just
		}
		modifier = {
			add = -10
			has_trait = arbitrary
		}
	}
}
