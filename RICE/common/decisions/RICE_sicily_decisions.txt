
#############################################
#											#
# STRUGGLE ENDING DECISIONS				    #
#											#
#############################################

# Dominion Ending
RICE_sicily_struggle_ending_dominion_decision = {
	decision_group_type = major
	title = RICE_sicily_struggle_ending_dominion_decision
	picture = { reference = "gfx/interface/illustrations/decisions/decision_mediterranean_throne_room.dds" }
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_mediterranean_throne_room_small.dds"
	desc = RICE_sicily_struggle_ending_dominion_decision_desc
	selection_tooltip = RICE_sicily_struggle_ending_dominion_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		exists = struggle:RICE_sicily_struggle

		custom_tooltip = {
			text = RICE_sicily_struggle_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = RICE_sicily_struggle
			}
		}

		completely_controls_region = custom_sicily

		dynasty ?= {
			has_dynasty_perk = RICE_sicily_legacy_5
		}

	}

	widget = {
		gui = "decision_view_widget_RICE_sicily_dominion_ending"
		controller = decision_option_list_controller
		decision_to_second_step_button = "RICE_SICILY_PICK_DOMINION_ENDING_TYPE"
		show_from_start = yes
		
		### LATIN
		item = {
			value = RICE_sicily_struggle_ending_dominion_latin
			is_valid = {
				custom_description = {
					text = RICE_sicily_latin_world_req	
					RICE_sicily_latin_trigger = yes
				}
				has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_latin value >= 25 }
			}
			current_description = RICE_sicily_struggle_ending_dominion_latin_desc
			localization = RICE_sicily_struggle_ending_dominion_latin_name
			icon = "gfx/interface/icons/icon_RICE_sicily_latin.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### GREEK
		item = {
			value = RICE_sicily_struggle_ending_dominion_greek
			is_valid = {
				custom_description = {
					text = RICE_sicily_greek_world_req	
					RICE_sicily_greek_trigger = yes
				}
				has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_greek value >= 25 }
			}
			current_description = RICE_sicily_struggle_ending_dominion_greek_desc
			localization = RICE_sicily_struggle_ending_dominion_greek_name
			icon = "gfx/interface/icons/icon_RICE_sicily_greek.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### ARAB-BERBER
		item = {
			value = RICE_sicily_struggle_ending_dominion_arabic
			is_valid = {
				custom_description = {
					text = RICE_sicily_arabic_world_req	
					RICE_sicily_arabic_trigger = yes
				}
				has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_arabic value >= 25 }
			}
			current_description = RICE_sicily_struggle_ending_dominion_arabic_desc
			localization = RICE_sicily_struggle_ending_dominion_arabic_name
			icon = "gfx/interface/icons/icon_RICE_sicily_arabic.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### OUTSIDER
		item = {
			value = RICE_sicily_struggle_ending_dominion_outsider
			is_valid = {
				prestige_level >= 3
				custom_description = {
					text = RICE_NOT_sicily_latin_world_req	
					RICE_sicily_latin_trigger = no
				}
				custom_description = {
					text = RICE_NOT_sicily_greek_world_req	
					RICE_sicily_greek_trigger = no
				}
				custom_description = {
					text = RICE_NOT_sicily_arabic_world_req	
					RICE_sicily_arabic_trigger = no
				}
			}
			current_description = RICE_sicily_struggle_ending_dominion_outsider_desc
			localization = RICE_sicily_struggle_ending_dominion_outsider_name
			icon = "gfx/interface/icons/icon_RICE_sicily_default.dds"
			ai_chance = {
				value = 10
			}
		}

	}

	effect = {
		if = {
			limit = { has_dlc_feature = legends }
			RICE_sicily_legend_seed_dominion_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = RICE_sicily_struggle
			}
		}
		if = {
			limit = { has_ach_dlc_trigger = yes }
			add_character_flag = ach_ended_struggle
		}
		save_scope_as = RICE_sicily_struggle_ender

		##### Major Effects #####		
		
		set_global_variable = {
			name = RICE_sicily_struggle_ending_dominion
			value = yes
		}

		RICE_sicily_ending_dominion_victor_effects = yes

		if = {
			limit = { scope:RICE_sicily_struggle_ending_dominion_latin = yes }
			RICE_sicily_struggle_ending_dominion_latin_modifier_effects = yes
		}

		else_if = {
			limit = { scope:RICE_sicily_struggle_ending_dominion_greek = yes }
			RICE_sicily_struggle_ending_dominion_greek_modifier_effects = yes		
		}

		else_if = {
			limit = { scope:RICE_sicily_struggle_ending_dominion_arabic = yes }
			RICE_sicily_struggle_ending_dominion_arabic_modifier_effects = yes		
		}

		else_if = {
			limit = { scope:RICE_sicily_struggle_ending_dominion_outsider = yes }
			RICE_sicily_struggle_ending_dominion_outsider_modifier_effects = yes				
		}

		# Permanent Ending
		custom_tooltip = RICE_sicily_struggle_ending_permanent_effect_tt
	

		# Trigger the ending event
		every_ruler = {
			limit = {
				OR = {
					this = scope:RICE_sicily_struggle_ender
					is_ai = no
				}
				RICE_sicily_does_this_player_care_about_the_sicilian_struggle = yes
			}
			trigger_event = sicily.0005
		}
	}

	cost = {}

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}



# Crossroads Ending
RICE_sicily_struggle_ending_crossroads_decision = {
	decision_group_type = major
	title = RICE_sicily_struggle_ending_crossroads_decision
	picture = { reference = "gfx/interface/illustrations/decisions/decision_middle_eastern_tavern.dds" }
	extra_picture = "gfx/interface/illustrations/struggle_decisions_buttons/decision_middle_eastern_tavern_small.dds"
	desc = RICE_sicily_struggle_ending_crossroads_decision_desc
	selection_tooltip = RICE_sicily_struggle_ending_crossroads_decision_tooltip
	confirm_click_sound = "event:/DLC/FP2/SFX/UI/fp2_struggle_ending_decision_confirm"
	is_invisible = yes

	sort_order = 80

	is_valid = {
		is_independent_ruler = yes

		exists = struggle:RICE_sicily_struggle

		custom_tooltip = {
			text = RICE_sicily_struggle_correct_involvement_tt
			any_character_struggle = {
				involvement = involved
				is_struggle_type = RICE_sicily_struggle
			}
		}

		prestige_level >= 3

		dynasty ?= {
			has_dynasty_perk = RICE_sicily_legacy_5
		}

		has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_latin value >= 25 }
		has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_greek value >= 25 }
		has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_arabic value >= 25 }

		OR = {
			AND = {
				completely_controls_region = custom_sicily
				custom_tooltip = {
					text = RICE_sicily_struggle_ending_crossroads_development_lower_tt
					NOT = {
						capital_county.duchy = {
							any_in_de_jure_hierarchy = {
								tier = tier_county
								development_level < RICE_sicily_crossroads_ending_development_level_lower
							}
						}
					}
				}
			}
			AND = {
				# Have at least 60 dev in each county of your capital's de jure duchy
				custom_tooltip = {
					text = RICE_sicily_struggle_ending_crossroads_development_higher_tt
					NOT = {
						capital_county.duchy = {
							any_in_de_jure_hierarchy = {
								tier = tier_county
								development_level < RICE_sicily_crossroads_ending_development_level_higher
							}
						}
					}
				}
				calc_true_if = {
					amount >= 2
					completely_controls = title:d_sicily
					completely_controls = title:d_apulia
					completely_controls = title:d_benevento 
					completely_controls = title:d_capua
					completely_controls = title:d_salerno
					completely_controls = title:d_calabria
				}
			}
		}

	}

	effect = {
		if = {
			limit = { has_dlc_feature = legends }
			RICE_sicily_legend_seed_crossroads_struggle_ending_effect = {
				ENDER = root
				STRUGGLE = RICE_sicily_struggle
			}
		}
		save_scope_as = RICE_sicily_struggle_ender
		if = {
			limit = { has_ach_dlc_trigger = yes }
			add_character_flag = ach_ended_struggle
		}
		##### Major Effects #####		
		
		set_global_variable = {
			name = RICE_sicily_struggle_ending_crossroads
			value = yes
		}

		RICE_sicily_ending_crossroads_victory_effects = yes
		RICE_sicily_struggle_ending_crossroads_modifier_effects = yes

		# Permanent Ending
		custom_tooltip = RICE_sicily_struggle_ending_permanent_effect_tt
	

		# Trigger the ending event
		every_ruler = {
			limit = {
				OR = {
					this = scope:RICE_sicily_struggle_ender
					is_ai = no
				}
				RICE_sicily_does_this_player_care_about_the_sicilian_struggle = yes
			}
			trigger_event = sicily.0006
		}
	}

	cost = {}

	ai_check_interval = 120

	ai_potential = { always = yes }

	ai_will_do = { base = 100 }
}


#############################################
#											#
# STRUGGLE START DECISIONS				    #
#											#
#############################################



# Occupy Sicilian Frontier
RICE_sicily_occupy_sicilian_frontier = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_RICE_mediterranean_coast.dds" }

	desc = RICE_sicily_occupy_sicilian_frontier_desc
	selection_tooltip = RICE_sicily_occupy_sicilian_frontier_tooltip
	decision_group_type = RICE_sicily_struggle_major

	ai_check_interval = 24

	is_shown = {	
		has_game_rule = RICE_struggle_sicily_toggle_on
		# Do not enable it if TFE is running
		NOT = { exists = culture:soissons }
		NOT = { exists = struggle:RICE_sicily_struggle }
		exists = dynasty
		highest_held_title_tier > tier_barony
		is_landed = yes
		# Owns territory in Sicily or one of the surrounding regions
		any_held_title = {
			tier = tier_county
			any_county_province = {
				OR = {
					#geographical_region = custom_sicily		
					geographical_region = world_europe_south
					geographical_region = world_europe_west_iberia
					geographical_region = world_africa_north
				}	
			}
		}
		OR = {
			has_global_variable = RICE_sicily_struggle_ending_periphery
			has_global_variable = RICE_sicily_struggle_ending_imperial
		}
		NOT = { has_global_variable = RICE_sicily_struggle_resetting_temp }
	}
	
	is_valid = {
		# Struggle did not recently end
		custom_description = {
			text = "RICE_sicily_NOT_recent_struggle_ended_req"
			NOT = {
				has_global_variable = RICE_sicily_temporary_ending_timer
			}
		}		
		# Capital is NOT in Sicily
		custom_description = {
			text = "RICE_sicily_NOT_capital_req"
			NOT = {
				root.capital_county = {
					title_province = { geographical_region = custom_sicily }
				}
			}
		}		
		# Own at least 4 counties in Sicily
		custom_tooltip = {
			text = RICE_sicily_start_struggle_geographical_req
			any_sub_realm_county = {
				count >= 4
				title_province = { geographical_region = custom_sicily }
			}
		}
		# Own at least 8 counties overall
		sub_realm_size >= 8
		OR = {
			trigger_if = {
				limit = {
					is_ai = yes
				}
				prestige_level >= 1
			}
			trigger_else = {
				prestige_level >= 3
			}
			custom_description = {
				text = "is_king_or_emperor"
				highest_held_title_tier >= tier_kingdom
			}
		}
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	effect = {

		set_global_variable = {
			name = RICE_sicily_struggle_resetting_temp
			value = yes
			days = 1
		}

		save_scope_as = sicily_struggle_restarter

		custom_tooltip = RICE_sicily_occupy_sicilian_frontier_effect_tooltip_1
		custom_tooltip = RICE_sicily_occupy_sicilian_frontier_effect_tooltip_2
		custom_tooltip = RICE_sicily_occupy_sicilian_frontier_effect_tooltip_3
		custom_tooltip = RICE_restart_sicily_struggle_make_cultures_faiths_involved_effect_tooltip

		custom_tooltip = RICE_sicily_culture_faith_now_involved_desc

		show_as_tooltip = {
			RICE_sicily_occupy_sicilian_frontier_effect = yes
		}

		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_sicily_occupy_sicilian_frontier_context_tooltip
		}

		hidden_effect = {
			every_ruler = {
				limit = {
					OR = {
						this = scope:sicily_struggle_restarter
						any_held_title = {
							tier = tier_county
							any_county_province = {
								OR = { # Is in relevant region
									geographical_region = world_europe_south
									geographical_region = world_europe_west_francia
									geographical_region = world_asia_minor
									geographical_region = world_europe_west_iberia
									geographical_region = world_africa_north
									geographical_region = world_africa_sahara
									geographical_region = world_middle_east_jerusalem
								}		
							}
						}
					}
				}
				trigger_event = {
					id = sicily.0010
				}
			}		
		}


	}

	cost = { 
		gold = medium_gold_value # Will depend
	}	

	ai_potential = {
		gold > medium_gold_value
	}

	ai_will_do = {
		base = 40
		# Culture is not one of the dominant ones?
		# modifier = {
		# 	add = -30
		# 	NOT = { culture = { has_cultural_pillar = heritage_north_germanic } }
		# }
		modifier = {
			add = -10
			has_trait = content
		}
		modifier = {
			add = 10
			has_trait = ambitious
		}
	}
}

# Revitalize Sicilian Frontier
RICE_sicily_stabilize_sicilian_frontier = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_RICE_mediterranean_coast.dds" }

	desc = RICE_sicily_stabilize_sicilian_frontier_desc
	selection_tooltip = RICE_sicily_stabilize_sicilian_frontier_tooltip
	decision_group_type = RICE_sicily_struggle_major

	ai_check_interval = 24

	is_shown = {	
		has_game_rule = RICE_struggle_sicily_toggle_on
		# Do not enable it if TFE is running
		NOT = { exists = culture:soissons }
		NOT = { exists = struggle:RICE_sicily_struggle }
		exists = dynasty
		highest_held_title_tier > tier_barony
		is_landed = yes
		# Owns territory in Sicily or one of the surrounding regions
		any_held_title = {
			tier = tier_county
			any_county_province = {
				OR = {
					#geographical_region = custom_sicily		
					geographical_region = world_europe_south
					geographical_region = world_europe_west_iberia
					geographical_region = world_africa_north
				}	
			}
		}
		OR = {
			has_global_variable = RICE_sicily_struggle_ending_periphery
			has_global_variable = RICE_sicily_struggle_ending_imperial
		}
		NOT = { has_global_variable = RICE_sicily_struggle_resetting_temp }
	}
	
	is_valid = {
		# Struggle did not recently end
		custom_description = {
			text = "RICE_sicily_NOT_recent_struggle_ended_req"
			NOT = {
				has_global_variable = RICE_sicily_temporary_ending_timer
			}
		}
		# Capital is in Sicily
		custom_description = {
			text = "RICE_sicily_capital_req"
			root.capital_county = {
				title_province = { geographical_region = custom_sicily }
			}
		}		
		# Own at least 4 counties in Sicily
		custom_tooltip = {
			text = RICE_sicily_start_struggle_geographical_req
			any_sub_realm_county = {
				count >= 4
				title_province = { geographical_region = custom_sicily }
			}
		}
		# Own at least 5 counties overall
		sub_realm_size >= 5
		OR = {
			trigger_if = {
				limit = {
					is_ai = yes
				}
				prestige_level >= 1
			}
			trigger_else = {
				prestige_level >= 3
			}
			custom_description = {
				text = "is_king_or_emperor"
				highest_held_title_tier >= tier_kingdom
			}
		}
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	effect = {

		set_global_variable = {
			name = RICE_sicily_struggle_resetting_temp
			value = yes
			days = 1
		}

		save_scope_as = sicily_struggle_restarter

		custom_tooltip = RICE_sicily_stabilize_sicilian_frontier_effect_tooltip_1
		custom_tooltip = RICE_sicily_stabilize_sicilian_frontier_effect_tooltip_2
		custom_tooltip = RICE_sicily_stabilize_sicilian_frontier_effect_tooltip_3
		custom_tooltip = RICE_restart_sicily_struggle_make_cultures_faiths_involved_effect_tooltip

		custom_tooltip = RICE_sicily_culture_faith_now_involved_desc

		show_as_tooltip = {
			RICE_sicily_stabilize_sicilian_frontier_effect = yes
		}

		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_sicily_stabilize_sicilian_frontier_context_tooltip
		}

		hidden_effect = {
			every_ruler = {
				limit = {
					OR = {
						this = scope:sicily_struggle_restarter
						any_held_title = {
							tier = tier_county
							any_county_province = {
								OR = { # Is in relevant region
									geographical_region = world_europe_south
									geographical_region = world_europe_west_francia
									geographical_region = world_asia_minor
									geographical_region = world_europe_west_iberia
									geographical_region = world_africa_north
									geographical_region = world_africa_sahara
									geographical_region = world_middle_east_jerusalem
								}		
							}
						}
					}
				}
				trigger_event = {
					id = sicily.0011
				}
			}		
		}

	}

	cost = { 
		gold = medium_gold_value # Will depend
	}	

	ai_potential = {
		gold > medium_gold_value
	}

	ai_will_do = {
		base = 40
		# Culture is not one of the dominant ones?
		# modifier = {
		# 	add = -30
		# 	NOT = { culture = { has_cultural_pillar = heritage_north_germanic } }
		# }
		modifier = {
			add = -10
			has_trait = content
		}
		modifier = {
			add = 10
			has_trait = ambitious
		}
	}
}




#############################################
#											#
# MISCELLANEOUS DECISIONS  					#
#											#
#############################################


RICE_sicily_embed_into_sicily = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_RICE_mediterranean_coast.dds" }
	desc = RICE_sicily_embed_into_sicily_desc
	decision_group_type = RICE_sicily_struggle_major

	ai_check_interval = 64
	
	#cooldown = { days = 3650 }

	is_shown = {
		is_playable_character = yes
		NOT = { is_landed = yes }
		NOT = { has_trait = RICE_sicilian_ruler }
		domicile.domicile_location ?= {
			geographical_region = custom_sicily
		}
	}

	is_valid = {
		prestige_level >= 2
		custom_description = {
			text = RICE_domicile_sicily_county_req
			domicile.domicile_location ?= {
				geographical_region = custom_sicily
			}
		}	
		OR = {		
			prestige_level >= 4	
			custom_description = {
				text = RICE_sicily_latin_world_req	
				RICE_sicily_latin_trigger = yes
			}
			custom_description = {
				text = RICE_sicily_greek_world_req	
				RICE_sicily_greek_trigger = yes
			}
			custom_description = {
				text = RICE_sicily_arabic_world_req	
				RICE_sicily_arabic_trigger = yes
			}
		}
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	cost = {
		gold = minor_gold_value
		prestige = medium_prestige_value
	}
	
	ai_potential = {
		short_term_gold > minor_gold_value
		prestige > medium_prestige_value
	}

	effect = {

		show_as_tooltip = {
			RICE_sicily_landless_get_trait_effect = yes
		}

		custom_tooltip = RICE_sicily_embed_into_sicily_effect_tooltip_1
		#custom_tooltip = RICE_sicily_embed_into_sicily_effect_tooltip_2
		
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_sicily_embed_into_sicily_context_tooltip
		}
		
		trigger_event = sicily.0233

	}

	ai_will_do = {
		base = 30
		modifier = {
			add = 10
			has_trait = ambitious
		}
		modifier = {
			add = -10
			has_trait = lazy
		}
		modifier = {
			add = -25
			NOR = {
				RICE_sicily_latin_trigger = yes
				RICE_sicily_greek_trigger = yes
				RICE_sicily_arabic_trigger = yes
			}
		}
	}
}

RICE_sicily_second_pavia_decision = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_ck2_prospering_province.dds" }
	decision_group_type = RICE_sicily_struggle_major
	desc = RICE_sicily_second_pavia_decision_desc

	ai_check_interval = 64

	is_shown = {
		NOT = { has_global_variable = RICE_game_started_on_TFE_start_date }
		is_landed = yes
		# culture = {
		# 	OR = {
		# 		this = culture:langobard
		# 		any_parent_culture_or_above = {
		# 			this = culture:langobard
		# 		}
		# 	}
		# }
		root.capital_county = {
			title_province = { geographical_region = custom_sicily }
		}
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:RICE_sicily_second_pavia_decision_flag
			}
		}
	}

	is_valid = {
		is_independent_ruler = yes
		prestige_level >= 3
		culture = {
			has_cultural_tradition = tradition_RICE_longbeards
		}
		# Not tribal - vanilla localization is bugged atm
		custom_description = {
			text = RICE_not_tribal_government_req
			NOT = { government_has_flag = government_is_tribal }
		}	
		# Langobard or descended from Langobard culture
		# custom_description = {
		# 	text = RICE_lombard_culture_req
		# 	culture = {
		# 		OR = {
		# 			this = culture:langobard
		# 			any_parent_culture_or_above = {
		# 				this = culture:langobard
		# 			}
		# 		}
		# 	}
		# }		
		custom_tooltip = {
			text = RICE_sicily_pavia_capital_development_req
			capital_county = {
				development_level >= RICE_sicily_pavia_development_level
			}
		}	
		# Capital is in Sicily
		custom_description = {
			text = "RICE_sicily_capital_req"
			root.capital_county = {
				title_province = { geographical_region = custom_sicily }
			}
		}
		# Own at least 5 counties overall
		sub_realm_size >= 5
		OR = {
			completely_controls = title:d_sicily
			completely_controls = title:d_apulia
			completely_controls = title:d_benevento 
			completely_controls = title:d_capua
			completely_controls = title:d_salerno
			completely_controls = title:d_calabria
		}
	}

	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	cost = { 
		gold = { value = major_gold_value }
	}	

	ai_potential = {
		short_term_gold > major_gold_value
	}

	effect = {

		save_scope_as = second_pavia_founder

		capital_county = {
			save_scope_as = second_pavia
		}
		
		#Can only happen once
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:RICE_sicily_second_pavia_decision_flag
		}
		
		#custom_tooltip = RICE_sicily_second_pavia_decision_effect_tooltip_1
		#custom_tooltip = RICE_sicily_second_pavia_decision_effect_tooltip_2	
		
		show_as_tooltip = {
			RICE_sicily_second_pavia_decision_effect = yes			
		}

		# Trigger the ending event
		every_ruler = {
			limit = {
				OR = {
					this = scope:second_pavia_founder
					is_ai = no
				}
				OR = {
					this = scope:second_pavia_founder
					culture = {
						OR = {
							this = culture:langobard
							any_parent_culture_or_above = {
								this = culture:langobard
							}
						}
					}
					any_held_title = {
						tier = tier_county
						any_county_province = {
							geographical_region = custom_sicily
						}
					}
				}
			}
			trigger_event = sicily.0014
		}
		
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_sicily_second_pavia_decision_context_tooltip
		}

		# add_to_list = notification_sent
	}

	ai_will_do = {
		base = 100
	}
}

RICE_sicily_byzantine_syracuse_decision = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_RICE_ancient_greek_city.dds" }
	decision_group_type = RICE_sicily_struggle_major
	desc = RICE_sicily_byzantine_syracuse_decision_desc

	ai_check_interval = 64

	is_shown = {
		NOT = { has_global_variable = RICE_game_started_on_TFE_start_date }
		is_landed = yes
		OR = {
			RICE_sicily_greek_trigger = yes
			has_title = title:e_byzantium
			top_liege = { has_title = title:e_byzantium }
			has_title = title:e_roman_empire
			top_liege = { has_title = title:e_roman_empire }
		}
		root.capital_county = {
			title_province = { geographical_region = custom_sicily }
		}
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:RICE_sicily_byzantine_syracuse_decision_flag
			}
		}
	}

	is_valid = {
		RICE_sicily_greek_trigger = yes
		OR = {
			has_title = title:c_siracusa
			any_vassal_or_below = { has_title = title:c_siracusa }
		}
		OR = {
			has_title = title:d_sicily
			any_liege_or_above = {
				has_title = title:d_sicily
			}
		}
		OR = {
			completely_controls = title:d_sicily
			any_liege_or_above = {
				completely_controls = title:d_sicily
			}
		}
		OR = {
			has_title = title:e_byzantium
			top_liege = { has_title = title:e_byzantium }
			has_title = title:e_roman_empire
			top_liege = { has_title = title:e_roman_empire }
		}
		# Not tribal - vanilla localization is bugged atm
		custom_description = {
			text = RICE_not_tribal_government_req
			NOT = { government_has_flag = government_is_tribal }
		}
	}

	is_valid_showing_failures_only = {
		is_available_adult = yes
	}

	cost = { 
		gold = { value = major_gold_value }
	}	

	ai_potential = {
		short_term_gold > major_gold_value
	}

	effect = {

		save_scope_as = syracuse_restorer

		capital_county = {
			save_scope_as = second_pavia
		}
		
		#Can only happen once
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:RICE_sicily_byzantine_syracuse_decision_flag
		}
		
		show_as_tooltip = {
			RICE_sicily_byzantine_syracuse_decision_effect = yes			
		}

		# Trigger the ending event
		every_ruler = {
			limit = {
				OR = {
					this = scope:syracuse_restorer
					is_ai = no
				}
				OR = {
					this = scope:syracuse_restorer
					RICE_sicily_greek_trigger = yes
					has_title = title:e_byzantium
					top_liege = { has_title = title:e_byzantium }
					has_title = title:e_roman_empire
					top_liege = { has_title = title:e_roman_empire }
					# any_character_struggle = {
					# 	involvement = involved
					# 	is_struggle_type = RICE_sicily_struggle
					# }	
					any_held_title = {
						tier = tier_county
						any_county_province = {
							OR = {
								geographical_region = world_europe_south
								geographical_region = world_europe_west_iberia
								geographical_region = world_africa_north
								geographical_region = world_africa_sahara
								geographical_region = world_asia_minor
								geographical_region = world_europe_west_francia
							}		
						}
					}
				}
			}
			trigger_event = sicily.0230
		}
		
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_sicily_byzantine_syracuse_decision_context_tooltip
		}

		# add_to_list = notification_sent
	}

	ai_will_do = {
		base = 100
	}
}



RICE_sicily_admirals_bridge_decision = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_ck2_castle_tower.dds" }
	decision_group_type = RICE_sicily_struggle_major
	desc = RICE_sicily_admirals_bridge_decision_desc

	ai_check_interval = 60

	is_shown = {
		NOT = { has_global_variable = RICE_game_started_on_TFE_start_date }
		is_landed = yes
		has_title = title:c_palermo
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:RICE_sicily_admirals_bridge_built
			}
		}
	}

	is_valid = {
		has_title = title:c_palermo
		prestige_level >= 3
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	cost = {
		gold = {
			value = major_gold_value
		}
		prestige = {
			value = medium_prestige_value
		}
	}

	effect = {
		#Can only happen once
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:RICE_sicily_admirals_bridge_built
		}
		
		save_scope_as = admirals_bridge_builder

		show_as_tooltip = {
			RICE_sicily_build_admirals_bridge_effect = yes
		}
		
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_sicily_admirals_bridge_decision_context_tooltip
		}
		
		trigger_event = sicily.0017

		# add_to_list = notification_sent
	}

	ai_will_do = {
		base = 30
		modifier = {
			add = 10
			has_trait = diligent
		}
		modifier = {
			add = -10
			has_trait = lazy
		}
		modifier = {
			add = 10
			has_trait = ambitious
		}
		modifier = {
			add = -10
			has_trait = content
		}
	}
}

RICE_sicily_catania_elephant_decision = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_RICE_ancient_greek_city.dds" }
	decision_group_type = RICE_sicily_struggle_major
	desc = RICE_sicily_catania_elephant_decision_desc

	ai_check_interval = 60

	is_shown = {
		NOT = { has_global_variable = RICE_game_started_on_TFE_start_date }
		is_landed = yes
		has_title = title:c_messina
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:RICE_sicily_catania_elephant_decision_done
			}
		}
	}

	is_valid = {
		has_title = title:c_messina
		OR = {
			prestige_level >= 3
			piety_level >= 3
		}
		culture = {
			OR = {
				has_cultural_era_or_later = culture_era_high_medieval
				has_innovation = innovation_royal_prerogative
			}
		}
		custom_tooltip = {
			text = RICE_sicily_messina_development_req
			title:c_messina = {
				development_level >= RICE_sicily_pavia_development_level
			}
		}	
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	cost = {
		gold = {
			value = medium_gold_value
		}
	}

	effect = {
		#Can only happen once
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:RICE_sicily_catania_elephant_decision_done
		}
		
		#save_scope_as = catania_statue_builder

		show_as_tooltip = {
			RICE_sicily_catania_statue_decision_effect = yes
		}
		
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_sicily_catania_elephant_decision_context_tooltip
		}
		
		trigger_event = sicily.0231
	}

	ai_will_do = {
		base = 30
		modifier = {
			add = 10
			has_trait = diligent
		}
		modifier = {
			add = -10
			has_trait = lazy
		}
		modifier = {
			add = 10
			has_trait = humble
		}
		modifier = {
			add = -10
			has_trait = arrogant
		}
	}
}





RICE_sicily_support_salerno_medical_school = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_ck2_scientific_experiment.dds" }
	desc = RICE_sicily_support_salerno_medical_school_desc
	decision_group_type = RICE_sicily_struggle
	ai_check_interval = 64
	
	cooldown = { days = 3650 }

	is_shown = {
		NOT = { has_global_variable = RICE_game_started_on_TFE_start_date }
		OR = {
			AND = {
				is_landed = yes
				any_held_county = {
					any_county_province = {
						geographical_region = custom_sicily
					}
				}
			}
			AND = {				
				is_landless_ruler = yes
				location = {
					geographical_region = custom_sicily
				}
			}
		}
	}
	is_valid = {
		OR = {
			AND = {
				is_landed = yes
				custom_description = {
					text = RICE_own_sicily_county
					any_held_county = {
						any_county_province = {
							geographical_region = custom_sicily
						}
					}
				}
			}
			AND = {				
				is_landless_ruler = yes
				custom_description = {
					text = RICE_location_sicily_county
					location = {
						geographical_region = custom_sicily
					}
				}
			}
		}
		title:c_salerno = {
			has_county_modifier = RICE_sicily_salerno_medical_school_modifier
		}	
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	cost = {
		gold = RICE_sicily_medical_salerno_decision_cost
	}
	
	ai_potential = {
		short_term_gold > RICE_sicily_medical_salerno_decision_cost
	}

	effect = {

		show_as_tooltip = {
			RICE_sicily_salerno_medical_school_decision_effect = yes
		}

		custom_tooltip = RICE_sicily_support_salerno_medical_school_effect_tooltip_1
		custom_tooltip = RICE_sicily_support_salerno_medical_school_effect_tooltip_2
		
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_sicily_support_salerno_medical_school_context_tooltip
		}
		
		trigger_event = sicily.0140

		# add_to_list = notification_sent
	}

	ai_will_do = {
		base = 30
		modifier = {
			add = 10
			has_trait = diligent
		}
		modifier = {
			add = -10
			has_trait = lazy
		}
		modifier = {
			add = 10
			has_trait = compassionate
		}
		modifier = {
			add = -10
			has_trait = callous
		}
		modifier = {
			add = 10
			has_trait = generous
		}
		modifier = {
			add = -10
			has_trait = greedy
		}
	}
}

# Sortes Vergilianae
RICE_sicily_virgil_divination_decision = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_ck2_carolingian_script_cm.dds" }
	desc = RICE_sicily_virgil_divination_decision_desc
	#decision_group_type = RICE_regional
	ai_check_interval = 40
	
	cooldown = { days = 3650 }

	is_shown = {
		is_playable_character = yes
		OR = {
			RICE_is_greco_roman_religion_group_trigger = yes
			AND = {
				OR = {
					root.capital_county ?= {
						title_province = { geographical_region = custom_roman_full_borders }
					}
					domicile.domicile_location ?= {
						geographical_region = custom_roman_full_borders
					}
				}
				OR = {
					learning >= medium_skill_rating	
					has_trait = scholar
					has_trait = theologian
					has_trait = lifestyle_mystic
				}				
			}
			has_character_flag = RICE_sicily_can_do_virgil_divination
		}
	}

	is_valid = {
		OR = {
			RICE_is_greco_roman_religion_group_trigger = yes
			custom_description = {
				text = "RICE_sicily_virgil_divination_decision_activity_req"
				has_character_flag = RICE_sicily_can_do_virgil_divination
			}
			AND = {		
				# Capital is in the former Roman Empire
				OR = {
					custom_description = {
						text = "RICE_old_roman_empire_geographical_req"
						root.capital_county ?= {
							title_province = { geographical_region = custom_roman_full_borders }
						}
					}
					custom_description = {
						text = "RICE_old_roman_empire_domicile_geographical_req"
						domicile.domicile_location ?= {
							geographical_region = custom_roman_full_borders
						}
					}
				}
				OR = {
					learning >= medium_skill_rating	
					has_trait = scholar
					has_trait = theologian
					has_trait = lifestyle_mystic
				}
			}
		}
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	cost = { 
		gold = { value = minor_gold_value }
	}	
	
	ai_potential = {
		short_term_gold > minor_gold_value
	}

	effect = {

		add_piety = minor_piety_gain

		custom_tooltip = RICE_sicily_virgil_divination_decision_effect_tooltip_1
		custom_tooltip = RICE_sicily_virgil_divination_decision_effect_tooltip_2
		custom_tooltip = RICE_sicily_virgil_divination_decision_effect_tooltip_3
		
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_sicily_virgil_divination_decision_context_tooltip
		}
		
		trigger_event = sicily.0123

		# add_to_list = notification_sent
	}

	ai_will_do = {
		base = 30
		modifier = {
			add = 10
			has_trait = diligent
		}
		modifier = {
			add = -10
			has_trait = lazy
		}
		modifier = {
			add = 10
			has_trait = compassionate
		}
		modifier = {
			add = -10
			has_trait = callous
		}
		modifier = {
			add = 10
			has_trait = generous
		}
		modifier = {
			add = -10
			has_trait = greedy
		}
	}
}



# Sponsor the Liber pantegni
# RICE_sicily_sponsor_liber_pantegni = {
# 	picture = { reference = "gfx/interface/illustrations/decisions/decision_RICE_european_book.dds" }

# 	desc = RICE_sicily_sponsor_liber_pantegni_desc
# 	selection_tooltip = RICE_sicily_sponsor_liber_pantegni_tooltip
# 	decision_group_type = major

# 	ai_check_interval = 24

# 	is_shown = {
# 		exists = dynasty
# 		highest_held_title_tier > tier_barony
# 		is_landed = yes
# 		NOT = {
# 			is_target_in_global_variable_list = {
# 				name = unavailable_unique_decisions
# 				target = flag:RICE_normandy_commission_normandy_history
# 			}
# 		}
# 		OR = {
# 			AND = {
# 				exists = struggle:RICE_normandy_struggle
# 				OR = {
# 					any_character_struggle = {
# 						involvement = involved
# 						is_struggle_type = RICE_normandy_struggle
# 					}					
# 					any_character_struggle = {
# 						involvement = interloper
# 						is_struggle_type = RICE_normandy_struggle
# 					}
# 				}
# 			}
# 			any_held_title = {
# 				tier = tier_county
# 				any_county_province = {
# 					geographical_region = RICE_normandy_region	
# 				}
# 			}
# 		}
# 		# OR = {
# 		# 	culture = culture:norman
# 		# 	culture = {
# 		# 		any_parent_culture_or_above = {
# 		# 			this = culture:norman
# 		# 		}
# 		# 	}
# 		# 	dynasty = {
# 		# 		has_dynasty_modifier = RICE_normandy_rollo_family_equivalent
# 		# 	}
# 		# }
# 	}
	
# 	is_valid = {
# 		has_title = title:d_normandy
# 		completely_controls = title:d_normandy
# 		OR = {
# 			culture = culture:norman
# 			culture = {
# 				any_parent_culture_or_above = {
# 					this = culture:norman
# 				}
# 			}
# 			dynasty = {
# 				has_dynasty_modifier = RICE_normandy_rollo_family_equivalent
# 			}
# 		}
# 		OR = {
# 			prestige_level >= 4
# 			dynasty = {
# 				dynasty_prestige_level >= 3
# 			}
# 		}
# 		OR = {
# 			custom_tooltip = {
# 				text = RICE_normandy_struggle_assimilation_decision_correct_phase_tt
# 				struggle:RICE_normandy_struggle ?= {
# 					is_struggle_phase = struggle_RICE_normandy_phase_acculturation
# 				}
# 			}	
# 			AND = {
# 				learning >= medium_skill_rating
# 				prestige_level >= 3
# 			}		
# 		}
# 	}

# 	is_valid_showing_failures_only = {
# 		is_available_adult = yes
# 	}

# 	effect = {		

# 		culture:norman = {
# 			save_scope_as = norman
# 		}

# 		culture:french = {
# 			save_scope_as = french
# 		}

# 		culture:norse = {
# 			save_scope_as = norse
# 		}

# 		#Can only happen once
# 		add_to_global_variable_list = {
# 			name = unavailable_unique_decisions
# 			target = flag:RICE_normandy_commission_normandy_history
# 		}

# 		custom_tooltip = RICE_sicily_sponsor_liber_pantegni_effect_tooltip_1
# 		custom_tooltip = RICE_sicily_sponsor_liber_pantegni_effect_tooltip_2
# 		custom_tooltip = RICE_sicily_sponsor_liber_pantegni_effect_tooltip_3
# 		custom_tooltip = RICE_sicily_sponsor_liber_pantegni_effect_tooltip_4
# 		custom_tooltip = RICE_sicily_sponsor_liber_pantegni_effect_tooltip_5

# 		if = {
# 			limit = {
# 				has_game_rule = RICE_historical_context_on
# 			}
# 			custom_tooltip = RICE_sicily_sponsor_liber_pantegni_context_tooltip
# 		}

# 		trigger_event = {
# 			id = normandy.0110
# 		}

# 	}

# 	cost = { 
# 		gold = medium_gold_value # Will depend
# 	}	

# 	ai_potential = {
# 		gold > medium_gold_value
# 	}

# 	ai_will_do = {
# 		base = 50
# 		modifier = {
# 			add = -5
# 			has_trait = content
# 		}
# 		modifier = {
# 			add = 5
# 			has_trait = ambitious
# 		}
# 		modifier = {
# 			add = -5
# 			has_trait = craven
# 		}
# 		modifier = {
# 			add = 5
# 			has_trait = brave
# 		}
# 		modifier = {
# 			add = 25
# 			# Happened late 900s IRL
# 			current_date >= 950.1.1
# 		}
# 		modifier = {
# 			add = 50
# 			# Happened late 900s IRL
# 			current_date >= 975.1.1
# 		}
# 		modifier = {
# 			add = 75
# 			# Happened late 900s IRL
# 			current_date >= 1000.1.1
# 		}
# 		modifier = {
# 			add = 100
# 			# Happened late 900s IRL
# 			current_date >= 1025.1.1
# 		}
# 		modifier = {
# 			add = 100
# 			# Happened late 900s IRL
# 			current_date >= 1050.1.1
# 		}
# 	}
# }




#############################################
#											#
# MISCELLANEOUS STRUGGLE-RELATED DECISIONS  #
#											#
#############################################



RICE_sicily_bargain_with_stronghold = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_RICE_mediterranean_coast.dds" }
	desc = RICE_sicily_bargain_with_stronghold_desc
	decision_group_type = RICE_sicily_struggle
	ai_check_interval = 40
	
	cooldown = { years = 5 }

	is_shown = {
		NOT = { has_global_variable = RICE_game_started_on_TFE_start_date }
		is_landed = yes
		any_held_county = {
			any_county_province = {
				geographical_region = custom_sicily
			}
		}
	}

	is_valid = {

		# culture = {
		# 	has_innovation = innovation_scorpio
		# }
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	
	widget = {
		gui = "decision_view_widget_RICE_sicily_bargain_with_stronghold"
		controller = decision_option_list_controller
		decision_to_second_step_button = "RICE_SICILY_PICK_STRONGHOLD_TYPE"
		show_from_start = yes
		
		### LATIN
		item = {
			value = RICE_sicily_bargain_with_stronghold_choose_latin
			is_valid = {	
				custom_description = {
					text = RICE_any_latin_stronghold_county_sicily		
					any_held_county = {
						has_county_modifier = RICE_sicily_stronghold_latin
					}			
				}	
			}
			current_description = RICE_sicily_bargain_with_stronghold_choose_latin_desc
			localization = RICE_sicily_bargain_with_stronghold_choose_latin_name
			icon = "gfx/interface/icons/modifiers/RICE_sicily_latin.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### GREEK
		item = {
			value = RICE_sicily_bargain_with_stronghold_choose_greek
			is_valid = {
				custom_description = {
					text = RICE_any_greek_stronghold_county_sicily		
					any_held_county = {
						has_county_modifier = RICE_sicily_stronghold_greek
					}	
				}
			}
			current_description = RICE_sicily_bargain_with_stronghold_choose_greek_desc
			localization = RICE_sicily_bargain_with_stronghold_choose_greek_name
			icon = "gfx/interface/icons/modifiers/RICE_sicily_greek.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### ARAB-BERBER
		item = {
			value = RICE_sicily_bargain_with_stronghold_choose_arabic
			is_valid = {
				custom_description = {
					text = RICE_any_arabic_stronghold_county_sicily					
					any_held_county = {
						has_county_modifier = RICE_sicily_stronghold_arabic
					}
				}
			}
			current_description = RICE_sicily_bargain_with_stronghold_choose_arabic_desc
			localization = RICE_sicily_bargain_with_stronghold_choose_arabic_name
			icon = "gfx/interface/icons/modifiers/RICE_sicily_arabic.dds"
			ai_chance = {
				value = 10
			}
		}
	}

	minimum_cost = {
		gold = RICE_sicily_stronghold_bargain_min_bottom_value
	}
	
	ai_potential = {
		short_term_gold > RICE_sicily_stronghold_bargain_min_base_value
	}

	effect = {

		add_prestige = medium_prestige_gain

		if = {
			limit = { scope:RICE_sicily_bargain_with_stronghold_choose_latin = yes }
			custom_tooltip = RICE_sicily_bargain_with_stronghold_latin_effect_tooltip_1
			custom_tooltip = RICE_sicily_bargain_with_stronghold_latin_effect_tooltip_2
			set_variable = {
				name = RICE_sicily_bargain_type
				value = flag:latin
				days = 1
			}
		}

		else_if = {
			limit = { scope:RICE_sicily_bargain_with_stronghold_choose_greek = yes }
			custom_tooltip = RICE_sicily_bargain_with_stronghold_greek_effect_tooltip_1
			custom_tooltip = RICE_sicily_bargain_with_stronghold_greek_effect_tooltip_2
			set_variable = {
				name = RICE_sicily_bargain_type
				value = flag:greek
				days = 1
			}
		}

		else_if = {
			limit = { scope:RICE_sicily_bargain_with_stronghold_choose_arabic = yes }
			custom_tooltip = RICE_sicily_bargain_with_stronghold_arabic_effect_tooltip_1
			custom_tooltip = RICE_sicily_bargain_with_stronghold_arabic_effect_tooltip_2
			set_variable = {
				name = RICE_sicily_bargain_type
				value = flag:arabic
				days = 1
			}
		}

		custom_tooltip = RICE_sicily_bargain_with_stronghold_effect_tooltip_1

		trigger_event = sicily.0030


	}

	ai_will_do = {
		base = 30
		modifier = {
			add = 10
			has_trait = diligent
		}
	}
}



RICE_sicily_recruit_soldiers_decision = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_ck2_battle_scene.dds" }
	desc = RICE_sicily_recruit_soldiers_decision_desc
	decision_group_type = RICE_sicily_struggle
	ai_check_interval = 40
	
	cooldown = { years = 10 }

	is_shown = {
		NOT = { has_global_variable = RICE_game_started_on_TFE_start_date }
		is_landed = yes
		any_held_county = {
			any_county_province = {
				geographical_region = custom_sicily
			}
		}
	}

	is_valid = {

	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	
	widget = {
		gui = "decision_view_widget_generic_multichoice_with_effects"
		controller = decision_option_list_controller
		decision_to_second_step_button = "RICE_SICILY_PICK_SOLDIER_TYPE"
		show_from_start = yes
		
		### LATIN
		item = {
			value = RICE_sicily_recruit_soldiers_choose_latin
			is_valid = {	
				trigger_if = {
					limit = {
						struggle:RICE_sicily_struggle ?= {
							is_struggle_phase = struggle_RICE_sicily_phase_borderland
						}
					}
					has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_latin value >= 25 }		
				}	
				trigger_else = {
					has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_latin value >= 50 }
				}	
				custom_description = {
					text = RICE_any_latin_trigger_or_stronghold_sicily	
					OR = {		
						RICE_sicily_latin_trigger = yes		
						any_held_county = {
							has_county_modifier = RICE_sicily_stronghold_latin
						}
						has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_latin value >= 75 }
					}
				}		
				# OR = {
				# 	has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_latin value >= 75 }
				# 	custom_description = {
				# 		text = RICE_sicily_latin_world_req					
				# 		RICE_sicily_latin_trigger = yes
				# 	}
				# 	custom_description = {
				# 		text = RICE_any_latin_stronghold_county_sicily					
				# 		any_held_county = {
				# 			has_county_modifier = RICE_sicily_stronghold_latin
				# 		}
				# 	}
				# }
			}
			current_description = RICE_sicily_recruit_soldiers_choose_latin_desc
			localization = RICE_sicily_recruit_soldiers_choose_latin_name
			icon = "gfx/interface/icons/modifiers/RICE_sicily_latin.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### GREEK
		item = {
			value = RICE_sicily_recruit_soldiers_choose_greek
			is_valid = {
				trigger_if = {
					limit = {
						struggle:RICE_sicily_struggle ?= {
							is_struggle_phase = struggle_RICE_sicily_phase_borderland
						}
					}
					has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_greek value >= 25 }	
				}	
				trigger_else = {
					has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_greek value >= 50 }
				}
				custom_description = {
					text = RICE_any_greek_trigger_or_stronghold_sicily	
					OR = {		
						RICE_sicily_greek_trigger = yes		
						any_held_county = {
							has_county_modifier = RICE_sicily_stronghold_greek
						}
						has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_greek value >= 75 }
					}
				}
				# OR = {
				# 	has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_greek value >= 75 }
				# 	custom_description = {
				# 		text = RICE_sicily_greek_world_req					
				# 		RICE_sicily_greek_trigger = yes
				# 	}		
				# 	custom_description = {
				# 		text = RICE_any_greek_stronghold_county_sicily					
				# 		any_held_county = {
				# 			has_county_modifier = RICE_sicily_stronghold_greek
				# 		}
				# 	}
				# }
			}
			current_description = RICE_sicily_recruit_soldiers_choose_greek_desc
			localization = RICE_sicily_recruit_soldiers_choose_greek_name
			icon = "gfx/interface/icons/modifiers/RICE_sicily_greek.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### ARAB-BERBER
		item = {
			value = RICE_sicily_recruit_soldiers_choose_arabic
			is_valid = {
				trigger_if = {
					limit = {
						struggle:RICE_sicily_struggle ?= {
							is_struggle_phase = struggle_RICE_sicily_phase_borderland
						}
					}
					has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_arabic value >= 25 }	
				}	
				trigger_else = {
					has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_arabic value >= 50 }	
				}			
				custom_description = {
					text = RICE_any_arabic_trigger_or_stronghold_sicily	
					OR = {		
						RICE_sicily_arabic_trigger = yes		
						any_held_county = {
							has_county_modifier = RICE_sicily_stronghold_arabic
						}
						has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_arabic value >= 75 }
					}
				}
				# OR = {
				# 	has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_arabic value >= 75 }
				# 	custom_description = {
				# 		text = RICE_sicily_arabic_world_req					
				# 		RICE_sicily_arabic_trigger = yes
				# 	}
				# 	custom_description = {
				# 		text = RICE_any_arabic_stronghold_county_sicily					
				# 		any_held_county = {
				# 			has_county_modifier = RICE_sicily_stronghold_arabic
				# 		}
				# 	}
				# }
			}
			current_description = RICE_sicily_recruit_soldiers_choose_arabic_desc
			localization = RICE_sicily_recruit_soldiers_choose_arabic_name
			icon = "gfx/interface/icons/modifiers/RICE_sicily_arabic.dds"
			ai_chance = {
				value = 10
			}
		}
	}

	cost = {
		gold = { value = medium_gold_value }
		prestige = { value = major_prestige_value }
	}
	
	ai_potential = {
		short_term_gold > medium_gold_value
	}

	effect = {

		if = {
			limit = {
				has_character_modifier = RICE_sicily_aspiration_establish_islam_in_southern_italy
				NOT = { has_character_flag = RICE_sawdan_sicily_soldier_decision_taken }
			}

			add_character_flag = RICE_sawdan_sicily_soldier_decision_taken
			
		}


		#custom_tooltip = RICE_sicily_recruit_soldiers_decision_effect_tooltip_1

		if = {
			limit = { scope:RICE_sicily_recruit_soldiers_choose_latin = yes }
			set_variable = {
				name = RICE_sicily_soldier_type
				value = flag:latin
				days = 1
			}
			RICE_sicily_recruit_latin_soldiers_effect = yes
		}

		else_if = {
			limit = { scope:RICE_sicily_recruit_soldiers_choose_greek = yes }
			set_variable = {
				name = RICE_sicily_soldier_type
				value = flag:greek
				days = 1
			}
			RICE_sicily_recruit_greek_soldiers_effect = yes
		}

		else_if = {
			limit = { scope:RICE_sicily_recruit_soldiers_choose_arabic = yes }
			set_variable = {
				name = RICE_sicily_soldier_type
				value = flag:arabic
				days = 1
			}
			RICE_sicily_recruit_arabic_soldiers_effect = yes
		}

		trigger_event = sicily.0018

	}

	ai_will_do = {
		base = 30
		modifier = {
			add = 10
			has_trait = diligent
		}
	}
}

RICE_sicily_administer_frontier = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_RICE_mediterranean_coast.dds" }
	desc = RICE_sicily_administer_frontier_desc
	decision_group_type = RICE_sicily_struggle
	ai_check_interval = 28
	
	cooldown = { years = 5 }

	is_shown = {
		NOT = { has_global_variable = RICE_game_started_on_TFE_start_date }
		is_landed = yes
		any_held_county = {
			any_county_province = {
				geographical_region = custom_sicily
			}
		}
	}

	is_valid = {
		has_trait = RICE_sicilian_ruler
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	
	widget = {
		gui = "decision_view_widget_RICE_sicily_administer_frontier"
		controller = decision_option_list_controller
		decision_to_second_step_button = "RICE_SICILY_PICK_AGENDA_TYPE"
		show_from_start = yes
		
		### Reform Government Practices
		item = {
			value = RICE_sicily_frontier_agenda_government_practices
			is_valid = {
				diplomacy >= RICE_sicily_frontier_decision_skill_requirement
				OR = {
					is_married = yes
					custom_tooltip = {
						text = COUNCILLOR_MISSING_CHANCELLOR
						exists = cp:councillor_chancellor
					}
					custom_tooltip = {
						text = COUNCILLOR_MISSING_STEWARD
						exists = cp:councillor_steward
					}
					custom_tooltip = {
						text = COUNCILLOR_MISSING_COURT_CHAPLAIN
						exists = cp:councillor_court_chaplain
					}
				}
			}
			current_description = RICE_sicily_frontier_agenda_government_practices_desc
			localization = RICE_sicily_frontier_agenda_government_practices_name
			icon = "gfx/interface/icons/widgets/RICE_sicily_legal.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### Fortify Settlements
		item = {
			value = RICE_sicily_frontier_agenda_settlements
			is_valid = {
				martial >= RICE_sicily_frontier_decision_skill_requirement
			}
			current_description = RICE_sicily_frontier_agenda_settlements_desc
			localization = RICE_sicily_frontier_agenda_settlements_name
			icon = "gfx/interface/icons/widgets/RICE_sicily_building.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### Update Records
		item = {
			value = RICE_sicily_frontier_agenda_records
			is_valid = {
				stewardship >= RICE_sicily_frontier_decision_skill_requirement
				OR = {
					is_married = yes
					custom_tooltip = {
						text = COUNCILLOR_MISSING_CHANCELLOR
						exists = cp:councillor_chancellor
					}
					custom_tooltip = {
						text = COUNCILLOR_MISSING_STEWARD
						exists = cp:councillor_steward
					}
					custom_tooltip = {
						text = COUNCILLOR_MISSING_COURT_CHAPLAIN
						exists = cp:councillor_court_chaplain
					}
				}
			}
			current_description = RICE_sicily_frontier_agenda_records_desc
			localization = RICE_sicily_frontier_agenda_records_name
			icon = "gfx/interface/icons/widgets/RICE_sicily_book.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### Promote Officials
		item = {
			value = RICE_sicily_frontier_agenda_officials
			is_valid = {
				intrigue >= RICE_sicily_frontier_decision_skill_requirement
			}
			current_description = RICE_sicily_frontier_agenda_officials_desc
			localization = RICE_sicily_frontier_agenda_officials_name
			icon = "gfx/interface/icons/widgets/RICE_sicily_officials.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### Patronize Arts and Sciences
		item = {
			value = RICE_sicily_frontier_agenda_arts_and_sciences
			is_valid = {
				learning >= RICE_sicily_frontier_decision_skill_requirement
			}
			current_description = RICE_sicily_frontier_agenda_arts_and_sciences_desc
			localization = RICE_sicily_frontier_agenda_arts_and_sciences_name
			icon = "gfx/interface/icons/widgets/RICE_sicily_armillary_sphere.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### Attract Immigrants
		item = {
			value = RICE_sicily_frontier_agenda_immigrants
			current_description = RICE_sicily_frontier_agenda_immigrants_desc
			localization = RICE_sicily_frontier_agenda_immigrants_name
			icon = "gfx/interface/icons/widgets/RICE_sicily_immigrants.dds"
			ai_chance = {
				value = 10
			}
		}
		
		### Improve Caricatori Ports
		item = {
			value = RICE_sicily_frontier_agenda_ports
			is_valid = {
				any_held_county = {
					any_county_province = {
						geographical_region = RICE_insular_sicily
					}
				}
			}
			current_description = RICE_sicily_frontier_agenda_ports_desc
			localization = RICE_sicily_frontier_agenda_ports_name
			icon = "gfx/interface/icons/widgets/RICE_sicily_grain.dds"
			ai_chance = {
				value = 10
			}
		}

	}

	cost = {
		gold = { value = RICE_sicily_frontier_administration_value }
	}
	
	ai_potential = {
		short_term_gold > medium_gold_value
	}

	effect = {

		if = {
			limit = {
				has_character_modifier = RICE_sicily_aspiration_establish_islam_in_southern_italy
				NOT = { has_character_flag = RICE_sawdan_sicily_frontier_decision_taken }
			}

			add_character_flag = RICE_sawdan_sicily_frontier_decision_taken

			# if = {
			# 	limit = {
			# 		NOT = { has_variable = RICE_sawdan_sicily_frontier_decision_count }
			# 	}
			# 	set_variable = {
			# 		name = RICE_sawdan_sicily_frontier_decision_count
			# 		value = 1
			# 	}
			# }
			# else_if = {
			# 	limit = {
			# 		exists = var:RICE_sawdan_sicily_frontier_decision_count
			# 		var:RICE_sawdan_sicily_frontier_decision_count < 3
			# 	}		
			# 	change_variable = {
			# 		name = RICE_sawdan_sicily_frontier_decision_count
			# 		add = 1
			# 	}
			# }

		}

		if = {
			limit = {
				has_title = title:c_siracusa
				title:c_siracusa = {
					has_county_modifier = RICE_sicily_syracuse_restoration
				}
			}
			add_legitimacy = miniscule_legitimacy_gain
		}

		
		if = {
			limit = {
				is_ai = yes
			}

			random_list = {
				10 = {
					trigger = {
						diplomacy >= RICE_sicily_frontier_decision_skill_requirement
						OR = {
							is_married = yes
							exists = cp:councillor_chancellor
							exists = cp:councillor_steward
							exists = cp:councillor_court_chaplain
						}
					}
					trigger_event = sicily.0104
				}
				10 = {
					trigger = {
						martial >= RICE_sicily_frontier_decision_skill_requirement
					}
					trigger_event = sicily.0105
				}
				10 = {
					trigger = {
						stewardship >= RICE_sicily_frontier_decision_skill_requirement
						OR = {
							is_married = yes
							exists = cp:councillor_chancellor
							exists = cp:councillor_steward
							exists = cp:councillor_court_chaplain
						}
					}
					trigger_event = sicily.0103
				}
				10 = {
					trigger = {
						intrigue >= RICE_sicily_frontier_decision_skill_requirement
					}
					trigger_event = sicily.0100
				}
				10 = {
					trigger = {
						learning >= RICE_sicily_frontier_decision_skill_requirement
					}
					trigger_event = sicily.0106
				}
				# Default
				10 = {
					#trigger = {

					#}
					trigger_event = sicily.0109
				}
				10 = {
					trigger = {
						any_held_county = {
							any_county_province = {
								geographical_region = RICE_insular_sicily
							}
						}						
					}
					trigger_event = sicily.0108
				}
			}
		}

		else_if = {
			limit = { scope:RICE_sicily_frontier_agenda_government_practices = yes }
			show_as_tooltip = {
				RICE_sicily_government_practices_effect = yes
				custom_tooltip = RICE_sicily_agenda_government_practices_effect_1_tt
				custom_tooltip = RICE_sicily_agenda_government_practices_effect_2_tt
			}
			trigger_event = sicily.0104
		}

		else_if = {
			limit = { scope:RICE_sicily_frontier_agenda_settlements = yes }
			show_as_tooltip = {
				RICE_sicily_agenda_fortified_settlement_effect = yes
				custom_tooltip = RICE_sicily_fortify_settlement_effect_tt_1
				custom_tooltip = RICE_sicily_fortify_settlement_effect_tt_2
			}
			trigger_event = sicily.0105
		}

		else_if = {
			limit = { scope:RICE_sicily_frontier_agenda_records = yes }
			show_as_tooltip = {
				RICE_sicily_records_effect = yes
				custom_tooltip = RICE_sicily_frontier_agenda_records_effect_tt_1
				custom_tooltip = RICE_sicily_frontier_agenda_records_effect_tt_2
				custom_tooltip = RICE_sicily_frontier_agenda_records_effect_tt_3
			}
			trigger_event = sicily.0103
		}

		else_if = {
			limit = { scope:RICE_sicily_frontier_agenda_officials = yes }
			show_as_tooltip = {
				RICE_sicily_officials_effect = yes
				custom_tooltip = RICE_sicily_frontier_agenda_officials_effect_tt_1
				custom_tooltip = RICE_sicily_frontier_agenda_officials_effect_tt_2
			}
			trigger_event = sicily.0100
		}

		else_if = {
			limit = { scope:RICE_sicily_frontier_agenda_arts_and_sciences = yes }
			show_as_tooltip = {
				RICE_sicily_sponsor_arts_sciences_effect = yes
				custom_tooltip = RICE_sicily_frontier_agenda_arts_and_sciences_effect_tt_1
				custom_tooltip = RICE_sicily_frontier_agenda_arts_and_sciences_effect_tt_2
				custom_tooltip = RICE_sicily_frontier_agenda_arts_and_sciences_effect_tt_3
			}
			trigger_event = sicily.0106
		}

		else_if = {
			limit = { scope:RICE_sicily_frontier_agenda_immigrants = yes }
			show_as_tooltip = {
				RICE_sicily_attract_immigrants_effect = yes
				custom_tooltip = RICE_sicily_frontier_agenda_immigrants_effect_tt_1
				custom_tooltip = RICE_sicily_frontier_agenda_immigrants_effect_tt_2
				custom_tooltip = RICE_sicily_stronghold_chance_choose_generic_desc
			}
			trigger_event = sicily.0109
		}

		else_if = {
			limit = { scope:RICE_sicily_frontier_agenda_ports = yes }
			show_as_tooltip = {
				RICE_sicily_agenda_port_effect = yes
				custom_tooltip = RICE_sicily_agenda_port_effect_tt
			}
			trigger_event = sicily.0108
		}

		if = {
			limit = {
				title:c_palermo = {
					has_county_modifier = RICE_sicily_substrate_latin
				}
				RICE_sicily_latin_trigger = yes
			}
			custom_tooltip = RICE_sicily_administer_frontier_substrate_latin_effect
		}
		if = {
			limit = {
				title:c_palermo = {
					has_county_modifier = RICE_sicily_substrate_greek
				}
				RICE_sicily_greek_trigger = yes
			}
			custom_tooltip = RICE_sicily_administer_frontier_substrate_greek_effect
		}
		if = {
			limit = {
				title:c_palermo = {
					has_county_modifier = RICE_sicily_substrate_arabic
				}
				RICE_sicily_arabic_trigger = yes
			}
			custom_tooltip = RICE_sicily_administer_frontier_substrate_arabic_effect
		}

		if = {
			limit = {
				title:c_palermo = {
					has_county_modifier = RICE_sicily_ruling_class_latin
				}
				RICE_sicily_latin_trigger = yes
			}
			custom_tooltip = RICE_sicily_administer_frontier_ruling_class_latin_effect
		}
		if = {
			limit = {
				title:c_palermo = {
					has_county_modifier = RICE_sicily_ruling_class_greek
				}
				RICE_sicily_greek_trigger = yes
			}
			custom_tooltip = RICE_sicily_administer_frontier_ruling_class_greek_effect
		}
		if = {
			limit = {
				title:c_palermo = {
					has_county_modifier = RICE_sicily_ruling_class_arabic
				}
				RICE_sicily_arabic_trigger = yes
			}
			custom_tooltip = RICE_sicily_administer_frontier_ruling_class_arabic_effect
		}

		custom_tooltip = RICE_sicily_administer_frontier_effect_tooltip_1

	}

	ai_will_do = {
		base = 30
		modifier = {
			add = -10
			has_trait = lazy
		}
		modifier = {
			add = 10
			has_trait = diligent
		}
		modifier = {
			add = -10
			has_trait = content
		}
		modifier = {
			add = 10
			has_trait = ambitious
		}
	}
}




# Finance Almadraba Fishing
RICE_sicily_almadraba_decision = {
	picture = { reference = "gfx/interface/illustrations/decisions/decision_RICE_water.dds" }
	desc = RICE_sicily_almadraba_decision_desc
	decision_group_type = RICE_regional
	ai_check_interval = 40
	
	cooldown = { days = 3650 }

	is_shown = {
		highest_held_title_tier > tier_barony
		is_landed = yes
		culture = { has_innovation = innovation_RICE_almadraba }
		any_held_title = {
			tier = tier_county
			is_coastal_county = yes
		}
	}

	is_valid = {
		culture = { has_innovation = innovation_RICE_almadraba }
		custom_description = {
			text = RICE_normandy_coastal_county_req
			any_held_title = {
				tier = tier_county
				is_coastal_county = yes
			}
		}
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		RICE_is_available_adult_even_if_sick_trigger = yes
	}

	minimum_cost = {
		gold = RICE_almadraba_cost
	}
	
	ai_potential = {
		short_term_gold > RICE_almadraba_cost
	}

	effect = {

		custom_tooltip = RICE_sicily_almadraba_decision_effect_tooltip_1

		show_as_tooltip = {
			RICE_sicily_almadraba_decision_effect = yes
		}
		
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = RICE_sicily_almadraba_decision_context_tooltip
		}
		
		trigger_event = sicily.0232

		# add_to_list = notification_sent
	}

	ai_will_do = {
		base = 30
		modifier = {
			add = 10
			has_trait = ambitious
		}
		modifier = {
			add = -10
			has_trait = lazy
		}
		modifier = {
			add = 10
			has_trait = greedy
		}
		modifier = {
			add = -10
			has_trait = generous
		}
		modifier = {
			add = 10
			has_trait = just
		}
		modifier = {
			add = -10
			has_trait = arbitrary
		}
	}
}


