###############################################################################
# 
# SICILY
# 
# sicily.0000-sicily.0019			Setup events, history events, miscellaneous events and decisions
# sicily.0020-sicily.0029			Casus Bellis and other warfare related stuff
# sicily.0030-sicily.0049			Sicily Strongholds
# sicily.0050-sicily.0059			Sicily Grain
# sicily.0060-sicily.0089			Starting situation/aspiration events
# sicily.0090-sicily.0099			Baths of Baia
# sicily.0100-sicily.0119			Administer Frontier Decision
# sicily.0120-sicily.0129			Virgil Flavor
# sicily.0130-sicily.0139			Palermo Tomb Visit
# sicily.0140-sicily.0149			Salerno Medical School
# sicily.0150-sicily.0169			Monte Gargano Pilgrimage
# sicily.0170-sicily.0179			Courtier Spawn
# sicily.0180-sicily.0199			Other Historical Events
# sicily.0200-sicily.0229			Generic events
# 
###############################################################################

namespace = sicily

######################################################################################
# 
# SETUP EVENTS, HISTORY EVENTS, MISC DECISIONS
# 
# sicily.0000-sicily.0019
# 
######################################################################################



# SICILY STRUGGLE INTRO 
sicily.0001 = { # Fullscreen Intro Event
	type = character_event
	window = fullscreen_event
	title = sicily.0001.t
	desc = {
		desc = sicily.0001.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					any_character_struggle = {
						involvement = involved
						is_struggle_type = RICE_sicily_struggle
					}
				}
				desc = sicily.0001.desc.involved
			}
			triggered_desc = {
				trigger = {
					any_character_struggle = {
						involvement = interloper
						is_struggle_type = RICE_sicily_struggle
					}
				}
				desc = sicily.0001.desc.interloper
			}
			desc = sicily.0001.desc.uninvolved # Fallback option
		}
	}
	theme = diplomacy_foreign_affairs_focus
	trigger = { # we need to prevent this from firing for all players when a new player joins in MP
		is_ai = no
		NOT = { has_character_flag = RICE_sicily_struggle_intro_event_flag }
		OR = {
			any_character_struggle = {
				involvement = involved
				is_struggle_type = RICE_sicily_struggle
			}
			any_character_struggle = {
				involvement = interloper
				is_struggle_type = RICE_sicily_struggle
			}
		}
 	}
	override_background = { reference = RICE_sicily_struggle_start }
	override_sound = { reference = "event:/DLC/FP2/SFX/UI/fp2_struggle_ui_intro_animate" }

	widgets = {
		widget = {
 			gui = "event_window_widget_struggle_info"
 			container = "dynamic_content_widget"
 			controller = struggle_info
 			setup_scope = { struggle:RICE_sicily_struggle = { save_scope_as = struggle } }
		}
	}
	immediate = {
		play_music_cue = "mx_spirit_of_the_mediterranean"
		add_character_flag = RICE_sicily_struggle_intro_event_flag
		add_to_global_variable_list = { # List is only checked for removal, comparing it in the trigger would be needlessly expensive
			name = RICE_sicily_struggle_intro_flag_character_list
			target = root
		}
		save_scope_value_as = {
			name = start
			value = yes
		}
	}

	option = {
		name = sicily.0001.a
		play_music_cue = "mx_spirit_of_the_mediterranean"
		clicksound = "event:/DLC/FP2/SFX/UI/fp2_struggle_start_select"
	}

}


# Give the yearly resources since it doesn't work in effects for some reason
sicily.0002 = {
	type = character_event
	hidden = yes

	immediate = {

		send_interface_message = {
			type = sicily_struggle_event
			title = RICE_sicily_dominance_notification.title
			custom_description_no_bullet = {
				text = RICE_sicily_dominance_notification.tooltip
			}
		}

	}
}

# Sicily struggle Periphery Ending
sicily.0003 = { # Fullscreen Intro Event
	type = character_event
	window = fullscreen_event
	title = sicily.0003.t
	desc = sicily.0003.desc
	theme = diplomacy_foreign_affairs_focus
	override_background = { reference = RICE_sicily_struggle_end_bad }
	override_sound = { reference = "event:/DLC/FP2/SFX/UI/fp2_struggle_ui_intro_animate" }

	immediate = {
		play_music_cue = "mx_spirit_of_the_mediterranean"
		show_as_tooltip = {
			if = {
				limit = {
					title:c_palermo = {
						has_county_modifier = RICE_sicily_substrate_latin
					}
				}
				every_county_in_region = {
					region = custom_sicily
					custom = RICE_every_county_sicily
					change_county_control = massive_county_control_loss
					add_county_modifier = {
						modifier = RICE_sicily_substrate_latin
					}
				}	
			}			
			else_if = {
				limit = {
					title:c_palermo = {
						has_county_modifier = RICE_sicily_substrate_greek
					}
				}
				every_county_in_region = {
					region = custom_sicily
					custom = RICE_every_county_sicily
					change_county_control = massive_county_control_loss
					add_county_modifier = {
						modifier = RICE_sicily_substrate_greek
					}
				}	
			}			
			else_if = {
				limit = {
					title:c_palermo = {
						has_county_modifier = RICE_sicily_substrate_arabic
					}
				}
				every_county_in_region = {
					region = custom_sicily
					custom = RICE_every_county_sicily
					change_county_control = massive_county_control_loss
					add_county_modifier = {
						modifier = RICE_sicily_substrate_arabic
					}
				}	
			}	
			struggle:RICE_sicily_struggle = { end_struggle = yes }		
		}	
		custom_tooltip = RICE_sicily_struggle_periphery_ending_restart_tt
	}

	option = {
		name = sicily.0003.a
		#play_music_cue = "mx_nostalgia_for_siqilliya"
		clicksound = "event:/DLC/FP2/SFX/UI/fp2_struggle_start_select"
	}

}

# Sicily struggle Imperial Ending
sicily.0004 = { # Fullscreen Intro Event
	type = character_event
	window = fullscreen_event
	title = sicily.0004.t
	desc = sicily.0004.desc
	theme = diplomacy_foreign_affairs_focus
	override_background = { reference = RICE_sicily_struggle_end_bad }
	override_sound = { reference = "event:/DLC/FP2/SFX/UI/fp2_struggle_ui_intro_animate" }

	immediate = {
		play_music_cue = "mx_spirit_of_the_mediterranean"
		show_as_tooltip = {
			if = {
				limit = {
					title:c_palermo = {
						has_county_modifier = RICE_sicily_ruling_class_latin
					}
				}
				every_county_in_region = {
					region = custom_sicily
					custom = RICE_every_county_sicily
					change_development_level = minor_development_level_loss
					add_county_modifier = {
						modifier = RICE_sicily_ruling_class_latin
					}
				}	
			}			
			else_if = {
				limit = {
					title:c_palermo = {
						has_county_modifier = RICE_sicily_ruling_class_greek
					}
				}
				every_county_in_region = {
					region = custom_sicily
					custom = RICE_every_county_sicily
					change_development_level = minor_development_level_loss
					add_county_modifier = {
						modifier = RICE_sicily_ruling_class_greek
					}
				}	
			}			
			else_if = {
				limit = {
					title:c_palermo = {
						has_county_modifier = RICE_sicily_ruling_class_arabic
					}
				}
				every_county_in_region = {
					region = custom_sicily
					custom = RICE_every_county_sicily
					change_development_level = minor_development_level_loss
					add_county_modifier = {
						modifier = RICE_sicily_ruling_class_arabic
					}
				}	
			}	
			struggle:RICE_sicily_struggle = { end_struggle = yes }		
		}	
		custom_tooltip = RICE_sicily_struggle_imperial_ending_restart_tt
	}

	option = {
		name = sicily.0004.a
		#play_music_cue = "mx_nostalgia_for_siqilliya"
		clicksound = "event:/DLC/FP2/SFX/UI/fp2_struggle_start_select"
	}

}

# Sicily struggle Dominion Ending
sicily.0005 = {
	type = character_event
	window = fullscreen_event
	title = sicily.0005.t
	desc = {
		desc = sicily.0005.desc.intro
		first_valid = {
			triggered_desc = {
				trigger = {
					has_global_variable = RICE_sicily_struggle_ending_dominion_latin
				}
				desc = sicily.0005.desc.latin
			}
			triggered_desc = {
				trigger = {
					has_global_variable = RICE_sicily_struggle_ending_dominion_greek
				}
				desc = sicily.0005.desc.greek
			}
			triggered_desc = {
				trigger = {
					has_global_variable = RICE_sicily_struggle_ending_dominion_arabic
				}
				desc = sicily.0005.desc.arabic
			}
			desc = sicily.0005.desc.outsider # Fallback option
		}
		desc = sicily.0005.desc.conclusion
	}
	theme = diplomacy_foreign_affairs_focus
	override_background = { reference = RICE_sicily_struggle_start }
	override_sound = { reference = "event:/DLC/FP2/SFX/UI/fp2_struggle_ui_intro_animate" }

	immediate = {
		play_music_cue = "mx_spirit_of_the_mediterranean"
		show_as_tooltip = {
			scope:RICE_sicily_struggle_ender = {
				RICE_sicily_ending_dominion_victor_effects = yes
				# Use county modifiers to identify which ending was chosen
				if = {
					limit = {
						any_county_in_region = {
							region = custom_sicily
							has_county_modifier = RICE_sicily_dominion_latin
						}
					}
					RICE_sicily_struggle_ending_dominion_latin_modifier_effects = yes
				}
				else_if = {
					limit = {
						any_county_in_region = {
							region = custom_sicily
							has_county_modifier = RICE_sicily_dominion_greek
						}
					}
					RICE_sicily_struggle_ending_dominion_greek_modifier_effects = yes
				}
				else_if = {
					limit = {
						any_county_in_region = {
							region = custom_sicily
							has_county_modifier = RICE_sicily_dominion_arabic
						}
					}
					RICE_sicily_struggle_ending_dominion_arabic_modifier_effects = yes
				}
				else = {
					RICE_sicily_struggle_ending_dominion_outsider_modifier_effects = yes
				}
			}
		}
		custom_tooltip = RICE_sicily_struggle_ending_permanent_effect_tt
		if = {
			limit = {
				root = scope:RICE_sicily_struggle_ender
			}
			struggle:RICE_sicily_struggle = { end_struggle = yes }
			RICE_sicily_end_struggle_effect = yes
			# RICE_sicily_end_struggle_effect = {
			# 	ENDING = yes
			# 	#EVENT = sicily.0003 # # This event ping doesn't work for some reason
			# 	#FLAG = flag:periphery # Doesn't work for some reason
			# }
		}
		else = {
			show_as_tooltip = {	
				struggle:RICE_sicily_struggle = { end_struggle = yes }		
				RICE_sicily_end_struggle_effect = yes	
				# RICE_sicily_end_struggle_effect = {
				# 	ENDING = yes
				# 	#EVENT = sicily.0003 # # This event ping doesn't work for some reason
				# 	#FLAG = flag:periphery # Doesn't work for some reason
				# }
			}	
		}
	}

	option = {
		name = sicily.0006.a
		clicksound = "event:/DLC/FP3/SFX/UI/Notifications/Toasts/struggle_end_positive"
	}

	# after = {
	# }

}

# Sicily struggle Crossroads Ending
sicily.0006 = {
	type = character_event
	window = fullscreen_event
	title = sicily.0006.t
	desc = sicily.0006.desc
	theme = diplomacy_foreign_affairs_focus
	override_background = { reference = RICE_sicily_struggle_end_bad }
	override_sound = { reference = "event:/DLC/FP2/SFX/UI/fp2_struggle_ui_intro_animate" }

	immediate = {
		play_music_cue = "mx_spirit_of_the_mediterranean"
		show_as_tooltip = {
			scope:RICE_sicily_struggle_ender = {
				RICE_sicily_ending_crossroads_victory_effects = yes
				RICE_sicily_struggle_ending_crossroads_modifier_effects = yes
			}
		}
		custom_tooltip = RICE_sicily_struggle_ending_permanent_effect_tt
		if = {
			limit = {
				root = scope:RICE_sicily_struggle_ender
			}
			struggle:RICE_sicily_struggle = { end_struggle = yes }
			RICE_sicily_end_struggle_effect = yes
			# RICE_sicily_end_struggle_effect = {
			# 	ENDING = yes
			# 	#EVENT = sicily.0003 # # This event ping doesn't work for some reason
			# 	#FLAG = flag:periphery # Doesn't work for some reason
			# }
		}
		else = {
			show_as_tooltip = {	
				struggle:RICE_sicily_struggle = { end_struggle = yes }
				RICE_sicily_end_struggle_effect = yes			
				# RICE_sicily_end_struggle_effect = {
				# 	ENDING = yes
				# 	#EVENT = sicily.0003 # # This event ping doesn't work for some reason
				# 	#FLAG = flag:periphery # Doesn't work for some reason
				# }
			}	
		}
	}

	option = {
		name = sicily.0006.a
		clicksound = "event:/DLC/FP3/SFX/UI/Notifications/Toasts/struggle_end_positive"
	}

	# after = {
	# }

}



# Year change catalyst
sicily.0007 = {
	hidden = yes
	scope = none
	scope = struggle

	trigger = {
		exists = struggle:RICE_sicily_struggle
	}

	immediate = {
		if = {
			limit = {
				exists = struggle:RICE_sicily_struggle
			}
			# Activate the catalyst
			# activate_struggle_catalyst = catalyst_RICE_sicily_passing_of_time
			struggle:RICE_sicily_struggle = {
				# Stats
				every_involved_ruler = {
					limit = { 
						OR = {
							diplomacy >= decent_skill_rating
							stewardship >= decent_skill_rating
							learning >= decent_skill_rating
						}
					}
					struggle:RICE_sicily_struggle = {
						activate_struggle_catalyst = catalyst_RICE_sicily_high_diplo_steward_learning
					}
				}
				every_involved_ruler = {
					limit = { 
						OR = {
							martial >= decent_skill_rating
							intrigue >= decent_skill_rating
							prowess >= decent_skill_rating
						}
					}
					struggle:RICE_sicily_struggle = {
						activate_struggle_catalyst = catalyst_RICE_sicily_high_martial_intrigue_prowess
					}
				}
				# Independent vs Non-Independent
				every_involved_ruler = {
					limit = { 
						is_independent_ruler = yes
						highest_held_title_tier >= tier_duchy
					}
					struggle:RICE_sicily_struggle = {
						activate_struggle_catalyst = catalyst_RICE_sicily_independent_involved_ruler
					}
				}
				every_involved_ruler = {
					limit = { 
						NOT = { is_independent_ruler = yes }
						highest_held_title_tier >= tier_duchy
					}
					struggle:RICE_sicily_struggle = {
						activate_struggle_catalyst = catalyst_RICE_sicily_non_independent_involved_ruler
					}
				}
			}
			# Then queue the event up against for a year hence.
			trigger_event = {
				id = sicily.0007
				years = 1
			}
		}
	}
}


# Restart Sicilian Struggle (Occupation)
sicily.0010 = {
	type = character_event
	title = sicily.0010.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_global_variable = RICE_sicily_struggle_ending_periphery
				}
				desc = sicily.0010.desc.periphery
			}		
			triggered_desc = {
				trigger = {
					has_global_variable = RICE_sicily_struggle_ending_imperial
				}
				desc = sicily.0010.desc.imperial
			}		
		}
		desc = sicily.0010.desc
		desc = sicily.0010.desc.conclusion
	}
	theme = martial
	override_background = { reference = RICE_background_sicily_travel }

	right_portrait = {
		character = scope:sicily_struggle_restarter
		animation = war_attacker
	}

	# Ok
	option = {
		name = sicily.0010.a
	}

	after = {
		if = {
			limit = {
				root = scope:sicily_struggle_restarter
			}
			RICE_sicily_occupy_sicilian_frontier_effect = yes
			trigger_event = sicily.0012
		}
	}

}


# Restart Sicilian Struggle (Revitalizer)
sicily.0011 = {
	type = character_event
	title = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_global_variable = RICE_sicily_struggle_ending_periphery
				}
				desc = sicily.0011.t.periphery
			}		
			triggered_desc = {
				trigger = {
					has_global_variable = RICE_sicily_struggle_ending_imperial
				}
				desc = sicily.0011.t.imperial
			}	
			desc = sicily.0011.t # Backup	
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_global_variable = RICE_sicily_struggle_ending_periphery
				}
				desc = sicily.0010.desc.periphery
			}		
			triggered_desc = {
				trigger = {
					has_global_variable = RICE_sicily_struggle_ending_imperial
				}
				desc = sicily.0010.desc.imperial
			}		
		}
		desc = sicily.0011.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					has_global_variable = RICE_sicily_struggle_ending_periphery
				}
				desc = sicily.0011.desc.periphery
			}		
			triggered_desc = {
				trigger = {
					has_global_variable = RICE_sicily_struggle_ending_imperial
				}
				desc = sicily.0011.desc.imperial
			}		
		}
		desc = sicily.0010.desc.conclusion
	}
	theme = diplomacy_foreign_affairs_focus
	override_background = { reference = RICE_background_sicily_travel }

	right_portrait = {
		character = scope:sicily_struggle_restarter
		animation = war_attacker
	}

	# Ok
	option = {
		name = sicily.0011.a
	}

	after = {
		if = {
			limit = {
				root = scope:sicily_struggle_restarter
			}
			RICE_sicily_stabilize_sicilian_frontier_effect = yes
			trigger_event = sicily.0013
		}
	}

}

sicily.0012 = {
	hidden = yes

	immediate = {
		RICE_sicily_remove_end_county_modifiers = yes
		if = {
			limit = {
				has_global_variable = RICE_sicily_struggle_ending_periphery
			}
			remove_global_variable = RICE_sicily_struggle_ending_periphery
		}
	
		if = {
			limit = {
				has_global_variable = RICE_sicily_struggle_ending_imperial
			}
			remove_global_variable = RICE_sicily_struggle_ending_imperial
		}
		start_struggle = {
			struggle_type = RICE_sicily_struggle
			start_phase = struggle_RICE_sicily_phase_borderland
		}
		# Won't start on any other phase but the predefined starting phase
		struggle:RICE_sicily_struggle = {
			change_struggle_phase = struggle_RICE_sicily_phase_colony
		}
		struggle:RICE_sicily_struggle = {
			trigger_event = { on_action = RICE_sicily_struggle_starting_events }
		}
	}
}

sicily.0013 = {
	hidden = yes

	immediate = {
		RICE_sicily_remove_end_county_modifiers = yes
		if = {
			limit = {
				has_global_variable = RICE_sicily_struggle_ending_periphery
			}
			remove_global_variable = RICE_sicily_struggle_ending_periphery
		}
	
		if = {
			limit = {
				has_global_variable = RICE_sicily_struggle_ending_imperial
			}
			remove_global_variable = RICE_sicily_struggle_ending_imperial
		}
		start_struggle = {
			struggle_type = RICE_sicily_struggle
			start_phase = struggle_RICE_sicily_phase_borderland
		}
		struggle:RICE_sicily_struggle = {
			trigger_event = { on_action = RICE_sicily_struggle_starting_events }
		}
	}
}

# Founding the Second Pavia
sicily.0014 = {
	type = character_event
	title = sicily.0014.t
	desc = sicily.0014.desc
	theme = RICE_theme_sicily_amalfi_coast

	right_portrait = {
		character = scope:second_pavia_founder
		animation = personality_bold
	}


	immediate = {
		
		play_music_cue = "mx_cue_sacredrite"

		culture:lombard = {
			save_scope_as = lombard
		}

		culture:frankish = {
			save_scope_as = frankish
		}
		
		if = {
			limit = {
				root = scope:second_pavia_founder
			}
			RICE_sicily_second_pavia_decision_effect = yes
		}
		else = {
			show_as_tooltip = {
				scope:second_pavia_founder = {
					RICE_sicily_second_pavia_decision_effect = yes
				}
			}
		}

	}

	option = {
		name = sicily.0014.a
	}
}

#Gain negative stronghold effects
sicily.0015 = {
	hidden = yes

	trigger = {
		#Holder still needs to be the same
		scope:county.holder = scope:holder
	}

	immediate = {
		struggle:RICE_sicily_struggle ?= {
			activate_struggle_catalyst = {
				catalyst = catalyst_RICE_sicily_stronghold_raid
				character = scope:county.holder
			}
		}
		random_list = {
			10 = {
				scope:county.holder = {
					send_interface_message = {
						type = sicily_struggle_event_bad
						title = sicily.0015.message
						left_icon = scope:county
						scope:county = {
							change_county_control = major_county_control_loss
						}
					}
				}
			}
			10 = {
				scope:county.holder = {
					send_interface_message = {
						type = sicily_struggle_event_bad
						title = sicily.0015.message
						left_icon = scope:county
						scope:county = {
							change_development_progress = minor_development_progress_loss
						}
					}
				}
			}
		}
	}
}


# Siculo-Arabic culture event
sicily.0016 = {
	type = character_event
	title = sicily.0016.t
	desc = sicily.0016.desc
	theme = culture_change
	override_background = { reference = RICE_background_sicily_travel }

	left_portrait = root
	
	trigger = {
		# Not Sicilian
		culture = {
			NOR = {
				this = culture:sicilian
				any_parent_culture_or_above = {
					this = culture:sicilian
				}
			}
		}
		RICE_sicily_arabic_trigger = yes
		any_held_title = {
			tier = tier_county
			exists = holder
			NOT = { exists = var:RICE_had_siculo_arabic_county_conversion }
			title_province = {
				geographical_region = custom_sicily
			}
			culture = {
				NOR = {
					this = culture:sicilian
					any_parent_culture_or_above = {
						this = culture:sicilian
					}
				}
				NOR = {
					this = culture:siculo_arabic
					any_parent_culture_or_above = {
						this = culture:siculo_arabic
					}
				}
			}
			OR = {
				RICE_sicily_latin_trigger = yes
				RICE_sicily_greek_trigger = yes
				RICE_sicily_arabic_trigger = yes
			}
		}		
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 2
			culture = culture:norman
		}
	}

	immediate = {
		random_held_title = {
			limit = {
				tier = tier_county
				exists = holder
				NOT = { exists = var:RICE_had_siculo_arabic_county_conversion }
				title_province = {
					geographical_region = custom_sicily
				}
				culture = {
					NOR = {
						this = culture:sicilian
						any_parent_culture_or_above = {
							this = culture:sicilian
						}
					}
					NOR = {
						this = culture:siculo_arabic
						any_parent_culture_or_above = {
							this = culture:siculo_arabic
						}
					}
				}
				OR = {
					RICE_sicily_latin_trigger = yes
					RICE_sicily_greek_trigger = yes
					RICE_sicily_arabic_trigger = yes
				}
			}
			weight = { # Try to approximate organic spread
				base = 1
				modifier = {
					add = 4
					any_neighboring_county = {
						culture = culture:siqilli
					}
				}
			}
			save_scope_as = county_to_change
			culture = {
				save_scope_as = old_culture
			}
			set_variable = {
				name = RICE_had_siculo_arabic_county_conversion
				value = yes
			}
			# Necessary to prevent Sicilian from arising here later on
			set_variable = {
				name = had_sicilian_county_conversion
				value = yes
			}
		}
		culture:siqilli = {
			save_scope_as = siculo_arabic # For loc
		}
		debug_log = "Converted a province to Siculo-Arabic from sicily.0016"
	}

	option = {
		name = sicily.0016.a
		scope:county_to_change = {
			set_county_culture = culture:siqilli
		}
	}
}


# Admiral Bridge's decision event
sicily.0017 = {
	type = character_event
	title = sicily.0017.t
	desc = sicily.0017.desc
	theme = RICE_theme_sicily_village

	left_portrait = root


	immediate = {
		RICE_sicily_build_admirals_bridge_effect = yes
	}

	option = {
		name = sicily.0017.a
	}
}


# Sicily recruit soldier decision
sicily.0018 = {
	type = character_event
	title = sicily.0018.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					var:RICE_sicily_soldier_type ?= flag:latin
				}
				desc = sicily.0018.desc.latin
			}
			triggered_desc = {
				trigger = {
					var:RICE_sicily_soldier_type ?= flag:greek
				}
				desc = sicily.0018.desc.greek
			}
			triggered_desc = {
				trigger = {
					var:RICE_sicily_soldier_type ?= flag:arabic
				}
				desc = sicily.0018.desc.arabic
			}
			desc = sicily.0018.desc.none # Fallback option
		}
		desc = sicily.0018.desc
	}
	theme = martial
	override_background = { reference = RICE_background_sicily_interior }

	right_portrait = {
		character = root
		animation = war_defender
	}

	immediate = {
		# Save a potential county for the stronghold to appear in
		if = {
			limit = {
				var:RICE_sicily_soldier_type ?= flag:latin
				any_held_county = {
					any_county_province = {
						geographical_region = custom_sicily
					}
					NOT = { has_county_modifier = RICE_sicily_stronghold_latin }
				}

			}
			random_held_county = {
				limit = {
					any_county_province = {
						geographical_region = custom_sicily
					}
					NOT = { has_county_modifier = RICE_sicily_stronghold_latin }
				}
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_soldier_type ?= flag:greek
				any_held_county = {
					any_county_province = {
						geographical_region = custom_sicily
					}
					NOT = { has_county_modifier = RICE_sicily_stronghold_greek }
				}

			}
			random_held_county = {
				limit = {
					any_county_province = {
						geographical_region = custom_sicily
					}
					NOT = { has_county_modifier = RICE_sicily_stronghold_greek }
				}
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_soldier_type ?= flag:arabic
				any_held_county = {
					any_county_province = {
						geographical_region = custom_sicily
					}
					NOT = { has_county_modifier = RICE_sicily_stronghold_arabic }
				}

			}
			random_held_county = {
				limit = {
					any_county_province = {
						geographical_region = custom_sicily
					}
					NOT = { has_county_modifier = RICE_sicily_stronghold_arabic }
				}
				save_scope_as = county
			}
		}
	}

	option = {
		name = sicily.0018.a
		if = {
			limit = { var:RICE_sicily_soldier_type ?= flag:latin }
			set_variable = {
				name = RICE_sicily_soldier_type
				value = flag:latin
				days = 1
			}
			RICE_sicily_recruit_latin_soldiers_effect = yes
		}

		else_if = {
			limit = { var:RICE_sicily_soldier_type ?= flag:greek }
			set_variable = {
				name = RICE_sicily_soldier_type
				value = flag:greek
				days = 1
			}
			RICE_sicily_recruit_greek_soldiers_effect = yes
		}

		else_if = {
			limit = { var:RICE_sicily_soldier_type ?= flag:arabic }
			set_variable = {
				name = RICE_sicily_soldier_type
				value = flag:arabic
				days = 1
			}
			RICE_sicily_recruit_arabic_soldiers_effect = yes
		}
	}

	after = {

		hidden_effect = {
			if = {
				limit = {
					var:RICE_sicily_soldier_type ?= flag:latin
				}
				random = {
					chance = RICE_sicily_latin_stronghold_appearance_value
					send_interface_toast = {
						type = sicily_struggle_event
						left_icon = root
						title = sicily.county_appears.latin_stronghold
						scope:county = {
							add_county_modifier = {
								modifier = RICE_sicily_stronghold_latin
							}
						}
					}	
				}
			}
			else_if = {
				limit = {
					var:RICE_sicily_soldier_type ?= flag:greek
				}
				random = {
					chance = RICE_sicily_greek_stronghold_appearance_value
					send_interface_toast = {
						type = sicily_struggle_event
						left_icon = root
						title = sicily.county_appears.greek_stronghold
						scope:county = {
							add_county_modifier = {
								modifier = RICE_sicily_stronghold_greek
							}
						}
					}
				}	
			}
			else_if = {
				limit = {
					var:RICE_sicily_soldier_type ?= flag:arabic
				}
				random = {
					chance = RICE_sicily_arabic_stronghold_appearance_value
					send_interface_toast = {
						type = sicily_struggle_event
						left_icon = root
						title = sicily.county_appears.arabic_stronghold
						scope:county = {
							add_county_modifier = {
								modifier = RICE_sicily_stronghold_arabic
							}
						}
					}
				}	
			}
		}

		if = {
			limit = {
				has_variable = RICE_sicily_soldier_type
			}
			remove_variable = RICE_sicily_soldier_type
		}

	}

}


# Give the yearly resources since it doesn't work in effects for some reason
sicily.0019 = {
	type = character_event
	hidden = yes

	immediate = {

		add_character_flag = {
			flag = RICE_sicily_records_bonus_flag
			days = 1
		}

		random_held_county = {
			limit = {
				OR = {
					has_county_modifier = RICE_sicily_updated_bureaucratic_records_latin
					has_county_modifier = RICE_sicily_updated_bureaucratic_records_greek
					has_county_modifier = RICE_sicily_updated_bureaucratic_records_arabic
				}
			}
			save_scope_as = county
		}

		if = {
			limit = {
				scope:county = {
					has_county_modifier = RICE_sicily_updated_bureaucratic_records_latin
				}
			}
			send_interface_message = {
				type = sicily_struggle_event_good
				title = RICE_sicily_records_random_gain.latin.title
				RICE_sicily_signore_latin_track_medium_gain = yes
			}
		}

		else_if = {
			limit = {
				scope:county = {
					has_county_modifier = RICE_sicily_updated_bureaucratic_records_greek
				}
			}
			send_interface_message = {
				type = sicily_struggle_event_good
				title = RICE_sicily_records_random_gain.greek.title
				RICE_sicily_signore_greek_track_medium_gain = yes
			}
		}

		else_if = {
			limit = {
				scope:county = {
					has_county_modifier = RICE_sicily_updated_bureaucratic_records_arabic
				}
			}
			send_interface_message = {
				type = sicily_struggle_event_good
				title = RICE_sicily_records_random_gain.arabic.title
				RICE_sicily_signore_arabic_track_medium_gain = yes
			}
		}


	}
}

######################################################################################
# 
# CASUS BELLI & WARFARE EVENTS
# 
# sicily.0020-sicily.0029
# 
######################################################################################

sicily.0020 = {
	hidden = yes

	immediate = {
		random_character_war = { # We need to locate the war we just created, since we can't save it on creation
			limit = {
				using_cb = RICE_sicily_intervention_cb
				primary_attacker = scope:secondary_recipient # root
				primary_defender = scope:recipient
			}
			add_attacker = scope:actor
		}
	}
}

sicily.0021 = {
	hidden = yes

	immediate = {
		random_character_war = { # We need to locate the war we just created, since we can't save it on creation
			limit = {
				using_cb = RICE_sicily_intervention_cb
				primary_attacker = scope:secondary_recipient # root
				primary_defender = scope:recipient
			}
			save_scope_as = sicilian_intervention_war
		}
		spawn_army = {
			men_at_arms = {
				type = bowmen
				stacks = fp3_request_invasion_troop_value_bonus_troops
			}
			men_at_arms = {
				type = pikemen_unit
				stacks = fp3_request_invasion_troop_value_bonus_troops
			}
			men_at_arms = {
				type = light_horsemen
				stacks = fp3_request_invasion_troop_value_bonus_troops
			}
			levies = fp3_request_invasion_troop_value_bonus_levy_troops
			location = capital_province
			uses_supply = yes
			war = scope:sicilian_intervention_war
			inheritable = no
			name = RICE_sicily_intervention_event_troops
		}
	}
}





######################################################################################
# 
# SICILY STRONGHOLDS
# 
# sicily.0030-sicily.0049
# 
######################################################################################


# Bargains with the strongholds
sicily.0030 = {
	type = character_event
	title = {
		first_valid = {
			triggered_desc = {
				trigger = {
					var:RICE_sicily_bargain_type ?= flag:latin
				}
				desc = sicily.0030.t.latin
			}
			triggered_desc = {
				trigger = {
					var:RICE_sicily_bargain_type ?= flag:greek
				}
				desc = sicily.0030.t.greek
			}
			triggered_desc = {
				trigger = {
					var:RICE_sicily_bargain_type ?= flag:arabic
				}
				desc = sicily.0030.t.arabic
			}
			# Fallback
			desc = sicily.0030.t
		}
	}
	desc = {
		desc = sicily.0030.desc.intro
		first_valid = {
			triggered_desc = {
				trigger = {
					var:RICE_sicily_bargain_type ?= flag:latin
				}
				desc = sicily.0030.desc.latin
			}
			triggered_desc = {
				trigger = {
					var:RICE_sicily_bargain_type ?= flag:greek
				}
				desc = sicily.0030.desc.greek
			}
			triggered_desc = {
				trigger = {
					var:RICE_sicily_bargain_type ?= flag:arabic
				}
				desc = sicily.0030.desc.arabic
			}
		}
		desc = sicily.0030.desc
	}
	theme = RICE_theme_sicily_travel
	override_icon = { reference = "gfx/interface/icons/event_types/type_diplomacy.dds" }
	
	left_portrait = {
		character = scope:representative
		animation = war_over_win
	}

	right_portrait = {
		character = root
		triggered_animation = {
			trigger = {
				root = {
					OR = {
						has_trait = vengeful
						has_trait = wrathful
						has_trait = brave
					}
				}
			}
			animation = personality_vengeful
		}
		triggered_animation = {
			trigger = {
				root = {
					OR = {
						has_trait = paranoid
						has_trait = shy
						has_trait = craven
					}
				}
			}
			animation = worry
		}
		animation = personality_callous		
	}
	
	immediate = {

		# Save a potential county for reference
		if = {
			limit = {
				var:RICE_sicily_bargain_type ?= flag:latin
				OR = {
					any_held_county = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_latin_trigger = yes
					}		
					any_vassal_or_below = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_latin_trigger = yes
						}	
					}
				}
			}
			if = {
				limit = {
					any_held_county = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_latin_trigger = yes
					}
				}
				every_held_county = {
					limit = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_latin_trigger = yes
					}
					add_to_list = candidate_counties
				}
			}
			if = {
				limit = {	
					any_vassal_or_below = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_latin_trigger = yes
						}	
					}
				}
				every_vassal_or_below = {
					limit = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_latin_trigger = yes
						}
					}
					every_held_county = {
						limit = {							
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_latin_trigger = yes
						}
						add_to_list = candidate_counties
					}
				}
			}
			random_in_list = {
				list = candidate_counties
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_bargain_type ?= flag:latin
				any_county_in_region = {
					region = RICE_mediterranean_and_nearby_region
					RICE_sicily_latin_trigger = yes
				}

			}
			every_county_in_region = {
				region = RICE_mediterranean_and_nearby_region
				limit = {
					RICE_sicily_latin_trigger = yes
				}
				add_to_list = candidate_counties
			}
			random_in_list = {
				list = candidate_counties
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_bargain_type ?= flag:latin
			}
			add_character_flag = {
				flag = RICE_sicily_bargain_no_counties
				days = 1
			}
			random_list = {
				20 = { culture:italian = { save_scope_as = sicily_culture } }
				20 = { culture:cisalpine = { save_scope_as = sicily_culture } }
				10 = { culture:frankish = { save_scope_as = sicily_culture } }
				10 = { culture:castilian = { save_scope_as = sicily_culture } }
				10 = { culture:andalusian = { save_scope_as = sicily_culture } }
				20 = { culture:norman = { save_scope_as = sicily_culture } }
				10 = { culture:franconian = { save_scope_as = sicily_culture } }
				10 = { culture:dutch = { save_scope_as = sicily_culture } }
				10 = { culture:anglo_saxon = { save_scope_as = sicily_culture } }
				10 = { culture:catalan = { save_scope_as = sicily_culture } }
				10 = { culture:occitan = { save_scope_as = sicily_culture } }
				10 = { culture:saxon = { save_scope_as = sicily_culture } }
				20 = { culture:lombard = { save_scope_as = sicily_culture } }
			}
			faith:catholic = { save_scope_as = sicily_faith }
			capital_county = {
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_bargain_type ?= flag:greek
				OR = {
					any_held_county = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_greek_trigger = yes
					}		
					any_vassal_or_below = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_greek_trigger = yes
						}	
					}
				}

			}
			if = {
				limit = {
					any_held_county = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_greek_trigger = yes
					}
				}
				every_held_county = {
					limit = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_greek_trigger = yes
					}
					add_to_list = candidate_counties
				}
			}
			if = {
				limit = {	
					any_vassal_or_below = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_greek_trigger = yes
						}	
					}
				}
				every_vassal_or_below = {
					limit = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_greek_trigger = yes
						}
					}
					every_held_county = {
						limit = {							
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_greek_trigger = yes
						}
						add_to_list = candidate_counties
					}
				}
			}
			random_in_list = {
				list = candidate_counties
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_bargain_type ?= flag:greek
				any_county_in_region = {
					region = RICE_mediterranean_and_nearby_region
					RICE_sicily_greek_trigger = yes
				}

			}
			every_county_in_region = {
				region = RICE_mediterranean_and_nearby_region
				limit = {
					RICE_sicily_greek_trigger = yes
				}
				add_to_list = candidate_counties
			}
			random_in_list = {
				list = candidate_counties
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_bargain_type ?= flag:greek
			}
			add_character_flag = {
				flag = RICE_sicily_bargain_no_counties
				days = 1
			}
			random_list = {
				50 = { culture:greek = { save_scope_as = sicily_culture } }
				10 = { culture:armenian = { save_scope_as = sicily_culture } }
				10 = { culture:bulgarian = { save_scope_as = sicily_culture } }
			}
			faith:orthodox = { save_scope_as = sicily_faith }
			capital_county = {
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_bargain_type ?= flag:arabic
				OR = {
					any_held_county = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_arabic_trigger = yes
					}		
					any_vassal_or_below = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_arabic_trigger = yes
						}	
					}
				}

			}

			if = {
				limit = {
					any_held_county = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_arabic_trigger = yes
					}
				}
				every_held_county = {
					limit = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_arabic_trigger = yes
					}
					add_to_list = candidate_counties
				}
			}
			if = {
				limit = {	
					any_vassal_or_below = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_arabic_trigger = yes
						}	
					}
				}
				every_vassal_or_below = {
					limit = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_arabic_trigger = yes
						}
					}
					every_held_county = {
						limit = {							
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_arabic_trigger = yes
						}
						add_to_list = candidate_counties
					}
				}
			}
			random_in_list = {
				list = candidate_counties
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_bargain_type ?= flag:arabic
				any_county_in_region = {
					region = RICE_mediterranean_and_nearby_region
					RICE_sicily_arabic_trigger = yes
				}

			}
			every_county_in_region = {
				region = RICE_mediterranean_and_nearby_region
				limit = {
					RICE_sicily_arabic_trigger = yes
				}
				add_to_list = candidate_counties
			}
			random_in_list = {
				list = candidate_counties
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_bargain_type ?= flag:arabic
			}
			add_character_flag = {
				flag = RICE_sicily_bargain_no_counties
				days = 1
			}
			random_list = {
				20 = { culture:andalusian = { save_scope_as = sicily_culture } }
				20 = { culture:maghrebi = { save_scope_as = sicily_culture } }
				10 = { culture:butr = { save_scope_as = sicily_culture } }
				10 = { culture:baranis = { save_scope_as = sicily_culture } }
				10 = { culture:egyptian = { save_scope_as = sicily_culture } }
				10 = { culture:levantine = { save_scope_as = sicily_culture } }
				10 = { culture:yemeni = { save_scope_as = sicily_culture } }
				10 = { culture:persian = { save_scope_as = sicily_culture } }
				20 = { culture:siculo_arabic = { save_scope_as = sicily_culture } }
				10 = { culture:kurdish = { save_scope_as = sicily_culture } }
			}
			random_list = {
				10 = { faith:ashari = { save_scope_as = sicily_faith } }
				10 = { faith:muwalladi = { save_scope_as = sicily_faith } }
				10 = { faith:ismaili = { save_scope_as = sicily_faith } }
				10 = { faith:ibadi = { save_scope_as = sicily_faith } }
			}
			capital_county = {
				save_scope_as = county
			}
		}	
	
		if = {
			limit = {
				NOT = { has_character_flag = RICE_sicily_bargain_no_counties }
			}
			scope:county.faith = {
				save_scope_as = sicily_faith
			}		
			scope:county.culture = {
				save_scope_as = sicily_culture
			}
		}	

		create_character = {
			location = root.capital_province
			template = RICE_stronghold_faction_leader_template
			save_scope_as = representative
		}

		set_variable = {
			name = bargain_amount
			value = {
				value = 0
				add = {
					integer_range = {
						min = RICE_sicily_stronghold_bargain_min_value
						max = RICE_sicily_stronghold_bargain_max_value
					}
				}
			}
			days = 1
		}	
		
		# set_variable = {
		# 	name = counterproposal_amount
		# 	value = {
		# 		value = 0
		# 		add = {
		# 			integer_range = {
		# 				min = RICE_sicily_stronghold_bargain_min_value
		# 				max = RICE_sicily_stronghold_bargain_max_value
		# 			}
		# 		}
		# 	}
		# 	days = 1
		# }	

	}

	option = { # OK
		name = sicily.0030.a
		remove_short_term_gold = var:bargain_amount
		RICE_sicily_bargain_strongholds_success_effect = yes
		if = {
			limit = {
				has_variable = RICE_sicily_bargain_type
			}
			remove_variable = RICE_sicily_bargain_type
		}
		if = {
			limit = {
				has_variable = bargain_amount
			}
			remove_variable = bargain_amount
		}
		hidden_effect = {
			scope:representative = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}

	option = { # Bargain for more if you qualify
		name = sicily.0030.b
		trigger = {
			OR = {
				AND = {
					var:RICE_sicily_bargain_type ?= flag:latin
					OR = {
						has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_latin value >= 50 }
						dynasty ?= {
							has_dynasty_perk = RICE_sicily_legacy_3
						}
					}
				}
				AND = {
					var:RICE_sicily_bargain_type ?= flag:greek
					OR = {
						has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_greek value >= 50 }
						dynasty ?= {
							has_dynasty_perk = RICE_sicily_legacy_3
						}
					}
				}
				AND = {
					var:RICE_sicily_bargain_type ?= flag:arabic
					OR = {
						has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_arabic value >= 50 }
						dynasty ?= {
							has_dynasty_perk = RICE_sicily_legacy_3
						}
					}
				}
			}
		}
		remove_short_term_gold = var:bargain_amount
		RICE_sicily_bargain_strongholds_success_effect = yes
		add_prestige = medium_prestige_loss
		add_legitimacy = minor_legitimacy_loss
		duel = {
			skills = { diplomacy martial stewardship intrigue learning }
			target = scope:representative
			8 = {
				custom_tooltip = sicily.0030.b.failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = -0.9
				}
				set_variable = {
					name = stronghold_extra_negotiation
					value = flag:failure
					days = 1
				}
			}
			12 = {
				custom_tooltip = sicily.0030.b.success
				compare_modifier = {
					value = scope:duel_value
					multiplier = 0.9
				}
				set_variable = {
					name = stronghold_extra_negotiation
					value = flag:success
					days = 1
				}
			}
		}
		trigger_event = sicily.0031
	}

	option = { # OK
		name = sicily.0030.c
		RICE_sicily_bargain_strongholds_failure_effect = yes
		if = {
			limit = {
				has_variable = RICE_sicily_bargain_type
			}
			remove_variable = RICE_sicily_bargain_type
		}
		if = {
			limit = {
				has_variable = bargain_amount
			}
			remove_variable = bargain_amount
		}
		hidden_effect = {
			scope:representative = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}

	after = {
		if = {
			limit = {
				has_variable = RICE_sicily_bargain_no_counties
			}
			remove_variable = RICE_sicily_bargain_no_counties
		}
	}

}



# Extra bargains with the strongholds
sicily.0031 = {
	type = character_event
	title = {
		first_valid = {
			triggered_desc = {
				trigger = {
					var:RICE_sicily_bargain_type ?= flag:latin
				}
				desc = sicily.0030.t.latin
			}
			triggered_desc = {
				trigger = {
					var:RICE_sicily_bargain_type ?= flag:greek
				}
				desc = sicily.0030.t.greek
			}
			triggered_desc = {
				trigger = {
					var:RICE_sicily_bargain_type ?= flag:arabic
				}
				desc = sicily.0030.t.arabic
			}
			# Fallback
			desc = sicily.0030.t
		}
	}
	desc = {
		desc = sicily.0031.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					var:stronghold_extra_negotiation ?= flag:failure
				}
				desc = sicily.0031.desc.failure
			}
			triggered_desc = {
				trigger = {
					var:bargain_extras ?= flag:prestige
				}
				desc = sicily.0031.desc.prestige
			}
			triggered_desc = {
				trigger = {
					var:bargain_extras ?= flag:gold
				}
				desc = sicily.0031.desc.gold
			}
			triggered_desc = {
				trigger = {
					var:bargain_extras ?= flag:troops
				}
				desc = sicily.0031.desc.troops
			}
			triggered_desc = {
				trigger = {
					var:bargain_extras ?= flag:county
				}
				desc = sicily.0031.desc.county
			}
		}
	}
	theme = RICE_theme_sicily_travel
	override_icon = { reference = "gfx/interface/icons/event_types/type_diplomacy.dds" }
	
	left_portrait = {
		character = scope:representative
		triggered_animation = {
			trigger = {
				root = {
					var:stronghold_extra_negotiation ?= flag:failure
				}
			}
			animation = dismissal
		}
		animation = war_over_tie
	}

	right_portrait = {
		character = root
		triggered_animation = {
			trigger = {
				root = {
					var:stronghold_extra_negotiation ?= flag:failure
				}
			}
			animation = anger
		}
		animation = scheme		
	}

	immediate = {
		if = {
			limit = {
				var:stronghold_extra_negotiation ?= flag:failure
			}
			add_prestige = -100
			stress_impact = {
				greedy = miniscule_stress_impact_gain
				vengeful = miniscule_stress_impact_gain
				wrathful = miniscule_stress_impact_gain
			}
		}
		if = {
			limit = {
				var:stronghold_extra_negotiation ?= flag:success
			}
			random_list = {
				10 = {					
					set_variable = {
						name = bargain_extras
						value = flag:prestige
						days = 1
					}
				}
				10 = {					
					set_variable = {
						name = bargain_extras
						value = flag:gold
						days = 1
					}
				}
				10 = {					
					set_variable = {
						name = bargain_extras
						value = flag:troops
						days = 1
					}
				}
				10 = {					
					set_variable = {
						name = bargain_extras
						value = flag:county
						days = 1
					}
				}
			}
		}
	}

	option = { # OK
		name = sicily.0031.a
		if = {
			limit = {
				var:stronghold_extra_negotiation ?= flag:success
			}
			if = {
				limit = {
					var:RICE_sicily_bargain_type ?= flag:latin
				}
				RICE_sicily_signore_latin_track_medium_gain = yes
			}
			else_if = {
				limit = {
					var:RICE_sicily_bargain_type ?= flag:greek
				}
				RICE_sicily_signore_greek_track_medium_gain = yes
			}
			else_if = {
				limit = {
					var:RICE_sicily_bargain_type ?= flag:arabic
				}
				RICE_sicily_signore_arabic_track_medium_gain = yes
			}
		}
		if = {
			limit = {
				var:bargain_extras ?= flag:prestige
			}
			add_prestige = { minor_prestige_gain medium_prestige_gain }
		}
		else_if = {
			limit = {
				var:bargain_extras ?= flag:gold
			}
			add_gold = { 25 RICE_sicily_stronghold_bargain_min_bottom_value }
		}
		else_if = {
			limit = {
				var:bargain_extras ?= flag:troops
			}
			if = {
				limit = {
					var:RICE_sicily_bargain_type ?= flag:latin
				}
				if = {
					limit = {
						root.culture = { has_cultural_era_or_later = culture_era_high_medieval }
					}
					spawn_army = {
						levies = 200
						men_at_arms = {
							type = picchieri
							stacks = 1
						}
						men_at_arms = {
							type = bowmen
							stacks = 1
						}
						location = root.capital_province
						inheritable = no
						name = RICE_sicily_event_troops
					}
				}
				else = {
					spawn_army = {
						levies = 200
						men_at_arms = {
							type = RICE_arimanni
							stacks = 1
						}
						men_at_arms = {
							type = bowmen
							stacks = 1
						}
						location = root.capital_province
						inheritable = no
						name = RICE_sicily_event_troops
					}
				}
			}
			else_if = {
				limit = {
					var:RICE_sicily_bargain_type ?= flag:greek
				}
				spawn_army = {
					levies = 200
					men_at_arms = {
						type = light_footmen
						stacks = 1
					}
					men_at_arms = {
						type = cataphract
						stacks = 2
					}
					location = root.capital_province
					inheritable = no
					name = RICE_sicily_event_troops
				}
			}
			else_if = {
				limit = {
					var:RICE_sicily_bargain_type ?= flag:arabic
				}
				spawn_army = {
					levies = 200
					men_at_arms = {
						type = mubarizun
						stacks = 1
					}
					men_at_arms = {
						type = RICE_sicily_bowmen
						stacks = 1
					}
					location = root.capital_province
					inheritable = no
					name = RICE_sicily_event_troops
				}
			}
		}
		else_if = {
			limit = {
				var:bargain_extras ?= flag:county
			}
			every_county_in_region = {
				region = custom_sicily
				limit = {
					holder = root
				}
				custom = RICE_every_county_owned_sicily
				change_county_control = minor_county_control_gain
				change_development_progress = minor_development_progress_gain	
			}
		}
	}

	after = {
		if = {
			limit = {
				has_variable = RICE_sicily_bargain_type
			}
			remove_variable = RICE_sicily_bargain_type
		}
		if = {
			limit = {
				has_variable = bargain_amount
			}
			remove_variable = bargain_amount
		}
		if = {
			limit = {
				has_variable = bargain_extras
			}
			remove_variable = bargain_extras
		}
		hidden_effect = {
			scope:representative = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}

}









######################################################################################
# 
# SICILY GRAIN
# 
# sicily.0050-sicily.0059
# 
######################################################################################


# Give Sicilian grain shipments
sicily.0050 = {
	type = character_event
	title = sicily.0050.t
	desc = sicily.0050.desc
	theme = RICE_theme_sicily_countryside
	
	left_portrait = scope:actor
	right_portrait = scope:recipient
	
	immediate = {
		show_as_tooltip = {
			remove_short_term_gold = minor_gold_value
			add_prestige = medium_prestige_value	
			struggle:RICE_sicily_struggle ?= {
				activate_struggle_catalyst = {
					catalyst = catalyst_RICE_sicily_send_grain
					character = scope:actor
				}
			}
		}		
	}

	option = { # OK
		name = sicily.0050.a
		custom_tooltip = RICE_sicily_wheat_shipments_legitimacy_effects_actor_tt
		custom_tooltip = RICE_sicily_wheat_shipments_opinion_effects_actor_tt
		scope:recipient = {
			custom_tooltip = RICE_sicily_wheat_shipments_legitimacy_effects_recipient_tt
			custom_tooltip = RICE_sicily_wheat_shipments_opinion_effects_recipient_tt
			show_as_tooltip = {
				RICE_sicily_recipient_gets_wheat_shipments_effect = yes				
			}
			trigger_event = sicily.0051
		}
	}

	after = {
		hidden_effect = {
			RICE_sicily_grain_reaction_effects = yes
		}
	}
}



# Gift target receives Sicilian grain shipments
sicily.0051 = {
	type = letter_event
	opening = {
		desc = sicily.0051.opening
	}
	desc = sicily.0051.desc
	
	sender = scope:actor


	option = {
		name = sicily.0051.a
		scope:actor = {
			show_as_tooltip = {
				remove_short_term_gold = minor_gold_value
				add_prestige = medium_prestige_value
				struggle:RICE_sicily_struggle ?= {
					activate_struggle_catalyst = {
						catalyst = catalyst_RICE_sicily_send_grain
						character = scope:actor
					}
				}
				custom_tooltip = RICE_sicily_wheat_shipments_legitimacy_effects_actor_tt
				custom_tooltip = RICE_sicily_wheat_shipments_opinion_effects_actor_tt
			}
		}
		scope:recipient = {		
			RICE_sicily_recipient_gets_wheat_shipments_effect = yes	
			custom_tooltip = RICE_sicily_wheat_shipments_legitimacy_effects_recipient_tt
			custom_tooltip = RICE_sicily_wheat_shipments_opinion_effects_recipient_tt
		}
	}

	after = {
		hidden_effect = {
			RICE_sicily_grain_reaction_effects = yes
		}
	}

}



# Gift target refuses Sicilian grain shipments
sicily.0052 = {
	type = letter_event
	opening = {
		desc = sicily.0052.opening
	}
	desc = sicily.0052.desc
	
	sender = scope:recipient

	option = {
		name = sicily.0052.a
		scope:actor = {
			add_prestige = -50
		}
		scope:recipient = {			
			#custom_tooltip = RICE_sicily_give_wheat_shipments_reject_effects_1_tt
			#custom_tooltip = RICE_sicily_give_wheat_shipments_reject_effects_2_tt
			reverse_add_opinion = {
				target = scope:actor
				modifier = rejected_opinion
			}
		}
	}
}


# Requestee gives Sicilian grain shipments
sicily.0053 = {
	type = letter_event
	opening = {
		desc = sicily.0053.opening
	}
	desc = sicily.0053.desc
	
	sender = scope:recipient

	option = {
		name = sicily.0053.a
		scope:actor = {
			remove_short_term_gold = minor_gold_value
			add_character_modifier = {
				modifier = RICE_sicily_grain_shipments
				years = 10
			}
			every_held_title = {
				custom = RICE_every_county_UI_actor_owns
				limit = {
					tier = tier_county
					NOT = {
						any_county_province = {
							geographical_region = RICE_insular_sicily	
						}
					}
				}
				custom_tooltip = RICE_sicily_wheat_shipments_control_tt
				custom_tooltip = RICE_sicily_wheat_shipments_development_tt
			}	
			add_opinion = {
				target = scope:recipient
				modifier = grateful_opinion
				opinion = 20
			}
			custom_tooltip = RICE_sicily_wheat_shipments_legitimacy_effects_actor_tt
			custom_tooltip = RICE_sicily_wheat_shipments_opinion_effects_actor_tt
		}
		show_as_tooltip = {
			scope:recipient = {		
				add_prestige = medium_prestige_value
				add_gold = minor_gold_value
				if = {
					limit = {
						scope:recipient = {
							can_add_hook = {
								target = scope:actor
								type = RICE_sicily_grain_hook
							}
						}
					}
					scope:recipient = {
						add_hook = {
							target = scope:actor
							type = RICE_sicily_grain_hook
						}
					}
				}
				struggle:RICE_sicily_struggle ?= {
					activate_struggle_catalyst = {
						catalyst = catalyst_RICE_sicily_request_grain
						character = scope:actor
					}
				}	
				custom_tooltip = RICE_sicily_wheat_shipments_legitimacy_effects_recipient_tt
				custom_tooltip = RICE_sicily_wheat_shipments_opinion_effects_recipient_tt	
			}			
		}
	}

	after = {
		hidden_effect = {
			RICE_sicily_grain_reaction_effects = yes
		}
	}

}


# Requestee gives Sicilian grain shipments (view of sender)
sicily.0054 = {
	type = letter_event
	opening = {
		desc = sicily.0054.opening
	}
	desc = sicily.0054.desc
	
	sender = scope:actor

	option = {
		name = sicily.0054.a
		show_as_tooltip = {
			scope:actor = {
				remove_short_term_gold = minor_gold_value
				add_character_modifier = {
					modifier = RICE_sicily_grain_shipments
					years = 10
				}
				every_held_title = {
					custom = RICE_every_county_UI_actor_owns
					limit = {
						tier = tier_county
						NOT = {
							any_county_province = {
								geographical_region = RICE_insular_sicily	
							}
						}
					}
					custom_tooltip = RICE_sicily_wheat_shipments_control_tt
					custom_tooltip = RICE_sicily_wheat_shipments_development_tt
				}	
				add_opinion = {
					target = scope:recipient
					modifier = grateful_opinion
					opinion = 20
				}
				struggle:RICE_sicily_struggle ?= {
					activate_struggle_catalyst = {
						catalyst = catalyst_RICE_sicily_request_grain
						character = scope:actor
					}
				}
				custom_tooltip = RICE_sicily_wheat_shipments_legitimacy_effects_actor_tt
				custom_tooltip = RICE_sicily_wheat_shipments_opinion_effects_actor_tt
			}
			scope:recipient = {		
				add_prestige = medium_prestige_value
				add_gold = minor_gold_value
				if = {
					limit = {
						scope:recipient = {
							can_add_hook = {
								target = scope:actor
								type = RICE_sicily_grain_hook
							}
						}
					}
					scope:recipient = {
						add_hook = {
							target = scope:actor
							type = RICE_sicily_grain_hook
						}
					}
				}
				custom_tooltip = RICE_sicily_wheat_shipments_legitimacy_effects_recipient_tt
				custom_tooltip = RICE_sicily_wheat_shipments_opinion_effects_recipient_tt	
			}			
		}
	}

	after = {
		hidden_effect = {
			RICE_sicily_grain_reaction_effects = yes
		}
	}

}

# Requestee refuses to give Sicilian grain shipments
sicily.0055 = {
	type = letter_event
	opening = {
		desc = sicily.0055.opening
	}
	desc = sicily.0055.desc
	
	sender = scope:recipient

	option = {
		name = sicily.0055.a
		scope:actor = {
			add_prestige = -50
			add_opinion = {
				target = scope:recipient
				modifier = rejected_opinion
			}
		}
	}
}




######################################################################################
# 
# STARTING SITUATION/ASPIRATION EVENTS
# 
# sicily.0060-sicily.0089
# 
######################################################################################



# Roger, Benavert and other Sicilian Muslim leaders in 1066 Intro Event
sicily.0060 = {
	type = character_event
	title = sicily.0060.t
	desc = {
		desc = sicily.0060.desc
		first_valid = {
			triggered_desc = {
				trigger = {				
					religion = religion:islam_religion
				}
				desc = sicily.0060.desc.muslim
			}
			triggered_desc = {
				trigger = {				
					religion = religion:christianity_religion
				}
				desc = sicily.0060.desc.christian
			}
			desc = sicily.0060.desc.fallback
		}
	}
	theme = martial
	override_background = { reference = RICE_background_sicily_ancient_temple }

	left_portrait = {
		character = scope:roger
		animation = war_over_win
	}
	right_portrait = {
		character = scope:benavert
		animation = marshal
	}

	lower_right_portrait = scope:palermo
	lower_center_portrait = scope:agrigento
	lower_left_portrait = scope:malta

	immediate = {

		culture:norman = {
			save_scope_as = norman
		}

		culture:lombard = {
			save_scope_as = lombard
		}

		culture:greek = {
			save_scope_as = greek
		}

		character:maghrebi0011 = { # ibn al-Thumna
			save_scope_as = al_thumna
		}		

		character:159193 = { # Hassan as-Samson, last Kalbid Emir
			save_scope_as = kalbid
		}		

		character:20829 = { # Benavert
			save_scope_as = benavert
		}		

		character:1132 = { # roger I of Sicily
			save_scope_as = roger
		}		

		character:1128 = { # Robert of Sicily
			save_scope_as = robert
		}		

		title:c_palermo.holder = { # palermo
			save_scope_as = palermo
		}		

		title:c_agrigento.holder = { # agrigento
			save_scope_as = agrigento
		}		

		title:c_malta.holder = { # Palermo
			save_scope_as = malta
		}	
		
		title:c_siracusa.holder = {
			save_scope_as = syracuse
		}

		show_as_tooltip = {	
			scope:benavert = {
				add_character_modifier = {
					modifier = RICE_sicily_aspiration_reunify_sicily
				}
			}
			scope:palermo = {
				add_character_modifier = {
					modifier = RICE_sicily_aspiration_reunify_sicily
				}
			}
			scope:agrigento = {
				add_character_modifier = {
					modifier = RICE_sicily_aspiration_reunify_sicily
				}
			}
			scope:malta = {
				add_character_modifier = {
					modifier = RICE_sicily_aspiration_reunify_sicily
				}
			}
			scope:roger = {
				add_character_modifier = {
					modifier = RICE_sicily_aspiration_complete_conquest_of_sicily
				}
			}
		}
		# In case we have a custom Muslim ruler
		if = {
			limit = {
				has_title = title:c_siracusa
				religion = religion:islam_religion
				NOT = { has_character_modifier = RICE_sicily_aspiration_reunify_sicily }
			}
			add_character_modifier = {
				modifier = RICE_sicily_aspiration_reunify_sicily
			}
		}
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_description_no_bullet = {
				text = sicily.0060.tooltip
			}
		}
	}

	# Ok
	option = {
		name = sicily.0060.a
	}
}


# Roger's Aspiration fulfilled
sicily.0061 = {
	type = character_event
	title = sicily.0061.t
	desc = {
		desc = sicily.0061.desc
		# Benavert's fate
		first_valid = {
			triggered_desc = {
				trigger = {				
					scope:benavert = {
						religion = religion:christianity_religion
					}
				}
				desc = sicily.0061.desc.benavert_converted
			}
			triggered_desc = {
				trigger = {				
					scope:benavert = {
						is_alive = no
					}
				}
				desc = sicily.0061.desc.benavert_dead
			}
		}
		desc = sicily.0061.desc.ending
	}
	theme = RICE_theme_sicily_coastal_town

	right_portrait = {
		character = scope:uniter
		animation = war_over_win
	}

	lower_center_portrait = scope:benavert

	immediate = {

		save_scope_as = uniter

		religion:christianity_religion = { save_scope_as = christian }

		character:1132 = { # Roger
			save_scope_as = roger
		}	

		character:20829 = { # Benavert
			save_scope_as = benavert
		}		

		play_music_cue = "mx_cue_epic_sacral_moment"

		struggle:RICE_sicily_struggle ?= {
			activate_struggle_catalyst = {
				catalyst = catalyst_RICE_sicily_historical_event_new_rulers
				character = scope:uniter
			}
		}	

		RICE_historical_aspiration_fulfilled_effect = yes

		hidden_effect = {
			if = {
				limit = {
					has_character_modifier = RICE_sicily_aspiration_complete_conquest_of_sicily
				}
				remove_character_modifier = RICE_sicily_aspiration_complete_conquest_of_sicily
			}
		}

		# Main Objective Reward
		add_piety = RICE_aspiration_medium_resource_bonus
		add_prestige = RICE_aspiration_medium_resource_bonus
		if = {
			limit = {
				faith = { exists = religious_head }
			}
			faith.religious_head = {
				save_scope_as = hof
			}
			scope:hof = {
				add_opinion = {
					modifier = RICE_conquered_sicily_opinion
					target = root
				}
			}
		}
		every_county_in_region = {
			region = RICE_insular_sicily
			limit = {
				holder = root
			}
			change_development_level = RICE_red_sea_al_umari_aspiration_dev_bonus		
		}

		# Bonus Objective Reward(s)

		# Have piety level 3
		if = {
			limit = {
				piety_level >= 3
			}
			add_legitimacy = medium_legitimacy_gain
		}

		# Be the ruler of Sicily OR own at least 10 counties
		if = {
			limit = {
				OR = {
					has_title = title:d_sicily
					sub_realm_size >= 10
				}
			}
			spawn_army = {
				men_at_arms = {
					type = RICE_sicily_bowmen
					stacks = 4
				}
				location = capital_province
				uses_supply = yes
				inheritable = yes
				name = RICE_sicily_norman_muslim_event_troops
			}
			spawn_army = {
				men_at_arms = {
					type = RICE_norman_cavalry
					stacks = 2
				}
				location = capital_province
				uses_supply = yes
				inheritable = yes
				name = RICE_norman_spawn_event_troops
			}
		}

		# Benavert is converted or dead
		if = {
			limit = {
				scope:benavert = {
					religion = religion:christianity_religion
				}
			}
			add_piety = RICE_aspiration_medium_resource_bonus
		}
		if = {
			limit = {
				scope:benavert = {
					is_alive = no
				}	
			}
			add_prestige = RICE_aspiration_medium_resource_bonus
		}
		if = {
			limit = {
				OR = {
					scope:benavert = {
						is_alive = no
					}					
					scope:benavert = {
						religion = religion:christianity_religion
					}
				}
			}			
			dynasty ?= {
				add_dynasty_prestige = RICE_aspiration_small_resource_bonus
			}
		}

	}

	# Ok
	option = {
		name = sicily.0061.a
	}

	after = {
		# Ping rulers of interest
		every_ruler = {
			limit = {
				is_ai = no
				NOT = { this = root }
				any_held_title = {
					tier = tier_county
					any_county_province = {
						geographical_region = RICE_mediterranean_and_nearby_region
					}
				}
			}
			trigger_event = sicily.0063
		}
	}

}


# Sicily Muslim rulers' Aspiration fulfilled
sicily.0062 = {
	type = character_event
	title = sicily.0062.t
	desc = {
		desc = sicily.0062.desc.intro
		# Roger's fate
		first_valid = {
			triggered_desc = {
				trigger = {				
					scope:roger = {
						religion = religion:islam_religion
					}
				}
				desc = sicily.0062.desc.roger_converted
			}
			triggered_desc = {
				trigger = {				
					scope:roger = {
						is_alive = no
					}
				}
				desc = sicily.0062.desc.roger_dead
			}
		}
		desc = sicily.0062.desc.ending
	}
	theme = RICE_theme_sicily_coastal_town

	right_portrait = {
		character = scope:uniter
		animation = war_over_win
	}

	immediate = {

		add_character_flag = RICE_sicily_no_ping_event_needed

		faith = {
			save_scope_as = faith
		}
		culture:norman = {
			save_scope_as = norman
		}
		title:d_sicily.holder = {
			save_scope_as = uniter
		}

		
		character:1132 = { # Roger
			save_scope_as = roger
		}	

		play_music_cue = "mx_cue_epic_sacral_moment"

		struggle:RICE_sicily_struggle ?= {
			activate_struggle_catalyst = {
				catalyst = catalyst_RICE_sicily_historical_event_new_rulers
				character = scope:uniter
			}
		}	

		RICE_historical_aspiration_fulfilled_effect = yes

		hidden_effect = {
			if = {
				limit = {
					has_character_modifier = RICE_sicily_aspiration_reunify_sicily
				}
				remove_character_modifier = RICE_sicily_aspiration_reunify_sicily
			}
		}

		# Main Objective Reward
		if = {
			limit = {
				root = scope:uniter
			}
			RICE_sicily_1066_muslim_aspiration_completed_effect = yes
		}
		else = {
			show_as_tooltip = {
				scope:uniter = {
					RICE_sicily_1066_muslim_aspiration_completed_effect = yes
				}
			}
		}

	}

	# Ok
	option = {
		name = sicily.0062.a
	}


	after = {
		# Ping rulers of interest
		every_ruler = {
			limit = {
				is_ai = no
				any_held_title = {
					tier = tier_county
					any_county_province = {
						geographical_region = RICE_mediterranean_and_nearby_region
					}
				}
				NOT = { has_character_flag = RICE_sicily_no_ping_event_needed }
			}
			trigger_event = sicily.0063
		}
		if = {
			limit = {
				has_character_flag = RICE_sicily_no_ping_event_needed
			}
			remove_character_flag = RICE_sicily_no_ping_event_needed
		}
	}

}

# Notification event for the region
sicily.0063 = {
	type = character_event
	title = sicily.0063.t
	desc = sicily.0063.desc
	theme = RICE_theme_sicily_coastal_town

	right_portrait = {
		character = scope:uniter
		animation = war_over_win
	}

	immediate = {

		play_music_cue = "mx_cue_epic_sacral_moment"
		
		character:159193 = { # Hassan as-Samson, last Kalbid Emir
			save_scope_as = kalbid
		}	

		if = {
			limit = {
				OR = {
					any_character_struggle = {
						involvement = involved
						is_struggle_type = RICE_sicily_struggle
					}					
					any_character_struggle = {
						involvement = interloper
						is_struggle_type = RICE_sicily_struggle
					}
					any_held_title = {
						tier = tier_county
						any_county_province = {
							geographical_region = custom_sicily
						}
					}					
				}
			}
			show_as_tooltip = {
				struggle:RICE_sicily_struggle ?= {
					activate_struggle_catalyst = {
						catalyst = catalyst_RICE_sicily_historical_event_new_rulers
						character = scope:uniter
					}
				}				
			}
		}

	}

	# Ok
	option = {
		name = sicily.0063.a
	}

}




# Sawdan Intro Event
sicily.0064 = {
	type = character_event
	title = sicily.0064.t
	desc = sicily.0064.desc
	theme = martial
	override_background = { reference = RICE_background_sicily_amalfi_coast }

	left_portrait = {
		character = scope:louis
		animation = personality_vengeful
	}
	right_portrait = {
		character = scope:sawdan
		animation = personality_callous
	}

	immediate = {

		religion:islam_religion = { save_scope_as = islam }
		religion:christianity_religion = { save_scope_as = christian }

		character:163094 = { # Sawdan
			save_scope_as = sawdan
		}		

		character:30228 = { # Emperor Louis
			save_scope_as = louis
		}		

		character:1700 = { # Byzantine Emperor
			save_scope_as = emperor
		}		

		character:34014 = { # Abbasid Caliph
			save_scope_as = abbasid
		}		

		show_as_tooltip = {	
			scope:sawdan = {
				add_character_modifier = {
					modifier = RICE_sicily_aspiration_establish_islam_in_southern_italy
				}
			}
		}
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_description_no_bullet = {
				text = sicily.0064.tooltip
			}
		}
	}

	# Ok
	option = {
		name = sicily.0064.a
	}
}


# Sawdan's Aspiration fulfilled
sicily.0065 = {
	type = character_event
	title = sicily.0065.t
	desc = sicily.0065.desc
	theme = RICE_theme_sicily_coastal_town

	right_portrait = {
		character = scope:sawdan
		animation = war_over_win
	}

	immediate = {

		save_scope_as = sawdan

		religion:islam_religion = { save_scope_as = islam }
		religion:christianity_religion = { save_scope_as = christian }

		play_music_cue = "mx_Struggle_ending_hostility"

		struggle:RICE_sicily_struggle ?= {
			activate_struggle_catalyst = {
				catalyst = catalyst_RICE_sicily_historical_event_new_rulers
				character = scope:sawdan
			}
		}	

		RICE_historical_aspiration_fulfilled_effect = yes

		hidden_effect = {
			if = {
				limit = {
					has_character_modifier = RICE_sicily_aspiration_establish_islam_in_southern_italy
				}
				remove_character_modifier = RICE_sicily_aspiration_establish_islam_in_southern_italy
			}
		}

		# Main Objective Reward
		add_piety = RICE_aspiration_medium_resource_bonus
		add_prestige = RICE_aspiration_medium_resource_bonus
		add_legitimacy = medium_legitimacy_gain
		spawn_army = {
			levies = 400
			men_at_arms = {
				type = RICE_sicily_bowmen
				stacks = 2
			}
			men_at_arms = {
				type = mubarizun
				stacks = 1
			}
			men_at_arms = {
				type = pikemen_unit
				stacks = 1
			}
			men_at_arms = {
				type = light_footmen
				stacks = 1
			}
			men_at_arms = {
				type = light_horsemen
				stacks = 1
			}
			location = capital_province
			uses_supply = yes
			inheritable = yes
			name = RICE_southern_italy_intervention_event_troops
		}
		if = {
			limit = {
				faith = { exists = religious_head }
			}
			faith.religious_head = {
				save_scope_as = hof
			}
			scope:hof = {
				add_opinion = {
					modifier = RICE_conquered_sicily_opinion
					target = root
				}
			}
		}
		custom_tooltip = sicily.0065.a.tooltip

		# Bonus Objective Reward(s)

		# Took the Sicily soldier decision at least once
		if = {
			limit = {
				has_character_flag = RICE_sawdan_sicily_soldier_decision_taken
			}
			add_martial_lifestyle_perk_points = 1
		}

		# Be a king or hold at least three duchy titles
		if = {
			limit = {
				OR = {
					highest_held_title_tier >= tier_kingdom
					any_held_title = {
						tier = tier_duchy
						count >= 3
					}
				}
			}
			dynasty ?= {
				add_dynasty_prestige = RICE_aspiration_large_resource_bonus
			}
		}

		# Control Rome
		if = {
			limit = {
				has_title = title:c_roma
			}
			add_gold = RICE_aspiration_medium_resource_bonus
		}

	}

	# Ok
	option = {
		name = sicily.0065.a
	}

	after = {
		# Ping rulers of interest
		every_ruler = {
			limit = {
				is_ai = no
				NOT = { this = root }
				any_held_title = {
					tier = tier_county
					any_county_province = {
						geographical_region = RICE_mediterranean_and_nearby_region
					}
				}
			}
			trigger_event = sicily.0066
		}
	}

}

# Notification event for the region
sicily.0066 = {
	type = character_event
	title = sicily.0066.t
	desc = sicily.0066.desc
	theme = RICE_theme_sicily_coastal_town

	right_portrait = {
		character = scope:sawdan
		animation = war_over_win
	}

	immediate = {

		play_music_cue = "mx_Struggle_ending_hostility"

		if = {
			limit = {
				OR = {
					any_character_struggle = {
						involvement = involved
						is_struggle_type = RICE_sicily_struggle
					}					
					any_character_struggle = {
						involvement = interloper
						is_struggle_type = RICE_sicily_struggle
					}
					any_held_title = {
						tier = tier_county
						any_county_province = {
							geographical_region = custom_sicily
						}
					}					
				}
			}
			show_as_tooltip = {
				struggle:RICE_sicily_struggle ?= {
					activate_struggle_catalyst = {
						catalyst = catalyst_RICE_sicily_historical_event_new_rulers
						character = scope:uniter
					}
				}				
			}
		}
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_description_no_bullet = {
				text = sicily.0064.tooltip
			}
		}

	}

	# Ok
	option = {
		name = sicily.0066.a
	}

}



# Abu Aaron prepares to leave, ping event
sicily.0070 = {
	type = character_event
	hidden = yes

	trigger = {
		NOT = { has_global_variable = RICE_sicily_abu_aaron_event_happened }
	}

	immediate = {

		# If Abu Aaron isn't in a ruler's court that's not in Babylon, trigger the event again at a later time
		if = {
			limit = {
				OR = {
					is_ruler = yes
					is_foreign_court_or_pool_guest = yes
					employer ?= {
						OR = {
							is_landed = no
							any_held_title = {
								tier = tier_county
								any_county_province = {
									geographical_region = ghw_region_near_east
								}
							}
							highest_held_title_tier = tier_barony
						}
					}
				}
			}

			trigger_event = {
				id = sicily.0070
				years = { 3 8 }
			}

		}

		# If Abu Aaron is in a qualifying court
		else_if = {
			limit = {
				employer ?= {
					is_landed = yes
					highest_held_title_tier > tier_barony
					NOT = {
						any_held_title = {
							tier = tier_county
							any_county_province = {
								geographical_region = ghw_region_near_east
							}
						}
					}
				}
			}
			employer = {
				trigger_event = sicily.0071
			}
		}

		# Failsafe for edge cases
		else = {
			trigger_event = {
				id = sicily.0070
				years = { 3 10 }
			}
		}

	}
}

# Abu Aaron says he'll be leaving
sicily.0071 = {
	type = character_event
	title = sicily.0071.t
	desc = {
		desc = sicily.0071.desc
		triggered_desc = {
			trigger = {
				root = character:163094
				has_relation_friend = scope:abu_aaron
			}
			desc = sicily.0071.desc.sawdan
		}
	}
	theme = travel_pilgrimage
	override_background = { reference = RICE_background_sicily_coastal_town }
	
	left_portrait = {
		character = root
		animation = sadness
	}
	
	right_portrait = {
		character = scope:abu_aaron
		animation = personality_forgiving
	}

	immediate = {
		save_scope_as = abu_aaron_original_liege
		character:RICE_sicily_jewish_001 = {
			save_scope_as = abu_aaron
		}
		title:c_baghdad.holder = {
			save_scope_as = baghdad_holder
		}
		set_global_variable = {
			name = RICE_sicily_abu_aaron_event_happened
			value = yes
		}
	}
	
	option = { # Let him go
		name = sicily.0071.a
		add_piety = major_piety_gain
		scope:abu_aaron = {
			set_employer = scope:baghdad_holder
			start_travel_plan = {
				destination = scope:baghdad_holder.capital_province
				return_trip = no # One way
			}
		}
		scope:baghdad_holder = {
			trigger_event = sicily.0072
		}
	}


	option = { # Try to detain him
		name = sicily.0071.b
		add_prestige = major_prestige_loss
		# scope:abu_aaron = {
		# 	if = {
		# 		limit = { has_relation_friend = root }
		# 		remove_friend_or_downgrade_friendship_effect = { SCOPE = root }
		# 	}
		# 	else_if = {
		# 		limit = { has_relation_lover = root }
		# 		remove_relation_lover = root
		# 	}
		# }
		duel = {
			skills = { prowess intrigue diplomacy }
			target = scope:courtier_1
			# You fail to detain him
			10 = {
				desc = sicily.0071.b.failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = -0.9
					min = -49
					max = 49
				}
				send_interface_toast = {
					type = event_toast_effect_bad
					left_icon = scope:abu_aaron
					title = sicily.0071.b.failure
					scope:abu_aaron = {
						set_employer = scope:baghdad_holder
						add_opinion = {
							modifier = disappointed_opinion
							target = root
							opinion = -40
						}
						start_travel_plan = {
							destination = scope:baghdad_holder.capital_province
							return_trip = no # One way
						}
					}
				}	
				scope:baghdad_holder = {
					trigger_event = sicily.0072
				}
			}
			# You manage to detain him
			10 = {
				desc = sicily.0071.b.success
				compare_modifier = {
					value = scope:duel_value
					multiplier = 0.9
					min = -49
					max = 49
				}
				send_interface_toast = {
					type = event_toast_effect_good
					left_icon = scope:abu_aaron
					title = sicily.0071.b.success
					scope:abu_aaron = {
						add_trait = depressed_1
						add_opinion = {
							modifier = angry_opinion
							target = root
							opinion = -40
						}
					}
					imprison = {
						target = scope:abu_aaron
						type = house_arrest
					}
				}
			}
		}
	}

	
}


# Abu Aaron returns home
sicily.0072 = {
	type = character_event
	title = sicily.0072.t
	desc = sicily.0072.desc
	theme = diplomacy
	
	right_portrait = {
		character = scope:abu_aaron
		animation = throne_room_bow_1
	}

	lower_center_portrait = scope:abu_aaron_original_liege

	immediate = {
		# Make sure you can't convert Abu Aaron
		hidden_effect = {
			scope:abu_aaron = {
				trigger_event = RICEmisc.0002
			}
		}
		show_as_tooltip = {
			scope:abu_aaron = {
				set_employer = scope:baghdad_holder
			}			
		}
	}
	
	option = { # Ok
		name = sicily.0072.a
	}
}


######################################################################################
# 
# BATHS OF BAIA
# 
# sicily.0090-sicily.0099
# 
######################################################################################

# Setup activity
sicily.0090 = {
	type = character_event
	title = sicily.0090.t
	desc = sicily.0090.desc
	theme = RICE_theme_sicily_travel
	
	left_portrait = {
		character = root
		animation = personality_content
	}

	trigger = {
		is_available_travelling = yes
		is_landed = yes
		exists = involved_activity
		involved_activity = {
			has_activity_type = activity_RICE_hot_springs_visit
			activity_location.barony = title:b_napoli
		}
	}
	
	option = { # Ok
		name = sicily.0090.a
		if = {
			limit = {
				faith = {
					NOT = { trait_is_virtue = chaste }
					OR = {
						has_doctrine = tenet_hedonistic
						has_doctrine = tenet_carnal_exaltation
						trait_is_virtue = lustful
					}
				}
			}
			custom_tooltip = RICE_sicily_baia_modifier.travel.dont_care
		}
		else_if = {
			limit = {			
				OR = {
					AND = {
						faith = { has_doctrine_parameter = male_dominated_law }
						is_female = yes
					}
					AND = {
						faith = { has_doctrine_parameter = female_dominated_law }
						is_male = yes
					}
				}
			}
			custom_tooltip = RICE_sicily_baia_modifier.travel.non_dominant
		}
		else = {
			custom_tooltip = RICE_sicily_baia_modifier.travel.dominant
		}
	}	
}


# Day of the Springs visit
sicily.0091 = {
	type = activity_event
	title = sicily.0091.t
	desc = sicily.0091.desc
	theme = RICE_theme_sicily_amalfi_coast
	
	right_portrait = {
		character = root
		animation = happiness
	}

	immediate = {
		add_character_flag = is_naked
		scope:activity = {
			activity_location = { save_scope_as = location }
		}
		if = {
			limit = {
				scope:activity = {
					has_activity_option = {
						category = special_type
						option = RICE_hot_springs_visit_type_public
					}
				}
			}
			set_variable = {
				name = RICE_hot_springs_visit_special_type
				value = flag:public
				days = 1
			}
		}
		else = {			
			set_variable = {
				name = RICE_hot_springs_visit_special_type
				value = flag:private
				days = 1
			}
		}
	}
	
	option = { # Relaxing
		name = sicily.0091.a
		stress_impact = {
			base = miniscule_stress_impact_loss
		}
	}
	
	option = { # Beaches
		name = sicily.0091.b
		add_prestige = miniscule_prestige_gain
	}
	
	option = { # Sightseeing
		name = sicily.0091.c
		RICE_minor_lifestyle_experience_gain_effect = yes
	}
	
	after = {
		RICE_sicily_visit_baia_effect = yes
		if = {
			limit = { has_character_flag = is_naked }
			remove_character_flag = is_naked
		}
		# RICE_hot_springs_memory_effect = yes
		set_variable = {
			name = RICE_hot_springs_visit_special_location
			value = flag:baia
			days = 1
		}
		scope:activity = {
			every_attending_character = {
				limit = { NOT = { this = scope:host } }
				custom = EVERY_ACTIVITY_PARTICIPANT_EFFECT
				stress_impact = {
					base = minor_stress_impact_loss
				}
				# random_list = {
				# 	desc = RICE_sicily_baia_enjoy_yourself_tt
				# 	100 = {
				# 		show_chance = no
				# 		desc = RICE_sicily_baia_modifier.dominant
				# 		trigger = {
				# 			NOT = {
				# 				faith = {
				# 					NOT = { trait_is_virtue = chaste }
				# 					OR = {
				# 						faith = { has_doctrine = tenet_hedonistic }
				# 						faith = { has_doctrine = tenet_carnal_exaltation }
				# 						trait_is_virtue = lustful
				# 					}
				# 				}
				# 			}
				# 			NOR = {
				# 				AND = {
				# 					faith = { has_doctrine_parameter = male_dominated_law }
				# 					is_female = yes
				# 				}
				# 				AND = {
				# 					faith = { has_doctrine_parameter = female_dominated_law }
				# 					is_male = yes
				# 				}
				# 			}						
				# 		}
				# 		add_character_modifier = {
				# 			modifier = RICE_sicily_visit_baia_normal
				# 			years = 10
				# 		}
				# 	}
				# 	100 = {
				# 		show_chance = no
				# 		desc = RICE_sicily_baia_modifier.non_dominant
				# 		trigger = {
				# 			NOT = {
				# 				faith = {
				# 					NOT = { trait_is_virtue = chaste }
				# 					OR = {
				# 						faith = { has_doctrine = tenet_hedonistic }
				# 						faith = { has_doctrine = tenet_carnal_exaltation }
				# 						trait_is_virtue = lustful
				# 					}
				# 				}
				# 			}
				# 			OR = {
				# 				AND = {
				# 					faith = { has_doctrine_parameter = male_dominated_law }
				# 					is_female = yes
				# 				}
				# 				AND = {
				# 					faith = { has_doctrine_parameter = female_dominated_law }
				# 					is_male = yes
				# 				}
				# 			}						
				# 		}
				# 		add_character_modifier = {
				# 			modifier = RICE_sicily_visit_baia_naughty
				# 			years = 10
				# 		}
				# 	}
				# 	# You're a faith that doesn't care about such things
				# 	100 = {
				# 		show_chance = no
				# 		desc = RICE_sicily_baia_modifier.dont_care
				# 		trigger = {
				# 			faith = {
				# 				NOT = { trait_is_virtue = chaste }
				# 				OR = {
				# 					faith = { has_doctrine = tenet_hedonistic }
				# 					faith = { has_doctrine = tenet_carnal_exaltation }
				# 					trait_is_virtue = lustful
				# 				}
				# 			}					
				# 		}
				# 		add_character_modifier = {
				# 			modifier = RICE_sicily_visit_baia_naughty
				# 			years = 10
				# 		}
				# 	}
				# }
				# if = {
				# 	limit = {
				# 		OR = {
				# 			AND = {
				# 				faith = { has_doctrine_parameter = male_dominated_law }
				# 				is_female = yes
				# 			}
				# 			AND = {
				# 				faith = { has_doctrine_parameter = female_dominated_law }
				# 				is_male = yes
				# 			}
				# 		}
				# 	}
				# 	add_character_modifier = {
				# 		modifier = RICE_sicily_visit_baia_naughty
				# 		years = 10
				# 	}
				# }
				# else = {
				# 	add_character_modifier = {
				# 		modifier = RICE_sicily_visit_baia_normal
				# 		years = 10
				# 	}
				# }
			}	
			hidden_effect = { skip_activity_phase = yes }
		}
	}	
}






######################################################################################
# 
# ADMINISTER FRONTIER DECISION
# 
# sicily.0100-sicily.0119
# 
######################################################################################


# Promote Officials
sicily.0100 = {
	type = character_event
	title = sicily.0100.t
	desc = sicily.0100.desc
	theme = diplomacy
	override_background = { reference = RICE_background_sicily_interior }
	
	right_portrait = {
		character = root
		animation = thinking
	}
	
	option = { # Latin
		name = sicily.0100.a
		trigger = {
			OR = {
				any_held_county = {
					any_county_province = {
						geographical_region = custom_sicily
					}
					RICE_sicily_latin_trigger = yes
				}		
				any_vassal_or_below = {
					any_held_county = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_latin_trigger = yes
					}	
				}
				RICE_sicily_latin_trigger = yes	
				has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_latin value >= 50 }		
			}
		}
		set_variable = {
			name = RICE_sicily_promote_officials_type
			value = flag:latin
			days = 1
		}
	}
	
	option = { # Greek
		name = sicily.0100.b
		trigger = {
			OR = {
				any_held_county = {
					any_county_province = {
						geographical_region = custom_sicily
					}
					RICE_sicily_greek_trigger = yes
				}	
				any_vassal_or_below = {
					any_held_county = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_greek_trigger = yes
					}	
				}
				RICE_sicily_greek_trigger = yes	
				has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_greek value >= 50 }		
			}
		}
		set_variable = {
			name = RICE_sicily_promote_officials_type
			value = flag:greek
			days = 1
		}
	}
	
	option = { # Arab-Berber
		name = sicily.0100.c
		trigger = {
			OR = {
				any_held_county = {
					any_county_province = {
						geographical_region = custom_sicily
					}
					RICE_sicily_arabic_trigger = yes
				}			
				any_vassal_or_below = {
					any_held_county = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_arabic_trigger = yes
					}	
				}
				RICE_sicily_arabic_trigger = yes	
				has_trait_xp = { trait = RICE_sicilian_ruler track = RICE_sicilian_ruler_arabic value >= 50 }		
			}
		}
		set_variable = {
			name = RICE_sicily_promote_officials_type
			value = flag:arabic
			days = 1
		}
	}
	
	option = { # Self
		name = sicily.0100.d
		trigger = {
			NOR = {
				RICE_sicily_latin_trigger = yes
				RICE_sicily_greek_trigger = yes
				RICE_sicily_arabic_trigger = yes
			}
		}
		set_variable = {
			name = RICE_sicily_promote_officials_type
			value = flag:none
			days = 1
		}
	}

	after = {
		trigger_event = sicily.0101
	}
	
}


# Promote Officials
sicily.0101 = {
	type = character_event
	title = sicily.0101.t
	desc = sicily.0101.desc
	theme = diplomacy
	override_background = { reference = RICE_background_sicily_interior }
	
	right_portrait = {
		character = root
		animation = writing
	}

	
	option = { # Diplomacy
		name = sicily.0101.a		
		set_variable = {
			name = RICE_sicily_promote_officials_class
			value = flag:diplomacy
			days = 1
		}
	}
	
	option = { # Martial
		name = sicily.0101.b	
		set_variable = {
			name = RICE_sicily_promote_officials_class
			value = flag:martial
			days = 1
		}
	}
	
	option = { # Stewardship
		name = sicily.0101.c
		set_variable = {
			name = RICE_sicily_promote_officials_class
			value = flag:stewardship
			days = 1
		}
	}
	
	option = { # Intrigue
		name = sicily.0101.d
		set_variable = {
			name = RICE_sicily_promote_officials_class
			value = flag:intrigue
			days = 1
		}
	}
	
	option = { # Learning
		name = sicily.0101.e
		set_variable = {
			name = RICE_sicily_promote_officials_class
			value = flag:learning
			days = 1
		}
	}

	after = {
		trigger_event = sicily.0102
	}
	
}




# Promote Officials
sicily.0102 = {
	type = character_event
	title = sicily.0102.t
	desc = sicily.0102.desc
	theme = stewardship_duty_focus
	override_background = { reference = RICE_background_sicily_interior }
	
	left_portrait = scope:official_1
	
	right_portrait = scope:official_2

	immediate = {

		# Save a potential county for reference
		if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:latin
				OR = {
					any_held_county = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_latin_trigger = yes
					}		
					any_vassal_or_below = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_latin_trigger = yes
						}	
					}
				}
			}
			if = {
				limit = {
					any_held_county = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_latin_trigger = yes
					}
				}
				every_held_county = {
					limit = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_latin_trigger = yes
					}
					add_to_list = candidate_counties
				}
			}
			if = {
				limit = {	
					any_vassal_or_below = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_latin_trigger = yes
						}	
					}
				}
				every_vassal_or_below = {
					limit = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_latin_trigger = yes
						}
					}
					every_held_county = {
						limit = {							
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_latin_trigger = yes
						}
						add_to_list = candidate_counties
					}
				}
			}
			random_in_list = {
				list = candidate_counties
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:latin
				any_county_in_region = {
					region = RICE_mediterranean_and_nearby_region
					RICE_sicily_latin_trigger = yes
				}

			}
			every_county_in_region = {
				region = RICE_mediterranean_and_nearby_region
				limit = {
					RICE_sicily_latin_trigger = yes
				}
				add_to_list = candidate_counties
			}
			random_in_list = {
				list = candidate_counties
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:latin

			}
			add_character_flag = {
				flag = RICE_sicily_promote_officials_no_counties
				days = 1
			}
			random_list = {
				20 = { culture:italian = { save_scope_as = sicily_culture } }
				20 = { culture:cisalpine = { save_scope_as = sicily_culture } }
				10 = { culture:frankish = { save_scope_as = sicily_culture } }
				10 = { culture:castilian = { save_scope_as = sicily_culture } }
				10 = { culture:andalusian = { save_scope_as = sicily_culture } }
				20 = { culture:norman = { save_scope_as = sicily_culture } }
				10 = { culture:franconian = { save_scope_as = sicily_culture } }
				10 = { culture:dutch = { save_scope_as = sicily_culture } }
				10 = { culture:anglo_saxon = { save_scope_as = sicily_culture } }
				10 = { culture:catalan = { save_scope_as = sicily_culture } }
				10 = { culture:occitan = { save_scope_as = sicily_culture } }
				10 = { culture:saxon = { save_scope_as = sicily_culture } }
				20 = { culture:lombard = { save_scope_as = sicily_culture } }
			}
			faith:catholic = { save_scope_as = sicily_faith }
			capital_county = {
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:greek
				OR = {
					any_held_county = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_greek_trigger = yes
					}		
					any_vassal_or_below = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_greek_trigger = yes
						}	
					}
				}

			}
			if = {
				limit = {
					any_held_county = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_greek_trigger = yes
					}
				}
				every_held_county = {
					limit = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_greek_trigger = yes
					}
					add_to_list = candidate_counties
				}
			}
			if = {
				limit = {	
					any_vassal_or_below = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_greek_trigger = yes
						}	
					}
				}
				every_vassal_or_below = {
					limit = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_greek_trigger = yes
						}
					}
					every_held_county = {
						limit = {							
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_greek_trigger = yes
						}
						add_to_list = candidate_counties
					}
				}
			}
			random_in_list = {
				list = candidate_counties
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:greek
				any_county_in_region = {
					region = RICE_mediterranean_and_nearby_region
					RICE_sicily_greek_trigger = yes
				}

			}
			every_county_in_region = {
				region = RICE_mediterranean_and_nearby_region
				limit = {
					RICE_sicily_greek_trigger = yes
				}
				add_to_list = candidate_counties
			}
			random_in_list = {
				list = candidate_counties
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:greek

			}
			add_character_flag = {
				flag = RICE_sicily_promote_officials_no_counties
				days = 1
			}
			random_list = {
				50 = { culture:greek = { save_scope_as = sicily_culture } }
				10 = { culture:armenian = { save_scope_as = sicily_culture } }
				10 = { culture:bulgarian = { save_scope_as = sicily_culture } }
			}
			faith:orthodox = { save_scope_as = sicily_faith }
			capital_county = {
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:arabic
				OR = {
					any_held_county = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_arabic_trigger = yes
					}		
					any_vassal_or_below = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_arabic_trigger = yes
						}	
					}
				}

			}

			if = {
				limit = {
					any_held_county = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_arabic_trigger = yes
					}
				}
				every_held_county = {
					limit = {
						any_county_province = {
							geographical_region = custom_sicily
						}
						RICE_sicily_arabic_trigger = yes
					}
					add_to_list = candidate_counties
				}
			}
			if = {
				limit = {	
					any_vassal_or_below = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_arabic_trigger = yes
						}	
					}
				}
				every_vassal_or_below = {
					limit = {
						any_held_county = {
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_arabic_trigger = yes
						}
					}
					every_held_county = {
						limit = {							
							any_county_province = {
								geographical_region = custom_sicily
							}
							RICE_sicily_arabic_trigger = yes
						}
						add_to_list = candidate_counties
					}
				}
			}
			random_in_list = {
				list = candidate_counties
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:arabic
				any_county_in_region = {
					region = RICE_mediterranean_and_nearby_region
					RICE_sicily_arabic_trigger = yes
				}

			}
			every_county_in_region = {
				region = RICE_mediterranean_and_nearby_region
				limit = {
					RICE_sicily_arabic_trigger = yes
				}
				add_to_list = candidate_counties
			}
			random_in_list = {
				list = candidate_counties
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:arabic

			}
			add_character_flag = {
				flag = RICE_sicily_promote_officials_no_counties
				days = 1
			}
			random_list = {
				20 = { culture:andalusian = { save_scope_as = sicily_culture } }
				20 = { culture:maghrebi = { save_scope_as = sicily_culture } }
				10 = { culture:butr = { save_scope_as = sicily_culture } }
				10 = { culture:baranis = { save_scope_as = sicily_culture } }
				10 = { culture:egyptian = { save_scope_as = sicily_culture } }
				10 = { culture:levantine = { save_scope_as = sicily_culture } }
				10 = { culture:yemeni = { save_scope_as = sicily_culture } }
				10 = { culture:persian = { save_scope_as = sicily_culture } }
				20 = { culture:siculo_arabic = { save_scope_as = sicily_culture } }
				10 = { culture:kurdish = { save_scope_as = sicily_culture } }
			}
			random_list = {
				10 = { faith:ashari = { save_scope_as = sicily_faith } }
				10 = { faith:muwalladi = { save_scope_as = sicily_faith } }
				10 = { faith:ismaili = { save_scope_as = sicily_faith } }
				10 = { faith:ibadi = { save_scope_as = sicily_faith } }
			}
			capital_county = {
				save_scope_as = county
			}
		}	
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:none

			}
			add_character_flag = {
				flag = RICE_sicily_promote_officials_no_counties
				days = 1
			}
			root.faith = {
				save_scope_as = sicily_faith
			}
			root.faith = {
				save_scope_as = sicily_culture
			}
			capital_county = {
				save_scope_as = county
			}
		}	

		if = {
			limit = {
				NOT = { has_character_flag = RICE_sicily_promote_officials_no_counties }
			}
			scope:county.faith = {
				save_scope_as = sicily_faith
			}		
			scope:county.culture = {
				save_scope_as = sicily_culture
			}
		}

		if = {
			limit = {
				var:RICE_sicily_promote_officials_class ?= flag:diplomacy
			}
			create_character = {
				location = root.capital_province
				template = RICE_sicily_promoted_official_diplomacy_template
				save_scope_as = official_1
			}
			create_character = {
				location = root.capital_province
				template = RICE_sicily_promoted_official_diplomacy_template
				save_scope_as = official_2
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_class ?= flag:martial
			}
			create_character = {
				location = root.capital_province
				template = RICE_sicily_promoted_official_martial_template
				save_scope_as = official_1
			}
			create_character = {
				location = root.capital_province
				template = RICE_sicily_promoted_official_martial_template
				save_scope_as = official_2
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_class ?= flag:stewardship
			}
			create_character = {
				location = root.capital_province
				template = RICE_sicily_promoted_official_stewardship_template
				save_scope_as = official_1
			}
			create_character = {
				location = root.capital_province
				template = RICE_sicily_promoted_official_stewardship_template
				save_scope_as = official_2
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_class ?= flag:intrigue
			}
			create_character = {
				location = root.capital_province
				template = RICE_sicily_promoted_official_intrigue_template
				save_scope_as = official_1
			}
			create_character = {
				location = root.capital_province
				template = RICE_sicily_promoted_official_intrigue_template
				save_scope_as = official_2
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_class ?= flag:learning
			}
			create_character = {
				location = root.capital_province
				template = RICE_sicily_promoted_official_learning_template
				save_scope_as = official_1
			}
			create_character = {
				location = root.capital_province
				template = RICE_sicily_promoted_official_learning_template
				save_scope_as = official_2
			}
		}

	}
	
	option = { # Option 1
		name = sicily.0102.a
		add_courtier = scope:official_1
		if = {
			limit = {
				can_add_hook = {
					target = scope:official_1
					type = loyalty_hook
				}
			}
			add_hook = {
				target = scope:official_1
				type = loyalty_hook
			}
		}
		if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:latin
			}
			RICE_sicily_signore_latin_track_medium_gain = yes
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:greek
			}
			RICE_sicily_signore_greek_track_medium_gain = yes
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:arabic
			}
			RICE_sicily_signore_arabic_track_medium_gain = yes
		}
		RICE_sicily_officials_effect = yes
		hidden_effect = {
			scope:official_2 = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
	
	option = { # Option 2
		name = sicily.0102.b
		add_courtier = scope:official_2
		if = {
			limit = {
				can_add_hook = {
					target = scope:official_2
					type = loyalty_hook
				}
			}
			add_hook = {
				target = scope:official_2
				type = loyalty_hook
			}
		}
		if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:latin
			}
			RICE_sicily_signore_latin_track_medium_gain = yes
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:greek
			}
			RICE_sicily_signore_greek_track_medium_gain = yes
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:arabic
			}
			RICE_sicily_signore_arabic_track_medium_gain = yes
		}
		RICE_sicily_officials_effect = yes
		hidden_effect = {
			scope:official_1 = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
	
	option = { # Promote both
		name = sicily.0102.c
		trigger = {
			OR = {
				is_ai = no
				short_term_gold >= medium_gold_value			
			}
		}
		remove_short_term_gold = medium_gold_value
		add_courtier = scope:official_1
		add_courtier = scope:official_2
		if = {
			limit = {
				can_add_hook = {
					target = scope:official_1
					type = loyalty_hook
				}
			}
			add_hook = {
				target = scope:official_1
				type = loyalty_hook
			}
		}
		if = {
			limit = {
				can_add_hook = {
					target = scope:official_2
					type = loyalty_hook
				}
			}
			add_hook = {
				target = scope:official_2
				type = loyalty_hook
			}
		}
		add_prestige = minor_prestige_gain
		add_legitimacy = miniscule_legitimacy_gain
		if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:latin
			}
			RICE_sicily_signore_latin_track_major_gain = yes
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:greek
			}
			RICE_sicily_signore_greek_track_major_gain = yes
		}
		else_if = {
			limit = {
				var:RICE_sicily_promote_officials_type ?= flag:arabic
			}
			RICE_sicily_signore_arabic_track_major_gain = yes
		}
		RICE_sicily_officials_effect = yes
	}
	
	# option = { # No
	# 	name = sicily.0102.d
	# }

	after = {
		if = {
			limit = {
				has_variable = RICE_sicily_promote_officials_type
			}
			remove_variable = RICE_sicily_promote_officials_type
		}
		if = {
			limit = {
				has_variable = RICE_sicily_promote_officials_class
			}
			remove_variable = RICE_sicily_promote_officials_class
		}
	}
	
}


# Updating Bureaucratic Records
sicily.0103 = {
	type = character_event
	title = sicily.0103.t
	desc = sicily.0103.desc
	theme = stewardship_domain_focus
	override_background = { reference = RICE_background_sicily_interior }
	
	left_portrait = {
		character = scope:councillor
		animation = writing
	}
	
	right_portrait = {
		character = root
		animation = thinking
	}

	immediate = {
		# Choose the councilor to talk to you
		if = {
			limit = {
				exists = cp:councillor_chancellor
			}
			cp:councillor_chancellor = {
				add_to_list = councilor_candidates
			}
		}
		if = {
			limit = {
				exists = cp:councillor_steward
			}
			cp:councillor_steward = {
				add_to_list = councilor_candidates
			}
		}
		if = {
			limit = {
				exists = cp:councillor_court_chaplain
			}
			cp:councillor_court_chaplain = {
				add_to_list = councilor_candidates
			}
		}
		if = {
			limit = {
				is_married = yes
			}
			random_spouse = {
				add_to_list = councilor_candidates
			}
		}
		random_in_list = {
			list = councilor_candidates
			save_scope_as = councillor
		}
	}
	
	option = { # Latin
		name = sicily.0103.a
		RICE_sicily_signore_latin_track_minor_gain = yes
		RICE_sicily_records_effect = yes
		every_county_in_region = {
			region = custom_sicily
			limit = {
				holder = root
			}
			custom = RICE_every_county_owned_sicily
			add_county_modifier = {
				modifier = RICE_sicily_updated_bureaucratic_records_latin
				years = 10
			}		
		}
	}
	
	option = { # Greek
		name = sicily.0103.b
		RICE_sicily_signore_greek_track_minor_gain = yes
		RICE_sicily_records_effect = yes
		every_county_in_region = {
			region = custom_sicily
			limit = {
				holder = root
			}
			custom = RICE_every_county_owned_sicily
			add_county_modifier = {
				modifier = RICE_sicily_updated_bureaucratic_records_greek
				years = 10
			}		
		}
	}
	
	option = { # Arabic
		name = sicily.0103.c
		RICE_sicily_signore_arabic_track_minor_gain = yes
		RICE_sicily_records_effect = yes
		every_county_in_region = {
			region = custom_sicily
			limit = {
				holder = root
			}
			custom = RICE_every_county_owned_sicily
			add_county_modifier = {
				modifier = RICE_sicily_updated_bureaucratic_records_arabic
				years = 10
			}		
		}
	}
	
}

# Reforming government practices
sicily.0104 = {
	type = character_event
	title = sicily.0104.t
	desc = {
		desc = sicily.0104.desc
		# Latin practices
		first_valid = {
			triggered_desc = {
				trigger = {
					exists = scope:latin_ruler
				}
				desc = sicily.0104.desc.latin
			}
			desc = sicily.0104.desc.no_latin # Fallback option
		}
		# Greek practices
		first_valid = {
			triggered_desc = {
				trigger = {
					exists = scope:greek_ruler
				}
				desc = sicily.0104.desc.greek
			}
			desc = sicily.0104.desc.no_greek # Fallback option
		}
		# Arabic practices
		first_valid = {
			triggered_desc = {
				trigger = {
					exists = scope:arabic_ruler
				}
				desc = sicily.0104.desc.arabic
			}
			desc = sicily.0104.desc.no_arabic # Fallback option
		}
	}
	theme = diplomacy
	override_background = { reference = RICE_background_sicily_interior }
	
	left_portrait = {
		character = scope:councillor
		animation = happy_teacher
	}
	
	right_portrait = {
		character = root
		animation = thinking
	}

	lower_left_portrait = {
		trigger = { exists = scope:latin_ruler }
		character = scope:latin_ruler
	}
	lower_center_portrait = {
		trigger = { exists = scope:greek_ruler }
		character = scope:greek_ruler
	}
	lower_right_portrait = {
		trigger = { exists = scope:arabic_ruler }
		character = scope:arabic_ruler
	}

	immediate = {

		# Choose the councilor to talk to you
		if = {
			limit = {
				exists = cp:councillor_chancellor
			}
			cp:councillor_chancellor = {
				add_to_list = councilor_candidates
			}
		}
		if = {
			limit = {
				exists = cp:councillor_steward
			}
			cp:councillor_steward = {
				add_to_list = councilor_candidates
			}
		}
		if = {
			limit = {
				exists = cp:councillor_court_chaplain
			}
			cp:councillor_court_chaplain = {
				add_to_list = councilor_candidates
			}
		}
		if = {
			limit = {
				is_married = yes
			}
			random_spouse = {
				add_to_list = councilor_candidates
			}
		}
		random_in_list = {
			list = councilor_candidates
			save_scope_as = councillor
		}

		# Possible ruler chosen to use as a basis
		if = {
			limit = {
				any_county_in_region = {
					region = RICE_lands_near_sicily_region_farther
					RICE_sicily_latin_trigger = yes
					holder = {
						RICE_sicily_latin_trigger = yes
					}
				}
			}
			every_county_in_region = {
				region = RICE_lands_near_sicily_region_farther
				limit = {
					RICE_sicily_latin_trigger = yes
					holder = {
						RICE_sicily_latin_trigger = yes
					}
				}
				add_to_list = nearby_latin_counties
			}
			random_in_list = {
				list = nearby_latin_counties
				weight = {
					base = 10
					modifier = {
						is_coastal_county = yes
						add = 10
					}
					modifier = {
						holder = {
							highest_held_title_tier >= tier_kingdom
						}
						add = 100
					}
					modifier = {
						holder = {
							highest_held_title_tier < tier_duchy
						}
						add = -30
					}
					modifier = {
						holder = {
							is_independent_ruler = no
						}
						add = -30
					}
					modifier = {
						holder = {
							diplomacy >= medium_skill_rating
						}
						add = 10
					}
					modifier = {
						holder = {
							martial >= medium_skill_rating
						}
						add = 5
					}
					modifier = {
						holder = {
							stewardship >= medium_skill_rating
						}
						add = 20
					}
					modifier = {
						holder = {
							intrigue >= medium_skill_rating
						}
						add = 10
					}
					modifier = {
						holder = {
							learning >= medium_skill_rating
						}
						add = 10
					}
				}
				save_scope_as = latin_county
			}
			scope:latin_county.holder = {
				save_scope_as = latin_ruler
			}
		}

		if = {
			limit = {
				any_county_in_region = {
					region = RICE_lands_near_sicily_region_farther
					RICE_sicily_greek_trigger = yes
					holder = {
						RICE_sicily_greek_trigger = yes
					}
				}
			}
			every_county_in_region = {
				region = RICE_lands_near_sicily_region_farther
				limit = {
					RICE_sicily_greek_trigger = yes
					holder = {
						RICE_sicily_greek_trigger = yes
					}
				}
				add_to_list = nearby_greek_counties
			}
			random_in_list = {
				list = nearby_greek_counties
				weight = {
					base = 10
					modifier = {
						is_coastal_county = yes
						add = 10
					}
					modifier = {
						holder = {
							highest_held_title_tier >= tier_kingdom
						}
						add = 100
					}
					modifier = {
						holder = {
							highest_held_title_tier < tier_duchy
						}
						add = -30
					}
					modifier = {
						holder = {
							is_independent_ruler = no
						}
						add = -30
					}
					modifier = {
						holder = {
							diplomacy >= medium_skill_rating
						}
						add = 10
					}
					modifier = {
						holder = {
							martial >= medium_skill_rating
						}
						add = 5
					}
					modifier = {
						holder = {
							stewardship >= medium_skill_rating
						}
						add = 20
					}
					modifier = {
						holder = {
							intrigue >= medium_skill_rating
						}
						add = 10
					}
					modifier = {
						holder = {
							learning >= medium_skill_rating
						}
						add = 10
					}
				}
				save_scope_as = greek_county
			}
			scope:greek_county.holder = {
				save_scope_as = greek_ruler
			}
		}

		if = {
			limit = {
				any_county_in_region = {
					region = RICE_lands_near_sicily_region_farther
					RICE_sicily_arabic_trigger = yes
					holder = {
						RICE_sicily_arabic_trigger = yes
					}
				}
			}
			every_county_in_region = {
				region = RICE_lands_near_sicily_region_farther
				limit = {
					RICE_sicily_arabic_trigger = yes
					holder = {
						RICE_sicily_arabic_trigger = yes
					}
				}
				add_to_list = nearby_arabic_counties
			}
			random_in_list = {
				list = nearby_arabic_counties
				weight = {
					base = 10
					modifier = {
						is_coastal_county = yes
						add = 10
					}
					modifier = {
						holder = {
							highest_held_title_tier >= tier_kingdom
						}
						add = 100
					}
					modifier = {
						holder = {
							highest_held_title_tier < tier_duchy
						}
						add = -30
					}
					modifier = {
						holder = {
							is_independent_ruler = no
						}
						add = -30
					}
					modifier = {
						holder = {
							diplomacy >= medium_skill_rating
						}
						add = 10
					}
					modifier = {
						holder = {
							martial >= medium_skill_rating
						}
						add = 5
					}
					modifier = {
						holder = {
							stewardship >= medium_skill_rating
						}
						add = 20
					}
					modifier = {
						holder = {
							intrigue >= medium_skill_rating
						}
						add = 10
					}
					modifier = {
						holder = {
							learning >= medium_skill_rating
						}
						add = 10
					}
				}
				save_scope_as = arabic_county
			}
			scope:arabic_county.holder = {
				save_scope_as = arabic_ruler
			}
		}		
	}
	
	option = { # Latin
		name = sicily.0104.a
		RICE_sicily_signore_latin_track_major_gain = yes
		scope:latin_ruler = {
			if = {
				limit = {
					root = {
						highest_held_title_tier = tier_empire
					}
				}
				add_prestige = 300
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_kingdom
					}
				}
				add_prestige = 200
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_duchy
					}
				}
				add_prestige = 100
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_county
					}
				}
				add_prestige = 50
			}
		}
		if = {
			limit = {
				exists = scope:latin_ruler
			}
			duel = {
				skills = { diplomacy }
				target = scope:latin_ruler
				30 = {
					compare_modifier = {
						value = scope:duel_value
						multiplier = 2.5
						min = -49
					}
					add_opinion = {
						target = scope:latin_ruler
						modifier = RICE_sicily_government_inspired_by_opinion_lesser
					}
					reverse_add_opinion = {
						target = scope:latin_ruler
						modifier = RICE_sicily_government_inspiration_to_opinion_lesser
					}
					random_list = {
						30 = {

						}
						50 = {
							progress_towards_friend_effect = {
								CHARACTER = scope:latin_ruler
								OPINION = default_friend_opinion
								REASON = RICE_sicily_ties_reason_placeholder
							}
						}
						20 = {
							set_relation_friend = {
								target = scope:latin_ruler
								reason = RICE_sicily_ties_reason_placeholder
							}
						}
					}
				}
				20 = {
					compare_modifier = {
						value = scope:duel_value
						multiplier = -2.5
						min = -49
					}
					add_opinion = {
						target = scope:latin_ruler
						modifier = RICE_sicily_government_inspired_by_opinion_greater
					}
					reverse_add_opinion = {
						target = scope:latin_ruler
						modifier = RICE_sicily_government_inspiration_to_opinion_greater
					}	
					random_list = {
						10 = {

						}
						45 = {
							progress_towards_friend_effect = {
								CHARACTER = scope:latin_ruler
								OPINION = default_friend_opinion
								REASON = RICE_sicily_ties_reason_placeholder
							}
						}
						45 = {
							set_relation_friend = {
								target = scope:latin_ruler
								reason = RICE_sicily_ties_reason_placeholder
							}
						}
					}
				}
			}
		}
	}

	option = { # Greek
		name = sicily.0104.b
		RICE_sicily_signore_greek_track_major_gain = yes
		scope:greek_ruler = {
			if = {
				limit = {
					root = {
						highest_held_title_tier = tier_empire
					}
				}
				add_prestige = 300
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_kingdom
					}
				}
				add_prestige = 200
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_duchy
					}
				}
				add_prestige = 100
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_county
					}
				}
				add_prestige = 50
			}
		}
		if = {
			limit = {
				exists = scope:greek_ruler
			}
			duel = {
				skills = { diplomacy }
				target = scope:greek_ruler
				30 = {
					compare_modifier = {
						value = scope:duel_value
						multiplier = 2.5
						min = -49
					}
					add_opinion = {
						target = scope:greek_ruler
						modifier = RICE_sicily_government_inspired_by_opinion_lesser
					}
					reverse_add_opinion = {
						target = scope:greek_ruler
						modifier = RICE_sicily_government_inspiration_to_opinion_lesser
					}
					random_list = {
						30 = {

						}
						50 = {
							progress_towards_friend_effect = {
								CHARACTER = scope:greek_ruler
								OPINION = default_friend_opinion
								REASON = RICE_sicily_ties_reason_placeholder
							}
						}
						20 = {
							set_relation_friend = {
								target = scope:greek_ruler
								reason = RICE_sicily_ties_reason_placeholder
							}
						}
					}
				}
				20 = {
					compare_modifier = {
						value = scope:duel_value
						multiplier = -2.5
						min = -49
					}
					add_opinion = {
						target = scope:greek_ruler
						modifier = RICE_sicily_government_inspired_by_opinion_greater
					}
					reverse_add_opinion = {
						target = scope:greek_ruler
						modifier = RICE_sicily_government_inspiration_to_opinion_greater
					}	
					random_list = {
						10 = {

						}
						45 = {
							progress_towards_friend_effect = {
								CHARACTER = scope:greek_ruler
								OPINION = default_friend_opinion
								REASON = RICE_sicily_ties_reason_placeholder
							}
						}
						45 = {
							set_relation_friend = {
								target = scope:greek_ruler
								reason = RICE_sicily_ties_reason_placeholder
							}
						}
					}
				}
			}
		}
	}	

	option = { # arabic
		name = sicily.0104.c
		RICE_sicily_signore_arabic_track_major_gain = yes
		scope:arabic_ruler = {
			if = {
				limit = {
					root = {
						highest_held_title_tier = tier_empire
					}
				}
				add_prestige = 300
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_kingdom
					}
				}
				add_prestige = 200
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_duchy
					}
				}
				add_prestige = 100
			}
			else_if = {
				limit = {
					root = {
						highest_held_title_tier = tier_county
					}
				}
				add_prestige = 50
			}
		}
		if = {
			limit = {
				exists = scope:arabic_ruler
			}
			duel = {
				skills = { diplomacy }
				target = scope:arabic_ruler
				30 = {
					compare_modifier = {
						value = scope:duel_value
						multiplier = 2.5
						min = -49
					}
					add_opinion = {
						target = scope:arabic_ruler
						modifier = RICE_sicily_government_inspired_by_opinion_lesser
					}
					reverse_add_opinion = {
						target = scope:arabic_ruler
						modifier = RICE_sicily_government_inspiration_to_opinion_lesser
					}
					random_list = {
						30 = {

						}
						50 = {
							progress_towards_friend_effect = {
								CHARACTER = scope:arabic_ruler
								OPINION = default_friend_opinion
								REASON = RICE_sicily_ties_reason_placeholder
							}
						}
						20 = {
							set_relation_friend = {
								target = scope:arabic_ruler
								reason = RICE_sicily_ties_reason_placeholder
							}
						}
					}
				}
				20 = {
					compare_modifier = {
						value = scope:duel_value
						multiplier = -2.5
						min = -49
					}
					add_opinion = {
						target = scope:arabic_ruler
						modifier = RICE_sicily_government_inspired_by_opinion_greater
					}
					reverse_add_opinion = {
						target = scope:arabic_ruler
						modifier = RICE_sicily_government_inspiration_to_opinion_greater
					}	
					random_list = {
						10 = {

						}
						45 = {
							progress_towards_friend_effect = {
								CHARACTER = scope:arabic_ruler
								OPINION = default_friend_opinion
								REASON = RICE_sicily_ties_reason_placeholder
							}
						}
						45 = {
							set_relation_friend = {
								target = scope:arabic_ruler
								reason = RICE_sicily_ties_reason_placeholder
							}
						}
					}
				}
			}
		}
	}

	after = {
		RICE_sicily_government_practices_effect = yes
	}

}


# Fortifying Settlements
sicily.0105 = {
	type = character_event
	title = sicily.0105.t
	desc = {
		desc = sicily.0105.desc
		triggered_desc = {
			trigger = {
				exists = scope:soldier
			}
			desc = sicily.0105.desc.soldier
		}
	}
	theme = martial
	override_background = { reference = RICE_background_sicily_ancient_temple }

	
	left_portrait = {
		character = scope:soldier
		animation = marshal
		trigger = {
			exists = scope:soldier
		}
	}	
	right_portrait = {
		character = root
		animation = war_defender
	}

	immediate = {
		random_held_county = {
			limit = {
				any_county_province = {
					geographical_region = custom_sicily
				}
			}
			# Counties with strongholds are more likely to be chosen
			weight = {
				base = 1
				modifier = {
					factor = 5
					RICE_sicily_has_stronghold_trigger = yes
				}
			}
			save_scope_as = county
		}		
		scope:county.culture = {
			save_scope_as = sicily_culture
		}
		scope:county.faith = {
			save_scope_as = sicily_faith
		}
		random = {
			chance = RICE_sicily_fortify_stronghold_knight_spawn_chance
			create_character = {
				location = root.capital_province
				template = RICE_sicily_knight
				save_scope_as = soldier
			}
		}
	}

	option = { # Ok
		name = sicily.0105.a
		RICE_sicily_agenda_fortified_settlement_effect = yes
		if = {
			limit = {
				exists = scope:soldier
			}
			add_courtier = scope:soldier
		}
	}
	
}


# Arts and Sciences
sicily.0106 = {
	type = character_event
	title = sicily.0106.t
	desc = sicily.0106.desc
	theme = learning
	override_background = { reference = RICE_background_sicily_interior }
	
	right_portrait = {
		character = root
		animation = thinking
	}

	immediate = {
		# Get rid of variable if they have it for some reason, just in case
		if = {
			limit = {
				exists = var:RICE_sicily_scholar
			}
			remove_variable = RICE_sicily_scholar
		}
	}
	
	option = { # Latin
		name = sicily.0106.a
		RICE_sicily_signore_latin_track_medium_gain = yes
		RICE_sicily_sponsor_arts_sciences_effect = yes
		custom_tooltip = sicily.0106.tooltip
		hidden_effect = {
			random = {
				chance = RICE_sicily_art_science_scholar_chance
				set_variable = {
					name = RICE_sicily_scholar
					value = flag:latin
					days = 365
				}
			}
		}
	}
	
	option = { # Greek
		name = sicily.0106.b
		RICE_sicily_signore_greek_track_medium_gain = yes
		RICE_sicily_sponsor_arts_sciences_effect = yes
		custom_tooltip = sicily.0106.tooltip
		hidden_effect = {
			random = {
				chance = RICE_sicily_art_science_scholar_chance
				set_variable = {
					name = RICE_sicily_scholar
					value = flag:greek
					days = 365
				}
			}
		}
	}
	
	option = { # Arab-Berber
		name = sicily.0106.c
		RICE_sicily_signore_arabic_track_medium_gain = yes
		RICE_sicily_sponsor_arts_sciences_effect = yes
		custom_tooltip = sicily.0106.tooltip
		hidden_effect = {
			random = {
				chance = RICE_sicily_art_science_scholar_chance
				set_variable = {
					name = RICE_sicily_scholar
					value = flag:arabic
					days = 365
				}
			}
		}
	}

	after = {
		if = {
			limit = {
				exists = var:RICE_sicily_scholar
			}
			trigger_event = {
				id = sicily.0107
				days = { 30 365 }
			}
		}
	}
	
}

# Arts and Sciences
sicily.0107 = {
	type = character_event
	title = sicily.0107.t
	desc = sicily.0107.desc
	theme = learning
	override_background = { reference = RICE_background_sicily_interior }
	
	left_portrait = {
		character = scope:scholar
		animation = thinking
	}
	
	right_portrait = {
		character = root
		animation = admiration
	}

	immediate = {
		if = {
			limit = {
				var:RICE_sicily_scholar ?= flag:latin
				any_county_in_region = {
					region = RICE_mediterranean_and_nearby_region
					RICE_sicily_latin_trigger = yes
				}

			}
			every_county_in_region = {
				region = RICE_mediterranean_and_nearby_region
				limit = {
					RICE_sicily_latin_trigger = yes
				}
				add_to_list = candidate_counties
			}
			random_in_list = {
				list = candidate_counties
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_scholar ?= flag:latin
			}
			random_list = {
				20 = { culture:italian = { save_scope_as = sicily_culture } }
				20 = { culture:cisalpine = { save_scope_as = sicily_culture } }
				10 = { culture:frankish = { save_scope_as = sicily_culture } }
				10 = { culture:castilian = { save_scope_as = sicily_culture } }
				10 = { culture:andalusian = { save_scope_as = sicily_culture } }
				20 = { culture:norman = { save_scope_as = sicily_culture } }
				10 = { culture:franconian = { save_scope_as = sicily_culture } }
				10 = { culture:dutch = { save_scope_as = sicily_culture } }
				10 = { culture:anglo_saxon = { save_scope_as = sicily_culture } }
				10 = { culture:catalan = { save_scope_as = sicily_culture } }
				10 = { culture:occitan = { save_scope_as = sicily_culture } }
				10 = { culture:saxon = { save_scope_as = sicily_culture } }
				20 = { culture:lombard = { save_scope_as = sicily_culture } }
			}
			faith:catholic = { save_scope_as = sicily_faith }
			capital_county = {
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_scholar ?= flag:greek
				any_county_in_region = {
					region = RICE_mediterranean_and_nearby_region
					RICE_sicily_greek_trigger = yes
				}

			}
			every_county_in_region = {
				region = RICE_mediterranean_and_nearby_region
				limit = {
					RICE_sicily_greek_trigger = yes
				}
				add_to_list = candidate_counties
			}
			random_in_list = {
				list = candidate_counties
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_scholar ?= flag:greek
			}
			random_list = {
				50 = { culture:greek = { save_scope_as = sicily_culture } }
				10 = { culture:armenian = { save_scope_as = sicily_culture } }
				10 = { culture:bulgarian = { save_scope_as = sicily_culture } }
			}
			faith:orthodox = { save_scope_as = sicily_faith }
			capital_county = {
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_scholar ?= flag:arabic
				any_county_in_region = {
					region = RICE_mediterranean_and_nearby_region
					RICE_sicily_arabic_trigger = yes
				}

			}
			every_county_in_region = {
				region = RICE_mediterranean_and_nearby_region
				limit = {
					RICE_sicily_arabic_trigger = yes
				}
				add_to_list = candidate_counties
			}
			random_in_list = {
				list = candidate_counties
				save_scope_as = county
			}
		}
		else_if = {
			limit = {
				var:RICE_sicily_scholar ?= flag:arabic
			}
			random_list = {
				20 = { culture:andalusian = { save_scope_as = sicily_culture } }
				20 = { culture:maghrebi = { save_scope_as = sicily_culture } }
				10 = { culture:butr = { save_scope_as = sicily_culture } }
				10 = { culture:baranis = { save_scope_as = sicily_culture } }
				10 = { culture:egyptian = { save_scope_as = sicily_culture } }
				10 = { culture:levantine = { save_scope_as = sicily_culture } }
				10 = { culture:yemeni = { save_scope_as = sicily_culture } }
				10 = { culture:persian = { save_scope_as = sicily_culture } }
				20 = { culture:siculo_arabic = { save_scope_as = sicily_culture } }
				10 = { culture:kurdish = { save_scope_as = sicily_culture } }
			}
			random_list = {
				10 = { faith:ashari = { save_scope_as = sicily_faith } }
				10 = { faith:muwalladi = { save_scope_as = sicily_faith } }
				10 = { faith:ismaili = { save_scope_as = sicily_faith } }
				10 = { faith:ibadi = { save_scope_as = sicily_faith } }
			}
			capital_county = {
				save_scope_as = county
			}
		}	

		scope:county.faith = {
			save_scope_as = sicily_faith
		}		
		scope:county.culture = {
			save_scope_as = sicily_culture
		}	

		create_character = {
			location = root.capital_province
			template = RICE_sicily_traveling_scholar_template
			save_scope_as = scholar
		}

	}
	
	option = { # ok
		name = sicily.0107.a
		add_courtier = scope:scholar
		if = {
			limit = {
				can_add_hook = {
					target = scope:scholar
					type = loyalty_hook
				}
			}
			add_hook = {
				target = scope:scholar
				type = loyalty_hook
			}
		}
	}

	after = {
		if = {
			limit = {
				exists = var:RICE_sicily_scholar
			}
			remove_variable = RICE_sicily_scholar
		}
		# Make sure you can't convert them
		hidden_effect = {
			scope:scholar = {
				trigger_event = RICEmisc.0002
			}
		}
	}
	
}




# Caricatori Ports
sicily.0108 = {
	type = character_event
	title = sicily.0108.t
	desc = sicily.0108.desc
	theme = stewardship_wealth_focus
	override_background = { reference = RICE_background_sicily_coastal_town }
	
	right_portrait = {
		character = root
		animation = steward
	}

	immediate = {
		RICE_sicily_agenda_port_effect = yes
		# Possible ruler chosen to improve relations
		# if = {
		# 	limit = {
		# 		any_county_in_region = {
		# 			region = RICE_lands_near_sicily_region
		# 			RICE_sicily_latin_trigger = yes
		# 		}
		# 	}
		# 	every_county_in_region = {
		# 		region = RICE_lands_near_sicily_region
		# 		limit = {
		# 			RICE_sicily_latin_trigger = yes
		# 		}
		# 		add_to_list = nearby_latin_counties
		# 	}
		# 	random_in_list = {
		# 		list = nearby_latin_counties
		# 		weight = {
		# 			base = 10
		# 			modifier = {
		# 				is_coastal_county = yes
		# 				add = 10
		# 			}
		# 		}
		# 		save_scope_as = latin_county
		# 	}
		# 	scope:latin_county.holder = {
		# 		save_scope_as = latin_ruler
		# 	}
		# }
		# if = {
		# 	limit = {
		# 		any_county_in_region = {
		# 			region = RICE_lands_near_sicily_region
		# 			RICE_sicily_greek_trigger = yes
		# 		}
		# 	}
		# 	every_county_in_region = {
		# 		region = RICE_lands_near_sicily_region
		# 		limit = {
		# 			RICE_sicily_greek_trigger = yes
		# 		}
		# 		add_to_list = nearby_greek_counties
		# 	}
		# 	random_in_list = {
		# 		list = nearby_greek_counties
		# 		weight = {
		# 			base = 10
		# 			modifier = {
		# 				is_coastal_county = yes
		# 				add = 10
		# 			}
		# 		}
		# 		save_scope_as = greek_county
		# 	}
		# 	scope:greek_county.holder = {
		# 		save_scope_as = greek_ruler
		# 	}
		# }
		# if = {
		# 	limit = {
		# 		any_county_in_region = {
		# 			region = RICE_lands_near_sicily_region
		# 			RICE_sicily_arabic_trigger = yes
		# 		}
		# 	}
		# 	every_county_in_region = {
		# 		region = RICE_lands_near_sicily_region
		# 		limit = {
		# 			RICE_sicily_arabic_trigger = yes
		# 		}
		# 		add_to_list = nearby_arabic_counties
		# 	}
		# 	random_in_list = {
		# 		list = nearby_arabic_counties
		# 		weight = {
		# 			base = 10
		# 			modifier = {
		# 				is_coastal_county = yes
		# 				add = 10
		# 			}
		# 		}
		# 		save_scope_as = arabic_county
		# 	}
		# 	scope:arabic_county.holder = {
		# 		save_scope_as = arabic_ruler
		# 	}
		# }
	}
	
	option = { # Latin
		name = sicily.0108.a
		RICE_sicily_signore_latin_track_medium_gain = yes
		add_character_modifier = {
			modifier = RICE_sicily_caricatori_relations_latin
			years = 15
		}
	}
	
	option = { # Greek
		name = sicily.0108.b
		RICE_sicily_signore_greek_track_medium_gain = yes
		add_character_modifier = {
			modifier = RICE_sicily_caricatori_relations_greek
			years = 15
		}
	}
	
	option = { # Arab-Berber
		name = sicily.0108.c
		RICE_sicily_signore_arabic_track_medium_gain = yes
		add_character_modifier = {
			modifier = RICE_sicily_caricatori_relations_arabic
			years = 15
		}
	}
	
}


# Attracting Immigrants
sicily.0109 = {
	type = character_event
	title = sicily.0109.t
	desc = sicily.0109.desc
	theme = RICE_theme_sicily_travel
	
	right_portrait = {
		character = root
		animation = thinking
	}

	
	option = { # Latin
		name = sicily.0109.a
		trigger = {
			RICE_sicily_latin_trigger = yes	
		}
		RICE_sicily_signore_latin_track_medium_gain = yes
		RICE_sicily_attract_immigrants_effect = yes
		every_county_in_region = {
			region = custom_sicily
			limit = {
				holder = root
			}
			custom = RICE_every_county_owned_sicily
			add_county_modifier = {
				modifier = RICE_sicily_immigrants_latin
				years = 10
			}		
		}
	}
	
	option = { # Greek
		name = sicily.0109.b
		trigger = {
			RICE_sicily_greek_trigger = yes	
		}
		RICE_sicily_signore_greek_track_medium_gain = yes
		RICE_sicily_attract_immigrants_effect = yes
		every_county_in_region = {
			region = custom_sicily
			limit = {
				holder = root
			}
			custom = RICE_every_county_owned_sicily
			add_county_modifier = {
				modifier = RICE_sicily_immigrants_greek
				years = 10
			}		
		}
	}
	
	option = { # Arabic
		name = sicily.0109.c
		trigger = {
			RICE_sicily_arabic_trigger = yes	
		}
		RICE_sicily_signore_arabic_track_medium_gain = yes
		RICE_sicily_attract_immigrants_effect = yes
		every_county_in_region = {
			region = custom_sicily
			limit = {
				holder = root
			}
			custom = RICE_every_county_owned_sicily
			add_county_modifier = {
				modifier = RICE_sicily_immigrants_arabic
				years = 10
			}		
		}
	}
	
	option = { # None of the above
		name = sicily.0109.d
		trigger = {
			NOR = {
				RICE_sicily_latin_trigger = yes
				RICE_sicily_greek_trigger = yes
				RICE_sicily_arabic_trigger = yes
			}	
		}
		RICE_sicily_attract_immigrants_effect = yes
		every_county_in_region = {
			region = custom_sicily
			limit = {
				holder = root
			}
			custom = RICE_every_county_owned_sicily
			add_county_modifier = {
				modifier = RICE_sicily_immigrants_none
				years = 10
			}		
		}
	}


	
}





######################################################################################
# 
# VIRGIL FLAVOR
# 
# sicily.0120-sicily.0129
# 
######################################################################################

# Setup activity
sicily.0120 = {
	type = character_event
	title = sicily.0120.t
	desc = sicily.0120.desc
	theme = RICE_theme_sicily_travel
	
	left_portrait = {
		character = root
		animation = thinking
	}

	trigger = {
		is_available_travelling = yes
		is_landed = yes
		exists = involved_activity
		involved_activity = {
			has_activity_type = activity_RICE_sicily_virgil_tomb_visit
		}
	}

	immediate = {		
		culture:roman = {
			save_scope_as = roman
		}
	}
	
	option = { # Ok
		name = sicily.0120.a
	}	
}


# Day of the visit to the tunnel
sicily.0121 = {
	type = activity_event
	title = sicily.0121.t
	desc = sicily.0121.desc
	theme = RICE_theme_sicily_virgils_tomb
	
	right_portrait = {
		character = root
		animation = personality_content
	}

	immediate = {			
		culture:roman = {
			save_scope_as = roman
		}
	}
	
	option = { # Relaxing
		name = sicily.0121.a
	}
	
	after = {
		trigger_event = {
			id = sicily.0122
			days = { 2 5 }
		}
	}	
}

# Go to the chapel / reflect on Virgil
sicily.0122 = {
	type = activity_event
	title = sicily.0122.t
	desc = sicily.0122.desc
	theme = RICE_theme_sicily_virgils_tomb
	
	right_portrait = {
		character = root
		animation = thinking
	}
	
	option = { # Relaxing
		name = sicily.0122.a
		RICE_sicily_virgil_tomb_visit_completed_log_entry_effect = yes
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				hidden_effect = { skip_activity_phase = yes }
			}
		}
	}
}


# Perform the Sortes Virgilianae
sicily.0123 = {
	type = character_event
	title = sicily.0123.t
	desc = {
		desc = sicily.0123.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = RICE_virgil_result_bad
				}
				desc = sicily.0123.desc.negative
			}
			desc = sicily.0123.desc.positive
		}
	}
	theme = learning_scholarship_focus
	
	right_portrait = {
		character = root
		animation = reading
	}

	immediate = {	
			
		random = {
			chance = RICE_sicily_virgil_decision_bad_result_chance
			add_character_flag = {
				flag = RICE_virgil_result_bad
				days = 1 	# Failsafe in case the character flag isn't removed
			}
		}
		hidden_effect = {
			RICE_sicily_virgil_decision_result_effect = yes			
		}
	}
	
	option = { # Ok
		name = sicily.0123.a
		add_piety = minor_piety_gain
		RICE_sicily_virgil_decision_show_result_effect = yes
	}

	after = {

		if = {

			limit = {
				has_character_flag = RICE_virgil_result_bad
			}

			remove_character_flag = RICE_virgil_result_bad

		}

	}
	
}



######################################################################################
# 
# PALERMO TOMB VISIT
# 
# sicily.0130-sicily.0139
# 
######################################################################################

# Setup activity
sicily.0130 = {
	type = character_event
	title = sicily.0130.t
	desc = {
		desc = sicily.0130.desc.intro
		first_valid = {
			triggered_desc = {
				trigger = {
					involved_activity ?= {
						has_activity_option = {
							category = special_type
							option = RICE_sicily_palermo_tomb_visit_aristotle
						}
					}
				}
				desc = sicily.0130.desc.aristotle
			}
			triggered_desc = {
				trigger = {
					involved_activity ?= {
						has_activity_option = {
							category = special_type
							option = RICE_sicily_palermo_tomb_visit_galen
						}
					}
				}
				desc = sicily.0130.desc.galen
			}
			triggered_desc = {
				trigger = {
					involved_activity ?= {
						has_activity_option = {
							category = special_type
							option = RICE_sicily_palermo_tomb_visit_muslim
						}
					}
				}
				desc = sicily.0130.desc.muslim
			}
		}
		desc = sicily.0130.desc
	}
	theme = RICE_theme_sicily_travel
	
	left_portrait = {
		character = root
		animation = thinking
	}

	trigger = {
		is_available_travelling = yes
		is_landed = yes
		exists = involved_activity
		involved_activity = {
			has_activity_type = activity_RICE_sicily_palermo_tomb_visit
		}
	}

	immediate = {		
		culture:greek = {
			save_scope_as = greek
		}
		title:c_palermo = {
			faith = {
				save_scope_as = palermo_faith
			}
		}
	}
	
	option = { # Ok
		name = sicily.0130.a
	}	
}


# Arrive in Palermo, looking for the tomb
sicily.0131 = {
	type = activity_event
	title = sicily.0131.t
	desc = {
		desc = sicily.0131.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:activity = {
						has_activity_option = {
							category = special_type
							option = RICE_sicily_palermo_tomb_visit_aristotle
						}
					}
				}
				desc = sicily.0131.desc.aristotle
			}
			triggered_desc = {
				trigger = {
					scope:activity = {
						has_activity_option = {
							category = special_type
							option = RICE_sicily_palermo_tomb_visit_galen
						}
					}
				}
				desc = sicily.0131.desc.galen
			}
			triggered_desc = {
				trigger = {
					scope:activity = {
						has_activity_option = {
							category = special_type
							option = RICE_sicily_palermo_tomb_visit_muslim
						}
					}
				}
				desc = sicily.0131.desc.muslim
			}
		}
	}
	theme = RICE_theme_sicily_village
	
	right_portrait = {
		character = root
		animation = personality_greedy
	}

	immediate = {			
		culture:greek = {
			save_scope_as = greek
		}
		title:c_palermo = {
			faith = {
				save_scope_as = palermo_faith
			}
		}
	}
	
	option = { # Relaxing
		name = sicily.0131.a
	}
	
	after = {
		if = {
			limit = {				
				scope:activity = {
					has_activity_option = {
						category = special_type
						option = RICE_sicily_palermo_tomb_visit_aristotle
					}
				}
			}
			trigger_event = {
				id = sicily.0132
				days = { 2 5 }
			}
		}
		else_if = {
			limit = {				
				scope:activity = {
					has_activity_option = {
						category = special_type
						option = RICE_sicily_palermo_tomb_visit_galen
					}
				}
			}
			trigger_event = {
				id = sicily.0133
				days = { 2 5 }
			}
		}
		else_if = {
			limit = {				
				scope:activity = {
					has_activity_option = {
						category = special_type
						option = RICE_sicily_palermo_tomb_visit_muslim
					}
				}
			}
			trigger_event = {
				id = sicily.0134
				days = { 2 5 }
			}
		}
	}	
}

# Go to Aristotle's coffin/tomb
sicily.0132 = {
	type = activity_event
	title = sicily.0132.t
	desc = sicily.0132.desc
	theme = faith
	override_icon = "gfx/interface/icons/event_types/type_learning.dds"
	
	right_portrait = {
		character = root
		animation = personality_zealous
	}
	
	option = { # ok
		name = sicily.0132.a
		RICE_sicily_palermo_tomb_visit_completed_log_entry_effect = yes
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				hidden_effect = { skip_activity_phase = yes }
			}
		}
	}
}

# Go to Galen's tomb
sicily.0133 = {
	type = activity_event
	title = sicily.0133.t
	desc = sicily.0133.desc
	theme = RICE_theme_sicily_ancient_temple
	override_icon = "gfx/interface/icons/event_types/type_medicine.dds"
	
	right_portrait = {
		character = root
		animation = personality_zealous
	}
	
	option = { # ok
		name = sicily.0133.a
		RICE_sicily_palermo_tomb_visit_completed_log_entry_effect = yes
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				hidden_effect = { skip_activity_phase = yes }
			}
		}
	}
}

# Visit the Muslim tombs
sicily.0134 = {
	type = activity_event
	title = sicily.0134.t
	desc = sicily.0134.desc
	theme = faith
	
	right_portrait = {
		character = root
		animation = personality_zealous
	}
	
	option = { # ok
		name = sicily.0134.a
		RICE_sicily_palermo_tomb_visit_completed_log_entry_effect = yes
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				hidden_effect = { skip_activity_phase = yes }
			}
		}
	}
}




######################################################################################
# 
# SALERNO MEDICAL SCHOOL
# 
# sicily.0140-sicily.0149
# 
######################################################################################


# Support Salerno
sicily.0140 = {
	type = character_event
	title = sicily.0140.t
	desc = {
		desc = sicily.0140.desc
		triggered_desc = {
			trigger = {
				has_character_flag = RICE_sicily_medical_extras_flag
			}
			desc = sicily.0140.desc.extras
		}
	}
	theme = medicine
	override_background = { reference = RICE_background_sicily_interior }
	
	right_portrait = {
		character = root
		animation = personality_compassionate
	}

	immediate = {		
		# Potential extras
		random = {
			chance = RICE_sicily_salerno_medical_extra_chance
			add_character_flag = {
				flag = RICE_sicily_medical_extras_flag
				days = 2 	# Failsafe in case the character flag isn't removed
			}
		}
	}
	
	option = { # Ok
		name = {
			trigger = { NOT = { has_character_flag = RICE_sicily_medical_extras_flag } }
			text = sicily.0140.a
		}
		name = {
			trigger = { has_character_flag = RICE_sicily_medical_extras_flag }
			text = sicily.0140.a.extras
		}
		RICE_sicily_salerno_medical_school_decision_effect = yes
		# show_as_tooltip = {
		# 	random = {
		# 		chance = RICE_sicily_salerno_medical_extra_chance
		# 		custom_tooltip = sicily.0140.extras_tooltip
		# 		add_character_flag = {
		# 			flag = RICE_sicily_medical_extras_flag
		# 			days = 2 	# Failsafe in case the character flag isn't removed
		# 		}
		# 	}			
		# }
	}

	after = {

		if = {

			limit = {
				has_character_flag = RICE_sicily_medical_extras_flag
			}

			random_list = {
				# Further character modifiers
				10 = {
					trigger_event = sicily.0141
				}
				# Further county modifiers
				10 = {
					trigger_event = sicily.0142
				}
				# Book artifact
				10 = {
					trigger_event = sicily.0143
				}
				# Physician
				10 = {
					trigger_event = sicily.0144
				}
			}

			remove_character_flag = RICE_sicily_medical_extras_flag

		}

	}
	
}


# Support Salerno - extra character modifiers
sicily.0141 = {
	type = character_event
	title = sicily.0141.t
	desc = sicily.0141.desc
	theme = medicine
	override_background = { reference = RICE_background_sicily_interior }
	
	right_portrait = {
		character = root
		animation = personality_greedy
	}

	
	option = { # Ok
		name = sicily.0141.a
		add_character_modifier = {
			modifier = RICE_sicily_salerno_medical_school_extra_character_modifier
			years = 10
		}
	}

	after = {

		# Failsafe in case the character flag isn't removed
		if = {
			limit = {
				has_character_flag = RICE_sicily_medical_extras_flag
			}
			remove_character_flag = RICE_sicily_medical_extras_flag
		}

	}
	
}


# Support Salerno - extra county modifiers
sicily.0142 = {
	type = character_event
	title = sicily.0142.t
	desc = sicily.0142.desc
	theme = medicine
	override_background = { reference = RICE_background_sicily_interior }
	
	right_portrait = {
		character = root
		animation = personality_content
	}

	
	option = { # Ok
		name = sicily.0142.a
		capital_county = {
			add_county_modifier = {
				modifier = RICE_sicily_salerno_medical_school_extra_county_modifier
				years = 10
			}
		}
	}

	after = {

		# Failsafe in case the character flag isn't removed
		if = {
			limit = {
				has_character_flag = RICE_sicily_medical_extras_flag
			}
			remove_character_flag = RICE_sicily_medical_extras_flag
		}

	}
	
}


# Support Salerno - extra book artifact
sicily.0143 = {
	type = character_event
	title = sicily.0143.t
	desc = sicily.0143.desc
	theme = medicine
	override_background = { reference = RICE_background_sicily_interior }
	
	right_portrait = {
		character = root
		animation = personality_content
	}

	artifact = { # To display the artifact in the event-window
		target = scope:salerno_medical_text_artifact
		position = lower_center_portrait
		trigger = { exists = scope:salerno_medical_text_artifact }
	}	

	immediate = {
		RICE_sicily_create_salerno_medical_text_artifact_effect = yes
	}
	
	option = { # Ok
		name = sicily.0143.a
		if = {
			limit = {
				exists = scope:salerno_medical_text_artifact
			}
			show_as_tooltip = {
				scope:salerno_medical_text_artifact = {
					set_owner = {
						target = root
					}
				}
			}
		}
	}

	after = {

		# Failsafe in case the character flag isn't removed
		if = {
			limit = {
				has_character_flag = RICE_sicily_medical_extras_flag
			}
			remove_character_flag = RICE_sicily_medical_extras_flag
		}

	}
	
}


# Support Salerno - physician character
sicily.0144 = {
	type = character_event
	title = sicily.0144.t
	desc = {
		desc = sicily.0144.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					employs_court_position = court_physician_court_position
				}
				desc = sicily.0144.desc.old_physician
			}
			desc = sicily.0144.desc.new_physician
		}
	}
	theme = medicine
	override_background = { reference = RICE_background_sicily_interior }
	
	left_portrait = {
		character = scope:physician
		animation = throne_room_bow_3
	}
	
	right_portrait = {
		character = root
		animation = thinking
	}

	immediate = {
		# Pick a random county to be the source of the physicians
		random_list = {
			30 = {
				title:c_salerno = {
					save_scope_as = county
				}
			}
			70 = {
				every_county_in_region = {
					region = custom_sicily
					add_to_list = sicily_counties
				}
				random_in_list = {
					list = sicily_counties
					save_scope_as = county
				}
			}
		}
		scope:county.faith = {
			save_scope_as = sicily_faith
		}
		scope:county.culture = {
			save_scope_as = sicily_culture
		}
		if = {
			limit = {
				employs_court_position = court_physician_court_position
			}
			random_court_position_holder = {
				type = court_physician_court_position
				save_scope_as = physician
			}
			scope:physician = {
				if = {
					limit = {
						NAND = {
						   has_trait = lifestyle_physician
						   has_trait_xp = {
							   trait = lifestyle_physician
							   value >= 100
						   }
					   }
					}
					physician_lifestyle_rank_up_effect = yes
				}
				else = {
					random_list = {
						30 = {
							add_learning_skill = 1
						}
						20 = {
							add_learning_skill = 2
						}
						10 = {
							add_learning_skill = 3
						}
					}
				}
			}
		}
		else = {
			create_character = {
				location = root.capital_province
				template = RICE_sicily_salerno_physician_template
				save_scope_as = physician
			}
		}
	}
	
	option = { # Ok
		name = sicily.0144.a
		if = {
			limit = {
				NOT = { employs_court_position = court_physician_court_position }
			}
			set_court_physician_effect = {
				EMPLOYER = root
				PHYSICIAN = scope:physician
			}
		}
	}

	after = {

		# Failsafe in case the character flag isn't removed
		if = {
			limit = {
				has_character_flag = RICE_sicily_medical_extras_flag
			}
			remove_character_flag = RICE_sicily_medical_extras_flag
		}

	}
	
}


# employs_court_position






##################################################################
# 
# PILGRIMAGE TO MONTE GARGANO
# sicily.0150-0169 reserved
# 
##################################################################

# Make preparations to begin the pilgrimage
sicily.0150 = {
	type = character_event
	title = sicily.0150.t
	desc = sicily.0150.desc
	theme = travel_pilgrimage
	override_background = { reference = RICE_background_sicily_travel }
	
	right_portrait = root

	trigger = {
		is_available_travelling = yes
		is_landed = yes
		exists = involved_activity
		involved_activity = {
			has_activity_type = activity_RICE_sicily_monte_gargano_pilgrimage
		}
	}
	
	immediate = {
		faith = {
			save_scope_as = faith
		}
		religion:christianity_religion = { save_scope_as = christian }
		play_music_cue = "mx_cue_epic_sacral_moment"
	}
	
	option = { # Ok
		name = sicily.0150.a
	}
}



# Arrive in Monte Gargano
sicily.0151 = {
	type = activity_event
	title = sicily.0151.t
	desc = sicily.0151.desc
	theme = RICE_theme_sicily_monte_gargano
	
	right_portrait = {
		character = root
		animation = personality_compassionate
	}

	immediate = {
		title:b_vieste = {
			save_scope_as = gargano
		}
		faith = {
			save_scope_as = faith
		}
		religion:christianity_religion = { save_scope_as = christian }
	}
	
	option = { # Ok
		name = sicily.0151.a
		trigger_event = {
			id = sicily.0152
			days = { 3 8 }
		}
	}
}


# Arrive in Monte Gargano
sicily.0152 = {
	type = activity_event
	title = sicily.0152.t
	desc = sicily.0152.desc
	theme = RICE_theme_sicily_monte_gargano
	
	right_portrait = {
		character = root
		animation = admiration
	}

	immediate = {
		title:b_vieste = {
			save_scope_as = gargano
		}
		faith = {
			save_scope_as = faith
		}
		religion:christianity_religion = { save_scope_as = christian }
	}
	
	option = { # Ok
		name = sicily.0152.a
		trigger_event = {
			id = sicily.0153
			days = { 3 8 }
		}
	}
}


# Go into the cave of Monte Gargano
sicily.0153 = {
	type = activity_event
	title = sicily.0153.t
	desc = sicily.0153.desc
	theme = faith
	override_background = { reference = fp3_cave }
	
	right_portrait = {
		character = root
		animation = personality_zealous
	}
	
	option = { # Saint Michael the Healer
		name = sicily.0153.a
		random = {
			chance = RICE_normandy_mont_saint_michel_chance
			send_interface_toast = {
				type = event_toast_effect_good
				left_icon = ROOT
				title = sicily.0153.a.toast
				show_as_tooltip = {
					add_character_modifier = {
						modifier = RICE_sicily_gargano_michael_healer_modifier
						years = 10
					}					
				}
			}
			hidden_effect = {
				scope:activity = {
					add_activity_log_entry = {
						key = RICE_sicily_gargano_michael_healer_blessing_log
						tags = { good }
						# this line below adds the entry to the Effects section of the conclusion UI
						show_in_conclusion = yes
						character = root
						scope:host = {
							add_character_modifier = {
								modifier = RICE_sicily_gargano_michael_healer_modifier
								years = 10
							}
						}
					}
				}
			}
		}
	}
	
	option = { # Saint Michael the Warrior
		name = sicily.0153.b
		random = {
			chance = RICE_normandy_mont_saint_michel_chance
			send_interface_toast = {
				type = event_toast_effect_good
				left_icon = ROOT
				title = sicily.0153.b.toast
				show_as_tooltip = {
					add_character_modifier = {
						modifier = RICE_sicily_gargano_michael_warrior_modifier
						years = 10
					}					
				}
			}
			hidden_effect = {
				scope:activity = {
					add_activity_log_entry = {
						key = RICE_sicily_gargano_michael_warrior_blessing_log
						tags = { good }
						# this line below adds the entry to the Effects section of the conclusion UI
						show_in_conclusion = yes
						character = root
						scope:host = {
							add_character_modifier = {
								modifier = RICE_sicily_gargano_michael_warrior_modifier
								years = 10
							}
						}
					}
				}
			}
		}
	}

	after = {		
		trigger_event = {
			id = sicily.0154
			days = { 3 8 }
		}
	}

}

# Pilgrimage concludes
sicily.0154 = {
	type = activity_event
	title = sicily.0154.t
	desc = sicily.0154.desc
	theme = RICE_theme_sicily_monte_gargano
	
	right_portrait = {
		character = root
		animation = personality_zealous
	}
	
	option = { # Ok
		name = sicily.0154.a
		RICE_sicily_monte_gargano_pilgrimage_completed_log_effect = yes
	}

	after = {
		hidden_effect = {
			scope:activity = {
				hidden_effect = { skip_activity_phase = yes }
			}
		}
	}


}


# [[Armenian courtiers in Bari???]]



######################################################################################
# 
# OTHER HISTORICAL EVENTS
# 
# sicily.0180-sicily.0199 reserved
# 
######################################################################################


# Ayo visto lo mappamundi folksong becomes popular
# Ping event
sicily.0180 = {
	type = character_event
	hidden = yes

	trigger = {

		NOT = { has_global_variable = RICE_sicily_ayo_visto_lo_mappamundi_happened }

		highest_held_title_tier >= tier_kingdom

		# Has to control at least 2 of the following duchies in Sicily
		calc_true_if = {
			amount >= 2
			completely_controls = title:d_sicily
			completely_controls = title:d_apulia
			completely_controls = title:d_benevento 
			completely_controls = title:d_capua
			completely_controls = title:d_salerno
			completely_controls = title:d_calabria
		}

		# Directly control 4 counties in Sicily, or have a capital in Sicily
		OR = {
			any_held_county = {
				count >= 4
				any_county_province = {
					geographical_region = custom_sicily
				}
			}	
			capital_province = {
				geographical_region = custom_sicily
			}
		}

		root.culture = {
			has_cultural_era_or_later = culture_era_early_medieval
		}

	}

	weight_multiplier = {
		base = 1
		# Make it more likely to happen to a player
		modifier = {
			add = -3
			is_ai = yes
		}
		modifier = {
			add = 2
			root.culture = {
				has_cultural_era_or_later = culture_era_high_medieval
			}
		}
		modifier = {
			add = 3
			root.culture = {
				has_cultural_era_or_later = culture_era_late_medieval
			}
		}
		modifier = {
			add = 2
			culture = {
				OR = {
					this = culture:sicilian
					any_parent_culture_or_above = {
						this = culture:sicilian
					}
					this = culture:siqilli
					any_parent_culture_or_above = {
						this = culture:siqilli
					}
				}
			}
		}
		modifier = {
			add = 2
			capital_county = {
				OR = {
					culture = culture:sicilian
					culture = {
						any_parent_culture_or_above = {
							this = culture:sicilian
						}
					}
					culture = culture:siqilli
					culture = {
						any_parent_culture_or_above = {
							this = culture:siqilli
						}
					}
				}
			}
		}
	}	

	immediate = {

		set_global_variable = {
			name = RICE_sicily_ayo_visto_lo_mappamundi_happened
			value = yes
		}

		save_scope_as = alfonso
		add_character_modifier = {
			modifier = RICE_sicily_ayo_visto_lo_mappamundi_ruler_modifier
		}
		# hidden_effect_new_object = {
		# 	create_artifact = {
		# 		name = RICE_sicily_ayo_visto_lo_mappamundi_name
		# 		description = RICE_sicily_ayo_visto_lo_mappamundi_desc
		# 		type = miscellaneous
		# 		visuals = RICE_music_manuscript					
		# 		quality = 10
		# 		wealth = 10
		# 		modifier = RICE_sicily_ayo_visto_lo_mappamundi_modifier
		# 		save_scope_as = ayo_visto_lo_mappamundi
		# 		decaying = no
		# 	}
		# }
		every_ruler = {
			limit = {
				OR = {
					this = scope:alfonso
					any_liege_or_above = { this = scope:alfonso }
					any_vassal_or_below = { this = scope:alfonso }
					any_held_title = {
						tier = tier_county
						any_county_province = {
							geographical_region = custom_sicily
						}
					}
				}
			}
			trigger_event = sicily.0181
		}
	}

}



# Main event for the Ayo Visto la Mappamundi event
sicily.0181 = {
	type = character_event
	title = sicily.0181.t
	desc = {
		desc = sicily.0181.desc
			triggered_desc = {
				trigger = {
					exists = scope:ayo_visto_lo_mappamundi
				}
				desc = sicily.0181.desc.copy
			}
		desc = sicily.0181.desc.lyrics
	}
	theme = diplomacy
	override_background = { reference = RICE_background_sicily_travel }

	right_portrait = {
		character = scope:alfonso
		animation = personality_content
	}

	artifact = { # To display the artifact in the event-window
		target = scope:ayo_visto_lo_mappamundi
		position = lower_center_portrait
		trigger = { exists = scope:ayo_visto_lo_mappamundi }
	}

	immediate = {
		# Will always get the artifact if you're a human player or the original king the song is based on
		if = {
			limit = {
				OR = {
					root = scope:alfonso
					is_ai = no
				}
			}
			hidden_effect_new_object = {
				create_artifact = {
					name = RICE_sicily_ayo_visto_lo_mappamundi_name
					description = RICE_sicily_ayo_visto_lo_mappamundi_desc
					type = miscellaneous
					visuals = RICE_music_manuscript					
					quality = 10
					wealth = 10
					modifier = RICE_sicily_ayo_visto_lo_mappamundi_modifier
					save_scope_as = ayo_visto_lo_mappamundi
					decaying = no
					history = {
						type = created_before_history
					}
				}
			}			
		}
		else = {
			random = {
				chance = 25
				hidden_effect_new_object = {
					create_artifact = {
						name = RICE_sicily_ayo_visto_lo_mappamundi_name
						description = RICE_sicily_ayo_visto_lo_mappamundi_desc
						type = miscellaneous
						visuals = RICE_music_manuscript					
						quality = 10
						wealth = 10
						modifier = RICE_sicily_ayo_visto_lo_mappamundi_modifier
						save_scope_as = ayo_visto_lo_mappamundi
						decaying = no
						history = {
							type = created_before_history
						}
					}
				}	
			}
		}
	}

	option = { # Ok
		name = sicily.0181.a
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = sicily.0181.info
		}
	}

}






######################################################################################
# 
# GENERIC FLAVOR EVENTS
# 
# sicily.0200-sicily.0229 reserved
# 
######################################################################################


# Locals are using other culture/religion legal courts
sicily.0200 = {
	type = character_event
	title = sicily.0200.t
	desc = sicily.0200.desc
	theme = diplomacy
	override_background = { reference = RICE_background_sicily_interior }

	left_portrait = {
		character = root
		animation = stress
	}
	
	
	trigger = {
		any_held_county = {
			culture = root.culture
			any_county_province = {
				geographical_region = custom_sicily
			}
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = arbitrary
		}
		modifier = {
			add = -0.2
			has_trait = just
		}
		modifier = {
			add = 0.2
			has_trait = lazy
		}
		modifier = {
			add = -0.2
			has_trait = diligent
		}
		modifier = {
			add = 0.2
			has_trait = sadistic
		}
		modifier = {
			add = -0.2
			has_trait = compassionate
		}
	}

	immediate = {
		random_held_county = {
			limit = {		
				culture = root.culture	
				any_county_province = {
					geographical_region = custom_sicily
				}
			}
			save_scope_as = county
		}
		root.culture = {
			save_scope_as = culture
		}
	}

	option = { # Ok
		name = sicily.0200.a
		scope:county = {
			add_county_modifier = {
				modifier = RICE_sicily_legal_opportunism_cracking_down
				years = 10
			}
		}
		if = {
			limit = {
				RICE_sicily_latin_culture_trigger = yes
			}
			RICE_sicily_signore_latin_track_minor_gain = yes
		}
		else_if = {
			limit = {
				RICE_sicily_greek_culture_trigger = yes
			}
			RICE_sicily_signore_greek_track_minor_gain = yes
		}
		else_if = {
			limit = {
				RICE_sicily_arabic_culture_trigger = yes
			}
			RICE_sicily_signore_arabic_track_minor_gain = yes
		}
		stress_impact = {
			arbitrary = minor_stress_impact_gain
			lazy = miniscule_stress_impact_gain
			content = miniscule_stress_impact_gain
			forgiving = miniscule_stress_impact_gain
		}	
	}

	option = { # Ok
		name = sicily.0200.b
		scope:county = {
			add_county_modifier = {
				modifier = RICE_sicily_legal_opportunism_ignoring
				years = 10
			}
		}
		if = {
			limit = {
				RICE_sicily_latin_culture_trigger = no
			}
			RICE_sicily_signore_latin_track_minor_gain = yes
		}
		if = {
			limit = {
				RICE_sicily_greek_culture_trigger = no
			}
			RICE_sicily_signore_greek_track_minor_gain = yes
		}
		if = {
			limit = {
				RICE_sicily_arabic_culture_trigger = no
			}
			RICE_sicily_signore_arabic_track_minor_gain = yes
		}
		stress_impact = {
			just = minor_stress_impact_gain
			diligent = miniscule_stress_impact_gain
			ambitious = miniscule_stress_impact_gain
		}
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = sicily.0200.info
		}
	}

}



# Muslim scholar's interpretation of "Port of Holy War" (i.e. a religious boder zone) causing problems?
sicily.0201 = {
	type = character_event
	window = duel_event
	title = sicily.0201.t
	desc = sicily.0201.desc
	theme = diplomacy
	override_background = { reference = RICE_background_sicily_interior }

	left_portrait = {
		character = scope:courtier
		animation = disapproval
	}

	right_portrait = {
		character = scope:scholar
		animation = beg
	}
	
	
	trigger = {
		religion = religion:islam_religion
		any_held_county = {
			religion = religion:islam_religion
			any_county_province = {
				geographical_region = custom_sicily
			}
		}
		OR = {
			any_courtier_or_guest = {
				is_available_ai_adult = yes
				OR = {
					learning >= decent_skill_rating
					has_trait = scholar
					has_trait = theologian
					has_trait = education_learning_3
					has_trait = education_learning_4
				}
			}
			any_vassal = {
				is_available_ai_adult = yes
				OR = {
					learning >= decent_skill_rating
					has_trait = scholar
					has_trait = theologian
					has_trait = education_learning_3
					has_trait = education_learning_4
				}
			}
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = cynical
		}
		modifier = {
			add = -0.2
			has_trait = zealous
		}
		modifier = {
			add = 0.2
			has_trait = lazy
		}
		modifier = {
			add = -0.2
			has_trait = diligent
		}
		modifier = {
			add = 0.2
			has_trait = humble
		}
		modifier = {
			add = -0.2
			has_trait = arrogant
		}
	}

	immediate = {
		random_held_county = {
			limit = {		
				religion = religion:islam_religion
				any_county_province = {
					geographical_region = custom_sicily
				}
			}
			save_scope_as = county
		}
		scope:county.faith = {
			save_scope_as = sicily_faith
		}		
		scope:county.culture = {
			save_scope_as = sicily_culture
		}	

		hidden_effect = {
			create_character = {
				location = root.capital_province
				template = RICE_sicily_traveling_scholar_template
				save_scope_as = scholar
			}
	
			scope:scholar = {
				add_character_modifier = {
					modifier = RICE_sicily_firebrand_legal_scholar
				}
			}
			
		}

		every_courtier_or_guest = {
			limit = {
				is_available_ai_adult = yes
				OR = {
					learning >= decent_skill_rating
					has_trait = scholar
					has_trait = theologian
					has_trait = education_learning_3
					has_trait = education_learning_4
				}
			}
			add_to_list = candidate_characters
		}
		every_vassal = {
			limit = {
				is_available_ai_adult = yes
				OR = {
					learning >= decent_skill_rating
					has_trait = scholar
					has_trait = theologian
					has_trait = education_learning_3
					has_trait = education_learning_4
				}
			}
			add_to_list = candidate_characters
		}
		random_in_list = {
			list = candidate_characters
			save_scope_as = courtier
		}

		hidden_effect = {
			scope:courtier = {
				set_relation_rival = {
					target = scope:scholar
					reason = RICE_rival_reason_placeholder
				}
			}			
		}

	}

	option = { # Ok
		name = sicily.0201.a
		add_piety = 100
		add_prestige = -100
		scope:courtier = {
			add_opinion = {
				modifier = disappointed_opinion
				target = root
				opinion = -25
			}
		}
		if = {
			limit = {
				can_add_hook = {
					target = scope:entertainer
					type = loyalty_hook
				}
			}
			add_hook = {
				target = scope:entertainer
				type = loyalty_hook
			}
		}
		add_courtier = scope:scholar
		stress_impact = {
			paranoid = miniscule_stress_impact_gain
			cynical = miniscule_stress_impact_gain
			arrogant = miniscule_stress_impact_gain
		}	
	}

	option = { # Ok
		name = sicily.0201.b
		add_gold = { 25 75 }
		scope:scholar = {
			add_opinion = {
				modifier = disappointed_opinion
				target = root
				opinion = -25
			}
		}
		scope:courtier = {
			add_opinion = {
				modifier = pleased_opinion
				target = root
				opinion = 10
			}
		}
		stress_impact = {
			arbitrary = miniscule_stress_impact_gain
			lazy = miniscule_stress_impact_gain
		}
		hidden_effect = {
			scope:scholar = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}

	option = { # Ok
		name = sicily.0201.c
		add_legitimacy = miniscule_legitimacy_gain
		add_prestige = 50
		add_piety = -50
		scope:scholar = {
			add_opinion = {
				modifier = disappointed_opinion
				target = root
				opinion = -50
			}
		}
		scope:courtier = {
			add_opinion = {
				modifier = impressed_opinion
				target = root
				opinion = 30
			}
		}
		stress_impact = {
			arbitrary = miniscule_stress_impact_gain
			lazy = miniscule_stress_impact_gain
		}
		hidden_effect = {
			scope:scholar = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = sicily.0201.info
		}
	}

}



# You are getting slandered for being supposedly too open with other religions in Sicily
sicily.0202 = {
	type = character_event
	title = sicily.0202.t
	desc = sicily.0202.desc
	theme = faith
	override_background = { reference = RICE_background_sicily_travel }


	right_portrait = {
		character = root
		animation = eyeroll
	}
	
	
	trigger = {
		capital_province = {
			geographical_region = custom_sicily
		}
		any_held_county = {
			NOT = {
				religion = root.religion
			}
			any_county_province = {
				geographical_region = custom_sicily
			}
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = cynical
		}
		modifier = {
			add = -0.2
			has_trait = zealous
		}
		modifier = {
			add = 0.2
			has_trait = just
		}
		modifier = {
			add = -0.2
			has_trait = arbitrary
		}
		modifier = {
			add = 0.2
			has_trait = humble
		}
		modifier = {
			add = -0.2
			has_trait = arrogant
		}
	}


	option = { # Ok
		name = sicily.0202.a
		add_prestige = 50
		if = {
			limit = {
				RICE_sicily_latin_faith_trigger = no
			}
			RICE_sicily_signore_latin_track_minor_gain = yes
		}
		if = {
			limit = {
				RICE_sicily_greek_faith_trigger = no
			}
			RICE_sicily_signore_greek_track_minor_gain = yes
		}
		if = {
			limit = {
				RICE_sicily_arabic_faith_trigger = no
			}
			RICE_sicily_signore_arabic_track_minor_gain = yes
		}		
		stress_impact = {
			zealous = minor_stress_impact_gain
		}
	}

	option = { # Ok
		name = sicily.0202.b
		add_piety = 50
		if = {
			limit = {
				RICE_sicily_latin_faith_trigger = yes
			}
			RICE_sicily_signore_latin_track_minor_gain = yes
		}
		else_if = {
			limit = {
				RICE_sicily_greek_faith_trigger = yes
			}
			RICE_sicily_signore_greek_track_minor_gain = yes
		}
		else_if = {
			limit = {
				RICE_sicily_arabic_faith_trigger = yes
			}
			RICE_sicily_signore_arabic_track_minor_gain = yes
		}		
		stress_impact = {
			zealous = minor_stress_impact_gain
		}
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = sicily.0202.info
		}
	}

}


# Locals run your officials out of town and demand you instate their own candidates
sicily.0203 = {
	type = character_event
	title = sicily.0203.t
	desc = sicily.0203.desc
	theme = diplomacy_foreign_affairs_focus
	override_background = { reference = throne_room }


	left_portrait = {
		character = scope:leader
		animation = personality_callous
	}

	right_portrait = {
		character = root
		animation = stress
	}
	
	
	trigger = {
		# Have a capital outside Sicily, or at least two counties in Sicily
		OR = {
			NOT = {			
				capital_province = {
					geographical_region = custom_sicily
				}
			}
			any_held_county = {
				count >= 2
				any_county_province = {
					geographical_region = custom_sicily
				}
			}
		}
		any_held_county = {
			any_county_province = {
				geographical_region = custom_sicily
			}
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = arbitrary
		}
		modifier = {
			add = -0.2
			has_trait = just
		}
		modifier = {
			add = 0.2
			has_trait = sadistic
		}
		modifier = {
			add = -0.2
			has_trait = compassionate
		}
		modifier = {
			add = 0.2
			has_trait = arrogant
		}
		modifier = {
			add = -0.2
			has_trait = humble
		}
	}

	immediate = {
		capital_county = {
			save_scope_as = capital
		}
		random_held_county = {
			limit = {		
				NOT = { this = scope:capital }
				any_county_province = {
					geographical_region = custom_sicily
				}
			}
			save_scope_as = county
		}
		scope:county.culture = {
			save_scope_as = sicily_culture
		}
		scope:county.faith = {
			save_scope_as = sicily_faith
		}
		create_character = {
			location = root.capital_province
			template = RICE_sicily_local_template
			save_scope_as = leader
		}
	}


	option = { # Ok
		name = sicily.0203.a
		add_prestige = -100
		scope:county = {
			change_county_control = minor_county_control_loss
			add_county_modifier = {
				modifier = RICE_sicily_local_officials_promoted
				years = 10
			}
		}
		if = {
			limit = {
				scope:county = {
					RICE_sicily_latin_trigger = yes
				}
			}
			RICE_sicily_signore_latin_track_medium_gain = yes
		}
		if = {
			limit = {
				scope:county = {
					RICE_sicily_greek_trigger = yes
				}
			}
			RICE_sicily_signore_greek_track_medium_gain = yes
		}
		if = {
			limit = {
				scope:county = {
					RICE_sicily_arabic_trigger = yes
				}
			}
			RICE_sicily_signore_arabic_track_medium_gain = yes
		}		
		stress_impact = {
			ambitious = minor_stress_impact_gain
			greedy = miniscule_stress_impact_gain
			vengeful = miniscule_stress_impact_gain
			wrathful = miniscule_stress_impact_gain
		}
		hidden_effect = {
			scope:leader = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}

	option = { # Ok
		name = sicily.0203.b
		# Only if you won't make the title independent
		trigger = {
			highest_held_title_tier >= tier_duchy
		}
		add_prestige = -200
		add_legitimacy = miniscule_legitimacy_gain
		scope:county = {
			add_county_modifier = {
				modifier = RICE_sicily_local_officials_victory
				years = 10
			}
		}
		if = {
			limit = {
				scope:county = {
					RICE_sicily_latin_trigger = yes
				}
			}
			RICE_sicily_signore_latin_track_major_gain = yes
		}
		if = {
			limit = {
				scope:county = {
					RICE_sicily_greek_trigger = yes
				}
			}
			RICE_sicily_signore_greek_track_major_gain = yes
		}
		if = {
			limit = {
				scope:county = {
					RICE_sicily_arabic_trigger = yes
				}
			}
			RICE_sicily_signore_arabic_track_major_gain = yes
		}		
		stress_impact = {
			ambitious = medium_stress_impact_gain
			greedy = minor_stress_impact_gain
			vengeful = minor_stress_impact_gain
			wrathful = minor_stress_impact_gain
		}
		scope:leader = {
			get_title = scope:county
		}
		create_title_and_vassal_change = {
			type = swear_fealty
			save_scope_as = change
		}
		scope:leader = {
			change_liege = {
				liege = root
				change = scope:change
			}
		}
		resolve_title_and_vassal_change = scope:change
	}

	option = { # Ok
		name = sicily.0203.c
		add_prestige = 100
		scope:county = {
			change_county_control = medium_county_control_loss
			add_county_modifier = {
				modifier = RICE_sicily_local_officials_denied
				years = 10
			}
		}		
		stress_impact = {
			content = miniscule_stress_impact_gain
			lazy = miniscule_stress_impact_gain
			forgiving = miniscule_stress_impact_gain
			calm = miniscule_stress_impact_gain
		}
		hidden_effect = {
			scope:leader = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = sicily.0203.info
		}
	}

}


# Councillor suggests giving tax breaks to immigrants to attract settlers
sicily.0204 = {
	type = character_event
	title = sicily.0204.t
	desc = sicily.0204.desc
	theme = RICE_theme_sicily_interior


	left_portrait = scope:councillor

	right_portrait = {
		character = root
		animation = thinking
	}
	
	
	trigger = {
		any_held_county = {
			any_county_province = {
				geographical_region = custom_sicily
			}
		}
		any_councillor = {
			is_available_ai_adult = yes
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = patient
		}
		modifier = {
			add = -0.2
			has_trait = impatient
		}
		modifier = {
			add = 0.2
			has_trait = diligent
		}
		modifier = {
			add = -0.2
			has_trait = lazy
		}
		modifier = {
			add = 0.2
			has_trait = generous
		}
		modifier = {
			add = -0.2
			has_trait = greedy
		}
	}

	immediate = {
		random_councillor = {
			limit = {
				is_available_ai_adult = yes
			}
			save_scope_as = councillor
		}
	}


	option = { # Ok
		name = sicily.0204.a
		every_county_in_region = {
			region = custom_sicily
			limit = {
				holder = root
			}
			custom = RICE_every_county_owned_sicily
			add_county_modifier = {
				modifier = RICE_sicily_immigrants_tax_breaks
				years = 10
			}		
		}	
		scope:councillor = {
			add_opinion = {
				target = root
				opinion = 10
				modifier = pleased_opinion
			}	
		}		
		stress_impact = {
			greedy = miniscule_stress_impact_gain
			paranoid = miniscule_stress_impact_gain
			content = miniscule_stress_impact_gain
		}
	}

	option = { # Ok
		name = sicily.0204.b
		scope:councillor = {
			add_opinion = {
				modifier = disappointed_opinion
				target = root
				opinion = -10
			}	
		}		
		stress_impact = {
			ambitious = miniscule_stress_impact_gain
		}
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = sicily.0204.info
		}
	}

}


# Earthquake tremors in Sicily, courtier tells everyone to pray to their own god
sicily.0205 = {
	type = character_event
	title = sicily.0205.t
	desc = sicily.0205.desc
	theme = unfriendly
	override_background = { reference = RICE_background_sicily_interior }

	left_portrait = {
		character = scope:courtier
		animation = personality_bold
	}

	right_portrait = {
		character = root
		animation = worry
		triggered_animation = {
			trigger = {
				root = {
					NOT = { has_trait = brave }
					OR = {
						has_trait = craven
						has_trait = paranoid
						has_trait = eccentric
					}
				}
			}
			animation = fear
		}
	}
	
	
	trigger = {
		any_held_county = {
			NOT = { religion = root.religion }
			any_county_province = {
				geographical_region = custom_sicily
			}
		}
		capital_county = {
			title_province = { geographical_region = custom_sicily }
		}
		OR = {
			any_courtier_or_guest = {
				is_available_ai_adult = yes
				religion = root.religion
				NOT = { has_trait = zealous }
				NOT = { has_trait = callous }
				NOT = { has_trait = sadistic }
				NOT = { has_trait = arbitrary }
				NOT = { has_trait = shy }
				OR = {
					has_trait = compassionate
					has_trait = calm
					has_trait = patient
					has_trait = just
					has_trait = gregarious
				}
			}
			any_vassal = {
				is_available_ai_adult = yes
				religion = root.religion
				NOT = { has_trait = zealous }
				NOT = { has_trait = callous }
				NOT = { has_trait = sadistic }
				NOT = { has_trait = arbitrary }
				NOT = { has_trait = shy }
				OR = {
					has_trait = compassionate
					has_trait = calm
					has_trait = patient
					has_trait = just
					has_trait = gregarious
				}
			}
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = craven
		}
		modifier = {
			add = -0.2
			has_trait = brave
		}
		modifier = {
			add = 0.2
			has_trait = lazy
		}
		modifier = {
			add = -0.2
			has_trait = diligent
		}
		modifier = {
			add = 0.2
			has_trait = shy
		}
		modifier = {
			add = -0.2
			has_trait = gregarious
		}
	}

	immediate = {

		every_courtier_or_guest = {
			limit = {
				is_available_ai_adult = yes
				religion = root.religion
				NOT = { has_trait = zealous }
				NOT = { has_trait = callous }
				NOT = { has_trait = sadistic }
				NOT = { has_trait = arbitrary }
				NOT = { has_trait = shy }
				OR = {
					has_trait = compassionate
					has_trait = calm
					has_trait = patient
					has_trait = just
					has_trait = gregarious
				}
			}
			add_to_list = candidate_characters
		}
		every_vassal = {
			limit = {
				is_available_ai_adult = yes
				religion = root.religion
				NOT = { has_trait = zealous }
				NOT = { has_trait = callous }
				NOT = { has_trait = sadistic }
				NOT = { has_trait = arbitrary }
				NOT = { has_trait = shy }
				OR = {
					has_trait = compassionate
					has_trait = calm
					has_trait = patient
					has_trait = just
					has_trait = gregarious
				}
			}
			add_to_list = candidate_characters
		}
		random_in_list = {
			list = candidate_characters
			save_scope_as = courtier
		}

		scope:courtier = {
			add_character_modifier = {
				modifier = RICE_sicily_public_tolerance_of_other_religions
				years = 10
			}
		}

	}

	option = { # Ok
		name = sicily.0205.a
		add_prestige = 50
		add_character_modifier = {
			modifier = RICE_sicily_public_tolerance_of_other_religions
			years = 10
		}
		scope:courtier = {
			add_opinion = {
				modifier = pleased_opinion
				target = root
				opinion = 10
			}
		}
		every_courtier = {
			custom = RICE_every_zealous_courtier_of_religion
			limit = {
				religion = root.religion
				OR = {
					has_trait = zealous
					has_trait = arrogant
					has_trait = callous
				}
			}
			add_opinion = {
				modifier = RICE_sicily_dislikes_overly_tolerant_opinion
				target = root
			}
		}
		stress_impact = {
			zealous = minor_stress_impact_gain
			arrogant = miniscule_stress_impact_gain
			callous = miniscule_stress_impact_gain
		}	
	}

	option = { # Ok
		name = sicily.0205.b
		add_piety = 50
		scope:courtier = {
			add_opinion = {
				modifier = disappointed_opinion
				target = root
				opinion = -5
			}
		}
		every_courtier = {
			custom = RICE_every_zealous_courtier_of_religion
			limit = {
				religion = root.religion
				OR = {
					has_trait = zealous
					has_trait = arrogant
					has_trait = callous
				}
			}
			add_opinion = {
				modifier = RICE_approval_opinion
				target = root
				opinion = 10
			}
		}
		stress_impact = {
			cynical = miniscule_stress_impact_gain
		}
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = sicily.0205.info
		}
	}

}


# Enjoying sorbet from ice on Mount Etna
sicily.0206 = {
	type = character_event
	title = sicily.0206.t
	desc = sicily.0206.desc
	theme = feast_activity
	override_background = { reference = bp1_kitchen_western }


	right_portrait = {
		character = root
		animation = personality_greedy
	}
	
	
	trigger = {
		capital_county = {
			title_province = { geographical_region = RICE_insular_sicily }
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = gluttonous
		}
		modifier = {
			add = -0.2
			has_trait = temperate
		}
		modifier = {
			add = 0.2
			has_trait = gregarious
		}
		modifier = {
			add = -0.2
			has_trait = shy
		}
		modifier = {
			add = 0.2
			has_trait = lustful
		}
		modifier = {
			add = -0.2
			has_trait = chaste
		}
	}

	option = { # Ok
		name = sicily.0206.a
		stress_impact = {
			base = miniscule_stress_impact_loss
			gluttonous = minor_stress_impact_loss
			content = miniscule_stress_impact_loss
			lazy = miniscule_stress_impact_loss
		}
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = sicily.0206.info
		}
	}

}


# Scribes don't know how to use other calendar systems in Sicily
sicily.0207 = {
	type = character_event
	title = sicily.0207.t
	desc = sicily.0207.desc
	theme = stewardship_domain_focus
	override_background = { reference = RICE_background_sicily_interior }


	right_portrait = {
		character = root
		animation = worry
	}
	
	
	trigger = {
		capital_county = {
			title_province = { geographical_region = custom_sicily }
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = lazy
		}
		modifier = {
			add = -0.2
			has_trait = diligent
		}
		modifier = {
			add = 0.2
			has_trait = arbitrary
		}
		modifier = {
			add = -0.2
			has_trait = just
		}
		modifier = {
			add = 0.2
			has_trait = content
		}
		modifier = {
			add = -0.2
			has_trait = ambitious
		}
	}

	option = { # Ok
		name = sicily.0207.a
		#add_legitimacy = miniscule_legitimacy_loss
		add_character_modifier = {
			modifier = RICE_sicily_uncultured_scribes
			years = 10
		}
		stress_impact = {
			diligent = minor_stress_impact_gain
			just = minor_stress_impact_gain
		}
	}

	option = { # Ok
		name = sicily.0207.b
		trigger = {
			OR = {
				is_ai = no
				short_term_gold >= 50			
			}
		}
		remove_short_term_gold = 50
		if = {
			limit = {
				RICE_sicily_latin_trigger = no
			}
			RICE_sicily_signore_latin_track_medium_gain = yes
		}
		if = {
			limit = {
				RICE_sicily_greek_trigger = no
			}
			RICE_sicily_signore_greek_track_medium_gain = yes
		}
		if = {
			limit = {
				RICE_sicily_arabic_trigger = no
			}
			RICE_sicily_signore_arabic_track_medium_gain = yes
		}	
		add_character_modifier = {
			modifier = RICE_sicily_cultured_scribes
			years = 10
		}
		stress_impact = {
			lazy = miniscule_stress_impact_gain
			greedy = minor_stress_impact_gain
			callous = miniscule_stress_impact_gain
			arbitrary = miniscule_stress_impact_gain
		}
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = sicily.0207.info
		}
	}

}


# Officials in Sicily need to learn other languages
sicily.0208 = {
	type = character_event
	title = sicily.0208.t
	desc = sicily.0208.desc
	theme = stewardship_domain_focus
	override_background = { reference = RICE_background_sicily_interior }


	left_portrait = {
		character = scope:councillor
		animation = chancellor
	}

	right_portrait = {
		character = root
		animation = thinking
	}
	
	
	trigger = {
		OR = {
			RICE_sicily_latin_trigger = no
			RICE_sicily_greek_trigger = no
			RICE_sicily_arabic_trigger = no
		}
		any_councillor = {
			is_available_ai_adult = yes
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = just
		}
		modifier = {
			add = -0.2
			has_trait = arbitrary
		}
		modifier = {
			add = 0.2
			has_trait = diligent
		}
		modifier = {
			add = -0.2
			has_trait = lazy
		}
		modifier = {
			add = 0.2
			has_trait = generous
		}
		modifier = {
			add = -0.2
			has_trait = greedy
		}
	}

	immediate = {
		random_councillor = {
			limit = {
				is_available_ai_adult = yes
			}
			save_scope_as = councillor
		}
	}

	option = { # Ok
		name = sicily.0208.a
		ai_chance = {
			base = 25
			modifier = {
				has_trait = diligent
				add = 50 
			}
			modifier = {
				has_trait = ambitious
				add = 25 
			}
		}
		trigger = {
			RICE_sicily_latin_trigger = no
			OR = {
				is_ai = no
				short_term_gold >= 50			
			}
		}
		remove_short_term_gold = 50
		RICE_sicily_signore_latin_track_major_gain = yes
		every_county_in_region = {
			region = custom_sicily
			limit = {
				RICE_sicily_latin_trigger = yes
			}
			custom = RICE_every_owned_latin_county_sicily
			add_county_modifier = {
				modifier = RICE_sicily_officials_outreach_latin_locals
				years = 10
			}
		}	
		stress_impact = {
			lazy = miniscule_stress_impact_gain
			zealous = miniscule_stress_impact_gain
			callous = miniscule_stress_impact_gain
			arbitrary = miniscule_stress_impact_gain
		}
	}

	option = { # Ok
		name = sicily.0208.b
		ai_chance = {
			base = 25
			modifier = {
				has_trait = diligent
				add = 50 
			}
			modifier = {
				has_trait = ambitious
				add = 25 
			}
		}
		trigger = {
			RICE_sicily_greek_trigger = no
			OR = {
				is_ai = no
				short_term_gold >= 50			
			}
		}
		remove_short_term_gold = 50
		RICE_sicily_signore_greek_track_major_gain = yes
		every_county_in_region = {
			region = custom_sicily
			limit = {
				RICE_sicily_greek_trigger = yes
			}
			custom = RICE_every_owned_greek_county_sicily
			add_county_modifier = {
				modifier = RICE_sicily_officials_outreach_greek_locals
				years = 10
			}
		}	
		stress_impact = {
			lazy = miniscule_stress_impact_gain
			zealous = miniscule_stress_impact_gain
			callous = miniscule_stress_impact_gain
			arbitrary = miniscule_stress_impact_gain
		}
	}

	option = { # Ok
		name = sicily.0208.c
		ai_chance = {
			base = 25
			modifier = {
				has_trait = diligent
				add = 50 
			}
			modifier = {
				has_trait = ambitious
				add = 25 
			}
		}
		trigger = {
			RICE_sicily_arabic_trigger = no
			OR = {
				is_ai = no
				short_term_gold >= 50			
			}
		}
		remove_short_term_gold = 50
		RICE_sicily_signore_arabic_track_major_gain = yes
		every_county_in_region = {
			region = custom_sicily
			limit = {
				RICE_sicily_arabic_trigger = yes
			}
			custom = RICE_every_owned_arabic_county_sicily
			add_county_modifier = {
				modifier = RICE_sicily_officials_outreach_arabic_locals
				years = 10
			}
		}	
		stress_impact = {
			lazy = miniscule_stress_impact_gain
			zealous = miniscule_stress_impact_gain
			callous = miniscule_stress_impact_gain
			arbitrary = miniscule_stress_impact_gain
		}
	}

	option = { # Ok
		name = sicily.0208.d
		ai_chance = {
			factor = 225
		}
		if = {
			limit = {
				RICE_sicily_latin_trigger = yes
			}
			RICE_sicily_signore_latin_track_major_gain = yes
		}
		if = {
			limit = {
				RICE_sicily_greek_trigger = yes
			}
			RICE_sicily_signore_greek_track_major_gain = yes
		}
		if = {
			limit = {
				RICE_sicily_arabic_trigger = yes
			}
			RICE_sicily_signore_arabic_track_major_gain = yes
		}
		stress_impact = {
			humble = miniscule_stress_impact_gain
			just = miniscule_stress_impact_gain
		}
	}

	# after = {
	# 	if = {
	# 		limit = {
	# 			has_game_rule = RICE_historical_context_on
	# 		}
	# 		custom_tooltip = sicily.0208.info
	# 	}
	# }

}


# Locals in Sicily worry about whether you'll uphold their traditional laws
sicily.0209 = {
	type = character_event
	title = sicily.0209.t
	desc = sicily.0209.desc
	theme = stewardship_domain_focus
	override_background = { reference = RICE_background_sicily_interior }


	left_portrait = {
		character = scope:councillor
		animation = personality_compassionate
	}

	right_portrait = {
		character = root
		animation = thinking
	}
	
	
	trigger = {
		OR = {
			AND = {
				RICE_sicily_latin_trigger = no
				any_held_county = {
					RICE_sicily_latin_trigger = yes
					any_county_province = {
						geographical_region = custom_sicily
					}
				}
			}
			AND = {
				RICE_sicily_greek_trigger = no
				any_held_county = {
					RICE_sicily_greek_trigger = yes
					any_county_province = {
						geographical_region = custom_sicily
					}
				}
			}
			AND = {
				RICE_sicily_arabic_trigger = no
				any_held_county = {
					RICE_sicily_arabic_trigger = yes
					any_county_province = {
						geographical_region = custom_sicily
					}
				}
			}
		}
		any_councillor = {
			is_available_ai_adult = yes
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = just
		}
		modifier = {
			add = -0.2
			has_trait = arbitrary
		}
		modifier = {
			add = 0.2
			has_trait = diligent
		}
		modifier = {
			add = -0.2
			has_trait = lazy
		}
		modifier = {
			add = 0.2
			has_trait = compassionate
		}
		modifier = {
			add = -0.2
			has_trait = callous
		}
	}

	immediate = {
		random_councillor = {
			limit = {
				is_available_ai_adult = yes
			}
			save_scope_as = councillor
		}
	}

	option = { # Ok
		name = sicily.0209.a
		add_legitimacy = miniscule_legitimacy_gain
		add_prestige = -100
		add_character_modifier = {
			modifier = RICE_sicily_respects_traditional_laws
			years = 10
		}
		if = {
			limit = {
				RICE_sicily_latin_trigger = no
			}
			RICE_sicily_signore_latin_track_major_gain = yes
		}
		if = {
			limit = {
				RICE_sicily_greek_trigger = no
			}
			RICE_sicily_signore_greek_track_major_gain = yes
		}
		if = {
			limit = {
				RICE_sicily_arabic_trigger = no
			}
			RICE_sicily_signore_arabic_track_major_gain = yes
		}
		stress_impact = {
			lazy = miniscule_stress_impact_gain
			zealous = miniscule_stress_impact_gain
			callous = miniscule_stress_impact_gain
			arbitrary = miniscule_stress_impact_gain
		}
	}

	option = { # Ok
		name = sicily.0209.b
		add_prestige = 100
		stress_impact = {
			humble = minor_stress_impact_gain
			just = miniscule_stress_impact_gain
			compassionate = miniscule_stress_impact_gain
			ambitious = miniscule_stress_impact_gain
		}
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = sicily.0209.info
		}
	}

}


# Traveler tells tales about how Sicily is seen as a dangerous land abroad
sicily.0210 = {
	type = character_event
	title = sicily.0210.t
	desc = sicily.0210.desc
	theme = diplomacy_foreign_affairs_focus


	left_portrait = {
		character = scope:councillor
		animation = personality_compassionate
	}

	right_portrait = {
		character = root
		animation = thinking
	}
	
	
	trigger = {
		capital_county = {
			title_province = { geographical_region = custom_sicily }
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = gregarious
		}
		modifier = {
			add = -0.2
			has_trait = shy
		}
		modifier = {
			add = 0.2
			has_trait = diligent
		}
		modifier = {
			add = -0.2
			has_trait = lazy
		}
		modifier = {
			add = 0.2
			has_trait = humble
		}
		modifier = {
			add = -0.2
			has_trait = arrogant
		}
	}


	option = { # Ok
		name = sicily.0210.a
		add_prestige = 25
		stress_impact = {
			arrogant = miniscule_stress_impact_gain
			paranoid = miniscule_stress_impact_gain
		}
	}

	option = { # Ok
		name = sicily.0210.b
		add_piety = 25
		stress_impact = {
			humble = miniscule_stress_impact_gain
			craven = miniscule_stress_impact_gain
		}
	}

}



# Courtiers debate on whether the Baths of Baia are good or not
sicily.0211 = {
	type = character_event
	title = sicily.0211.t
	desc = sicily.0211.desc
	theme = seduction
	override_background = { reference = throne_room }

	left_portrait = {
		character = scope:lover
		animation = eyeroll
	}

	right_portrait = {
		character = scope:hater
		animation = disapproval
	}
	
	
	trigger = {

		capital_county = {
			title_province = { geographical_region = world_europe_south_italy }
		}

		# Debate doesn't make sense for a faith that would think hedonism is good
		NOR = {
			faith = { has_doctrine = tenet_hedonistic }
			faith = { has_doctrine = tenet_carnal_exaltation }
			faith = { trait_is_virtue = lustful }
		}

		# The one who likes it
		OR = {
			any_courtier_or_guest = {
				is_available_ai_adult = yes
				NOR = {
					faith = { has_doctrine = tenet_hedonistic }
					faith = { has_doctrine = tenet_carnal_exaltation }
					faith = { trait_is_virtue = lustful }
				}
				NOT = { has_trait = zealous }
				NOT = { has_trait = chaste }
				OR = {
					has_trait = forgiving
					has_trait = lustful
					has_trait = gregarious
					has_trait = trusting
					has_trait = lifestyle_physician
				}
			}
			any_vassal = {
				is_available_ai_adult = yes
				NOR = {
					faith = { has_doctrine = tenet_hedonistic }
					faith = { has_doctrine = tenet_carnal_exaltation }
					faith = { trait_is_virtue = lustful }
				}
				NOT = { has_trait = zealous }
				NOT = { has_trait = chaste }
				NOT = { has_trait = arrogant }
				OR = {
					has_trait = forgiving
					has_trait = lustful
					has_trait = gregarious
					has_trait = trusting
					has_trait = lifestyle_physician
				}
			}
		}

		# The one who hates it
		OR = {
			any_courtier_or_guest = {
				is_available_ai_adult = yes
				NOR = {
					faith = { has_doctrine = tenet_hedonistic }
					faith = { has_doctrine = tenet_carnal_exaltation }
					faith = { trait_is_virtue = lustful }
				}
				NOT = { has_trait = forgiving }
				NOT = { has_trait = lustful }
				NOT = { has_trait = gregarious }
				NOT = { has_trait = trusting }
				NOT = { has_trait = lifestyle_physician }
				OR = {
					has_trait = zealous
					has_trait = chaste
					has_trait = arrogant
				}
			}
			any_vassal = {
				is_available_ai_adult = yes
				NOR = {
					faith = { has_doctrine = tenet_hedonistic }
					faith = { has_doctrine = tenet_carnal_exaltation }
					faith = { trait_is_virtue = lustful }
				}
				NOT = { has_trait = forgiving }
				NOT = { has_trait = lustful }
				NOT = { has_trait = gregarious }
				NOT = { has_trait = trusting }
				NOT = { has_trait = lifestyle_physician }
				OR = {
					has_trait = zealous
					has_trait = chaste
					has_trait = arrogant
				}
			}
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = craven
		}
		modifier = {
			add = -0.2
			has_trait = brave
		}
		modifier = {
			add = 0.2
			has_trait = lazy
		}
		modifier = {
			add = -0.2
			has_trait = diligent
		}
		modifier = {
			add = 0.2
			has_trait = shy
		}
		modifier = {
			add = -0.2
			has_trait = gregarious
		}
	}

	immediate = {

		every_courtier_or_guest = {
			limit = {
				is_available_ai_adult = yes
				NOR = {
					faith = { has_doctrine = tenet_hedonistic }
					faith = { has_doctrine = tenet_carnal_exaltation }
					faith = { trait_is_virtue = lustful }
				}
				NOT = { has_trait = zealous }
				NOT = { has_trait = chaste }
				NOT = { has_trait = arrogant }
				OR = {
					has_trait = forgiving
					has_trait = lustful
					has_trait = gregarious
					has_trait = trusting
					has_trait = lifestyle_physician
				}
			}
			add_to_list = candidate_lovers
		}
		every_vassal = {
			limit = {
				is_available_ai_adult = yes
				NOR = {
					faith = { has_doctrine = tenet_hedonistic }
					faith = { has_doctrine = tenet_carnal_exaltation }
					faith = { trait_is_virtue = lustful }
				}
				NOT = { has_trait = zealous }
				NOT = { has_trait = chaste }
				NOT = { has_trait = arrogant }
				OR = {
					has_trait = forgiving
					has_trait = lustful
					has_trait = gregarious
					has_trait = trusting
					has_trait = lifestyle_physician
				}
			}
			add_to_list = candidate_lovers
		}
		random_in_list = {
			list = candidate_lovers
			save_scope_as = lover
		}

		every_courtier_or_guest = {
			limit = {
				is_available_ai_adult = yes
				NOR = {
					faith = { has_doctrine = tenet_hedonistic }
					faith = { has_doctrine = tenet_carnal_exaltation }
					faith = { trait_is_virtue = lustful }
				}
				NOT = { has_trait = forgiving }
				NOT = { has_trait = lustful }
				NOT = { has_trait = gregarious }
				NOT = { has_trait = trusting }
				NOT = { has_trait = lifestyle_physician }
				OR = {
					has_trait = zealous
					has_trait = chaste
					has_trait = arrogant
				}
			}
			add_to_list = candidate_haters
		}
		every_vassal = {
			limit = {
				is_available_ai_adult = yes
				NOR = {
					faith = { has_doctrine = tenet_hedonistic }
					faith = { has_doctrine = tenet_carnal_exaltation }
					faith = { trait_is_virtue = lustful }
				}
				NOT = { has_trait = forgiving }
				NOT = { has_trait = lustful }
				NOT = { has_trait = gregarious }
				NOT = { has_trait = trusting }
				NOT = { has_trait = lifestyle_physician }
				OR = {
					has_trait = zealous
					has_trait = chaste
					has_trait = arrogant
				}
			}
			add_to_list = candidate_haters
		}
		random_in_list = {
			list = candidate_haters
			save_scope_as = hater
		} # RICE_disagrees_with_me_opinion

		scope:lover = {
			add_opinion = {
				target = scope:hater
				modifier = RICE_disagrees_with_me_opinion
				opinion = -10
			}
			reverse_add_opinion = {
				target = scope:hater
				modifier = RICE_disagrees_with_me_opinion
				opinion = -10
			}		
		}

	}

	option = { # Ok
		name = sicily.0211.a
		scope:lover = {
			add_opinion = {
				target = root
				modifier = RICE_refuses_to_take_sides
				opinion = -5
			}		
		}
		scope:hater = {
			add_opinion = {
				target = root
				modifier = RICE_refuses_to_take_sides
				opinion = -5
			}		
		}
		stress_impact = {
			zealous = miniscule_stress_impact_gain
			chaste = miniscule_stress_impact_gain
			lustful = miniscule_stress_impact_gain
			cynical = miniscule_stress_impact_gain
			gregarious = miniscule_stress_impact_gain
			arrogant = miniscule_stress_impact_gain
		}
	}

	option = { # Ok
		name = sicily.0211.b
		add_prestige = 25
		scope:lover = {
			add_opinion = {
				target = root
				modifier = RICE_agrees_with_me_opinion
				opinion = 10
			}		
		}
		scope:hater = {
			add_opinion = {
				target = root
				modifier = RICE_disagrees_with_me_opinion
				opinion = -10
			}		
		}
		stress_impact = {
			zealous = miniscule_stress_impact_gain
			chaste = miniscule_stress_impact_gain
			arrogant = miniscule_stress_impact_gain
		}
	}

	option = { # Ok
		name = sicily.0211.c
		add_piety = 25
		scope:hater = {
			add_opinion = {
				target = root
				modifier = RICE_agrees_with_me_opinion
				opinion = 10
			}		
		}
		scope:lover = {
			add_opinion = {
				target = root
				modifier = RICE_disagrees_with_me_opinion
				opinion = -10
			}		
		}
		stress_impact = {
			lustful = miniscule_stress_impact_gain
			cynical = miniscule_stress_impact_gain
			arrogant = miniscule_stress_impact_gain
		}
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = sicily.0211.info
		}
	}

}



# Volcanic minerals are boosting the economy
sicily.0212 = {
	type = character_event
	title = sicily.0212.t
	desc = sicily.0212.desc
	theme = RICE_theme_sicily_countryside
	
	left_portrait = {
		character = root
		animation = happiness
	}
	
	trigger = {
		any_held_title = {
			tier = tier_county
			any_county_province = {
				geographical_region = RICE_italy_volcanism_region	
			}
		}	
	}
	
    weight_multiplier = {
        base = 0
		modifier = {
			add = {
				every_held_title = {
					limit = { tier = tier_county }
					add = 1
				}
			}		
		}		
    }
	
	immediate = {
		random_held_title = {
			limit = {
				tier = tier_county
				any_county_province = {
					geographical_region = RICE_italy_volcanism_region			
				}
			}	
			save_scope_as = county
		}
		random_list = {
			10 = {			
				scope:county = {
					add_county_modifier = {
						modifier = RICE_sicily_volcanic_minerals
						years = 4
					}		
				}
			}
			10 = {			
				scope:county = {
					add_county_modifier = {
						modifier = RICE_sicily_volcanic_minerals
						years = 6
					}		
				}
			}
			10 = {			
				scope:county = {
					add_county_modifier = {
						modifier = RICE_sicily_volcanic_minerals
						years = 8
					}		
				}
			}
			10 = {			
				scope:county = {
					add_county_modifier = {
						modifier = RICE_sicily_volcanic_minerals
						years = 10
					}		
				}
			}
		}
	}
	
	option = {
		name = sicily.0212.a
	}

}



# Gift of Maltese fungus
sicily.0213 = {
	type = character_event
	title = sicily.0213.t
	desc = sicily.0213.desc
	theme = diplomacy_foreign_affairs_focus


	right_portrait = {
		character = root
		animation = personality_greedy
	}
	
	
	trigger = {
		capital_province = {
			OR = {
				geographical_region = world_africa_north
				geographical_region = world_europe_west
				geographical_region = world_europe_south
				geographical_region = world_asia_minor
				geographical_region = world_middle_east_jerusalem
				geographical_region = world_middle_east_arabia
				geographical_region = world_africa_north
			}
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = gregarious
		}
		modifier = {
			add = -0.2
			has_trait = shy
		}
		modifier = {
			add = 0.2
			has_trait = diligent
		}
		modifier = {
			add = -0.2
			has_trait = lazy
		}
		modifier = {
			add = 0.2
			has_trait = humble
		}
		modifier = {
			add = -0.2
			has_trait = arrogant
		}
	}


	option = { # Ok
		name = sicily.0213.a
		add_character_modifier = {
			modifier = RICE_sicily_maltese_fungus_gift
			years = 10
		}
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = sicily.0213.info
		}
	}

}



# Merchants secure favorable trade deals in Maltese tongue stones
sicily.0214 = {
	type = character_event
	title = sicily.0214.t
	desc = sicily.0214.desc
	theme = stewardship_wealth_focus
	override_background = { reference = docks }
	
	right_portrait = {
		character = root
		animation = happiness
	}
	
	trigger = {
		any_held_title = {
			tier = tier_county
			is_coastal_county = yes
			any_county_province = {
				OR = {
					geographical_region = world_africa_north
					geographical_region = world_europe_west_iberia
					geographical_region = world_europe_west_francia
					geographical_region = world_europe_south
					geographical_region = world_asia_minor
					geographical_region = world_middle_east_jerusalem
					geographical_region = world_africa_north
				}	
			}
		}	
	}
	
    weight_multiplier = {
        base = 0
		modifier = {
			add = {
				every_held_title = {
					limit = { tier = tier_county }
					add = 1
				}
			}		
		}		
    }
	
	immediate = {
		random_held_title = {
			limit = {
				tier = tier_county
				is_coastal_county = yes
				any_county_province = {
					OR = {
						geographical_region = world_africa_north
						geographical_region = world_europe_west_iberia
						geographical_region = world_europe_west_francia
						geographical_region = world_europe_south
						geographical_region = world_asia_minor
						geographical_region = world_middle_east_jerusalem
						geographical_region = world_africa_north
					}
				}
			}	
			save_scope_as = county
		}
		scope:county = {
			random_list = {
				10 = {
					add_county_modifier = {
						modifier = RICE_sicily_tongue_stone_trade
						years = 3
					}				
				}
				10 = {
					add_county_modifier = {
						modifier = RICE_sicily_tongue_stone_trade
						years = 6
					}				
				}
				10 = {
					add_county_modifier = {
						modifier = RICE_sicily_tongue_stone_trade
						years = 9
					}				
				}
				10 = {
					add_county_modifier = {
						modifier = RICE_sicily_tongue_stone_trade
						years = 12
					}				
				}
				10 = {
					add_county_modifier = {
						modifier = RICE_sicily_tongue_stone_trade
						years = 15
					}				
				}
			}		
		}
	}
	
	option = { # ok
		name = sicily.0214.a
	}
}







