###############################################################################
# 
# MANICHEAN
# 
# manichean.0000-manichean.0019			Setup events, history events, miscellaneous events and decisions
# manichean.0020-manichean.0029			Minor decisions
# manichean.0030-manichean.0049			Bema Festival
# manichean.0050-manichean.0069			Manuscript decision
# manichean.0070-manichean.0089			Generic flavor events
# manichean.0090-manichean.0099			Misc Chinese Manicheism stuff
# 
###############################################################################

namespace = manichean

######################################################################################
# 
# SETUP EVENTS, HISTORY EVENTS, MISC DECISIONS
# 
# manichean.0000-manichean.0019
# 
######################################################################################


# Restore Manicheism in Mesopotamia
manichean.0001 = {
	type = character_event
	window = fullscreen_event
	title = manichean.0001.t
	desc = manichean.0001.desc
	theme = faith
	override_background = { reference = fp3_fullscreen_rekindle }

	immediate = {
		title:d_manichean.holder = {
			save_scope_as = archegos
		}
		title:c_kufa = {
			save_scope_as = babylon
		}
		if = {
			limit = {
				root = scope:manichean_reviver
			}
			RICE_revive_manicheism_in_mesopotamia_effect = yes
			# Discover the sealstone of Mani
			trigger_event = {
				id = manichean.0006
				days = { 365 3650 }
			}
			# Timer to prevent other rulers from finding the sealstone of Mani
			set_global_variable = {
				name = RICE_manichean_sealstone_timer
				value = yes
				days = 3650
			}
		}
		else = {
			show_as_tooltip = {
				scope:manichean_reviver = {
					RICE_revive_manicheism_in_mesopotamia_effect = yes					
				}
			}
		}
	}
	
	option = { # Ok
		name = manichean.0001.a
		trigger = {
			faith = { has_doctrine = rice_light_purification_doctrine }
		}		
	}
	
	option = { # Ok
		name = manichean.0001.b
		trigger = {
			NOT = { faith = { has_doctrine = rice_light_purification_doctrine } }
		}	
	}

}



# Persecution by the caliphs / Move the Archegos to Samarkand
manichean.0004 = {
	type = character_event
	window = fullscreen_event
	title = manichean.0004.t
	desc = manichean.0004.desc
	theme = faith
	override_background = { reference = fp3_fullscreen_sunder }

	immediate = {
		title:d_manichean.holder = {
			save_scope_as = archegos
		}
		title:c_samarkand = {
			save_scope_as = county
		}
		title:c_kufa = {
			save_scope_as = babylon
		}
		if = {
			limit = {
				root = scope:persecutor
			}
			RICE_persecute_manicheans_in_mesopotamia_effect = yes
		}
		else = {
			show_as_tooltip = {
				scope:persecutor = {
					RICE_persecute_manicheans_in_mesopotamia_effect = yes					
				}
			}
		}
	}
	
	option = { # Ok
		name = manichean.0004.a
		trigger = {
			faith = { has_doctrine = rice_light_purification_doctrine }
		}		
	}
	
	option = { # Ok
		name = manichean.0004.b
		trigger = {
			NOT = { faith = { has_doctrine = rice_light_purification_doctrine } }
		}	
	}

}

# Set up Archaegos
manichean.0005 = {
	type = character_event
	hidden = yes

	immediate = {
		RICE_manichean_create_archegos_effect = yes
	}

}

# Mani Sealstone Artifact is recovered
manichean.0006 = {
	type = character_event
	title = manichean.0006.t
	desc = manichean.0006.desc
	theme = faith
	override_background = { reference = RICE_background_khuzestan_farmland }

	right_portrait = {
		character = scope:discoverer
		animation = admiration
	}

	artifact = { # To display the artifact in the event-window
		target = scope:RICE_manichean_mani_sealstone
		position = lower_center_portrait
	}

	trigger = {		
		is_target_in_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:RICE_manichean_revival_happened
		}
		NOT = { has_global_variable = RICE_mani_sealstone_found }
		NOT = { has_global_variable = RICE_manichean_sealstone_timer }
		faith = { has_doctrine = rice_light_purification_doctrine }
		# This is always available to the reviver of Manicheism in Mesopotamia
		OR = {
			has_character_flag = RICE_manichean_mesopotamia_reviver_flag
			capital_county ?= {
				title_province = { 
					OR = {
						geographical_region = world_middle_east
						geographical_region = world_asia_minor
						geographical_region = world_europe_south_east
						geographical_region = world_africa_north_east
					}
				}
			}
		}
		OR = {
			has_character_flag = RICE_manichean_mesopotamia_reviver_flag
			is_ai = no
			is_independent_ruler = yes
		}
	}

	immediate = {
		set_global_variable = {
			name = RICE_mani_sealstone_found
			value = yes
		}
		save_scope_as = discoverer
		play_music_cue = "mx_cue_epic_sacral_moment"
		faith:manichean = {
			save_scope_as = manichean_faith
		}
		culture:assyrian = {
			save_scope_as = syriac_culture
		}
		random_county_in_region = {
			region = world_mesopotamia
			save_scope_as = county
		}

		hidden_effect_new_object = {
			create_artifact = {	
				name = RICE_manichean_mani_sealstone_name
				description = RICE_manichean_mani_sealstone_desc
				type = regalia_simple
				template = RICE_manichean_relic_template
				visuals = RICE_manichean_mani_sealstone
				quality = 100
				wealth = 100
				modifier = RICE_manichean_mani_sealstone_modifier
				decaying = no
				save_scope_as = RICE_manichean_mani_sealstone
				history = {
					type = created_before_history
				}
			}
		}
	}
	
	option = { # keep it
		name = manichean.0006.a
		add_piety = 500
		show_as_tooltip = {
			scope:RICE_manichean_mani_sealstone = {
				set_owner = {
					target = root
				}
			}
		}
		every_ruler = {
			limit = {
				OR = {
					this = scope:discoverer
					faith = {
						has_doctrine = rice_light_purification_doctrine
					}
					capital_county ?= {
						title_province = { 
							OR = {
								geographical_region = world_middle_east
								geographical_region = world_asia_minor
								geographical_region = world_europe_south_east
								geographical_region = world_africa_north_east
							}
						}
					}
				}
			}
			trigger_event = manichean.0007
		}
	}
	
	# option = { # don't keep it
	# 	name = manichean.0006.b
	# 	destroy_artifact = scope:RICE_manichean_mani_sealstone
	# }

}



# Notification event for Manichean Seal stone discovery
# TerrainTypeCountyScope
# IndefiniteBodyOfWater_Static
manichean.0007 = {
	type = character_event
	title = manichean.0007.t
	desc = manichean.0007.desc
	theme = faith
	override_background = { reference = RICE_background_khuzestan_farmland }

	right_portrait = {
		character = scope:discoverer
		animation = admiration
	}

	artifact = { # To display the artifact in the event-window
		target = scope:RICE_manichean_mani_sealstone
		position = lower_center_portrait
	}

	immediate = {
		show_as_tooltip = {
			add_piety = 500
			scope:RICE_manichean_mani_sealstone = {
				set_owner = {
					target = root
				}
			}
		}
	}
	
	option = { # Ok
		name = manichean.0007.a
	}

}



# Inherit the Lin Deng trait
manichean.0008 = {
	hidden = yes
	
	trigger = {
		OR = {
			# Father has Lin Deng trait, gender doctrine allows inheritance of it
			AND = {
				exists = father
				father = {
					has_trait = RICE_disciple_of_lin_deng
				}
				# father = {
				# 	faith = {
				# 		NOT = { has_doctrine = doctrine_gender_female_dominated }
				# 	}
				# }
			}
			# Mother has Lin Deng trait, gender doctrine allows inheritance of it
			AND = {
				exists = mother
				mother = {
					has_trait = RICE_disciple_of_lin_deng
				}
				# mother = {
				# 	faith = {
				# 		NOT = { has_doctrine = doctrine_gender_male_dominated }
				# 	}
				# }
			}
		}
	}
	
	immediate = {
		add_trait = RICE_disciple_of_lin_deng
	}
}


# Powerful Uyghur leader supports the Manichean Church in trouble
manichean.0010 = {
	type = character_event
	title = manichean.0010.t
	desc = manichean.0010.desc
	theme = faith
	override_background = { reference = RICE_background_iranian_throne_room }

	right_portrait = {
		character = scope:uyghur_leader
		animation = personality_zealous
	}

	immediate = {
		play_music_cue = "mx_cue_epic_sacral_moment"
		if = {
			limit = {
				root = scope:uyghur_leader
			}
			RICE_manichean_uyghur_decision_support_effect = yes
		}
		else = {
			show_as_tooltip = {
				scope:uyghur_leader = {
					RICE_manichean_uyghur_decision_support_effect = yes					
				}
			}
		}
	}
	
	option = { # Ok
		name = manichean.0010.a
		trigger = {
			faith = { has_doctrine = rice_light_purification_doctrine }
		}		
	}
	
	option = { # Ok
		name = manichean.0010.b
		trigger = {
			NOT = { faith = { has_doctrine = rice_light_purification_doctrine } }
		}	
	}

}


# Powerful Uyghur leader reforms the Manichean Church in trouble
manichean.0011 = {
	type = character_event
	title = manichean.0011.t
	desc = manichean.0011.desc
	theme = faith
	override_background = { reference = RICE_background_iranian_throne_room }

	right_portrait = {
		character = scope:uyghur_leader
		animation = personality_bold
	}

	immediate = {
		play_music_cue = "mx_cue_epic_sacral_moment"
		if = {
			limit = {
				root = scope:uyghur_leader
			}
			RICE_manichean_uyghur_decision_reform_effect = yes
		}
		else = {
			show_as_tooltip = {
				scope:uyghur_leader = {
					RICE_manichean_uyghur_decision_reform_effect = yes					
				}
			}
		}
	}
	
	option = { # Ok
		name = manichean.0011.a
		trigger = {
			faith = { has_doctrine = rice_light_purification_doctrine }
		}		
	}
	
	option = { # Ok
		name = manichean.0011.b
		trigger = {
			NOT = { faith = { has_doctrine = rice_light_purification_doctrine } }
		}	
	}

}


# Powerful Uyghur leader abandons the Manichean Church in trouble
manichean.0012 = {
	type = character_event
	title = manichean.0012.t
	desc = manichean.0012.desc
	theme = faith
	override_background = { reference = RICE_background_iranian_throne_room }

	right_portrait = {
		character = scope:uyghur_leader
		animation = personality_bold
	}

	immediate = {
		play_music_cue = "mx_cue_epic_sacral_moment"
		if = {
			limit = {
				root = scope:uyghur_leader
			}
			RICE_manichean_uyghur_decision_abandon_effect = yes
		}
		else = {
			show_as_tooltip = {
				scope:uyghur_leader = {
					RICE_manichean_uyghur_decision_abandon_effect = yes					
				}
			}
		}
	}
	
	option = { # Ok
		name = manichean.0012.a
		trigger = {
			faith = { has_doctrine = rice_light_purification_doctrine }
		}		
	}
	
	option = { # Ok
		name = manichean.0012.b
		trigger = {
			NOT = { faith = { has_doctrine = rice_light_purification_doctrine } }
		}	
	}

	after = {
		if = {
			limit = {
				root = scope:uyghur_leader
				scope:uyghur_leader = {
					any_held_title = {
						tier = tier_county
						any_county_province = {
							geographical_region = RICE_former_uyghur_influence_region
						}
						faith = {
							NOT = {
								has_doctrine = rice_light_purification_doctrine
							}
						}
					}
				}
			}
			trigger_event = manichean.0013
		}
	}

}


# Powerful Uyghur leader considers converting to a different faith
manichean.0013 = {
	type = character_event
	title = manichean.0013.t
	desc = manichean.0013.desc
	theme = faith
	override_background = { reference = RICE_background_iranian_throne_room }

	left_portrait = {
		character = scope:chaplain		
		trigger = {
			exists = scope:chaplain
		}
		triggered_animation = {
			trigger = {
				scope:chaplain = {
					OR = {
						has_trait = vengeful
						has_trait = wrathful
						has_trait = brave
						has_trait = zealous
						has_trait = honest
					}
				}
			}
			animation = rage
		}
		triggered_animation = {
			trigger = {
				scope:chaplain = {
					OR = {
						has_trait = cynical
						has_trait = arbitrary
						has_trait = content
					}
				}
			}
			animation = eyeroll
		}
		animation = beg
	}

	right_portrait = {
		character = scope:uyghur_leader
		animation = personality_cynical
	}

	immediate = {
		if = {
			limit = {			
				cp:councillor_court_chaplain = {
					exists = yes
					is_available_adult = yes
				}
			}
			cp:councillor_court_chaplain = { save_scope_as = chaplain }
		}
		random_held_title = {
			limit = {
				tier = tier_county
				any_county_province = {
					geographical_region = RICE_former_uyghur_influence_region
				}
				faith = {
					NOT = {
						has_doctrine = rice_light_purification_doctrine
					}
				}
			}
			save_scope_as = county
		}
		scope:county.faith = {
			save_scope_as = new_faith
		}
	}
	
	option = { # Ok
		name = manichean.0013.a
		set_character_faith_with_conversion = scope:new_faith
		ai_chance = {
			base = 25
			modifier = {
				add = 25
				has_trait = cynical
			}
			modifier = {
				add = 25
				has_trait = ambitious
			}
		}
	}
	
	option = { # Ok
		name = manichean.0013.b
		custom_tooltip = manichean.0013.b.tooltip # Tell player they can still take the decision to convert to another faith if they want to
		ai_chance = {
			base = 75
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}

}



# Bokut intro event
manichean.0014 = {
	type = character_event
	title = manichean.0014.t
	desc = manichean.0014.desc
	theme = RICE_theme_tarim_basin_town

	right_portrait = {
		character = root
		animation = war_attacker
	}

	immediate = {
		show_as_tooltip = {
			add_character_modifier = {
				modifier = RICE_manichean_aspiration_reclaim_uyghur_power_in_qocho
			}
		}
	}

	option = { # Ok
		name = manichean.0014.a
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}			
			custom_tooltip = manichean.0014.info
		}
	}

}



# Bokut Aspiration Fulfilled
manichean.0015 = {
	type = character_event
	title = manichean.0015.t
	desc = manichean.0015.desc
	theme = RICE_theme_tarim_basin_town

	right_portrait = {
		character = scope:bokut
		animation = war_over_win
	}

	immediate = {

		play_music_cue = "mx_cue_epic_sacral_moment"

		RICE_historical_aspiration_fulfilled_effect = yes

		character:302972 = { # bokut
			save_scope_as = bokut
		}	
		
		hidden_effect = {
			if = {
				limit = {
					has_character_modifier = RICE_manichean_aspiration_reclaim_uyghur_power_in_qocho
				}
				remove_character_modifier = RICE_manichean_aspiration_reclaim_uyghur_power_in_qocho
			}
		}

		# Main Objective Reward
		add_legitimacy = medium_legitimacy_gain
		add_prestige = RICE_aspiration_large_resource_bonus
		spawn_army = {
			levies = 300
			men_at_arms = {
				type = nomadic_riders
				stacks = 2
			}
			men_at_arms = {
				type = heavy_horse_archers
				stacks = 1
			}
			men_at_arms = {
				type = nomad_lancers
				stacks = 1
			}
			men_at_arms = {
				type = steppe_raiders
				stacks = 2
			}
			men_at_arms = {
				type = horse_archers
				stacks = 2
			}
			location = root.capital_province
			uses_supply = yes
			inheritable = yes
			name = RICE_ugyhur_bokut_event_troops
		}
		every_county_in_region = {
			region = RICE_greater_qocho_region
			custom = RICE_every_county_in_greater_qocho_region
			change_development_level = RICE_red_sea_al_umari_aspiration_dev_bonus	
		}

		# Bonus Objective Reward(s)
		if = {
			limit = {
				OR = {
					has_title = title:k_khotan
					NOT = { exists = title:k_khotan.holder }
					any_vassal_or_below = {
						has_title = title:k_khotan
					}
					any_tributary = {
						has_title = title:k_khotan
					}
					any_ally = {
						has_title = title:k_khotan
					}
				}
			}
			spawn_army = {
				levies = 500
				men_at_arms = {
					type = nomadic_riders
					stacks = 1
				}
				men_at_arms = {
					type = steppe_raiders
					stacks = 1
				}
				men_at_arms = {
					type = horse_archers
					stacks = 1
				}
				men_at_arms = {
					type = ayyar
					stacks = 2
				}
				location = root.capital_province
				uses_supply = yes
				inheritable = yes
				name = RICE_khotan_bokut_event_troops
			}
		}
		if = {
			limit = {
				OR = {
					has_title = title:k_guiyi
					NOT = { exists = title:k_guiyi.holder }
					any_vassal_or_below = {
						has_title = title:k_guiyi
					}
					any_tributary = {
						has_title = title:k_guiyi
					}
					any_ally = {
						has_title = title:k_guiyi
					}
				}
			}
			spawn_army = {
				levies = 500
				men_at_arms = {
					type = pikemen_unit
					stacks = 1
				}
				men_at_arms = {
					type = armored_footmen
					stacks = 1
				}
				men_at_arms = {
					type = chu_ko_nu
					stacks = 3
				}
				location = root.capital_province
				uses_supply = yes
				inheritable = yes
				name = RICE_guiyi_bokut_event_troops
			}
		}
		if = {
			limit = {
				OR = {
					has_character_modifier = RICE_manichean_uyghur_decision_support_character_modifier
					has_character_modifier = RICE_manichean_uyghur_decision_reform_character_modifier
					has_character_modifier = RICE_manichean_uyghur_decision_abandon_character_modifier
				}
			}
			dynasty ?= {
				add_dynasty_prestige = RICE_aspiration_large_resource_bonus
			}
		}

	}

	# Ok
	option = {
		name = manichean.0015.a
	}


}






# Uyghur leader converts to a different faith
manichean.0016 = {
	type = character_event
	title = manichean.0016.t
	desc = manichean.0016.desc
	theme = faith
	override_background = { reference = RICE_background_iranian_throne_room }

	left_portrait = {
		character = scope:chaplain		
		trigger = {
			exists = scope:chaplain
		}
		triggered_animation = {
			trigger = {
				scope:chaplain = {
					OR = {
						has_trait = vengeful
						has_trait = wrathful
						has_trait = brave
						has_trait = zealous
						has_trait = honest
					}
				}
			}
			animation = rage
		}
		triggered_animation = {
			trigger = {
				scope:chaplain = {
					OR = {
						has_trait = cynical
						has_trait = arbitrary
						has_trait = content
					}
				}
			}
			animation = eyeroll
		}
		animation = beg
	}

	right_portrait = {
		character = scope:uyghur_leader
		animation = personality_cynical
	}

	immediate = {
		if = {
			limit = {			
				cp:councillor_court_chaplain = {
					exists = yes
					is_available_adult = yes
				}
			}
			cp:councillor_court_chaplain = { save_scope_as = chaplain }
		}
	}
	
	option = { # Ok
		name = manichean.0016.a
		set_character_faith_with_conversion = scope:new_faith
	}

}



# Give the yearly bonuses for supporting the Manichean Church
manichean.0017 = {
	type = character_event
	hidden = yes

	immediate = {
		set_variable = {
			name = RICE_manichean_change_prestige_value
			value = {
				value = 0
				add = {
					integer_range = {
						min = 1
						max = minor_prestige_gain
					}
				}
			}
		}
		send_interface_message = {
			type = event_generic_neutral
			title = manichean.0017.title
			add_prestige = var:RICE_manichean_change_prestige_value
			custom_tooltip = manichean.0017.tooltip # This happens because you are still a member of the Manichean Church
		}
		if = {
			limit = { has_variable = RICE_manichean_change_prestige_value }
			remove_variable = RICE_manichean_change_prestige_value
		}
	}
}



# Give the yearly bonuses for reforming the Manichean Church
manichean.0018 = {
	type = character_event
	hidden = yes

	immediate = {
		set_variable = {
			name = RICE_manichean_change_piety_value
			value = {
				value = 0
				add = {
					integer_range = {
						min = 1
						max = minor_piety_gain
					}
				}
			}
		}
		send_interface_message = {
			type = event_generic_neutral
			title = manichean.0018.title
			add_piety = var:RICE_manichean_change_piety_value
			custom_tooltip = manichean.0018.tooltip # This happens because you are still a member of the Manichean Church
		}
		if = {
			limit = { has_variable = RICE_manichean_change_piety_value }
			remove_variable = RICE_manichean_change_piety_value
		}
	}
}


# Give the yearly malus when abandoning the Manichean Church
manichean.0018 = {
	type = character_event
	hidden = yes

	immediate = {
		set_variable = {
			name = RICE_manichean_change_piety_value
			value = {
				value = 0
				add = {
					integer_range = {
						min = minor_piety_loss
						max = -1
					}
				}
			}
		}
		set_variable = {
			name = RICE_manichean_change_prestige_value
			value = {
				value = 0
				add = {
					integer_range = {
						min = minor_prestige_loss
						max = -1
					}
				}
			}
		}
		send_interface_message = {
			type = event_generic_neutral
			title = manichean.0019.title
			add_piety = var:RICE_manichean_change_piety_value
			add_piety = var:RICE_manichean_change_prestige_value
			custom_tooltip = manichean.0019.tooltip # This happens because you are still a member of the Manichean Church
		}
		if = {
			limit = { has_variable = RICE_manichean_change_piety_value }
			remove_variable = RICE_manichean_change_piety_value
		}
		if = {
			limit = { has_variable = RICE_manichean_change_prestige_value }
			remove_variable = RICE_manichean_change_prestige_value
		}
	}
}


######################################################################################
# 
# MINOR DECISIONS
# 
# manichean.0020-manichean.0029
# 
######################################################################################



# Ming Cultist decision
manichean.0020 = {
	type = character_event
	title = manichean.0020.t
	desc = manichean.0020.desc
	theme = martial
	override_background = { reference = army_camp }

	right_portrait = {
		character = root
		animation = marshal
	}

	immediate = {
		RICE_manichean_recruit_ming_cultists_effect = yes
	}
	
	option = { # Ok
		name = manichean.0020.a
	}

	after = {		
		# For Chen Pingshan's aspiration
		if = {
			limit = {
				root = character:RICE_chinese_manichean_002
			}
			add_character_flag = RICE_chen_pingshan_did_ming_cultist_decision
		}
	}
}


# Manichean confession decision
manichean.0021 = {
	type = character_event
	title = manichean.0021.t
	desc = manichean.0021.desc
	theme = faith

	right_portrait = {
		character = root
		animation = prayer
	}
	
	option = { # Ok
		name = manichean.0021.a
		add_piety = { RICE_manichean_confession_piety_gain_min RICE_manichean_confession_piety_gain_max }
		RICE_manichean_confession_decision_effect = yes
		RICE_manichean_confession_effect = yes
	}

}




######################################################################################
# 
# BEMA FESIVAL
# 
# manichean.0030-manichean.0049
# 
######################################################################################


# Bema Festival preparations - Start fasting for the Bema Festival
manichean.0030 = {
	type = activity_event
	title = manichean.0030.t
	desc = manichean.0030.desc
	theme = faith
	override_background = { reference = relaxing_room }
	
	right_portrait = root
	
	option = { # Ok
		name = manichean.0030.a
		if = {
			limit = {
				scope:activity = {
					has_activity_option = {
						category = RICE_manichean_bema_festival_fasting_length_type
						option = RICE_manichean_bema_festival_fasting_length_type_month
					}
				}
			}
			trigger_event = {
				id = manichean.0031
				days = 30
			}
		}
		else_if = {
			limit = {
				scope:activity = {
					has_activity_option = {
						category = RICE_manichean_bema_festival_fasting_length_type
						option = RICE_manichean_bema_festival_fasting_length_type_week
					}
				}
			}
			trigger_event = {
				id = manichean.0031
				days = 7
			}
		}
		else = {
			# Have it trigger as a failsafe in case you don't have a length option for some reason
			# limit = {
			# 	scope:activity = {
			# 		has_activity_option = {
			# 			category = RICE_manichean_bema_festival_fasting_length_type
			# 			option = RICE_manichean_bema_festival_fasting_length_type_day
			# 		}
			# 	}
			# }
			trigger_event = {
				id = manichean.0031
				days = 1
			}
		}
	}
}


# Fasting done - prepare for the ceremony
manichean.0031 = {
	type = activity_event
	title = manichean.0031.t
	desc = manichean.0031.desc
	theme = faith
	override_background = { reference = relaxing_room }
	
	right_portrait = {
		character = root
		animation = personality_honorable
	}

	immediate = {
		random = {
			chance = RICE_manichean_fast_health_malus_chance
			RICE_manichean_fast_health_malus_effect = yes
		}
	}
	
	option = { # Ok
		name = manichean.0031.a
		trigger_event = {
			id = manichean.0032
			days = { 3 5 }
		}	
	}
}


# Ceremony begins - start prayers and rituals, confess your sins!
manichean.0032 = {
	type = activity_event
	title = manichean.0032.t
	desc = {
		desc = manichean.0032.desc.intro
		triggered_desc = {
			trigger = {
				has_character_flag = RICE_manichean_bema_festival_lost_sin_flag
			}
			desc = manichean.0032.desc.change
		}
	}
	theme = RICE_theme_manichean_bema_festival
	
	right_portrait = {
		character = root
		animation = prayer
	}

	immediate = {
		RICE_manichean_bema_festival_determine_lose_sin_effect = yes
	}
	
	option = { # Ok
		name = manichean.0032.a
		trigger_event = {
			id = manichean.0033
			days = { 3 5 }
		}	
	}

	after = {
		if = {
			limit = {
				has_character_flag = RICE_manichean_bema_festival_lost_sin_flag
			}
			remove_character_flag = RICE_manichean_bema_festival_lost_sin_flag
		}
	}
}


# Ceremony begins - listen to the sermons by the Elect
manichean.0033 = {
	type = activity_event
	title = manichean.0033.t
	desc = manichean.0033.desc
	theme = RICE_theme_manichean_bema_festival
	
	left_portrait = {
		character = scope:chaplain
		animation = wedding_priest
		trigger = {
			exists = scope:chaplain
		}
	}	

	right_portrait = {
		character = root
		animation = personality_content
	}

	immediate = {
		if = {
			limit = {
				exists = cp:councillor_court_chaplain
			}
			cp:councillor_court_chaplain ?= { save_scope_as = chaplain }
		}
	}
	
	option = { # Ok
		name = manichean.0033.a
		# if = {
		# 	limit = {
		# 		has_activity_intent = RICE_manichean_bema_festival_spiritual_guidance_intent
		# 	}
		# 	custom_tooltip = manichean.0033.a.guaranteed.tooltip
		# }
		# else = {
		# 	random = {
		# 		chance = 33
		# 		custom_tooltip = manichean.0033.a.chance.tooltip
		# 	}
		# }
		trigger_event = {
			id = manichean.0034
			days = { 3 5 }
		}	
	}
}


# Bema Festival - end event
manichean.0034 = {
	type = activity_event
	title = manichean.0034.t
	desc = manichean.0034.desc
	theme = RICE_theme_manichean_bema_festival
	
	right_portrait = root
	
	option = { # Ok
		name = manichean.0034.a
		RICE_manichean_bema_festival_completed_log_entry_effect = yes
	}

	after = {
		if = {
			limit = {
				root = scope:host
			}
			scope:activity = {
				hidden_effect = { skip_activity_phase = yes }
			}
		}
	}

}






######################################################################################
# 
# MANUSCRIPT DECISION
# 
# manichean.0050-manichean.0069
# 
######################################################################################

# Manuscript - will you do it yourself or not?
manichean.0050 = {
	type = character_event
	title = manichean.0050.t
	desc = manichean.0050.desc
	theme = learning

	right_portrait = {
		character = root
		animation = thinking
	}

	immediate = {
		# If you're doing another religious text, figure out what type it is
		if = {
			limit = {
				var:RICE_manichean_manuscript_type ?= flag:other_religions_texts
			}
			if = {
				limit = {
					# If you own a title with a non-Manichean faith, pick that
					any_held_title = {
						tier = county
						NOT = { faith = { has_doctrine = special_doctrine_rice_doctrine_late_manicheism_abandon } }
						NOT = { faith = { has_doctrine = unreformed_faith_doctrine } }
					}
				}
				random_held_title = {
					limit = {
						tier = county
						NOT = { faith = { has_doctrine = special_doctrine_rice_doctrine_late_manicheism_abandon } }
						NOT = { faith = { has_doctrine = unreformed_faith_doctrine } }
					}
					add_to_list = other_faith_candidates
				}
				random_in_list = {
					list = other_faith_candidates
					weight = {
						base = 10
						modifier = {
							any_county_province = {
								has_holding = yes
							}
							add = 10
						}
						modifier = {
							OR = {
								faith.religion = religion:christianity_religion
								faith.religion = religion:buddhism_religion
								faith.religion = religion:zoroastrianism_religion
								faith.religion = religion:judaism_religion
								faith.religion = religion:taoism_religion
							}
							add = 30
						}
					}
					save_scope_as = other_faith
				}
			}
			# If you don't own one, choose one in the appropriate region
			# Starting with Europe = Christianity
			else_if = {
				limit = {
					capital_county = {
						title_province = { 
							OR = {
								geographical_region = world_europe
								geographical_region = world_asia_minor
							}
						}
					}
				}
				religion:christianity_religion = {
					random_faith = {
						save_scope_as = other_faith
					}
				}
			}
			# North Africa/eastern steppes = Judaism
			else_if = {
				limit = {
					capital_county = {
						title_province = { 
							geographical_region = world_africa
						}
					}
				}
				religion:judaism_religion = {
					random_faith = {
						save_scope_as = other_faith
					}
				}
			}
			# Middle East = Zoroastrianism
			else_if = {
				limit = {
					capital_county = {
						title_province = { 
							geographical_region = world_middle_east
						}
					}
				}
				religion:zoroastrianism_religion = {
					random_faith = {
						save_scope_as = other_faith
					}
				}
			}
			# India/Central Asia = Buddhism
			else_if = {
				limit = {
					capital_county = {
						title_province = { 
							OR = {
								geographical_region = world_india
								geographical_region = world_steppe
								geographical_region = world_tibet
								geographical_region = world_burma
							}
						}
					}
				}
				religion:buddhism_religion = {
					random_faith = {
						save_scope_as = other_faith
					}
				}
			}
			# If for some reason you don't meet these criteria
			else = {
				random_list = {
					10 = {
						religion:christianity_religion = {
							random_faith = {
								save_scope_as = other_faith
							}
						}
					}
					10 = {
						religion:judaism_religion = {
							random_faith = {
								save_scope_as = other_faith
							}
						}
					}
					10 = {
						religion:zoroastrianism_religion = {
							random_faith = {
								save_scope_as = other_faith
							}
						}
					}
					10 = {
						religion:buddhism_religion = {
							random_faith = {
								save_scope_as = other_faith
							}
						}
					}
					10 = {
						religion:taoism_religion = {
							random_faith = {
								save_scope_as = other_faith
							}
						}
					}
				}
			}
		}
	}

	option = { # Ok
		name = manichean.0050.a			
		set_variable = {
			name = RICE_manichean_manuscript_author
			value = flag:other
			days = 730 # A little over one year just in case
		}
	}

	option = { # Ok
		name = manichean.0050.b
		trigger = {
			learning >= RICE_manichean_manuscript_learning_req_value # 8 (mediocre_skill_rating) if has the special doctrine, 12 (decent_skill_rating) otherwise/normally			
		}
		skill = learning
		show_as_unavailable = {
			learning < RICE_manichean_manuscript_learning_req_value
		}		
		set_variable = {
			name = RICE_manichean_manuscript_author
			value = flag:self
			days = 730 # A little over one year just in case
		}
		add_character_modifier = {
			modifier = RICE_manichean_writing_manuscript
			days = 365
		}
	}
	
	after = {
		custom_tooltip = manichean.0050.tooltip
		if = {
			limit = {
				var:RICE_manichean_manuscript_type ?= flag:seven_treatises
			}
			trigger_event = manichean.0051
			# trigger_event = {
			# 	id = manichean.0051
			# 	days = { 30 365 }
			# }
		}
		else_if = {
			limit = {
				var:RICE_manichean_manuscript_type ?= flag:shabuhragan
			}
			trigger_event = manichean.0052
			# trigger_event = {
			# 	id = manichean.0052
			# 	days = { 30 365 }
			# }
		}
		else_if = {
			limit = {
				var:RICE_manichean_manuscript_type ?= flag:arzhang
			}
			trigger_event = manichean.0053
			# trigger_event = {
			# 	id = manichean.0053
			# 	days = { 30 365 }
			# }
		}
		else_if = {
			limit = {
				var:RICE_manichean_manuscript_type ?= flag:kephalaia
			}
			trigger_event = manichean.0054
			# trigger_event = {
			# 	id = manichean.0054
			# 	days = { 30 365 }
			# }
		}
		else_if = {
			limit = {
				var:RICE_manichean_manuscript_type ?= flag:hymn_book
			}
			trigger_event = manichean.0055
			# trigger_event = {
			# 	id = manichean.0055
			# 	days = { 30 365 }
			# }
		}
		else_if = {
			limit = {
				var:RICE_manichean_manuscript_type ?= flag:confessional_texts
			}
			trigger_event = manichean.0056
			# trigger_event = {
			# 	id = manichean.0056
			# 	days = { 30 365 }
			# }
		}
		else_if = {
			limit = {
				var:RICE_manichean_manuscript_type ?= flag:parables_and_tales
			}
			trigger_event = manichean.0057
			# trigger_event = {
			# 	id = manichean.0057
			# 	days = { 30 365 }
			# }
		}
		else_if = {
			limit = {
				var:RICE_manichean_manuscript_type ?= flag:other_religions_texts
			}
			trigger_event = manichean.0058
			# trigger_event = {
			# 	id = manichean.0058
			# 	days = { 30 365 }
			# }
		}
	}

}

# Manuscript - Seven Treatises
manichean.0051 = {
	type = character_event
	title = manichean.0051.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					var:RICE_manichean_manuscript_author ?= flag:self
				}
				desc = manichean.0051.desc.self
			}
			triggered_desc = {
				trigger = {
					var:RICE_manichean_manuscript_author ?= flag:other
				}
				desc = manichean.0051.desc.other
			}
		}
		desc = manichean.0051.desc
	}
	theme = learning

	right_portrait = {
		character = root
		triggered_animation = {
			trigger = {
				var:RICE_manichean_manuscript_author ?= flag:self
			}
			animation = happy_teacher
		}
		animation = personality_content
	}

	artifact = { # To display the artifact in the event-window
        target = scope:RICE_manichean_manuscript_artifact
        position = lower_center_portrait
    }

	trigger = {
		faith = { has_doctrine = rice_light_purification_doctrine }
	}

	#Trigger if converted to another faith
	on_trigger_fail = { 
		trigger_event = manichean.0059
	}

	immediate = {
		RICE_manichean_manuscript_general_effect = yes
		random_list = {
			60 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_seven_treatises_name
						description = RICE_manichean_artifact_seven_treatises_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 15
						wealth = 15
						modifier = artifact_RICE_manichean_manuscript_seven_treatises_modifier_1
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_seven_treatises_variable
					}
				}
			}
			45 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_seven_treatises_name
						description = RICE_manichean_artifact_seven_treatises_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 30
						wealth = 30
						modifier = artifact_RICE_manichean_manuscript_seven_treatises_modifier_2
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_seven_treatises_variable
					}
				}
			}
			30 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_seven_treatises_name
						description = RICE_manichean_artifact_seven_treatises_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 65
						wealth = 65
						modifier = artifact_RICE_manichean_manuscript_seven_treatises_modifier_3
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_seven_treatises_variable
					}
				}
			}
			15 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_seven_treatises_name
						description = RICE_manichean_artifact_seven_treatises_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 95
						wealth = 95
						modifier = artifact_RICE_manichean_manuscript_seven_treatises_modifier_4
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_seven_treatises_variable
					}
				}
			}
		}
	}

	option = { # Ok
		name = manichean.0051.a
		show_as_tooltip = {
			scope:RICE_manichean_manuscript_artifact = {
				set_owner = {
					target = root
				}
			}
		}
	}

	after = {
		RICE_manichean_manuscript_event_chain_cleanup_effect = yes
	}

}



# Manuscript - shabuhragan
manichean.0052 = {
	type = character_event
	title = manichean.0051.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					var:RICE_manichean_manuscript_author ?= flag:self
				}
				desc = manichean.0051.desc.self
			}
			triggered_desc = {
				trigger = {
					var:RICE_manichean_manuscript_author ?= flag:other
				}
				desc = manichean.0051.desc.other
			}
		}
		desc = manichean.0052.desc
	}
	theme = learning

	right_portrait = {
		character = root
		triggered_animation = {
			trigger = {
				var:RICE_manichean_manuscript_author ?= flag:self
			}
			animation = happy_teacher
		}
		animation = personality_content
	}

	artifact = { # To display the artifact in the event-window
        target = scope:RICE_manichean_manuscript_artifact
        position = lower_center_portrait
    }

	trigger = {
		faith = { has_doctrine = rice_light_purification_doctrine }
	}

	#Trigger if converted to another faith
	on_trigger_fail = { 
		trigger_event = manichean.0059
	}

	immediate = {
		RICE_manichean_manuscript_general_effect = yes
		random_list = {
			60 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_shabuhragan_name
						description = RICE_manichean_artifact_shabuhragan_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 15
						wealth = 15
						modifier = artifact_RICE_manichean_manuscript_shabuhragan_modifier_1
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_shabuhragan_variable
					}
				}
			}
			45 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_shabuhragan_name
						description = RICE_manichean_artifact_shabuhragan_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 30
						wealth = 30
						modifier = artifact_RICE_manichean_manuscript_shabuhragan_modifier_2
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_shabuhragan_variable
					}
				}
			}
			30 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_shabuhragan_name
						description = RICE_manichean_artifact_shabuhragan_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 65
						wealth = 65
						modifier = artifact_RICE_manichean_manuscript_shabuhragan_modifier_3
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_shabuhragan_variable
					}
				}
			}
			15 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_shabuhragan_name
						description = RICE_manichean_artifact_shabuhragan_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 95
						wealth = 95
						modifier = artifact_RICE_manichean_manuscript_shabuhragan_modifier_4
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_shabuhragan_variable
					}
				}
			}
		}
	}

	option = { # Ok
		name = manichean.0051.a
		show_as_tooltip = {
			scope:RICE_manichean_manuscript_artifact = {
				set_owner = {
					target = root
				}
			}
		}
	}

	after = {
		RICE_manichean_manuscript_event_chain_cleanup_effect = yes
	}

}



# Manuscript - arzhang
manichean.0053 = {
	type = character_event
	title = manichean.0051.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					var:RICE_manichean_manuscript_author ?= flag:self
				}
				desc = manichean.0051.desc.self
			}
			triggered_desc = {
				trigger = {
					var:RICE_manichean_manuscript_author ?= flag:other
				}
				desc = manichean.0051.desc.other
			}
		}
		desc = manichean.0053.desc
	}
	theme = learning

	right_portrait = {
		character = root
		triggered_animation = {
			trigger = {
				var:RICE_manichean_manuscript_author ?= flag:self
			}
			animation = happy_teacher
		}
		animation = personality_content
	}

	artifact = { # To display the artifact in the event-window
        target = scope:RICE_manichean_manuscript_artifact
        position = lower_center_portrait
    }

	trigger = {
		faith = { has_doctrine = rice_light_purification_doctrine }
	}

	#Trigger if converted to another faith
	on_trigger_fail = { 
		trigger_event = manichean.0059
	}

	immediate = {
		RICE_manichean_manuscript_general_effect = yes
		random_list = {
			60 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_arzhang_name
						description = RICE_manichean_artifact_arzhang_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 15
						wealth = 15
						modifier = artifact_RICE_manichean_manuscript_arzhang_modifier_1
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_arzhang_variable
					}
				}
			}
			45 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_arzhang_name
						description = RICE_manichean_artifact_arzhang_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 30
						wealth = 30
						modifier = artifact_RICE_manichean_manuscript_arzhang_modifier_2
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_arzhang_variable
					}
				}
			}
			30 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_arzhang_name
						description = RICE_manichean_artifact_arzhang_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 65
						wealth = 65
						modifier = artifact_RICE_manichean_manuscript_arzhang_modifier_3
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_arzhang_variable
					}
				}
			}
			15 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_arzhang_name
						description = RICE_manichean_artifact_arzhang_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 95
						wealth = 95
						modifier = artifact_RICE_manichean_manuscript_arzhang_modifier_4
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_arzhang_variable
					}
				}
			}
		}
	}

	option = { # Ok
		name = manichean.0051.a
		show_as_tooltip = {
			scope:RICE_manichean_manuscript_artifact = {
				set_owner = {
					target = root
				}
			}
		}
	}

	after = {
		RICE_manichean_manuscript_event_chain_cleanup_effect = yes
	}

}



# Manuscript - kephalaia
manichean.0054 = {
	type = character_event
	title = manichean.0051.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					var:RICE_manichean_manuscript_author ?= flag:self
				}
				desc = manichean.0051.desc.self
			}
			triggered_desc = {
				trigger = {
					var:RICE_manichean_manuscript_author ?= flag:other
				}
				desc = manichean.0051.desc.other
			}
		}
		desc = manichean.0054.desc
	}
	theme = learning

	right_portrait = {
		character = root
		triggered_animation = {
			trigger = {
				var:RICE_manichean_manuscript_author ?= flag:self
			}
			animation = happy_teacher
		}
		animation = personality_content
	}

	artifact = { # To display the artifact in the event-window
        target = scope:RICE_manichean_manuscript_artifact
        position = lower_center_portrait
    }

	trigger = {
		faith = { has_doctrine = rice_light_purification_doctrine }
	}

	#Trigger if converted to another faith
	on_trigger_fail = { 
		trigger_event = manichean.0059
	}

	immediate = {
		RICE_manichean_manuscript_general_effect = yes
		random_list = {
			60 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_kephalaia_name
						description = RICE_manichean_artifact_kephalaia_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 15
						wealth = 15
						modifier = artifact_RICE_manichean_manuscript_kephalaia_modifier_1
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_kephalaia_variable
					}
				}
			}
			45 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_kephalaia_name
						description = RICE_manichean_artifact_kephalaia_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 30
						wealth = 30
						modifier = artifact_RICE_manichean_manuscript_kephalaia_modifier_2
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_kephalaia_variable
					}
				}
			}
			30 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_kephalaia_name
						description = RICE_manichean_artifact_kephalaia_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 65
						wealth = 65
						modifier = artifact_RICE_manichean_manuscript_kephalaia_modifier_3
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_kephalaia_variable
					}
				}
			}
			15 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_kephalaia_name
						description = RICE_manichean_artifact_kephalaia_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 95
						wealth = 95
						modifier = artifact_RICE_manichean_manuscript_kephalaia_modifier_4
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_kephalaia_variable
					}
				}
			}
		}
	}

	option = { # Ok
		name = manichean.0051.a
		show_as_tooltip = {
			scope:RICE_manichean_manuscript_artifact = {
				set_owner = {
					target = root
				}
			}
		}
	}

	after = {
		RICE_manichean_manuscript_event_chain_cleanup_effect = yes
	}

}



# Manuscript - hymn book
manichean.0055 = {
	type = character_event
	title = manichean.0051.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					var:RICE_manichean_manuscript_author ?= flag:self
				}
				desc = manichean.0051.desc.self
			}
			triggered_desc = {
				trigger = {
					var:RICE_manichean_manuscript_author ?= flag:other
				}
				desc = manichean.0051.desc.other
			}
		}
		desc = manichean.0055.desc
	}
	theme = learning

	right_portrait = {
		character = root
		triggered_animation = {
			trigger = {
				var:RICE_manichean_manuscript_author ?= flag:self
			}
			animation = happy_teacher
		}
		animation = personality_content
	}

	artifact = { # To display the artifact in the event-window
        target = scope:RICE_manichean_manuscript_artifact
        position = lower_center_portrait
    }

	trigger = {
		faith = { has_doctrine = rice_light_purification_doctrine }
	}

	#Trigger if converted to another faith
	on_trigger_fail = { 
		trigger_event = manichean.0059
	}

	immediate = {
		RICE_manichean_manuscript_general_effect = yes
		random_list = {
			60 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_hymn_book_name
						description = RICE_manichean_artifact_hymn_book_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 15
						wealth = 15
						modifier = artifact_RICE_manichean_manuscript_hymn_book_modifier_1
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_hymn_book_variable
					}
				}
			}
			45 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_hymn_book_name
						description = RICE_manichean_artifact_hymn_book_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 30
						wealth = 30
						modifier = artifact_RICE_manichean_manuscript_hymn_book_modifier_2
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_hymn_book_variable
					}
				}
			}
			30 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_hymn_book_name
						description = RICE_manichean_artifact_hymn_book_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 65
						wealth = 65
						modifier = artifact_RICE_manichean_manuscript_hymn_book_modifier_3
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_hymn_book_variable
					}
				}
			}
			15 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_hymn_book_name
						description = RICE_manichean_artifact_hymn_book_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 95
						wealth = 95
						modifier = artifact_RICE_manichean_manuscript_hymn_book_modifier_4
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_hymn_book_variable
					}
				}
			}
		}
	}

	option = { # Ok
		name = manichean.0051.a
		show_as_tooltip = {
			scope:RICE_manichean_manuscript_artifact = {
				set_owner = {
					target = root
				}
			}
		}
	}

	after = {
		RICE_manichean_manuscript_event_chain_cleanup_effect = yes
	}

}




# Manuscript - confessional texts
manichean.0056 = {
	type = character_event
	title = manichean.0051.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					var:RICE_manichean_manuscript_author ?= flag:self
				}
				desc = manichean.0051.desc.self
			}
			triggered_desc = {
				trigger = {
					var:RICE_manichean_manuscript_author ?= flag:other
				}
				desc = manichean.0051.desc.other
			}
		}
		desc = manichean.0056.desc
	}
	theme = learning

	right_portrait = {
		character = root
		triggered_animation = {
			trigger = {
				var:RICE_manichean_manuscript_author ?= flag:self
			}
			animation = happy_teacher
		}
		animation = personality_content
	}

	artifact = { # To display the artifact in the event-window
        target = scope:RICE_manichean_manuscript_artifact
        position = lower_center_portrait
    }

	trigger = {
		faith = { has_doctrine = rice_light_purification_doctrine }
	}

	#Trigger if converted to another faith
	on_trigger_fail = { 
		trigger_event = manichean.0059
	}

	immediate = {
		RICE_manichean_manuscript_general_effect = yes
		random_list = {
			60 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_confessional_texts_name
						description = RICE_manichean_artifact_confessional_texts_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 15
						wealth = 15
						modifier = artifact_RICE_manichean_manuscript_confessional_texts_modifier_1
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_confessional_texts_variable
					}
				}
			}
			45 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_confessional_texts_name
						description = RICE_manichean_artifact_confessional_texts_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 30
						wealth = 30
						modifier = artifact_RICE_manichean_manuscript_confessional_texts_modifier_2
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_confessional_texts_variable
					}
				}
			}
			30 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_confessional_texts_name
						description = RICE_manichean_artifact_confessional_texts_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 65
						wealth = 65
						modifier = artifact_RICE_manichean_manuscript_confessional_texts_modifier_3
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_confessional_texts_variable
					}
				}
			}
			15 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_confessional_texts_name
						description = RICE_manichean_artifact_confessional_texts_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 95
						wealth = 95
						modifier = artifact_RICE_manichean_manuscript_confessional_texts_modifier_4
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_confessional_texts_variable
					}
				}
			}
		}
	}

	option = { # Ok
		name = manichean.0051.a
		show_as_tooltip = {
			scope:RICE_manichean_manuscript_artifact = {
				set_owner = {
					target = root
				}
			}
		}
	}

	after = {
		RICE_manichean_manuscript_event_chain_cleanup_effect = yes
	}

}



# Manuscript - parables and tales
manichean.0057 = {
	type = character_event
	title = manichean.0051.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					var:RICE_manichean_manuscript_author ?= flag:self
				}
				desc = manichean.0051.desc.self
			}
			triggered_desc = {
				trigger = {
					var:RICE_manichean_manuscript_author ?= flag:other
				}
				desc = manichean.0051.desc.other
			}
		}
		desc = manichean.0057.desc
	}
	theme = learning

	right_portrait = {
		character = root
		triggered_animation = {
			trigger = {
				var:RICE_manichean_manuscript_author ?= flag:self
			}
			animation = happy_teacher
		}
		animation = personality_content
	}

	artifact = { # To display the artifact in the event-window
        target = scope:RICE_manichean_manuscript_artifact
        position = lower_center_portrait
    }

	trigger = {
		faith = { has_doctrine = rice_light_purification_doctrine }
	}

	#Trigger if converted to another faith
	on_trigger_fail = { 
		trigger_event = manichean.0059
	}

	immediate = {
		RICE_manichean_manuscript_general_effect = yes
		random_list = {
			60 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_parables_and_tales_name
						description = RICE_manichean_artifact_parables_and_tales_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 15
						wealth = 15
						modifier = artifact_RICE_manichean_manuscript_parables_and_tales_modifier_1
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_parables_and_tales_variable
					}
				}
			}
			45 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_parables_and_tales_name
						description = RICE_manichean_artifact_parables_and_tales_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 30
						wealth = 30
						modifier = artifact_RICE_manichean_manuscript_parables_and_tales_modifier_2
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_parables_and_tales_variable
					}
				}
			}
			30 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_parables_and_tales_name
						description = RICE_manichean_artifact_parables_and_tales_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 65
						wealth = 65
						modifier = artifact_RICE_manichean_manuscript_parables_and_tales_modifier_3
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_parables_and_tales_variable
					}
				}
			}
			15 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_parables_and_tales_name
						description = RICE_manichean_artifact_parables_and_tales_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 95
						wealth = 95
						modifier = artifact_RICE_manichean_manuscript_parables_and_tales_modifier_4
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_parables_and_tales_variable
					}
				}
			}
		}
	}

	option = { # Ok
		name = manichean.0051.a
		show_as_tooltip = {
			scope:RICE_manichean_manuscript_artifact = {
				set_owner = {
					target = root
				}
			}
		}
	}

	after = {
		RICE_manichean_manuscript_event_chain_cleanup_effect = yes
	}

}



# Manuscript - other religions texts
manichean.0058 = {
	type = character_event
	title = manichean.0051.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					var:RICE_manichean_manuscript_author ?= flag:self
				}
				desc = manichean.0051.desc.self
			}
			triggered_desc = {
				trigger = {
					var:RICE_manichean_manuscript_author ?= flag:other
				}
				desc = manichean.0051.desc.other
			}
		}
		desc = manichean.0058.desc
	}
	theme = learning

	right_portrait = {
		character = root
		triggered_animation = {
			trigger = {
				var:RICE_manichean_manuscript_author ?= flag:self
			}
			animation = happy_teacher
		}
		animation = personality_content
	}

	artifact = { # To display the artifact in the event-window
        target = scope:RICE_manichean_manuscript_artifact
        position = lower_center_portrait
    }

	trigger = {
		faith = { has_doctrine = rice_light_purification_doctrine }
	}

	#Trigger if converted to another faith
	on_trigger_fail = { 
		trigger_event = manichean.0059
	}

	immediate = {
		RICE_manichean_manuscript_general_effect = yes
		random_list = {
			60 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_other_religions_texts_name
						description = RICE_manichean_artifact_other_religions_texts_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 15
						wealth = 15
						modifier = artifact_RICE_manichean_manuscript_other_religions_texts_modifier_1
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_other_religions_texts_variable
					}
				}
			}
			45 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_other_religions_texts_name
						description = RICE_manichean_artifact_other_religions_texts_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 30
						wealth = 30
						modifier = artifact_RICE_manichean_manuscript_other_religions_texts_modifier_2
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_other_religions_texts_variable
					}
				}
			}
			30 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_other_religions_texts_name
						description = RICE_manichean_artifact_other_religions_texts_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 65
						wealth = 65
						modifier = artifact_RICE_manichean_manuscript_other_religions_texts_modifier_3
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_other_religions_texts_variable
					}
				}
			}
			15 = {
				hidden_effect_new_object = {
					create_artifact = {	
						name = RICE_manichean_artifact_other_religions_texts_name
						description = RICE_manichean_artifact_other_religions_texts_desc
						type = journal
						template = RICE_manichean_manuscript_template
						visuals = RICE_manichean_manuscript
						quality = 95
						wealth = 95
						modifier = artifact_RICE_manichean_manuscript_other_religions_texts_modifier_4
						#max_durability = 40
						decaying = no
						save_scope_as = RICE_manichean_manuscript_artifact
						history = {
							type = created_before_history
						}
					}
					scope:RICE_manichean_manuscript_artifact = {
						set_variable = RICE_manichean_artifact_other_religions_texts_variable
					}
				}
			}
		}
	}

	option = { # Ok
		name = manichean.0051.a
		show_as_tooltip = {
			scope:RICE_manichean_manuscript_artifact = {
				set_owner = {
					target = root
				}
			}
		}
	}

	after = {
		RICE_manichean_manuscript_event_chain_cleanup_effect = yes
	}

}



# Converted to another religion, no more manuscript
manichean.0059 = {
	type = character_event
	title = manichean.0059.t
	desc = manichean.0059.desc
	theme = faith

	right_portrait = {
		character = root
		animation = war_over_tie
	}

	option = { # Ok
		name = manichean.0059.a
	}

	after = {
		RICE_manichean_manuscript_event_chain_cleanup_effect = yes
	}

}




######################################################################################
# 
# MISC CHINESE MANICHEISM STUFF
# 
# manichean.0090-manichean.0099
# 
######################################################################################

# Chen Pingshan intro event
manichean.0090 = {
	type = character_event
	title = manichean.0090.t
	desc = manichean.0090.desc
	theme = RICE_theme_manichean_bema_festival

	left_portrait = {
		character = scope:lin_deng
		animation = personality_content
	}

	right_portrait = {
		character = root
		animation = prayer
	}

	immediate = {
		character:RICE_chinese_manichean_001 = {
			save_scope_as = lin_deng
		}
		show_as_tooltip = {
			add_trait = RICE_disciple_of_lin_deng
			add_character_modifier = {
				modifier = RICE_manichean_aspiration_continue_lin_dengs_legacy
			}
		}
	}

	option = { # Ok
		name = manichean.0090.a
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}			
			custom_description_no_bullet = {
				text = manichean.0090.info
			}
		}
	}

}




# Chen Pingshan Aspiration Fulfilled
manichean.0091 = {
	type = character_event
	title = manichean.0091.t
	desc = manichean.0091.desc
	theme = RICE_theme_manichean_bema_festival

	left_portrait = {
		character = scope:lin_deng
		animation = personality_content
	}

	right_portrait = {
		character = scope:chen_pingshan
		animation = prayer
	}

	immediate = {

		play_music_cue = "mx_cue_epic_sacral_moment"

		RICE_historical_aspiration_fulfilled_effect = yes

		character:RICE_chinese_manichean_001 = {
			save_scope_as = lin_deng
		}

		character:RICE_chinese_manichean_002 = {
			save_scope_as = chen_pingshan
		}
		
		hidden_effect = {
			if = {
				limit = {
					has_character_modifier = RICE_manichean_aspiration_continue_lin_dengs_legacy
				}
				remove_character_modifier = RICE_manichean_aspiration_continue_lin_dengs_legacy
			}
		}

		# Main Objective Reward
		dynasty ?= {
			add_dynasty_modifier = {
				modifier = RICE_manichean_lin_deng_spiritual_lineage_modifier
			}
		}
		add_learning_lifestyle_perk_points = 1
		add_piety = RICE_aspiration_large_resource_bonus

		# Bonus Objective Reward(s)
		if = {
			limit = {
				prestige_level >= 3
			}
			add_diplomacy_lifestyle_perk_points = 1
		}
		if = {
			limit = {
				has_character_flag = RICE_chen_pingshan_did_ming_cultist_decision
			}
			add_martial_lifestyle_perk_points = 1
		}


	}

	# Ok
	option = {
		name = manichean.0091.a
	}


}



# Lin Deng decision
manichean.0092 = {
	type = character_event
	title = manichean.0092.t
	desc = {
		desc = manichean.0092.desc
		triggered_desc = {
			trigger = {
				OR = {
					has_character_modifier = RICE_manichean_lin_deng_blessing_1
					has_character_modifier = RICE_manichean_lin_deng_blessing_2
					has_character_modifier = RICE_manichean_lin_deng_blessing_3
					has_character_modifier = RICE_manichean_lin_deng_blessing_4
					has_character_modifier = RICE_manichean_lin_deng_blessing_5
					has_character_modifier = RICE_manichean_lin_deng_blessing_6
					has_character_modifier = RICE_manichean_lin_deng_blessing_7
					has_character_modifier = RICE_manichean_lin_deng_blessing_8
					has_character_modifier = RICE_manichean_lin_deng_blessing_9
					has_character_modifier = RICE_manichean_lin_deng_blessing_10
					has_character_modifier = RICE_manichean_lin_deng_blessing_11
					has_character_modifier = RICE_manichean_lin_deng_blessing_12
					has_character_modifier = RICE_manichean_lin_deng_blessing_13
					has_character_modifier = RICE_manichean_lin_deng_blessing_14
					has_character_modifier = RICE_manichean_lin_deng_blessing_15
					has_character_modifier = RICE_manichean_lin_deng_blessing_16
					has_character_modifier = RICE_manichean_lin_deng_blessing_17
					has_character_modifier = RICE_manichean_lin_deng_blessing_18
					has_character_modifier = RICE_manichean_lin_deng_blessing_19
				}
			}
			desc = manichean.0092.desc.blessing
		}
	}
	theme = RICE_theme_manichean_bema_festival

	right_portrait = {
		character = root
		animation = prayer
	}

	immediate = {
		RICE_manichean_lin_deng_decision_effect = yes
		RICE_manichean_lin_deng_decision_modifier_effect = yes
	}

	option = { # Ok
		name = manichean.0092.a
	}

	after = {
		# For Chen Pingshan's aspiration
		if = {
			limit = {
				root = character:RICE_chinese_manichean_002
			}
			add_character_flag = RICE_chen_pingshan_did_lin_deng_decision
		}
	}

}





