###############################################################################
# 
# ZHANGZHUNG
# 
# zhangzhung.0000-zhangzhung.0019			Setup events, history events, miscellaneous events and decisions
# zhangzhung.0020-zhangzhung.0049			Tertons and Termas
# zhangzhung.0050-zhangzhung.0069			Misc Dharmachakra/Rajas of Asia Adapted Content
# zhangzhung.0070-zhangzhung.0089			Losar Activity (Adapted from Dharmachakra/Rajas of Asia)
# zhangzhung.0090-zhangzhung.0099			Glacier Marriage Activity
# zhangzhung.0100-zhangzhung.0119			Fulaich Flower Festival
# zhangzhung.0120-zhangzhung.0139			Historical Characters
# zhangzhung.0140-zhangzhung.0149			?????
# zhangzhung.0150-zhangzhung.0199			Generic flavor events
# 
###############################################################################

namespace = zhangzhung

######################################################################################
# 
# SETUP EVENTS, HISTORY EVENTS, MISC DECISIONS
# 
# zhangzhung.0000-zhangzhung.0019
# 
######################################################################################


# Milarepa defeats the Bon master Naro Bonchung at Mount Kailash, supposedly
# Setup event
zhangzhung.0001 = {
	hidden = yes

	immediate = {
		if = {
			limit = {
				exists = character:RICE_buddhist_008
			}	
			character:RICE_buddhist_008 = {
				save_scope_as = milarepa
			}
		}	
		else = {		
			create_character = {
				name = "Milarepa"
				location = root.capital_province
				template = RICE_random_experienced_male_monk_template
				culture = culture:bodpa
				faith = faith:lamaism
				save_scope_as = milarepa
			}	
			scope:milarepa = {				
				add_trait = devoted
			}
		}
		if = {
			limit = {
				exists = character:RICE_bon_002
			}
			character:RICE_bon_002 = {
				save_scope_as = naro_bonchung
			}	
		}
		else = {			
			create_character = {
				name = "naro_bonchung"
				location = root.capital_province
				template = RICE_random_experienced_male_monk_template
				culture = culture:bodpa
				faith = faith:bon
				save_scope_as = naro_bonchung
			}	
			scope:naro_bonchung = {				
				random = {
					chance = 75
					if = {
						limit = {
							NOT = { has_trait = devoted }
						}
						add_trait = devoted				
					}
				}
			}
		}
		set_global_variable = {
			name = RICE_milarepa_kailash_event_happened
			value = yes
		}
		religion:buddhism_religion = {
			every_faith = {
				limit = {
					has_doctrine = rice_vajrayana_canon_doctrine
				}
				change_fervor = {
					value = 5
					desc = fervor_gain_RICE_milarepa_event
				}
			}
		}
		every_ruler = {
			limit = {
				is_ai = no
				OR = {
					faith = {
						has_doctrine = rice_vajrayana_canon_doctrine
					}
					#religion = religion:buddhism_religion
					religion = religion:bon_religion
					religion = religion:west_himalayan_religion
					culture = {
						has_cultural_pillar = heritage_tibetan
					}
					AND = {
						religion = religion:buddhism_religion
						any_held_title = {
							tier = tier_county
							any_county_province = {
								OR = {
									geographical_region = world_himalaya
									geographical_region = world_steppe_tarim
									geographical_region = world_india_rajastan
									geographical_region = world_india_bengal
								}
							}
						}
					}
				}
				any_held_title = {
					tier = tier_county
					any_county_province = {
						OR = {
							geographical_region = world_middle_east_persia
							geographical_region = world_tibet
							geographical_region = world_india
							geographical_region = world_steppe_tarim
							geographical_region = world_steppe_east
						}
					}
				}
			}
			trigger_event = zhangzhung.0002
		}
	}
}

# Milarepa Mount Kailash notification event for everyone
zhangzhung.0002 = {
	type = character_event
	title = zhangzhung.0002.t
	window = big_event_window
	desc = zhangzhung.0002.desc
	theme = RICE_theme_mount_kailash

	left_portrait = {
		character = scope:naro_bonchung
		animation = personality_forgiving
	}

	right_portrait = {
		character = scope:milarepa
		animation = personality_compassionate
	}

	option = {
		name = zhangzhung.0002.a
		trigger_event = zhangzhung.0003
	}

}

# Milarepa Mount Kailash notification event for everyone
zhangzhung.0003 = {
	type = character_event
	title = zhangzhung.0003.t
	window = big_event_window
	desc = zhangzhung.0003.desc
	theme = RICE_theme_mount_kailash
	override_effect_2d = {
		reference = legend_glow
	}

	left_portrait = {
		character = scope:naro_bonchung
		animation = wedding_priest
	}

	right_portrait = {
		character = scope:milarepa
		animation = eavesdrop
	}

	immediate = {		
		play_music_cue = mx_tibet_cue_1
	}

	option = {
		name = zhangzhung.0003.a
		trigger = {
			religion = religion:buddhism_religion
			faith = { has_doctrine = rice_vajrayana_canon_doctrine }
		}
	}

	option = {
		name = zhangzhung.0003.b
		trigger = {
			religion = religion:bon_religion
		}
	}

	option = {
		name = zhangzhung.0003.c
		trigger = {
			NOR = {
				religion = religion:buddhism_religion
				religion = religion:bon_religion
			}
			title:b_teglakar = {
				is_holy_site_of = root.faith
			}
		}
	}

	option = {
		name = zhangzhung.0003.d
		trigger = {
			religion = religion:buddhism_religion
			NOT = { faith = { has_doctrine = rice_vajrayana_canon_doctrine } }
		}
	}

	option = {
		name = zhangzhung.0003.e
		trigger = {
			NOR = {
				religion = religion:buddhism_religion
				religion = religion:bon_religion
				title:b_teglakar = {
					is_holy_site_of = root.faith
				}
			}
		}
	}

	after = {
		custom_tooltip = zhangzhung.0003.tooltip
		show_as_tooltip = {
			religion:buddhism_religion = {
				every_faith = {
					custom = RICE_every_tantric_buddhist_faith
					limit = {
						has_doctrine = rice_vajrayana_canon_doctrine
					}
					change_fervor = {
						value = 5
						desc = fervor_gain_RICE_milarepa_event
					}
				}
			}
		}
	}
	
}

# Supplicating at Ancient Pillars
zhangzhung.0010 = {
	type = character_event
	title = zhangzhung.0010.t
	window = big_event_window
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					capital_county = {
						title_province = { geographical_region = RICE_upper_tibet }
					}
				}
				desc = zhangzhung.0010.desc.upper_tibet
			}
			desc = zhangzhung.0010.desc.outside_upper_tibet
		}
		desc = zhangzhung.0010.desc
	}
	theme = faith
	override_background = { reference = RICE_background_zhangzhung_ruins }

	right_portrait = {
		character = root
		animation = prayer
	}

	option = {
		name = zhangzhung.0010.a
		RICE_zhangzhung_pillars_general_effect = yes
		RICE_zhangzhung_pillars_diplomacy_effect = yes
	}

	option = {
		name = zhangzhung.0010.b
		RICE_zhangzhung_pillars_general_effect = yes
		RICE_zhangzhung_pillars_martial_effect = yes
	}

	option = {
		name = zhangzhung.0010.c
		RICE_zhangzhung_pillars_general_effect = yes
		RICE_zhangzhung_pillars_stewardship_effect = yes
	}

	option = {
		name = zhangzhung.0010.d
		RICE_zhangzhung_pillars_general_effect = yes
		RICE_zhangzhung_pillars_intrigue_effect = yes
	}

	option = {
		name = zhangzhung.0010.e
		RICE_zhangzhung_pillars_general_effect = yes
		RICE_zhangzhung_pillars_learning_effect = yes
	}
}


# Himalayan salt expedition sets out
zhangzhung.0011 = {
	type = character_event
	title = zhangzhung.0011.t
	desc = zhangzhung.0011.desc
	theme = stewardship_wealth_focus
	override_background = { reference = RICE_background_himalayan_wilderness }

	left_portrait = {
		character = root
		animation = personality_greedy
	}

	option = {
		name = zhangzhung.0011.a
		custom_tooltip = zhangzhung.0011.a.tooltip
	}

	option = {
		name = zhangzhung.0011.b
		add_piety = minor_piety_loss
		custom_tooltip = zhangzhung.0011.b.tooltip
		add_character_flag = {
			flag = RICE_himalayan_salt_expedition_small_piety_boost
			days = 120 # Failsafe in case it doesn't go away
		}
	}

	option = {
		name = zhangzhung.0011.c
		add_piety = medium_piety_loss
		custom_tooltip = zhangzhung.0011.c.tooltip
		add_character_flag = {
			flag = RICE_himalayan_salt_expedition_large_piety_boost
			days = 120 # Failsafe in case it doesn't go away
		}
	}

	after = {
		custom_tooltip = zhangzhung.0011.general.tooltip
		trigger_event = {
			id = zhangzhung.0012
			days = { 30 90 }
		}
	}

}


# Himalayan salt expedition returns
zhangzhung.0012 = {
	type = character_event
	title = zhangzhung.0012.t
	desc = {
		desc = zhangzhung.0012.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = RICE_himalayan_salt_expedition_success
				}
				desc = zhangzhung.0012.desc.success
			}
			desc = zhangzhung.0012.desc.failure
		}		
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = RICE_himalayan_salt_expedition_low
				}
				desc = zhangzhung.0012.desc.low
			}
			triggered_desc = {
				trigger = {
					has_character_flag = RICE_himalayan_salt_expedition_medium
				}
				desc = zhangzhung.0012.desc.medium
			}
			triggered_desc = {
				trigger = {
					has_character_flag = RICE_himalayan_salt_expedition_high
				}
				desc = zhangzhung.0012.desc.high
			}
		}		
	}
	theme = stewardship_wealth_focus
	override_background = { reference = RICE_background_himalayan_wilderness }

	right_portrait = {
		character = root
		triggered_animation = {
			trigger = { has_character_flag = RICE_himalayan_salt_expedition_success }
			animation = happiness
		}
		triggered_animation = {
			trigger = { NOT = { has_character_flag = RICE_himalayan_salt_expedition_success } }
			animation = sadness
		}
	}

	immediate = {
		random = {
			chance = RICE_himalayan_salt_expedition_success_chance
			add_character_flag = RICE_himalayan_salt_expedition_success
			random_list = {
				25 = {
					add_character_flag = RICE_himalayan_salt_expedition_low
				}
				20 = {
					modifier = {
						add = {
							value = stewardship
							multiply = 0.3
							max = 10
						}
					}
					modifier = {
						add = {
							value = diplomacy
							multiply = 0.2
							max = 10
						}
					}
					modifier = {
						add = {
							value = intrigue
							multiply = 0.2
							max = 10
						}
					}
					add_character_flag = RICE_himalayan_salt_expedition_medium
				}
				15 = {
					modifier = {
						add = {
							value = stewardship
							multiply = 0.15
							max = 10
						}
					}
					modifier = {
						add = {
							value = diplomacy
							multiply = 0.1
							max = 10
						}
					}
					modifier = {
						add = {
							value = intrigue
							multiply = 0.1
							max = 10
						}
					}
					add_character_flag = RICE_himalayan_salt_expedition_high
				}
			}
		}
	}

	option = {
		name = {
			trigger = { NOT = { has_character_flag = RICE_himalayan_salt_expedition_success } }
			text = zhangzhung.0012.a.failure
		}
		name = {
			trigger = { has_character_flag = RICE_himalayan_salt_expedition_low }
			text = zhangzhung.0012.a.low
		}
		name = {
			trigger = { has_character_flag = RICE_himalayan_salt_expedition_medium }
			text = zhangzhung.0012.a.medium
		}
		name = {
			trigger = { has_character_flag = RICE_himalayan_salt_expedition_high }
			text = zhangzhung.0012.a.high
		}
		if = {
			limit = {
				has_character_flag = RICE_himalayan_salt_expedition_success
			}
			add_prestige = { RICE_himalayan_salt_expedition_min_prestige_gain_value RICE_himalayan_salt_expedition_max_prestige_gain_value }
			add_gold = { RICE_himalayan_salt_expedition_min_gold_gain_value RICE_himalayan_salt_expedition_max_gold_gain_value }
		}
		if = {
			limit = {
				NOT = { has_character_flag = RICE_himalayan_salt_expedition_success }
			}
			stress_impact = {
				greedy = minor_stress_impact_gain
				ambitious = miniscule_stress_impact_gain
				wrathful = miniscule_stress_impact_gain
			}
		}
		if = {
			limit = {
				OR = {
					has_character_flag = RICE_himalayan_salt_expedition_medium
					has_character_flag = RICE_himalayan_salt_expedition_high
				}
			}
			stress_impact = {
				greedy = minor_stress_impact_loss
				ambitious = miniscule_stress_impact_loss
				diligent = miniscule_stress_impact_loss
			}
		}
	}

	after = {
		if = {
			limit = {
				has_character_flag = RICE_himalayan_salt_expedition_success
			}
			remove_character_flag = RICE_himalayan_salt_expedition_success
		}
		if = {
			limit = {
				has_character_flag = RICE_himalayan_salt_expedition_low
			}
			remove_character_flag = RICE_himalayan_salt_expedition_low
		}
		if = {
			limit = {
				has_character_flag = RICE_himalayan_salt_expedition_medium
			}
			remove_character_flag = RICE_himalayan_salt_expedition_medium
		}
		if = {
			limit = {
				has_character_flag = RICE_himalayan_salt_expedition_high
			}
			remove_character_flag = RICE_himalayan_salt_expedition_high
		}
		if = {
			limit = {
				has_character_flag = RICE_himalayan_salt_expedition_small_piety_boost
			}
			remove_character_flag = RICE_himalayan_salt_expedition_small_piety_boost
		}
		if = {
			limit = {
				has_character_flag = RICE_himalayan_salt_expedition_large_piety_boost
			}
			remove_character_flag = RICE_himalayan_salt_expedition_large_piety_boost
		}
	}

}

# Reviving/Restoring Zhangzhung
zhangzhung.0013 = {
	type = character_event
	title = zhangzhung.0013.t
	desc = {
		desc = zhangzhung.0013.desc
		first_valid = {	
			triggered_desc = {
				trigger = {
					scope:zhangzhung_reviver = {
						OR = {
							religion = religion:bon_religion
							religion = religion:west_himalayan_religion
						}
					}
				}
				desc = zhangzhung.0013.desc.bon
			}
			desc = zhangzhung.0013.desc.non_bon
		}
	}
	theme = RICE_theme_tibet_temple_exterior

	right_portrait = {
		character = root
		animation = war_over_win
	}

	lower_left_portrait = {		
		character = scope:last_zhangzhung
		trigger = {
			exists = scope:last_zhangzhung
		} 
	}

	lower_right_portrait = {		
		character = scope:songtsen_gampo
		trigger = {
			exists = scope:songtsen_gampo
		} 
	}

	immediate = {
		play_music_cue = mx_tibet_cue_1
		if = {
			limit = {
				game_start_date > 645.1.1
			}
			character:RICE_zhangzhung_king_001 = {
				save_scope_as = last_zhangzhung
			}
			character:247075 = {
				save_scope_as = songtsen_gampo
			}
		}
		culture:zhangzhung = {
			save_scope_as = zhangzhung
		}
		if = {
			limit = {
				root = scope:zhangzhung_reviver
			}
			RICE_zhangzhung_title_decision_effect = yes
		}
		else = {
			show_as_tooltip = {
				scope:zhangzhung_reviver = {
					RICE_zhangzhung_title_decision_effect = yes					
				}
			}
		}
	}

	option = { # OK
		name = zhangzhung.0013.a
	}
}

# Silver Palace
zhangzhung.0014 = {
	type = character_event
	title = zhangzhung.0014.t
	desc = zhangzhung.0014.desc
	theme = RICE_theme_tibet_temple_exterior_secular

	right_portrait = {
		character = root
		animation = war_over_tie
	}

	immediate = {
		play_music_cue = mx_tibet_cue_1
		RICE_zhangzhung_silver_palace_decision_effect = yes
	}

	option = { # OK
		name = zhangzhung.0014.a
	}
}

# Zuthulpuk Monastery event
zhangzhung.0015 = {
	type = character_event
	title = zhangzhung.0015.t
	desc = zhangzhung.0015.desc
	theme = RICE_theme_mount_kailash
	override_effect_2d = {
		reference = legend_glow
	}


	left_portrait = {
		character = root
		animation = prayer
	}

	right_portrait = {
		character = scope:milarepa
		animation = eavesdrop
	}

	immediate = {
		play_music_cue = mx_tibet_cue_1
		character:RICE_buddhist_008 = {
			save_scope_as = milarepa
		}
		RICE_zhangzhung_zuthulpuk_monastery_decision_effect = yes
	}

	option = {
		name = zhangzhung.0015.a
	}
}

# Terton mechanic is triggered c. 900s/1000s
zhangzhung.0016 = {
	type = character_event
	title = zhangzhung.0016.t
	window = fullscreen_event
	desc = zhangzhung.0016.desc
	theme = faith
	override_background = { reference = RICE_tibetan_buddhist_shrine } # RICE_fullscreen_mountains
	# override_effect_2d = {
	# 	reference = legend_glow
	# }

	immediate = {
		play_music_cue = mx_tibet_cue_1
		character:247126 = {
			save_scope_as = langdarma
		}
		character:RICE_buddhist_001 = {
			save_scope_as = padmasambhava
		}
	}

	option = {
		name = zhangzhung.0016.a
		custom_tooltip = zhangzhung.0016.tooltip.1
		custom_tooltip = zhangzhung.0016.tooltip.2
		custom_tooltip = zhangzhung.0016.tooltip.3
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = zhangzhung.0016.info
		}
	}
	
}

# Tertons become more common - triggered in the 1100s
zhangzhung.0017 = {
	type = character_event
	title = zhangzhung.0017.t
	window = fullscreen_event
	desc = zhangzhung.0017.desc
	theme = faith
	override_background = { reference = RICE_tibetan_buddhist_shrine } # RICE_fullscreen_mountains
	# override_effect_2d = {
	# 	reference = legend_glow
	# }

	immediate = {
		play_music_cue = mx_tibet_cue_1
		character:247126 = {
			save_scope_as = langdarma
		}
		character:RICE_buddhist_001 = {
			save_scope_as = padmasambhava
		}
	}

	option = {
		name = zhangzhung.0017.a
		custom_tooltip = zhangzhung.0017.tooltip.1
		custom_tooltip = zhangzhung.0017.tooltip.2
		custom_tooltip = zhangzhung.0017.tooltip.3
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = zhangzhung.0017.info
		}
	}
	
}


# Tibetan Bon conversions
zhangzhung.0018 = {
	type = character_event
	title = zhangzhung.0018.t
	desc = {
		desc = zhangzhung.0018.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					faith = faith:bon
				}
				desc = zhangzhung.0018.desc.new_bon
			}
			triggered_desc = {
				trigger = {
					faith = faith:mahayana
				}
				desc = zhangzhung.0018.desc.mahayana
			}
			triggered_desc = {
				trigger = {
					faith = faith:vajrayana
				}
				desc = zhangzhung.0018.desc.vajrayana
			}
			triggered_desc = {
				trigger = {
					faith = faith:manichean
				}
				desc = zhangzhung.0018.desc.manichean
			}
			triggered_desc = {
				trigger = {
					faith = faith:shaivism
				}
				desc = zhangzhung.0018.desc.shaivism
			}
			triggered_desc = {
				trigger = {
					faith = faith:zhengyi
				}
				desc = zhangzhung.0018.desc.zhengyi
			}
			triggered_desc = {
				trigger = {
					faith = faith:nestorian
				}
				desc = zhangzhung.0018.desc.nestorian
			}
			triggered_desc = {
				trigger = {
					faith = faith:maturidi
				}
				desc = zhangzhung.0018.desc.maturidi
			}
			triggered_desc = {
				trigger = {
					faith = faith:khurmazta
				}
				desc = zhangzhung.0018.desc.khurmazta
			}
			# Default
			desc = zhangzhung.0018.desc.lamaism
		}			
	}
	theme = RICE_theme_tibet_temple_exterior

	right_portrait = {
		character = root
		animation = prayer
	}

	immediate = {
		if = {
			limit = {
				faith = faith:lamaism
			}
			show_as_tooltip = { RICE_convert_from_bon_lamaism_effect = yes }
			show_as_tooltip = { RICE_convert_from_bon_general_effect = yes }
		}
		else_if = {
			limit = {
				faith = faith:bon
			}
			show_as_tooltip = { RICE_convert_from_bon_new_bon_effect = yes }
			show_as_tooltip = { RICE_convert_from_bon_general_effect = yes }
		}
		else_if = {
			limit = {
				faith = faith:mahayana
			}
			show_as_tooltip = { RICE_convert_from_bon_mahayana_effect = yes }
			show_as_tooltip = { RICE_convert_from_bon_general_effect = yes }
		}
		else_if = {
			limit = {
				faith = faith:vajrayana
			}
			show_as_tooltip = { RICE_convert_from_bon_vajrayana_effect = yes }
			show_as_tooltip = { RICE_convert_from_bon_general_effect = yes }
		}
		else_if = {
			limit = {
				faith = faith:manichean
			}
			show_as_tooltip = { RICE_convert_from_bon_manichean_effect = yes }
			show_as_tooltip = { RICE_convert_from_bon_general_effect = yes }
		}
		else_if = {
			limit = {
				faith = faith:shaivism
			}
			show_as_tooltip = { RICE_convert_from_bon_shaivism_effect = yes }
			show_as_tooltip = { RICE_convert_from_bon_general_effect = yes }
		}
		else_if = {
			limit = {
				faith = faith:zhengyi
			}
			show_as_tooltip = { RICE_convert_from_bon_zhengyi_effect = yes }
			show_as_tooltip = { RICE_convert_from_bon_general_effect = yes }
		}
		else_if = {
			limit = {
				faith = faith:nestorian
			}
			show_as_tooltip = { RICE_convert_from_bon_nestorian_effect = yes }
			show_as_tooltip = { RICE_convert_from_bon_general_effect = yes }
		}
		else_if = {
			limit = {
				faith = faith:maturidi
			}
			show_as_tooltip = { RICE_convert_from_bon_maturidi_effect = yes }
			show_as_tooltip = { RICE_convert_from_bon_general_effect = yes }
		}
		else_if = {
			limit = {
				faith = faith:khurmazta
			}
			show_as_tooltip = { RICE_convert_from_bon_khurmazta_effect = yes }
			show_as_tooltip = { RICE_convert_from_bon_general_effect = yes }
		}
		# If for some reason this event is triggered and you didn't convert yet, convert to Tibetan Buddhism by default
		else = {
			RICE_convert_from_bon_lamaism_effect = yes
			RICE_convert_from_bon_general_effect = yes
		}
	}

	option = {
		name = zhangzhung.0018.a
	}

}

######################################################################################
# 
# TERTONS AND TERMAS
# 
# zhangzhung.0020-zhangzhung.0049
# 
######################################################################################



# Generate random Buddhist Tertons
zhangzhung.0020 = {
	type = character_event
	hidden = yes

	immediate = {
		hidden_effect = {
			create_character = {
				location = root.capital_province
				template = terton_template
				culture = culture:bodpa
				faith = faith:lamaism
			}		
		}
	}
}


# Generate random Bon Tertons
zhangzhung.0021 = {
	type = character_event
	hidden = yes

	immediate = {
		hidden_effect = {
			create_character = {
				location = root.capital_province
				template = terton_template
				culture = culture:bodpa
				faith = faith:bon
			}			
		}
	}
}


# Person becomes a potential Terton
zhangzhung.0022 = {
	type = character_event
	title = {
		first_valid = {	
			triggered_desc = {
				trigger = {
					NOT = { religion = religion:buddhism_religion }
				}
				desc = zhangzhung.0022.t.bon
			}	
			desc = zhangzhung.0022.t
		}
	}
	
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					root = scope:nyangral
					NOT = { religion = religion:buddhism_religion }
				}
				desc = zhangzhung.0022.desc.self_bon
			}
			triggered_desc = {
				trigger = {
					root = scope:nyangral
					religion = religion:buddhism_religion
				}
				desc = zhangzhung.0022.desc.self
			}
			triggered_desc = {
				trigger = {
					NOT = { religion = religion:buddhism_religion }
				}
				desc = zhangzhung.0022.desc.bon
			}
			desc = zhangzhung.0022.desc
		}
	}
	theme = RICE_theme_tibet_inner_altar

	left_portrait = {
		character = root
		animation = personality_cynical
		trigger = { NOT = { root = scope:nyangral } } 
	}

	right_portrait = {
		character = scope:nyangral
		animation = storyteller
	}

	lower_center_portrait = {
		character = scope:padmasambhava
		trigger = { exists = scope:padmasambhava } # In case the game prunes him for some reason, which it shouldn't since he should be saved
	}

	trigger = {
		has_global_variable = RICE_terton_mechanic_triggered
		RICE_can_acess_terton_mechanics_trigger = yes
		any_courtier = {
			is_available_ai_adult = yes
			faith = root.faith
			RICE_can_acess_terton_mechanics_trigger = yes
			NOT = { has_character_flag = RICE_not_eligible_to_become_terton }
			NOT = { has_character_modifier = RICE_terton_candidate }
			NOT = { has_trait = RICE_terton }
			age >= 10
		}
	}
	weight_multiplier = {
		base = 1
		modifier = { 
			factor = 0.2
			NOT = { has_global_variable = RICE_terton_mechanic_expands }
		}
	}

	immediate = {
		if = {
			limit = {
				religion = religion:buddhism_religion
				exists = character:RICE_buddhist_001
			}
			character:RICE_buddhist_001 = {
				save_scope_as = padmasambhava
			}			
		}
		random_list = {
			95 = {
				every_courtier = {
					limit = {
						is_available_ai_adult = yes
						faith = root.faith
						RICE_can_acess_terton_mechanics_trigger = yes
						NOT = { has_character_flag = RICE_not_eligible_to_become_terton }
						NOT = { has_character_modifier = RICE_terton_candidate }
						NOT = { has_trait = RICE_terton }
						age >= 10
					}
					add_to_list = padmasambhava_dream_candidate	
				}
				random_in_list = {
					list = padmasambhava_dream_candidate
					weight = {
						base = 10
						# Try to pick someone young
						modifier = {
							age <= 40
							add = 15
						}
						# But not too young
						modifier = {
							age >= 16
							add = 15
						}
						# Try to avoid someone in your dynasty
						modifier = {
							dynasty = root.dynasty
							add = -25
						}
						# Try to pick someone smart
						modifier = {
							learning >= extremely_high_skill_rating
							add = 10
						}
						modifier = {
							learning >= high_skill_rating
							add = 10
						}
						modifier = {
							learning >= medium_skill_rating
							add = 10
						}
						modifier = {
							learning <= mediocre_skill_rating
							add = -15
						}
						modifier = {
							learning <= low_skill_rating
							add = -15
						}
						modifier = {
							has_trait = scholar
							add = 5
						}
						modifier = {
							has_trait = theologian
							add = 5
						}
						modifier = {
							has_trait = lifestyle_mystic
							add = 10
						}
						# Try to pick someone with the right traits
						modifier = {
							has_trait = zealous
							add = 5
						}
						modifier = {
							has_trait = cynical
							add = -5
						}
						modifier = {
							has_trait = compassionate
							add = 5
						}
						modifier = {
							has_trait = sadistic
							add = -5
						}
						modifier = {
							has_trait = calm
							add = 5
						}
						modifier = {
							has_trait = wrathful
							add = -5
						}
						modifier = {
							has_trait = just
							add = 5
						}
						modifier = {
							has_trait = arbitrary
							add = -5
						}
						modifier = {
							has_trait = generous
							add = 5
						}
						modifier = {
							has_trait = greedy
							add = -5
						}
						modifier = {
							has_trait = temperate
							add = 5
						}
						modifier = {
							has_trait = gluttonous
							add = -5
						}
					}
					save_scope_as = nyangral
				}
			}
			# Small chance that you become the terton candidate yourself
			5 = {
				trigger = {					
					is_available_adult = yes
					RICE_can_acess_terton_mechanics_trigger = yes
					NOT = { has_character_flag = RICE_not_eligible_to_become_terton }
					NOT = { has_character_modifier = RICE_terton_candidate }
					NOT = { has_trait = RICE_terton }
					age >= 10
				}				
				# Put here to make it much more likely player will be chosen
				modifier = {
					add = 1000
					has_character_flag = RICE_become_terton_more_likely_self_override
				}
				save_scope_as = nyangral
			}
		}
		scope:nyangral = {
			add_character_modifier = {
				modifier = RICE_terton_candidate
			}
		}
	}

	option = {
		name = zhangzhung.0022.a
		custom_tooltip = zhangzhung.0022.a.tooltip
	}

	option = {
		name = zhangzhung.0022.b
		custom_tooltip = zhangzhung.0022.a.tooltip
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = zhangzhung.0022.info
		}
	}

}

# Supporting/patronizing tertons
zhangzhung.0023 = {
	type = character_event
	title = zhangzhung.0023.t
	desc = zhangzhung.0023.desc
	theme = RICE_theme_tibetan_hall_religious

	left_portrait = {
		trigger = { exists = scope:terton }
		character = scope:terton
		animation = personality_content
	}

	right_portrait = {
		character = root
		animation = personality_zealous
	}

	lower_center_portrait = {
		character = scope:padmasambhava
		trigger = { exists = scope:padmasambhava } # In case the game prunes him for some reason, which it shouldn't since he should be saved
	}

	immediate = {
		if = {
			limit = {
				any_courtier = {
					is_available_ai_adult = yes
					RICE_is_or_can_become_terton_trigger = yes
				}
			}
			random_courtier = {
				limit = {
					is_available_ai_adult = yes
					RICE_is_or_can_become_terton_trigger = yes
				}
				save_scope_as = terton
			}
		}
		if = {
			limit = {
				religion = religion:buddhism_religion
				exists = character:RICE_buddhist_001
			}
			character:RICE_buddhist_001 = {
				save_scope_as = padmasambhava
			}			
		}
	}

	option = {
		name = zhangzhung.0023.a
		RICE_zhangzhung_patronize_tertons_effect = yes
	}

	# after = {
	# 	if = {
	# 		limit = {
	# 			has_game_rule = RICE_historical_context_on
	# 		}
	# 		custom_tooltip = zhangzhung.0023.info
	# 	}
	# }

}

# Focus on searching for termas
zhangzhung.0024 = {
	type = character_event
	title = zhangzhung.0024.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {			
					has_trait = RICE_terton
				}
				desc = zhangzhung.0024.desc.intro.terton
			}
			desc = zhangzhung.0024.desc.intro.not_terton
		}
		desc = zhangzhung.0024.desc
	}
	theme = RICE_theme_tibetan_hall_religious

	right_portrait = {
		character = root
		animation = personality_zealous
	}

	lower_center_portrait = {
		character = scope:padmasambhava
		trigger = { exists = scope:padmasambhava } # In case the game prunes him for some reason, which it shouldn't since he should be saved
	}

	immediate = {
		if = {
			limit = {
				religion = religion:buddhism_religion
				exists = character:RICE_buddhist_001
			}
			character:RICE_buddhist_001 = {
				save_scope_as = padmasambhava
			}			
		}
	}

	option = {
		name = zhangzhung.0024.a
		RICE_zhangzhung_search_for_termas_effect = yes
	}

	# after = {
	# 	if = {
	# 		limit = {
	# 			has_game_rule = RICE_historical_context_on
	# 		}
	# 		custom_tooltip = zhangzhung.0024.info
	# 	}
	# }

}


# Minor terma discovered (as a non-Terton)
zhangzhung.0025 = {
	type = character_event
	hidden = yes

	immediate = {
		if = {
			limit = {
				any_courtier = {
					is_available_ai_adult = yes
					RICE_can_acess_terton_mechanics_trigger = yes
					has_trait = RICE_terton
				}
			}		
			random_courtier = {
				limit = {
					is_available_ai_adult = yes
					RICE_can_acess_terton_mechanics_trigger = yes
					has_trait = RICE_terton
				}
				save_scope_as = terton
			}
			send_interface_message = {
				type = event_religious_good
				title = zhangzhung.minor_terma.message.specific_terton
				left_icon = scope:terton
				add_piety = { RICE_yearly_minor_terma_min_piety RICE_yearly_minor_terma_max_piety }
				add_prestige = { RICE_yearly_minor_terma_min_prestige RICE_yearly_minor_terma_max_prestige }
				scope:terton = {
					RICE_terton_experience_gain_tiny = yes
				}
			}
		}
		else = {
			send_interface_message = {
				type = event_religious_good
				title = zhangzhung.minor_terma.message.generic
				add_piety = { RICE_yearly_minor_terma_min_piety RICE_yearly_minor_terma_max_piety }
				add_prestige = { RICE_yearly_minor_terma_min_prestige RICE_yearly_minor_terma_max_prestige }
			}			
		}
	}
}

# Minor terma discovered (as a Terton yourself)
zhangzhung.0026 = {
	type = character_event
	hidden = yes

	immediate = {
		send_interface_message = {
			type = event_religious_good
			title = zhangzhung.minor_terma.message.self
			left_icon = root
			add_piety = { RICE_yearly_minor_terma_min_piety RICE_yearly_minor_terma_max_piety }
			add_prestige = { RICE_yearly_minor_terma_min_prestige RICE_yearly_minor_terma_max_prestige }
			RICE_terton_experience_gain_tiny = yes
		}
	}
}


# Terton event chain start - Ping event for liege
zhangzhung.0030 = {
	type = character_event
	hidden = yes

	immediate = {
		save_scope_as = terton
		if = {
			limit = {
				religion = religion:buddhism_religion
				exists = character:RICE_buddhist_001
			}
			character:RICE_buddhist_001 = {
				save_scope_as = padmasambhava
			}
		}
		if = {
			limit = {
				exists = liege
			}
			# If in Tibet and nearby regions, there is a chance of choosing a random province in Tibet OR a random province in your duchy
			# if = {
			# 	limit = {
			# 		liege.capital_province = {
			# 			geographical_region = RICE_basic_terton_region
			# 		}
			# 	}
			# 	random_list = {
			# 		50 = {
			# 			random_county_in_region = {
			# 				region = RICE_basic_terton_region
			# 				add_to_list = candidate_counties
			# 			}
			# 		}
			# 		50 = {
			# 			liege.capital_county.duchy = {
			# 				random_in_de_jure_hierarchy = {
			# 					limit = {
			# 						tier = tier_county
			# 					}
			# 					add_to_list = candidate_counties
			# 				}
			# 			}
			# 		}
			# 	}
			# 	random_in_list = {
			# 		list = candidate_counties
			# 		weight = {
			# 			base = 10					
			# 			modifier = {
			# 				add = 30
			# 				faith = scope:terton.faith
			# 			}
			# 			modifier = {
			# 				add = 20
			# 				religion = scope:terton.faith.religion
			# 			}
			# 		}
			# 		save_scope_as = target_county
			# 	}
			# 	scope:target_county = {
			# 		random_county_province = {
			# 			save_scope_as = target_province
			# 		}
			# 	}
			# }
			## Otherwise, choose a random province in your duchy
			#else = {
				liege.capital_county.duchy = {
					random_in_de_jure_hierarchy = {
						limit = {
							tier = tier_county
						}
						add_to_list = candidate_counties
					}
				}
				random_in_list = {
					list = candidate_counties
					weight = {
						base = 10					
						modifier = {
							add = 30
							faith = scope:terton.faith
						}
						modifier = {
							add = 20
							religion = scope:terton.faith.religion
						}
					}
					save_scope_as = target_county
				}
				scope:target_county = {
					random_county_province = {
						limit = {
							NOT = { this = liege.capital_province }
						}
						save_scope_as = target_province
					}
				}
			#}
			liege = {
				trigger_event = zhangzhung.0031
			}
		}
		# If they don't have an liege for whatever reason by the time the event triggers
		#else = {			
		#}
	}
}

# Terton receives signs/visions/dreams about the location of the terma
zhangzhung.0031 = {
	type = character_event
	title = zhangzhung.0031.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {			
					scope:terton = {				
						has_trait_xp = {
							trait = RICE_terton
							value >= 75
						}
					}
				}
				desc = zhangzhung.0031.desc.intro.great_terton
			}
			triggered_desc = {
				trigger = {			
					scope:terton = {				
						has_trait = RICE_terton
					}
				}
				desc = zhangzhung.0031.desc.intro.terton
			}
			desc = zhangzhung.0031.desc.intro.not_terton
		}
		desc = zhangzhung.0031.desc.middle
		first_valid = {
			triggered_desc = {
				trigger = {			
					religion = religion:buddhism_religion
				}
				desc = zhangzhung.0031.desc.buddhism
			}
			desc = zhangzhung.0031.desc.not_buddhism
		}
		desc = zhangzhung.0031.desc
	}
	theme = faith
	override_background = { reference = RICE_background_himalayan_wilderness }

	# left_portrait = {
	# 	character = root
	# 	animation = admiration
	# }

	right_portrait = {
		character = scope:terton
		animation = storyteller
	}

	lower_center_portrait = {
		character = scope:padmasambhava
		trigger = { exists = scope:padmasambhava } # In case the game prunes him for some reason, which it shouldn't since he should be saved
	}

	#immediate = {
	#}


	option = {
		name = zhangzhung.0031.a
		custom_tooltip = zhangzhung.0031.a.tooltip
		scope:terton = {
			# Terton flag
			add_character_modifier = {
				modifier = RICE_zhangzhung_discovering_termas
				years = 1
			}
			# add_character_flag = {
			# 	flag = RICE_terton_journey_flag
			# 	years = 5
			# }
			# To prevent them from somehow leaving your court while they're on the trip
			add_character_flag = {
				flag = blocked_from_leaving
				years = 1
			}
			start_travel_plan = { 
				destination = scope:target_province
				return_trip = yes
				on_arrival_event = zhangzhung.0032
				#on_travel_planner_cancel_event = zhangzhung.0034
			}
		}
	}

	option = {
		name = zhangzhung.0031.b
		if = {
			limit = {
				has_trait = zealous
			}
			stress_impact = {
				zealous = minor_stress_impact_gain
				humble = miniscule_stress_impact_gain
			}
		}
		else = {
			stress_impact = {
				paranoid = miniscule_stress_impact_loss
				cynical = minor_stress_impact_loss
				callous = miniscule_stress_impact_loss
			}
		}		
		scope:terton = {
			add_opinion = {
				target = root
				modifier = frustrated_opinion
				opinion = -15
			}
		}
	}

}


# Terton arrives at the destination where the terma is - Ping event for liege
# For AI, this is not at the travel destination but at the liege's court
zhangzhung.0032 = {
	type = character_event
	hidden = yes

	immediate = {
		save_scope_as = terton
		location.county = {
			save_scope_as = terma_county
		}		
		if = {
			limit = {
				exists = liege
			}
			# Determine whether there is a success or failure to begin with
			random_list = {
				# Failure
				30 = {
					modifier = {
						add = -10
						has_trait = RICE_terton								
						has_trait_xp = {
							trait = lifestyle_reveler
							value >= 50
						}
					}
					modifier = {
						add = -10
						has_trait = RICE_terton								
						has_trait_xp = {
							trait = lifestyle_reveler
							value >= 100
						}
					}
					set_variable = {
						name = RICE_terma_type
						value = flag:failure
						days = 1
					}
				}
				# Success
				70 = {
					modifier = {
						add = 20
						has_trait = RICE_terton
					}
					# Level of success
					random_list = {
						40 = {
							modifier = {
								add = -10
								has_trait = RICE_terton								
								has_trait_xp = {
									trait = RICE_terton
									value >= 50
								}
							}
							modifier = {
								add = -10
								has_trait = RICE_terton								
								has_trait_xp = {
									trait = RICE_terton
									value >= 50
								}
							}
							modifier = {
								add = -10
								has_trait = RICE_terton								
								has_trait_xp = {
									trait = RICE_terton
									value >= 100
								}
							}
							set_variable = {
								name = RICE_terma_recognition
								value = flag:questioned
								days = 1
							}
						}
						40 = {
							modifier = {
								add = 20
								has_trait = RICE_terton
							}
							modifier = {
								add = 20
								has_trait = RICE_terton								
								has_trait_xp = {
									trait = RICE_terton
									value >= 50
								}
							}
							modifier = {
								add = 20
								has_trait = RICE_terton								
								has_trait_xp = {
									trait = RICE_terton
									value >= 100
								}
							}
							set_variable = {
								name = RICE_terma_recognition
								value = flag:accepted
								days = 1
							}
						}
						20 = {
							modifier = {
								add = 10
								has_trait = RICE_terton
							}
							modifier = {
								add = 10
								has_trait = RICE_terton								
								has_trait_xp = {
									trait = RICE_terton
									value >= 50
								}
							}
							modifier = {
								add = 10
								has_trait = RICE_terton								
								has_trait_xp = {
									trait = RICE_terton
									value >= 100
								}
							}
							set_variable = {
								name = RICE_terma_recognition
								value = flag:venerated
								days = 1
							}
						}
					}
					# Type of Terma
					random_list = {
						40 = {
							modifier = {
								add = 1000
								liege = { has_character_flag = RICE_terma_teachings_physical_auto }
							}
							set_variable = {
								name = RICE_terma_type
								value = flag:teachings_physical
								days = 1
							}
						}
						40 = {
							modifier = {
								add = 1000
								liege = { has_character_flag = RICE_terma_teachings_internal_auto }
							}
							set_variable = {
								name = RICE_terma_type
								value = flag:teachings_internal
								days = 1
							}
						}
						# 10 = {
						# 	set_variable = {
						# 		name = RICE_terma_type
						# 		value = flag:teachings_great
						# 		days = 1
						# 	}
						# 	# Great teachings are always venerated level
						# 	set_variable = {
						# 		name = RICE_terma_quality
						# 		value = flag:teachings_venerated
						# 		days = 1
						# 	}
						# }
						10 = {
							modifier = {
								add = 1000
								liege = { has_character_flag = RICE_terma_statue_auto }
							}
							set_variable = {
								name = RICE_terma_type
								value = flag:artifact_statue
								days = 1
							}
						}
						10 = {
							modifier = {
								add = 1000
								liege = { has_character_flag = RICE_terma_sacred_image_auto }
							}
							set_variable = {
								name = RICE_terma_type
								value = flag:artifact_sacred_image
								days = 1
							}
						}
						10 = {
							modifier = {
								add = 1000
								liege = { has_character_flag = RICE_terma_ritual_instrument_auto }
							}
							set_variable = {
								name = RICE_terma_type
								value = flag:artifact_ritual_instrument
								days = 1
							}
						}
						10 = {
							# Only available if you own land in the location
							trigger = {
								liege = {	
									is_landed = yes
								}
								liege = scope:terma_county.holder
							}	
							modifier = {
								add = 1000
								liege = { has_character_flag = RICE_terma_buildings_auto }
							}
							set_variable = {
								name = RICE_terma_type
								value = flag:religious_building
								days = 1
							}
						}
						10 = {
							modifier = {
								add = 1000
								liege = { has_character_flag = RICE_terma_riches_auto }
							}
							set_variable = {
								name = RICE_terma_type
								value = flag:riches
								days = 1
							}
							liege = {
								# Set the gold amount that's gained
								set_variable = {
									name = RICE_terton_riches_gained
									value = {
										integer_range = {
											min = tiny_gold_value
											max = medium_gold_value
										}
									}
									days = 1
								}
							}
						}
						10 = {
							modifier = {
								add = 1000
								liege = { has_character_flag = RICE_terma_scholarly_texts_auto }
							}
							set_variable = {
								name = RICE_terma_type
								value = flag:artifact_scholarly_texts
								days = 1
							}
						}
						10 = {
							modifier = {
								add = 1000
								liege = { has_character_flag = RICE_terma_medicine_auto }
							}
							set_variable = {
								name = RICE_terma_type
								value = flag:medicine
								days = 1
							}
						}
					}					
				}
			}
			liege = {
				#save_scope_as = terton_result_recipient
				trigger_event = zhangzhung.0033
			}
		}
		# Don't remove it in case it was added by other means
		# if = {
		# 	limit = {
		# 		has_character_flag = blocked_from_leaving
		# 	}
		# 	remove_character_flag = blocked_from_leaving
		# }
	}
}

# Terton arrives at the destination where the terma is - liege event
zhangzhung.0033 = {
	type = character_event
	title = zhangzhung.0033.t
	window = big_event_window
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:failure
					}
				}
				desc = zhangzhung.0033.desc.intro.failure
			}
			desc = zhangzhung.0033.desc.intro
		}
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:terton = {
						religion = religion:bon_religion
					}
					NOT = {
						scope:terton = {
							var:RICE_terma_type ?= flag:failure
						}
					}
				}
				desc = zhangzhung.0033.desc.intro.bon
			}			
			triggered_desc = {
				trigger = {
					scope:terton = {
						religion = religion:buddhism_religion
					}
					NOT = {
						scope:terton = {
							var:RICE_terma_type ?= flag:failure
						}
					}
				}
				desc = zhangzhung.0033.desc.intro.buddhist
			}
		}
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:teachings_physical
					}
				}
				desc = zhangzhung.0033.desc.teachings_physical
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:teachings_internal
					}
				}
				desc = zhangzhung.0033.desc.teachings_internal
			}
			# triggered_desc = {
			# 	trigger = {
			# 		scope:terton = {
			# 			var:RICE_terma_type ?= flag:teachings_great
			# 		}
			# 	}
			# 	desc = zhangzhung.0033.desc.teachings_great
			# }
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:artifact_statue
					}
				}
				desc = zhangzhung.0033.desc.artifact_statue
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:artifact_sacred_image
					}
				}
				desc = zhangzhung.0033.desc.artifact_sacred_image
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:artifact_ritual_instrument
					}
				}
				desc = zhangzhung.0033.desc.artifact_ritual_instrument
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:religious_building
					}
				}
				desc = zhangzhung.0033.desc.religious_building
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:riches
					}
				}
				desc = zhangzhung.0033.desc.riches
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:artifact_scholarly_texts
					}
				}
				desc = zhangzhung.0033.desc.artifact_scholarly_texts
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:medicine
					}
				}
				desc = zhangzhung.0033.desc.medicine
			}
			# triggered_desc = {
			# 	trigger = {
			# 		scope:terton = {
			# 			var:RICE_terma_type ?= flag:failure
			# 		}
			# 	}
			# 	desc = zhangzhung.0033.desc.failure
			# }
		}
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:failure
					}
				}
				desc = zhangzhung.0033.desc.middle.failure
			}
			desc = zhangzhung.0033.desc.middle
		}
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_recognition ?= flag:questioned
					}
				}
				desc = zhangzhung.0033.desc.questioned
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_recognition ?= flag:accepted
					}
				}
				desc = zhangzhung.0033.desc.accepted
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_recognition ?= flag:venerated
					}
				}
				desc = zhangzhung.0033.desc.venerated
			}
		}
	}
	theme = faith
	override_background = { reference = RICE_background_himalayan_wilderness }

	left_portrait = {
		character = root
		triggered_animation = {
			trigger = {				
				scope:terton = {
					var:RICE_terma_type ?= flag:failure
				}
			}
			animation = disappointed
		}
		triggered_animation = {
			trigger = { RICE_can_acess_terton_mechanics_trigger = no }
			animation = personality_cynical
		}
		# If they are a great terton, they don't bow to you
		triggered_animation = {
			trigger = {
				RICE_can_acess_terton_mechanics_trigger = yes
				scope:terton = {				
					has_trait_xp = {
						trait = RICE_terton
						value >= 75
					}
				}
				NOT = {
					has_trait = arrogant
				}
				NOT = {
					has_trait = cynical
				}
			}
			animation = throne_room_bow_3
		}
		animation = admiration
	}

	right_portrait = {
		character = scope:terton
		triggered_animation = {
			trigger = {				
				scope:terton = {
					var:RICE_terma_type ?= flag:failure
				}
			}
			animation = sadness
		}
		# If they are a terton of some renown, they don't bow to you
		triggered_animation = {
			trigger = {				
				scope:terton = {				
					has_trait_xp = {
						trait = RICE_terton
						value >= 50
					}
				}
			}
			animation = personality_compassionate
		}
		animation = obsequious_bow
	}
	
	lower_right_portrait = {		
		character = scope:padmasambhava
		trigger = {
			exists = scope:padmasambhava # In case the game prunes him for some reason, which it shouldn't since he should be saved		
			scope:terton = {
				religion = religion:buddhism_religion
			}
		} 
	}
	artifact = { # To display the artifact in the event-window
		target = scope:terma_artifact
		position = lower_center_portrait
		trigger = { exists = scope:terma_artifact }
	}

	override_effect_2d = {
		trigger = {
			NOT = {			
				scope:terton = {
					var:RICE_terma_type ?= flag:failure
				}
			}
		}
		reference = legend_glow
	}

	immediate = {
		save_scope_as = terton_result_recipient
		if = {
			limit = {
				scope:terton = {
					religion = religion:buddhism_religion
				}
			}
			character:RICE_buddhist_001 = {
				save_scope_as = padmasambhava
			}
		}
		scope:terton = {
			location = {
				save_scope_as = location
			}
			RICE_terton_conclusion_general_effects = yes
		}
		if = {
			limit = {
				scope:terton = {
					var:RICE_terma_type ?= flag:teachings_physical
				}
			}
			RICE_create_terma_artifact_teachings_physical_effect = yes
		}
		else_if = {
			limit = {
				scope:terton = {
					var:RICE_terma_type ?= flag:teachings_internal
				}
			}
			RICE_create_terma_artifact_teachings_internal_effect = yes
		}
		# else_if = {
		# 	limit = {
		# 		scope:terton = {
		# 			var:RICE_terma_type ?= flag:teachings_great
		# 		}
		# 	}
		# }
		else_if = {
			limit = {
				scope:terton = {
					var:RICE_terma_type ?= flag:artifact_statue
				}
			}
			RICE_create_terma_artifact_statue_effect = yes
		}
		else_if = {
			limit = {
				scope:terton = {
					var:RICE_terma_type ?= flag:artifact_sacred_image
				}
			}
			RICE_create_terma_artifact_sacred_image_effect = yes
		}
		else_if = {
			limit = {
				scope:terton = {
					var:RICE_terma_type ?= flag:artifact_ritual_instrument
				}
			}
			RICE_create_terma_artifact_ritual_instrument_effect = yes
		}
		else_if = {
			limit = {
				scope:terton = {
					var:RICE_terma_type ?= flag:artifact_scholarly_texts
				}
			}
			RICE_create_terma_artifact_scholarly_texts_effect = yes
		}
	}

	# Accept it
	option = {
		name = zhangzhung.0033.a
		trigger = {			
			NOT = {
				scope:terton = {
					var:RICE_terma_type ?= flag:failure
				}
			}
		}
		RICE_terton_conclusion_accept_effects = yes
	}

	# Let them keep it
	option = {
		name = zhangzhung.0033.b
		trigger = {
			# Doesn't make sense if it's a religious building
			NOT = {				
				scope:terton = {
					var:RICE_terma_type ?= flag:religious_building
				}
			}		
			NOT = {
				scope:terton = {
					var:RICE_terma_type ?= flag:failure
				}
			}
		}
		RICE_terton_conclusion_let_keep_effects = yes
	}

	# Donate it
	option = {
		name = zhangzhung.0033.c
		trigger = {
			# Doesn't make sense if it's a religious building
			NOT = {				
				scope:terton = {
					var:RICE_terma_type ?= flag:religious_building
				}
			}		
			NOT = {
				scope:terton = {
					var:RICE_terma_type ?= flag:failure
				}
			}
		}
		RICE_terton_conclusion_donate_effects = yes
	}

	# Failure
	option = {
		name = zhangzhung.0033.d
		trigger = {	
			scope:terton = {
				var:RICE_terma_type ?= flag:failure
			}
		}
	}

	after = {
		scope:terton = {					
			if = {
				limit = { has_variable = RICE_terma_type }
				remove_variable = RICE_terma_type
			}					
			if = {
				limit = { has_variable = RICE_terma_recognition }
				remove_variable = RICE_terma_recognition
			}			
			if = {
				limit = {
					has_character_modifier = RICE_zhangzhung_discovering_termas
				}
				remove_character_modifier = RICE_zhangzhung_discovering_termas
			}
		}
		if = {
			limit = {
				has_variable = RICE_terton_riches_gained
			}
			remove_variable = RICE_terton_riches_gained
		}
	}

}

# You receive signs/visions/dreams about the location of the terma
zhangzhung.0040 = {
	type = character_event
	title = zhangzhung.0040.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {			
					has_trait_xp = {
						trait = RICE_terton
						value >= 75
					}
				}
				desc = zhangzhung.0040.desc.intro.great_terton
			}
			triggered_desc = {
				trigger = {			
					has_trait = RICE_terton
				}
				desc = zhangzhung.0040.desc.intro.terton
			}
			desc = zhangzhung.0040.desc.intro.not_terton
		}
		desc = zhangzhung.0040.desc.middle
		first_valid = {
			triggered_desc = {
				trigger = {			
					religion = religion:buddhism_religion
				}
				desc = zhangzhung.0040.desc.buddhism
			}
			desc = zhangzhung.0040.desc.not_buddhism
		}
		desc = zhangzhung.0040.desc
	}
	theme = faith
	override_background = { reference = RICE_background_himalayan_wilderness }

	# left_portrait = {
	# 	character = root
	# 	animation = admiration
	# }

	right_portrait = {
		character = root
		animation = thinking
	}

	lower_center_portrait = {
		character = scope:padmasambhava
		trigger = { exists = scope:padmasambhava } # In case the game prunes him for some reason, which it shouldn't since he should be saved
	}

	immediate = {
		save_scope_as = terton
		if = {
			limit = {
				religion = religion:buddhism_religion
				exists = character:RICE_buddhist_001
			}
			character:RICE_buddhist_001 = {
				save_scope_as = padmasambhava
			}
		}
		capital_county.duchy = {
			random_in_de_jure_hierarchy = {
				limit = {
					tier = tier_county
				}
				add_to_list = candidate_counties
			}
		}
		random_in_list = {
			list = candidate_counties
			weight = {
				base = 10					
				modifier = {
					add = 30
					faith = scope:terton.faith
				}
				modifier = {
					add = 20
					religion = scope:terton.faith.religion
				}
			}
			save_scope_as = target_county
		}
		scope:target_county = {
			random_county_province = {
				limit = {
					NOT = { this = root.capital_province }
				}
				save_scope_as = target_province
			}
		}
	}

	# Time to search for it!
	option = {
		name = zhangzhung.0040.a
		custom_tooltip = zhangzhung.0040.a.tooltip
		# Terton flag
		add_character_modifier = {
			modifier = RICE_zhangzhung_discovering_termas
			years = 1
		}
		start_travel_plan = { 
			destination = scope:target_province
			return_trip = yes
			on_arrival_event = zhangzhung.0041
			#on_travel_planner_cancel_event = zhangzhung.0042
		}
	}

	# Nah, I'm busy
	option = {
		name = zhangzhung.0040.b
		#custom_tooltip = zhangzhung.0040.b.tooltip
		if = {
			limit = {
				has_trait = zealous
			}
			stress_impact = {
				zealous = minor_stress_impact_gain
				ambitious = miniscule_stress_impact_gain
			}
		}
		else = {
			stress_impact = {
				lazy = minor_stress_impact_loss
				cynical = minor_stress_impact_loss
				craven = miniscule_stress_impact_loss
			}
		}
	}

}


# You, the terton, arrive at the destination where the terma is
zhangzhung.0041 = {
	type = character_event
	title = zhangzhung.0041.t
	window = big_event_window
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:failure
					}
				}
				desc = zhangzhung.0041.desc.intro.failure
			}
			desc = zhangzhung.0041.desc.intro
		}
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:terton = {
						religion = religion:bon_religion
					}
					NOT = {
						scope:terton = {
							var:RICE_terma_type ?= flag:failure
						}
					}
				}
				desc = zhangzhung.0033.desc.intro.bon
			}			
			triggered_desc = {
				trigger = {
					scope:terton = {
						religion = religion:buddhism_religion
					}
					NOT = {
						scope:terton = {
							var:RICE_terma_type ?= flag:failure
						}
					}
				}
				desc = zhangzhung.0033.desc.intro.buddhist
			}
		}
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:teachings_physical
					}
				}
				desc = zhangzhung.0033.desc.teachings_physical
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:teachings_internal
					}
				}
				desc = zhangzhung.0033.desc.teachings_internal
			}
			# triggered_desc = {
			# 	trigger = {
			# 		scope:terton = {
			# 			var:RICE_terma_type ?= flag:teachings_great
			# 		}
			# 	}
			# 	desc = zhangzhung.0041.desc.teachings_great
			# }
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:artifact_statue
					}
				}
				desc = zhangzhung.0033.desc.artifact_statue
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:artifact_sacred_image
					}
				}
				desc = zhangzhung.0033.desc.artifact_sacred_image
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:artifact_ritual_instrument
					}
				}
				desc = zhangzhung.0033.desc.artifact_ritual_instrument
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:religious_building
					}
				}
				desc = zhangzhung.0033.desc.religious_building
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:riches
					}
				}
				desc = zhangzhung.0033.desc.riches
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:artifact_scholarly_texts
					}
				}
				desc = zhangzhung.0033.desc.artifact_scholarly_texts
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:medicine
					}
				}
				desc = zhangzhung.0033.desc.medicine
			}
			# triggered_desc = {
			# 	trigger = {
			# 		scope:terton = {
			# 			var:RICE_terma_type ?= flag:failure
			# 		}
			# 	}
			# 	desc = zhangzhung.0041.desc.failure
			# }
		}
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_type ?= flag:failure
					}
				}
				desc = zhangzhung.0041.desc.middle.failure
			}
			desc = zhangzhung.0041.desc.middle
		}
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_recognition ?= flag:questioned
					}
				}
				desc = zhangzhung.0033.desc.questioned
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_recognition ?= flag:accepted
					}
				}
				desc = zhangzhung.0033.desc.accepted
			}
			triggered_desc = {
				trigger = {
					scope:terton = {
						var:RICE_terma_recognition ?= flag:venerated
					}
				}
				desc = zhangzhung.0033.desc.venerated
			}
		}
	}
	theme = faith
	override_background = { reference = RICE_background_himalayan_wilderness }

	right_portrait = {
		character = root
		triggered_animation = {
			trigger = {				
				scope:terton = {
					var:RICE_terma_type ?= flag:failure
				}
			}
			animation = sadness
		}
		animation = prayer
	}

	
	lower_right_portrait = {		
		character = scope:padmasambhava
		trigger = {
			exists = scope:padmasambhava # In case the game prunes him for some reason, which it shouldn't since he should be saved		
			scope:terton = {
				religion = religion:buddhism_religion
			}
		} 
	}
	artifact = { # To display the artifact in the event-window
		target = scope:terma_artifact
		position = lower_center_portrait
		trigger = { exists = scope:terma_artifact }
	}

	override_effect_2d = {
		trigger = {
			NOT = {			
				scope:terton = {
					var:RICE_terma_type ?= flag:failure
				}
			}
		}
		reference = legend_glow
	}

	immediate = {
		save_scope_as = terton_result_recipient
		location.county = {
			save_scope_as = terma_county
		}	
		# Determine whether there is a success or failure to begin with
		random_list = {
			# Failure
			30 = {
				modifier = {
					add = -10
					has_trait = RICE_terton								
					has_trait_xp = {
						trait = lifestyle_reveler
						value >= 50
					}
				}
				modifier = {
					add = -10
					has_trait = RICE_terton								
					has_trait_xp = {
						trait = lifestyle_reveler
						value >= 100
					}
				}
				set_variable = {
					name = RICE_terma_type
					value = flag:failure
					days = 1
				}
			}
			# Success
			70 = {
				modifier = {
					add = 20
					has_trait = RICE_terton
				}
				# Level of success
				random_list = {
					40 = {
						modifier = {
							add = -10
							has_trait = RICE_terton								
							has_trait_xp = {
								trait = RICE_terton
								value >= 25
							}
						}
						modifier = {
							add = -10
							has_trait = RICE_terton								
							has_trait_xp = {
								trait = RICE_terton
								value >= 50
							}
						}
						modifier = {
							add = -10
							has_trait = RICE_terton								
							has_trait_xp = {
								trait = RICE_terton
								value >= 100
							}
						}
						set_variable = {
							name = RICE_terma_recognition
							value = flag:questioned
							days = 1
						}
					}
					40 = {
						modifier = {
							add = 20
							has_trait = RICE_terton
						}
						modifier = {
							add = 10
							has_trait = RICE_terton								
							has_trait_xp = {
								trait = RICE_terton
								value >= 50
							}
						}
						modifier = {
							add = 10
							has_trait = RICE_terton								
							has_trait_xp = {
								trait = RICE_terton
								value >= 100
							}
						}
						set_variable = {
							name = RICE_terma_recognition
							value = flag:accepted
							days = 1
						}
					}
					20 = {
						modifier = {
							add = 10
							has_trait = RICE_terton
						}
						modifier = {
							add = 10
							has_trait = RICE_terton								
							has_trait_xp = {
								trait = RICE_terton
								value >= 50
							}
						}
						modifier = {
							add = 10
							has_trait = RICE_terton								
							has_trait_xp = {
								trait = RICE_terton
								value >= 100
							}
						}
						set_variable = {
							name = RICE_terma_recognition
							value = flag:venerated
							days = 1
						}
					}
				}
				# Type of Terma
				random_list = {
					40 = {
						modifier = {
							add = 1000
							has_character_flag = RICE_terma_teachings_physical_auto
						}
						set_variable = {
							name = RICE_terma_type
							value = flag:teachings_physical
							days = 1
						}
					}
					40 = {
						modifier = {
							add = 1000
							has_character_flag = RICE_terma_teachings_internal_auto
						}
						set_variable = {
							name = RICE_terma_type
							value = flag:teachings_internal
							days = 1
						}
					}
					# 10 = {
					# 	set_variable = {
					# 		name = RICE_terma_type
					# 		value = flag:teachings_great
					# 		days = 1
					# 	}
					# 	# Great teachings are always venerated level
					# 	set_variable = {
					# 		name = RICE_terma_quality
					# 		value = flag:teachings_venerated
					# 		days = 1
					# 	}
					# }
					10 = {
						modifier = {
							add = 1000
							has_character_flag = RICE_terma_statue_auto
						}
						set_variable = {
							name = RICE_terma_type
							value = flag:artifact_statue
							days = 1
						}
					}
					10 = {
						modifier = {
							add = 1000
							has_character_flag = RICE_terma_sacred_image_auto
						}
						set_variable = {
							name = RICE_terma_type
							value = flag:artifact_sacred_image
							days = 1
						}
					}
					10 = {
						modifier = {
							add = 1000
							has_character_flag = RICE_terma_ritual_instrument_auto
						}
						set_variable = {
							name = RICE_terma_type
							value = flag:artifact_ritual_instrument
							days = 1
						}
					}
					10 = {
						# Only available if you own land in the location
						trigger = {
							is_landed = yes
							scope:terma_county.holder = root
						}	
						modifier = {
							add = 1000
							has_character_flag = RICE_terma_religious_building_auto
						}
						set_variable = {
							name = RICE_terma_type
							value = flag:religious_building
							days = 1
						}
					}
					10 = {
						modifier = {
							add = 1000
							has_character_flag = RICE_terma_riches_auto
						}
						set_variable = {
							name = RICE_terma_type
							value = flag:riches
							days = 1
						}
						# Set the gold amount that's gained
						set_variable = {
							name = RICE_terton_riches_gained
							value = {
								integer_range = {
									min = tiny_gold_value
									max = medium_gold_value
								}
							}
							days = 1
						}
					}
					10 = {
						modifier = {
							add = 1000
							has_character_flag = RICE_terma_scholarly_texts_auto
						}
						set_variable = {
							name = RICE_terma_type
							value = flag:artifact_scholarly_texts
							days = 1
						}
					}
					10 = {
						modifier = {
							add = 1000
							has_character_flag = RICE_terma_medicine_auto
						}
						set_variable = {
							name = RICE_terma_type
							value = flag:medicine
							days = 1
						}
					}
				}					
			}
		}
		if = {
			limit = {
				scope:terton = {
					religion = religion:buddhism_religion
				}
			}
			character:RICE_buddhist_001 = {
				save_scope_as = padmasambhava
			}
		}
		scope:terton = {
			location = {
				save_scope_as = location
			}
			RICE_terton_conclusion_general_effects = yes
		}
		if = {
			limit = {
				scope:terton = {
					var:RICE_terma_type ?= flag:teachings_physical
				}
			}
			RICE_create_terma_artifact_teachings_physical_effect = yes
		}
		else_if = {
			limit = {
				scope:terton = {
					var:RICE_terma_type ?= flag:teachings_internal
				}
			}
			RICE_create_terma_artifact_teachings_internal_effect = yes
		}
		# else_if = {
		# 	limit = {
		# 		scope:terton = {
		# 			var:RICE_terma_type ?= flag:teachings_great
		# 		}
		# 	}
		# }
		else_if = {
			limit = {
				scope:terton = {
					var:RICE_terma_type ?= flag:artifact_statue
				}
			}
			RICE_create_terma_artifact_statue_effect = yes
		}
		else_if = {
			limit = {
				scope:terton = {
					var:RICE_terma_type ?= flag:artifact_sacred_image
				}
			}
			RICE_create_terma_artifact_sacred_image_effect = yes
		}
		else_if = {
			limit = {
				scope:terton = {
					var:RICE_terma_type ?= flag:artifact_ritual_instrument
				}
			}
			RICE_create_terma_artifact_ritual_instrument_effect = yes
		}
		else_if = {
			limit = {
				scope:terton = {
					var:RICE_terma_type ?= flag:religious_building
				}
			}
			hidden_effect = {
				RICE_terma_building_preset_effect = yes
			}
		}
		else_if = {
			limit = {
				scope:terton = {
					var:RICE_terma_type ?= flag:artifact_scholarly_texts
				}
			}
			RICE_create_terma_artifact_scholarly_texts_effect = yes
		}
	}

	# Accept it
	option = {
		name = zhangzhung.0041.a
		trigger = {
			NOT = {
				scope:terton = {
					var:RICE_terma_type ?= flag:failure
				}
			}
		}
		RICE_terton_conclusion_accept_effects = yes
	}

	# Donate it
	option = {
		name = zhangzhung.0041.b
		trigger = {
			# Doesn't make sense if it's a religious building
			NOT = {				
				scope:terton = {
					var:RICE_terma_type ?= flag:religious_building
				}
			}
			NOT = {
				scope:terton = {
					var:RICE_terma_type ?= flag:failure
				}
			}
		}
		RICE_terton_conclusion_donate_effects = yes
	}

	# Failure
	option = {
		name = zhangzhung.0041.c
		trigger = {
			scope:terton = {
				var:RICE_terma_type ?= flag:failure
			}
		}
	}

	after = {
		scope:terton = {					
			if = {
				limit = { has_variable = RICE_terma_type }
				remove_variable = RICE_terma_type
			}					
			if = {
				limit = { has_variable = RICE_terma_recognition }
				remove_variable = RICE_terma_recognition
			}
			if = {
				limit = {
					has_character_modifier = RICE_zhangzhung_discovering_termas
				}
				remove_character_modifier = RICE_zhangzhung_discovering_termas
			}
		}
	}

}



######################################################################################
# 
# MISC DHARMACHAKRA / RAJAS OF ASIA ADAPTED CONTENT
# 
# zhangzhung.0050-zhangzhung.0069
# 
######################################################################################

# Tibetan Buddhist Deities
zhangzhung.0050 = {
	type = character_event
	title = dharma_buddhism.200.t
	desc = dharma_buddhism.200.desc
	theme = RICE_theme_tibet_inner_altar
	# override_background = {
	# 	reference = tibetan_temple
	# }
	left_portrait = {
		character = root
		animation = prayer
	}

	# Bon Deities
	option = {# Sipe Gyalmo
		name = dharma_buddhism.200.gyalmo
		trigger = {
			OR = {
				religion = religion:bon_religion
				religion = religion:west_himalayan_religion
			}
			NOT = { has_character_modifier = buddhist_deity_sipe_gyalmo }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_sipe_gyalmo }
	}

	option = {# Shenlha Okar
		name = dharma_buddhism.200.shenlha
		trigger = {
			OR = {
				religion = religion:bon_religion
				religion = religion:west_himalayan_religion
			}
			NOT = { has_character_modifier = buddhist_deity_shenlha_okar }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_shenlha_okar }
	}

	option = { # Tonpa Shenrab 
		name = dharma_buddhism.200.shenrab
		trigger = {
			OR = {
				religion = religion:bon_religion
				religion = religion:west_himalayan_religion
			}
			NOT = { has_character_modifier = buddhist_deity_tonpa_shenrab }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_tonpa_shenrab }
	}

	option = {# Yeshe Walmo
		name = dharma_buddhism.200.yeshe
		trigger = {
			OR = {
				religion = religion:bon_religion
				religion = religion:west_himalayan_religion
			}
			NOT = { has_character_modifier = buddhist_deity_yeshe_walmo }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_yeshe_walmo }
	}

	option = {# ZhangZhung Meri
		name = dharma_buddhism.200.takla
		trigger = {
			OR = {
				religion = religion:bon_religion
				religion = religion:west_himalayan_religion
			}
			NOT = { has_character_modifier = buddhist_deity_takla_mebar }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_takla_mebar }
	}

	option = {# Zhambala
		name = dharma_buddhism.200.zhambala
		trigger = {
			OR = {
				religion = religion:bon_religion
				religion = religion:west_himalayan_religion
			}
			NOT = { has_character_modifier = buddhist_deity_Zhambala }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_Zhambala }
	}

	option = {# Sherab Chamma
		name = dharma_buddhism.200.chamma
		trigger = {
			OR = {
				religion = religion:bon_religion
				religion = religion:west_himalayan_religion
			}
			NOT = { has_character_modifier = buddhist_deity_sherab_chamma }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_sherab_chamma }
	}

	# Nang Chos Deities
	option = {# Palden Lhamo
		name = dharma_buddhism.200.palden
		trigger = {
			religion = religion:buddhism_religion
			NOT = { has_character_modifier = buddhist_deity_palden_lhamo }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_palden_lhamo }
	}

	option = {# Tara
		name = dharma_buddhism.200.tara
		trigger = {
			religion = religion:buddhism_religion
			NOT = { has_character_modifier = buddhist_deity_tara }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_tara }
	}

	option = {# Avalokiteśvara
		name = dharma_buddhism.200.avalokitesvara
		trigger = {
			religion = religion:buddhism_religion
			NOT = { has_character_modifier = buddhist_deity_avalokitesvara }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_avalokitesvara }
	}

	option = {# Yamantaka
		name = dharma_buddhism.200.yamantaka
		trigger = {
			religion = religion:buddhism_religion
			NOT = { has_character_modifier = buddhist_deity_yamantaka }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_yamantaka }
	}

	option = {# Hevajra
		name = dharma_buddhism.200.hevajra
		trigger = {
			religion = religion:buddhism_religion
			NOT = { has_character_modifier = buddhist_deity_hevajra }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_hevajra }
	}

	option = {# Vajrayogini
		name = dharma_buddhism.200.vajrayogini
		trigger = {
			religion = religion:buddhism_religion
			NOT = { has_character_modifier = buddhist_deity_vajrayogini }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_vajrayogini }
	}

	# Opt-Out
	option = {
		name = dharma_buddhism.200.optout
		ai_chance = {
			base = 0
		}		
	}
}

# Burmese Buddhist Deities
zhangzhung.0051 = {
	type = character_event
	title = dharma_buddhism.201.t
	desc = dharma_buddhism.201.desc
	theme = RICE_theme_sri_lanka_stupa
	# override_background = {
	# 	reference = wood_temple
	# }
	left_portrait = {
		character = root
		animation = prayer
	}

	# Ari Deities
	option = {# Thagyamin
		name = dharma_buddhism.201.thagyamin
		trigger = {
			religion = religion:burmic_religion
			#faith = faith:ari
			NOT = { has_character_modifier = nat_ari_thagyamin }
		}
		set_nat_effect = { NAT = nat_ari_thagyamin }
	}

	option = {# Mahagiri
		name = dharma_buddhism.201.mahagiri
		trigger = {
			religion = religion:burmic_religion
			#faith = faith:ari
			NOT = { has_character_modifier = nat_ari_mahagiri }
		}
		set_nat_effect = { NAT = nat_ari_mahagiri }
	}

	option = { # Hnamadawgyi
		name = dharma_buddhism.201.hnamadawgyi
		trigger = {
			religion = religion:burmic_religion
			#faith = faith:ari
			NOT = { has_character_modifier = nat_ari_hnamadawgyi }
		}
		set_nat_effect = { NAT = nat_ari_hnamadawgyi }
	}

	option = {# Ponmagyi
		name = dharma_buddhism.201.ponmagyi
		trigger = {
			religion = religion:burmic_religion
			#faith = faith:ari
			NOT = { has_character_modifier = nat_ari_ponmagyi }
		}
		set_nat_effect = { NAT = nat_ari_ponmagyi }
	}

	option = {# Sīvali
		name = dharma_buddhism.201.sivalia
		trigger = {
			# OR = {
			# 	faith = faith:ari
			# 	faith = faith:theravada
			# }
			NOT = { has_character_modifier = nat_ari_sivali }
		}
		set_nat_effect = { NAT = nat_ari_sivali }
	}

	option = {# Shwe Nabay
		name = dharma_buddhism.201.nabay
		trigger = {
			religion = religion:burmic_religion
			#faith = faith:ari
			NOT = { has_character_modifier = nat_ari_shwe_nabay }
		}
		set_nat_effect = { NAT = nat_ari_shwe_nabay }
	}

	# Burmese Therevada Deities
	option = {# Thurathadi
		name = dharma_buddhism.201.thurathadi
		trigger = {
			religion = religion:buddhism_religion
			NOT = { has_character_modifier = nat_therevada_thurathadi }
		}
		set_nat_effect = { NAT = nat_therevada_thurathadi }
	}

	option = {# Lokanat
		name = dharma_buddhism.201.lokanat
		trigger = {
			religion = religion:buddhism_religion
			NOT = { has_character_modifier = nat_therevada_lokanat }
		}
		set_nat_effect = { NAT = nat_therevada_lokanat }
	}

	option = {# Panhtwar
		name = dharma_buddhism.201.panhtwar
		trigger = {
			religion = religion:buddhism_religion
			NOT = { has_character_modifier = nat_therevada_panhtwar }
		}
		set_nat_effect = { NAT = nat_therevada_panhtwar }
	}

	option = {# Shin Upagutta
		name = dharma_buddhism.201.shin
		trigger = {
			religion = religion:buddhism_religion
			NOT = { has_character_modifier = nat_therevada_shin_upagutta }
		}
		set_nat_effect = { NAT = nat_therevada_shin_upagutta }
	}

	option = {# Manimekhala
		name = dharma_buddhism.201.manimekhala
		trigger = {
			religion = religion:buddhism_religion
			NOT = { has_character_modifier = nat_therevada_manimekhala }
		}
		set_nat_effect = { NAT = nat_therevada_manimekhala }
	}

	# Opt-Out
	option = {
		name = dharma_buddhism.201.optout
		ai_chance = {
			base = 0
		}		
	}
}

# Mahayana Boddhisattvas
zhangzhung.0052 = {
	type = character_event
	title = dharma_buddhism.202.t
	desc = dharma_buddhism.202.desc
	theme = faith
	# override_background = {
	# 	reference = tibetan_temple
	# }
	left_portrait = {
		character = root
		animation = prayer
	}

	# East Asian Mahayana
	option = {# Guanyin
		name = dharma_buddhism.202.guanyin
		trigger = {
			faith = { has_doctrine = rice_mahayana_canon_doctrine }
			NOR = {
				culture = { has_cultural_pillar = heritage_indo_aryan }
				culture = { has_cultural_pillar = heritage_dravidian }
			}
			NOT = { has_character_modifier = buddhist_deity_guanyin }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_guanyin }
	}
	option = {# Mahasthamaprapta
		name = dharma_buddhism.202.mahasthamaprapta
		trigger = {
			faith = { has_doctrine = rice_mahayana_canon_doctrine }
			NOR = {
				culture = { has_cultural_pillar = heritage_indo_aryan }
				culture = { has_cultural_pillar = heritage_dravidian }
			}
			NOT = { has_character_modifier = buddhist_deity_mahasthamaprapta }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_mahasthamaprapta }
	}
	option = {# Ksitigarbha
		name = dharma_buddhism.202.ksitigarbha
		trigger = {
			faith = { has_doctrine = rice_mahayana_canon_doctrine }
			NOR = {
				culture = { has_cultural_pillar = heritage_indo_aryan }
				culture = { has_cultural_pillar = heritage_dravidian }
			}
			NOT = { has_character_modifier = buddhist_deity_ksitigarbha }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_ksitigarbha }
	}
	option = {# Bhaisajyaguru
		name = dharma_buddhism.202.bhaisajyaguru
		trigger = {
			OR = { 
				faith = { has_doctrine = rice_mahayana_canon_doctrine }
				AND = {
					faith = { has_doctrine = rice_vajrayana_canon_doctrine }
					NOR = {
						culture = { has_cultural_pillar = heritage_indo_aryan }
						culture = { has_cultural_pillar = heritage_dravidian }
					}
				}
			}
			NOT = { has_character_modifier = buddhist_deity_bhaisajyaguru }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_bhaisajyaguru }
	}	
	# Indian Mahayana
	option = {# Vasudhara
		name = dharma_buddhism.202.vasudhara
		trigger = {
			AND = {
				faith = { has_doctrine = rice_mahayana_canon_doctrine }
				OR = {
					culture = { has_cultural_pillar = heritage_indo_aryan }
					culture = { has_cultural_pillar = heritage_dravidian }
				}
			}
			NOT = { has_character_modifier = buddhist_deity_vasudhara }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_vasudhara }
	}
	option = {# Vajrapani
		name = dharma_buddhism.202.vajrapani
		trigger = {
			OR = {
				faith = { has_doctrine = rice_vajrayana_canon_doctrine }
				AND = {
					faith = { has_doctrine = rice_mahayana_canon_doctrine }
					OR = {
						culture = { has_cultural_pillar = heritage_indo_aryan }
						culture = { has_cultural_pillar = heritage_dravidian }
					}
				}
			}
			NOT = { has_character_modifier = buddhist_deity_vajrapani }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_vajrapani }
	}
	option = {# Manjushri
		name = dharma_buddhism.202.manjushri
		trigger = {
			OR = {
				faith = { has_doctrine = rice_vajrayana_canon_doctrine }
				AND = {
					faith = { has_doctrine = rice_mahayana_canon_doctrine }
					OR = {
						culture = { has_cultural_pillar = heritage_indo_aryan }
						culture = { has_cultural_pillar = heritage_dravidian }
					}
				}
			}
			NOT = { has_character_modifier = buddhist_deity_manjushri }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_manjushri }
	}
	option = {# Samantabhadra
		name = dharma_buddhism.202.samantabhadra
		trigger = {
			AND = {
				faith = { has_doctrine = rice_mahayana_canon_doctrine }
				OR = {
					culture = { has_cultural_pillar = heritage_indo_aryan }
					culture = { has_cultural_pillar = heritage_dravidian }
				}
			}
			NOT = { has_character_modifier = buddhist_deity_samantabhadra }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_samantabhadra }
	}
	# Vajarayana Deities
	option = {# Tara
		name = dharma_buddhism.202.tara
		trigger = {
			faith = { has_doctrine = rice_vajrayana_canon_doctrine }
			NOT = { has_character_modifier = buddhist_deity_tara }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_tara }
	}
	option = {# Avalokiteśvara
		name = dharma_buddhism.202.avalokitesvara
		trigger = {
			faith = { has_doctrine = rice_vajrayana_canon_doctrine }
			NOT = { has_character_modifier = buddhist_deity_avalokitesvara }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_avalokitesvara }
	}
	option = {# Ratnasambhava
		name = dharma_buddhism.202.Ratnasambhava
		trigger = {
			faith = { has_doctrine = rice_vajrayana_canon_doctrine }
			NOT = { has_character_modifier = buddhist_deity_ratnasambhava }
		}
		set_yidam_effect = { YIDAM = buddhist_deity_ratnasambhava }
	}
	# Opt-Out
	option = {
		name = dharma_buddhism.200.optout
		ai_chance = {
			base = 0
		}		
	}
}


######################################################################################
# 
# LOSAR (Adapted from Dharmachakra)
# 
# zhangzhung.0070-zhangzhung.0089
# 
######################################################################################

zhangzhung.0070 = {# Losar Starts
	type = activity_event
	title = dharma_festivals.060.t
	desc = dharma_festivals.060.desc
	theme = feast_activity
	override_background = {
		reference = RICE_background_tibetan_hall
	}
	
	right_portrait = root
	
	option = { # Cleaning the palace
		name = dharma_festivals.060.clean
		add_piety = miniscule_piety_gain
		stress_impact = {
			shy = minor_stress_impact_gain
			cynical = minor_stress_impact_gain
		}
	}
	
	after = {
		trigger_event = { 
			id = zhangzhung.0071
			days = { 3 5 }
		}
	}

}

zhangzhung.0071 = {# Lama Losar
	type = activity_event
	title = dharma_festivals.061.t
	desc = dharma_festivals.061.desc
	theme = feast_activity
	override_background = {
		reference = RICE_background_tibetan_hall
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	option = {# Pay Homage to your guru
		name = dharma_festivals.061.guru
		if = {
			limit = { exists = cp:councillor_court_chaplain }
			cp:councillor_court_chaplain = {
				add_opinion = {
					target = root
					modifier = pious_opinion
					opinion = 15
				}
			}
		}
		stress_impact = {
			gregarious = miniscule_stress_impact_loss
			zealous = miniscule_stress_impact_loss
			humble = miniscule_stress_impact_loss
			shy = miniscule_stress_impact_gain
			cynical = miniscule_stress_impact_gain
			reclusive = miniscule_stress_impact_gain
		}
	}

	after = {
		trigger_event = { 
			id = zhangzhung.0072
			days = { 3 5 }
		}
	}

}

zhangzhung.0072 = {# King Losaar 
	type = activity_event
	title = dharma_festivals.062.t
	desc = dharma_festivals.062.desc
	theme = feast_activity
	override_background = {
		reference = RICE_background_tibetan_hall
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	option = {# It is their due. 
		name = dharma_festivals.062.king
		add_gold = { 5 RICE_losar_gift_amount }
		stress_impact = {
			gregarious = miniscule_stress_impact_loss
			greedy = minor_stress_impact_loss
			generous = miniscule_stress_impact_gain
			shy = miniscule_stress_impact_gain
			reclusive = miniscule_stress_impact_gain
		}
	}

	after = {
		trigger_event = { 
			id = zhangzhung.0073
			days = { 3 5 }
		}
	}
}

zhangzhung.0073 = {# Give Gift to the common people 
	type = activity_event
	title = dharma_festivals.063.t
	desc = dharma_festivals.063.desc
	theme = feast_activity
	override_background = {
		reference = RICE_background_tibet_temple_exterior
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	option = {# Large Gift to the People 
		name = dharma_festivals.063.large
		trigger = {
			scope:activity = {
				has_activity_option = {
					category = RICE_festival_losar_gift_type
					option = RICE_festival_losar_gift_large
				}
			}
		}
		add_prestige = medium_prestige_gain
		capital_county = {
			add_county_modifier = {
				modifier = RICE_losar_large_gift_modifier
				years = 3
			}
		}
		stress_impact = {
			greedy = minor_stress_impact_gain
			improvident = minor_stress_impact_loss
			just = minor_stress_impact_loss
			compassionate = minor_stress_impact_loss
			generous = minor_stress_impact_loss
		}
	}
	option = {# Medium Gift to the People 
		name = dharma_festivals.063.medium
		trigger = {
			scope:activity = {
				has_activity_option = {
					category = RICE_festival_losar_gift_type
					option = RICE_festival_losar_gift_medium
				}
			}
		}
		add_prestige = minor_prestige_gain
		capital_county = {
			add_county_modifier = {
				modifier = RICE_losar_medium_gift_modifier
				years = 3
			}
		}
		stress_impact = {
			greedy = miniscule_stress_impact_gain
			improvident = miniscule_stress_impact_loss
			just = miniscule_stress_impact_loss
			compassionate = miniscule_stress_impact_loss
			generous = miniscule_stress_impact_loss
		}
	}
	option = {# Small Gift to the People 
		name = dharma_festivals.063.small
		trigger = {
			scope:activity = {
				has_activity_option = {
					category = RICE_festival_losar_gift_type
					option = RICE_festival_losar_gift_small
				}
			}
		}
		capital_county = {
			add_county_modifier = {
				modifier = RICE_losar_small_gift_modifier
				years = 3
			}
		}
		add_prestige = miniscule_prestige_gain
		stress_impact = {
			greedy = minor_stress_impact_loss
			improvident = minor_stress_impact_gain
			just = minor_stress_impact_gain
			compassionate = minor_stress_impact_gain
			generous = minor_stress_impact_gain
		}
	}

	after = {
		trigger_event = { 
			id = zhangzhung.0074
			days = { 3 5 }
		}
	}
}

zhangzhung.0074 = {# Choe-Kyong Losar 
	type = activity_event
	title = dharma_festivals.064.t
	desc = dharma_festivals.064.desc
	theme = feast_activity
	override_background = {
		reference = RICE_background_tibetan_hall
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	option = {# Offer to the Meditional Deities and Boddhisattvas 
		name = dharma_festivals.064.prayers
		add_piety = minor_piety_gain
		stress_impact = {
			gregarious = miniscule_stress_impact_loss
			zealous = miniscule_stress_impact_loss
			shy = miniscule_stress_impact_gain
			cynical = miniscule_stress_impact_gain
		}
	}

	after = {
		trigger_event = { 
			id = zhangzhung.0075
			days = { 3 5 }
		}
	}

}

zhangzhung.0075 = {# Tibetan Dances 
	type = activity_event
	title = dharma_festivals.065.t
	desc = dharma_festivals.065.desc
	theme = feast_activity
	override_background = {
		reference = RICE_background_tibet_temple_exterior
	}
	
	left_portrait = {
		character = root
		animation = throne_room_applaud_1
	}

	option = {# What a wonderful Story 
		name = dharma_festivals.065.dance
		stress_impact = {
			base = minor_stress_impact_loss
		}
	}

	after = {
		trigger_event = { 
			id = zhangzhung.0076
			days = { 3 5 }
		}
	}

}

zhangzhung.0076 = {# feast with the court 
	type = activity_event
	title = dharma_festivals.066.t
	desc = dharma_festivals.066.desc
	theme = feast_activity
	override_background = {
		reference = RICE_background_tibetan_hall
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	option = {# It is their due. 
		name = dharma_festivals.066.feast
		every_close_or_extended_family_member = {
			limit = { is_alive = yes }
			add_opinion = {
				modifier = feast_pleasant_time_opinion
				target = root
				opinion = 5
			}
		}
		every_courtier = {
			custom = yearly.4031.b_every_courtier
			add_opinion = {
				modifier = feast_pleasant_time_opinion
				target = root
				opinion = 5
			}
		}
		stress_impact = {
			base = miniscule_stress_impact_loss
			family_first = minor_stress_impact_loss
		}
	}

	after = {
		trigger_event = { 
			id = zhangzhung.0077
			days = { 3 5 }
		}
	}

}

zhangzhung.0077 = {# Losar concludes
	type = activity_event
	title = dharma_festivals.067.t
	desc = dharma_festivals.067.desc
	theme = faith
	override_background = {
		reference = RICE_background_tibet_temple_exterior
	}	
	left_portrait = {
		character = root
		animation = ecstasy
	}
	
	option = {# Back Home
		name = dharma_festivals.067.home
		if = {
			limit = {
				has_activity_intent = RICE_festival_losar_worship_intent
			}
			add_piety = 50
			stress_impact = {
				zealous = minor_stress_impact_loss
				humble = minor_stress_impact_loss
			}
		}
		if = {
			limit = {
				has_activity_intent = RICE_festival_losar_reputation_intent
			}
			add_prestige = 50
			stress_impact = {
				zealous = minor_stress_impact_loss
				arrogant = minor_stress_impact_loss
			}
		}
		RICE_festival_losar_completed_log_entry_effect = yes
	}

	after = {
		scope:activity = {
			hidden_effect = { skip_activity_phase = yes }
		}
		# trigger_event = { 
		# 	id = zhangzhung.0078
		# 	days = 1
		# }
	}
}

# zhangzhung.0078 = {# Misc cleanup
# 	hidden = yes	
# 	immediate = {
# 		RICE_festival_losar_completed_log_entry_effect = yes
# 		scope:activity = {
# 			hidden_effect = { skip_activity_phase = yes }
# 		}
# 	}
# }



######################################################################################
# 
# GLACIER MARRIAGE
# 
# zhangzhung.0090-zhangzhung.0099
# 
######################################################################################



# Setup activity
zhangzhung.0090 = {
	type = activity_event
	title = zhangzhung.0090.t
	desc = zhangzhung.0090.desc
	theme = faith
	override_background = { reference = RICE_background_himalayan_wilderness }
	
	right_portrait = root

	immediate = {
		scope:activity = {
			activity_location = {
				save_scope_as = location
			}
		}
		scope:location.county = {
			save_scope_as = county
		}
		scope:location.county.culture = {
			save_scope_as = culture
		}
	}
	
	option = { # Ok
		name = zhangzhung.0090.a
	}	

	after = {
		trigger_event = {
			id = zhangzhung.0091
			days = { 3 7 }
		}
	}	

}



# Glacier marriage
zhangzhung.0091 = {
	type = activity_event
	title = zhangzhung.0091.t
	desc = zhangzhung.0091.desc
	theme = marriage
	override_background = { reference = RICE_background_himalayan_wilderness }
	
	right_portrait = {
		character = root
		animation = personality_forgiving
	}
	
	option = { # Ok
		name = zhangzhung.0091.a
	}	

	after = {
		trigger_event = {
			id = zhangzhung.0092
			days = { 3 7 }
		}
	}	

}



# Glacier marriage
zhangzhung.0092 = {
	type = activity_event
	title = zhangzhung.0092.t
	desc = zhangzhung.0092.desc
	theme = marriage
	override_background = { reference = RICE_background_himalayan_wilderness }
	
	right_portrait = {
		character = root
		animation = prayer
	}

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					scope:activity = {
						has_activity_option = {
							category = RICE_glacier_marriage_sacrifice_amount
							option = RICE_glacier_marriage_sacrifice_amount_large
						}
					}
				}
				random_list = {
					20 = {
						scope:activity.activity_location.county = {
							add_county_modifier = {
								modifier = RICE_glacier_marriage_modifier_large
								years = 10
							}			
						}
					}
					20 = {
						scope:activity.activity_location.county = {
							add_county_modifier = {
								modifier = RICE_glacier_marriage_modifier_medium
								years = 10
							}			
						}
					}
					20 = {
						scope:activity.activity_location.county = {
							add_county_modifier = {
								modifier = RICE_glacier_marriage_modifier_small
								years = 10
							}			
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:activity = {
						has_activity_option = {
							category = RICE_glacier_marriage_sacrifice_amount
							option = RICE_glacier_marriage_sacrifice_amount_medium
						}
					}
				}
				random_list = {
					10 = {
						scope:activity.activity_location.county = {
							add_county_modifier = {
								modifier = RICE_glacier_marriage_modifier_large
								years = 10
							}			
						}
					}
					20 = {
						scope:activity.activity_location.county = {
							add_county_modifier = {
								modifier = RICE_glacier_marriage_modifier_medium
								years = 10
							}			
						}
					}
					30 = {
						scope:activity.activity_location.county = {
							add_county_modifier = {
								modifier = RICE_glacier_marriage_modifier_small
								years = 10
							}			
						}
					}
				}
			}
			else = {
				random_list = {
					10 = {
						scope:activity.activity_location.county = {
							add_county_modifier = {
								modifier = RICE_glacier_marriage_modifier_large
								years = 10
							}			
						}
					}
					20 = {
						scope:activity.activity_location.county = {
							add_county_modifier = {
								modifier = RICE_glacier_marriage_modifier_medium
								years = 10
							}			
						}
					}
					30 = {
						scope:activity.activity_location.county = {
							add_county_modifier = {
								modifier = RICE_glacier_marriage_modifier_small
								years = 10
							}			
						}
					}
				}
			}
		}
	}
	
	option = {
		name = zhangzhung.0092.a
		RICE_glacier_marriage_completed_log_entry_effect = yes
	}

	after = {
		hidden_effect = {
			scope:activity = {
				hidden_effect = { skip_activity_phase = yes }
			}
		}
	}


}



######################################################################################
# 
# FULAICH FLOWER FESTIVAL
# 
# zhangzhung.0100-zhangzhung.0119
# 
######################################################################################

# Setup activity
zhangzhung.0100 = {
	type = character_event
	title = zhangzhung.0100.t
	desc = zhangzhung.0100.desc
	theme = travel
	override_background = { reference = RICE_background_himalayan_wilderness }
	
	left_portrait = {
		character = root
		animation = thinking
	}

	trigger = {
		is_available_travelling = yes
		is_landed = yes
		exists = involved_activity
		involved_activity = {
			has_activity_type = activity_RICE_zhangzhung_kinnaur_flower_festival
		}
	}
	
	option = { # Ok
		name = zhangzhung.0100.a
	}	
}


# Arrive at location, flower gatherers set out
# Give offerings to the deceased and to the ancestors first
zhangzhung.0101 = {
	type = activity_event
	title = zhangzhung.0101.t
	desc = {
		desc = zhangzhung.0101.desc
		triggered_desc = {
			trigger = {
				exists = scope:activity.special_guest:RICE_special_guest_flower_collector
			}
			desc = zhangzhung.0101.desc.flower_collector
		}
	}
	theme = RICE_theme_himachal_pradesh_valley
	
	left_portrait = {
		character = scope:flower_collector
		animation = personality_bold
		trigger = {
			exists = scope:flower_collector
		}
	}

	right_portrait = {
		character = root
		animation = happiness
	}

	immediate = {	
		faith = {
			save_scope_as = faith
		}
		scope:activity = {
			activity_location = {
				save_scope_as = location
			}
		}
		if = {
			limit = {
				exists = scope:activity.special_guest:RICE_special_guest_flower_collector
			}
			scope:activity.special_guest:RICE_special_guest_flower_collector = {
				save_scope_as = flower_collector
			}
		}
	}
	
	option = {
		name = zhangzhung.0101.a
	}
	
	after = {
		trigger_event = {
			id = zhangzhung.0102
			days = { 3 7 }
		}
	}	
}



# Flower gatherers return, decorating flowers everywhere and wearing it on caps, making garlands and bouquets; offerings to ancestors
zhangzhung.0102 = {
	type = activity_event
	title = zhangzhung.0102.t
	desc = {
		desc = zhangzhung.0102.desc.intro	
		first_valid = {
			triggered_desc = {
				trigger = {
					exists = scope:activity.special_guest:RICE_special_guest_flower_collector
				}
				desc = zhangzhung.0102.desc.flower_collector
			}
			desc = zhangzhung.0102.desc.no_flower_collector
		}
		desc = zhangzhung.0102.desc	
	}
	theme = RICE_theme_himachal_pradesh_valley
	
	left_portrait = {
		character = scope:flower_collector
		animation = personality_content
		trigger = {
			exists = scope:flower_collector
		}
	}

	right_portrait = {
		character = root
		animation = throne_room_cheer_1
	}

	immediate = {
		if = {
			limit = {
				exists = scope:flower_collector
			}					
			scope:activity = {
				add_activity_log_entry = {
					key = RICE_zhangzhung_kinnaur_flower_festival_collector_returns_log
					tags = { good }
					show_in_conclusion = yes
					character = scope:flower_collector
					scope:flower_collector = {
						add_piety = 100
						add_prestige = 100
						add_opinion = {
							target = root
							modifier = RICE_kinnaur_festival_flower_collector_opinion
						}
					}
				}
			}
		}
	}
	
	option = {
		name = zhangzhung.0102.a
	}
	
	after = {
		trigger_event = {
			id = zhangzhung.0103
			days = { 3 6 }
		}
	}	
}

# Singing and dancing with the local deity, Sacrifice of sheep/goats, or imitations of them, as deity is brought forth in a procession
zhangzhung.0103 = {
	type = activity_event
	title = zhangzhung.0103.t
	desc = {
		desc = zhangzhung.0103.desc		
		first_valid = {
			triggered_desc = {
				trigger = {
					faith = {
						has_doctrine = rice_bon_deities_new_doctrine
					}
				}
				desc = zhangzhung.0103.desc.new_bon
			}
			desc = zhangzhung.0103.desc.old_bon
		}
	}
	theme = RICE_theme_tibet_outer_altar

	left_portrait = {
		character = root
		animation = prayer
	}	
	
	right_portrait = {
		trigger = { exists = scope:guest_to_display }
		character = scope:guest_to_display
		animation = personality_zealous
	}

	immediate = {
		if = {
			limit = {			
				scope:activity = {
					any_attending_character = {
						NOT = { this = root }
					}
				}
			}
			scope:activity = {
				random_attending_character = {
					limit = {
						NOT = { this = root }
					}
					save_scope_as = guest_to_display
				}
			}
		}
	}
	
	option = {
		name = zhangzhung.0103.a					
		scope:activity = {
			add_activity_log_entry = {
				key = RICE_zhangzhung_kinnaur_flower_festival_collector_sacrifice_log
				tags = { good }
				show_in_conclusion = yes
				character = scope:host
				if = {
					limit = {				
						scope:activity = {
							has_activity_option = {
								category = RICE_zhangzhung_kinnaur_flower_festival_sacrifice_amount
								option = RICE_zhangzhung_kinnaur_flower_festival_sacrifice_amount_small
							}
						}
					}
					scope:host = {
						add_piety = RICE_zhangzhung_kinnaur_flower_festival_base_piety_small
						add_prestige = RICE_zhangzhung_kinnaur_flower_festival_base_prestige_small
					}
				}
				else_if = {
					limit = {				
						scope:activity = {
							has_activity_option = {
								category = RICE_zhangzhung_kinnaur_flower_festival_sacrifice_amount
								option = RICE_zhangzhung_kinnaur_flower_festival_sacrifice_amount_medium
							}
						}
					}
					scope:host = {
						add_piety = RICE_zhangzhung_kinnaur_flower_festival_base_piety_medium
						add_prestige = RICE_zhangzhung_kinnaur_flower_festival_base_prestige_medium
					}
				}
				else_if = {
					limit = {				
						scope:activity = {
							has_activity_option = {
								category = RICE_zhangzhung_kinnaur_flower_festival_sacrifice_amount
								option = RICE_zhangzhung_kinnaur_flower_festival_sacrifice_amount_large
							}
						}
					}
					scope:host = {
						add_piety = RICE_zhangzhung_kinnaur_flower_festival_base_piety_large
						add_prestige = RICE_zhangzhung_kinnaur_flower_festival_base_prestige_large
					}
				}
			}
		}
	}
	
	after = {
		trigger_event = {
			id = zhangzhung.0104
			days = { 3 6 }
		}
	}	
}

# Oracle of the local deity makes prediction
zhangzhung.0104 = {
	type = activity_event
	title = zhangzhung.0104.t
	desc = zhangzhung.0104.desc
	theme = RICE_theme_tibet_inner_altar

	left_portrait = {
		character = root
		animation = throne_room_applaud_1
	}

	immediate = {	
		if = {
			limit = {				
				scope:activity = {
					has_activity_option = {
						category = RICE_zhangzhung_kinnaur_flower_festival_sacrifice_amount
						option = RICE_zhangzhung_kinnaur_flower_festival_sacrifice_amount_small
					}
				}
			}
			random = {
				chance = RICE_zhangzhung_kinnaur_flower_festival_oracle_chance_low
				RICE_zhangzhung_kinnaur_flower_festival_oracle_modifiers_effect = yes
				RICE_zhangzhung_kinnaur_flower_festival_oracle_log_display_effect = yes
			}
		}
		else_if = {
			limit = {				
				scope:activity = {
					has_activity_option = {
						category = RICE_zhangzhung_kinnaur_flower_festival_sacrifice_amount
						option = RICE_zhangzhung_kinnaur_flower_festival_sacrifice_amount_medium
					}
				}
			}
			random = {
				chance = RICE_zhangzhung_kinnaur_flower_festival_oracle_chance_medium
				RICE_zhangzhung_kinnaur_flower_festival_oracle_modifiers_effect = yes
				RICE_zhangzhung_kinnaur_flower_festival_oracle_log_display_effect = yes
			}
		}
		else_if = {
			limit = {				
				scope:activity = {
					has_activity_option = {
						category = RICE_zhangzhung_kinnaur_flower_festival_sacrifice_amount
						option = RICE_zhangzhung_kinnaur_flower_festival_sacrifice_amount_large
					}
				}
			}
			random = {
				chance = RICE_zhangzhung_kinnaur_flower_festival_oracle_chance_high
				RICE_zhangzhung_kinnaur_flower_festival_oracle_modifiers_effect = yes
				RICE_zhangzhung_kinnaur_flower_festival_oracle_log_display_effect = yes
			}
		}
	}
	
	option = {
		name = zhangzhung.0104.a
	}
	
	after = {
		trigger_event = {
			id = zhangzhung.0105
			days = { 3 6 }
		}
	}	
}

# Dancing at the temple of the deity
zhangzhung.0105 = {
	type = activity_event
	title = zhangzhung.0105.t
	desc = zhangzhung.0105.desc
	theme = RICE_theme_tibet_outer_altar

	left_portrait = {
		character = root
		animation = dancing
	}

	right_portrait = {
		trigger = { exists = scope:guest_to_display }
		character = scope:guest_to_display
		animation = throne_room_cheer_2
	}

	immediate = {
		if = {
			limit = {			
				scope:activity = {
					any_attending_character = {
						NOT = { this = root }
					}
				}
			}
			scope:activity = {
				random_attending_character = {
					limit = {
						NOT = { this = root }
					}
					save_scope_as = guest_to_display
				}
			}
		}
	}
	
	option = {
		name = zhangzhung.0105.a
	}
	
	after = {
		trigger_event = {
			id = zhangzhung.0106
			days = { 3 6 }
		}
	}	
}

# Conclusion
zhangzhung.0106 = {
	type = activity_event
	title = zhangzhung.0106.t
	desc = zhangzhung.0106.desc
	theme = RICE_theme_himachal_pradesh_valley

	right_portrait = {
		character = root
		animation = personality_forgiving
	}
	
	option = {
		name = zhangzhung.0106.a
		RICE_zhangzhung_kinnaur_flower_festival_completed_log_entry_effect = yes
	}

	after = {
		hidden_effect = {
			scope:activity = {
				hidden_effect = { skip_activity_phase = yes }
			}
		}
	}

}








######################################################################################
# 
# HISTORICAL CHARACTERS
# 
# zhangzhung.0120-zhangzhung.0139
# 
######################################################################################


# Dpal Dus Sgra's startup event: intro
zhangzhung.0120 = {
	type = character_event
	title = zhangzhung.0120.t
	desc = zhangzhung.0120.desc
	theme = RICE_theme_ladakh_wilderness

	right_portrait = {
		character = root
		animation = war_over_tie
	}

	immediate = {
		save_scope_as = dpal_dus_sgra
		character:247142 = {
			save_scope_as = odetsen
		}
		# Generate a couple Burusho courtiers for him
		hidden_effect = {
			RICE_remove_personality_traits_effect = yes
			create_character = {
				employer = root
				template = burusho_courtier_template
				#save_scope_as = RICE_burusho_courtier_spawn_1
				culture = culture:burusho
			}	
			create_character = {
				employer = root
				template = burusho_courtier_template
				#save_scope_as = RICE_burusho_courtier_spawn_2
				culture = culture:burusho
			}
		}
	}

	# Religious building
	option = {
		name = zhangzhung.0120.a	
		random_list = {
			10 = {
				add_trait = zealous
			}
			10 = {
				add_trait = temperate
			}
			10 = {
				add_trait = shy
			}
		}	
	}

	# Building relationships
	option = {
		name = zhangzhung.0120.b	
		random_list = {
			10 = {
				add_trait = gregarious
			}
			10 = {
				add_trait = generous
			}
		}			
	}

	# Defending the region
	option = {
		name = zhangzhung.0120.c
		random_list = {
			10 = {
				add_trait = paranoid
			}
			10 = {
				add_trait = cynical
			}
		}		
	}

	# Enjoying official life
	option = {
		name = zhangzhung.0120.d	
		random_list = {
			10 = {
				add_trait = gluttonous
			}
			10 = {
				add_trait = greedy
			}
		}	
	}

	after = {
		trigger_event = zhangzhung.0121
	}

}

# Dpal Dus Sgra's startup event: family
zhangzhung.0121 = {
	type = character_event
	title = zhangzhung.0121.t
	desc = zhangzhung.0121.desc
	theme = RICE_theme_tibetan_hall_generic

	right_portrait = {
		character = root
		animation = war_over_tie
	}

	# Single
	option = {
		name = zhangzhung.0121.a
		custom_tooltip = zhangzhung.0121.a.tooltip
		add_prestige = 300
		random_list = {
			10 = {
				add_trait = ambitious
			}
			10 = {
				add_trait = chaste
			}
			10 = {
				add_trait = eccentric
			}
		}
	}

	# Has family
	option = {
		name = zhangzhung.0121.b
		custom_tooltip = zhangzhung.0121.b.tooltip
		hidden_effect = {
			RICE_generate_small_family_as_ruler = { CHARACTER = scope:dpal_dus_sgra }			
		}
		random_list = {
			10 = {
				add_trait = patient
			}
			10 = {
				add_trait = content
			}
			10 = {
				add_trait = lustful
			}
		}
	}

	after = {
		trigger_event = zhangzhung.0122
	}

}

# Dpal Dus Sgra's startup event: legacy
zhangzhung.0122 = {
	type = character_event
	title = zhangzhung.0122.t
	desc = zhangzhung.0122.desc
	theme = RICE_theme_spiti_valley

	right_portrait = {
		character = root
		animation = war_over_tie
	}

	# Military defender
	option = {
		name = zhangzhung.0122.a
		add_prestige = 300
		random_list = {
			10 = {
				add_martial_skill = 1
			}
			10 = {
				add_prowess_skill = 1
			}
		}
		random_list = {
			10 = {
				add_trait = brave
			}
			10 = {
				add_trait = wrathful
			}
			10 = {
				add_trait = stubborn
			}
		}
	}

	# Management of frontier
	option = {
		name = zhangzhung.0122.b
		add_prestige = 150
		add_piety = 150
		random_list = {
			10 = {
				add_stewardship_skill = 1
			}
			10 = {
				add_intrigue_skill = 1
			}
		}
		random_list = {
			10 = {
				add_trait = craven
			}
			10 = {
				add_trait = just
			}
			10 = {
				add_trait = calm
			}
		}
	}

	# Spreading of Buddhism
	option = {
		name = zhangzhung.0122.c
		add_piety = 300
		random_list = {
			10 = {
				add_diplomacy_skill = 1
			}
			10 = {
				add_learning_skill = 1
			}
		}
		random_list = {
			10 = {
				add_trait = humble
			}
			10 = {
				add_trait = honest
			}
			10 = {
				add_trait = compassionate
			}
		}
	}

	after = {
		RICE_zhangzhung_dpal_dus_sgra_startup_general_effect = yes
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = zhangzhung.0122.info
		}
	}
}


# Hrugs Wer starting event
zhangzhung.0130 = {
	type = character_event
	title = zhangzhung.0130.t
	desc = zhangzhung.0130.desc
	theme = faith
	override_background = { reference = RICE_background_spiti_valley }

	#left_portrait = root

	right_portrait = {
		character = scope:rinchen_zangpo
		animation = prayer
	}

	immediate = {
		character:RICE_yudra_8 = {
			save_scope_as = rinchen_zangpo
		}
		show_as_tooltip = {
			dynasty ?= {
				add_dynasty_modifier = {
					modifier = RICE_zhangzhung_hrugs_wer_modifier
				}
			}
		}
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = zhangzhung.0130.info
		}
	}

	option = {
		name = zhangzhung.0130.a
	}
}







######################################################################################
# 
# GENERIC FLAVOR EVENTS
# 
# zhangzhung.0150-zhangzhung.0199
# 
######################################################################################



# Viewing a thangka at a Buddhist monastery
zhangzhung.0150 = {
	type = character_event
	title = zhangzhung.0150.t
	desc = zhangzhung.0150.desc
	theme = RICE_theme_tibetan_hall_religious

	left_portrait = {
		character = root
		animation = personality_zealous
	}

	right_portrait = {
		character = scope:chaplain
		animation = personality_content
	}
		
	trigger = {
		RICE_tibetan_buddhist_or_reformed_bon_trigger = yes
		cp:councillor_court_chaplain = {
			exists = yes
			is_available_adult = yes
			RICE_tibetan_buddhist_or_reformed_bon_trigger = yes
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = zealous
		}
		modifier = {
			add = -0.2
			has_trait = cynical
		}
		modifier = {
			add = 0.2
			has_trait = diligent
		}
		modifier = {
			add = -0.2
			has_trait = lazy
		}
		modifier = {
			add = 0.2
			has_trait = humble
		}
		modifier = {
			add = -0.2
			has_trait = arrogant
		}
	}

	immediate = {
		cp:councillor_court_chaplain = { save_scope_as = chaplain }
	}
	

	option = { # Ok
		name = zhangzhung.0150.a
		add_prestige = 25
		stress_impact = {
			humble = minor_stress_impact_gain
			zealous = minor_stress_impact_gain
			content = miniscule_stress_impact_gain
		}
	}

	option = { # Ok
		name = zhangzhung.0150.b
		add_piety = 25
		stress_impact = {
			arrogant = minor_stress_impact_gain
			cynical = minor_stress_impact_gain
			arbitrary = miniscule_stress_impact_gain
		}
	}

	option = { # Ok
		name = zhangzhung.0150.c
		trigger = {
			OR = {
				is_ai = no
				gold >= 30
			}
		}
		remove_short_term_gold = 30
		add_piety = 100
		scope:chaplain = {
			add_opinion = {
				target = root
				modifier = pious_opinion
				opinion = 10
			}
		}
		stress_impact = {
			greedy = minor_stress_impact_gain
			cynical = minor_stress_impact_gain
			callous = miniscule_stress_impact_gain
		}
	}

}




# Padmasambhava cave - supposedly
zhangzhung.0151 = {
	type = character_event
	title = zhangzhung.0151.t
	desc = zhangzhung.0151.desc
	theme = faith
	override_background = { reference = RICE_background_himalayan_wilderness }
	
	right_portrait = {
		character = root
		animation = thinking
	}

	
	lower_center_portrait = {
		character = scope:padmasambhava
		trigger = { exists = scope:padmasambhava } # In case the game prunes him for some reason, which it shouldn't since he should be saved
	}
	
	trigger = {
		#religion = religion:buddhism_religion
		culture = { has_cultural_pillar = heritage_tibetan }
		faith = { has_doctrine = rice_vajrayana_canon_doctrine }
		any_held_title = {
			tier = tier_county
			faith = root.faith
			any_county_province = {
				geographical_region = RICE_greater_himalayan_region
			}
		}
		exists = character:RICE_buddhist_001
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = compassionate
		}
		modifier = {
			add = -0.2
			has_trait = sadistic
		}
		modifier = {
			add = 0.2
			has_trait = humble
		}
		modifier = {
			add = -0.2
			has_trait = arrogant
		}
		modifier = {
			add = 0.2
			has_trait = temperate
		}
		modifier = {
			add = -0.2
			has_trait = gluttonous
		}
	}

	immediate = {
		character:RICE_buddhist_001 = {
			save_scope_as = padmasambhava
		}
		random_held_title = {			
			limit = {
				tier = tier_county
				faith = root.faith
				any_county_province = {
					geographical_region = RICE_greater_himalayan_region
				}
			}
			save_scope_as = county
			random_list = {
				10 = {
					add_county_modifier = {
						modifier = RICE_zhangzhung_padmasambhava_cave
						years = 5
					}
				}
				10 = {
					add_county_modifier = {
						modifier = RICE_zhangzhung_padmasambhava_cave
						years = 10
					}
				}
				10 = {
					add_county_modifier = {
						modifier = RICE_zhangzhung_padmasambhava_cave
						years = 15
					}
				}
				10 = {
					add_county_modifier = {
						modifier = RICE_zhangzhung_padmasambhava_cave
						years = 20
					}
				}
			}
		}
	}

	option = { # Ok
		name = zhangzhung.0151.a
		add_piety = 25
		stress_impact = {
			cynical = minor_stress_impact_gain
		}
	}

	option = { # Ok
		name = zhangzhung.0151.b
		add_prestige = 25
		stress_impact = {
			zealous = minor_stress_impact_gain
		}
	}
}





# Rock with a giant foot on it (based on a legend about Gyalwa Gotsangpa)
zhangzhung.0152 = {
	type = character_event
	title = zhangzhung.0152.t
	desc = zhangzhung.0152.desc
	theme = travel
	override_background = { reference = RICE_background_himalayan_wilderness }
	
	right_portrait = {
		character = root
		animation = personality_zealous
	}	

	trigger = {
		is_location_valid_for_travel_event_on_land = yes
		OR = {
			religion = religion:buddhism_religion
			religion = religion:bon_religion
			religion = religion:west_himalayan_religion
		}
		location.county.religion = root.religion
		location = {
			geographical_region = RICE_greater_himalayan_region
		}
	}
	
	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = compassionate
		}
		modifier = {
			add = -0.2
			has_trait = sadistic
		}
		modifier = {
			add = 0.2
			has_trait = zealous
		}
		modifier = {
			add = -0.2
			has_trait = cynical
		}
		modifier = {
			add = 0.2
			has_trait = humble
		}
		modifier = {
			add = -0.2
			has_trait = arrogant
		}
	}

	immediate = {
		root.location.culture = {
			save_scope_as = culture
		}
		root.location.faith = {
			save_scope_as = faith
		}
	}

	option = { # Ok
		name = zhangzhung.0152.a
		add_piety = 25
		stress_impact = {
			cynical = minor_stress_impact_gain
		}
	}

	option = { # Ok
		name = zhangzhung.0152.b
		add_prestige = 25
		stress_impact = {
			zealous = minor_stress_impact_gain
		}
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = zhangzhung.0152.info
		}
	}

}



# Legendary castle inhabited by a demon king
zhangzhung.0153 = {
	type = character_event
	title = zhangzhung.0153.t
	desc = zhangzhung.0153.desc
	theme = martial
	override_background = { reference = RICE_background_zhangzhung_ruins }
	
	right_portrait = {
		character = root
		animation = frontend_right_idle
	}
	
	trigger = {
		any_held_title = {
			tier = tier_county
			any_county_province = {
				geographical_region = world_tibet
			}
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = diligent
		}
		modifier = {
			add = -0.2
			has_trait = lazy
		}
		modifier = {
			add = 0.2
			has_trait = just
		}
		modifier = {
			add = -0.2
			has_trait = arbitrary
		}
		modifier = {
			add = 0.2
			has_trait = craven
		}
		modifier = {
			add = -0.2
			has_trait = brave
		}
	}

	immediate = {
		random_held_title = {			
			limit = {
				tier = tier_county
				any_county_province = {
					geographical_region = world_tibet
				}
			}
			save_scope_as = county
		}
	}

	option = { # Ok
		name = zhangzhung.0153.a
		trigger = {
			OR = {
				is_ai = no
				gold >= 75
			}
		}
		remove_short_term_gold = 75
		scope:county = {
			add_county_modifier = {
				modifier = RICE_zhangzhung_demon_fortress
				years = 20
			}
		}
		stress_impact = {
			zealous = minor_stress_impact_gain
			paranoid = miniscule_stress_impact_gain
			craven = minor_stress_impact_gain
			content = miniscule_stress_impact_gain
		}
	}

	option = { # Ok
		name = zhangzhung.0153.b
		stress_impact = {
			brave = minor_stress_impact_gain
			ambitious = miniscule_stress_impact_gain
			cynical = minor_stress_impact_gain
			diligent = miniscule_stress_impact_gain
		}		
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = zhangzhung.0153.info
		}
	}
}



# Woman claims to have had a child out of wedlock with a mountain deity
zhangzhung.0154 = {
	type = character_event
	title = zhangzhung.0154.t
	desc = zhangzhung.0154.desc
	theme = pregnancy
	override_background = { reference = RICE_background_tibet_temple_exterior }
	
	right_portrait = {
		character = root
		animation = personality_cynical
	}
	
	trigger = {
		OR = {
			religion = religion:buddhism_religion
			religion = religion:bon_religion
			religion = religion:west_himalayan_religion
		}
		any_held_title = {
			tier = tier_county
			any_county_province = {
				geographical_region = RICE_greater_himalayan_region
			}
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = lazy
		}
		modifier = {
			add = -0.2
			has_trait = diligent
		}
		modifier = {
			add = 0.2
			has_trait = lustful
		}
		modifier = {
			add = -0.2
			has_trait = chaste
		}
		modifier = {
			add = 0.2
			has_trait = zealous
		}
		modifier = {
			add = -0.2
			has_trait = cynical
		}
	}

	immediate = {
		random_held_title = {			
			limit = {
				tier = tier_county
				any_county_province = {
					geographical_region = RICE_greater_himalayan_region
				}
			}
			save_scope_as = county
		}
	}

	option = { # Ok
		name = zhangzhung.0154.a
		add_piety = 25
		stress_impact = {
			cynical = minor_stress_impact_gain
		}
	}

	option = { # Ok
		name = zhangzhung.0154.b
		add_prestige = 25
		stress_impact = {
			zealous = minor_stress_impact_gain
		}		
	}

}



# Pilfering tombs in Tibet
zhangzhung.0155 = {
	type = character_event
	title = zhangzhung.0155.t
	desc = zhangzhung.0155.desc
	theme = corruption
	override_background = { reference = RICE_background_zhangzhung_ruins }
	
	right_portrait = {
		character = root
		animation = war_over_tie
	}
	
	trigger = {
		any_held_title = {
			tier = tier_county
			religion = root.religion
			any_county_province = {
				geographical_region = world_tibet
			}
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = generous
		}
		modifier = {
			add = -0.2
			has_trait = greedy
		}
		modifier = {
			add = 0.2
			has_trait = compassionate
		}
		modifier = {
			add = -0.2
			has_trait = sadistic
		}
		modifier = {
			add = 0.2
			has_trait = just
		}
		modifier = {
			add = -0.2
			has_trait = arbitrary
		}
	}

	immediate = {
		random_held_title = {			
			limit = {
				tier = tier_county
				religion = root.religion
				any_county_province = {
					geographical_region = world_tibet
				}
			}
			save_scope_as = county
		}
	}

	option = { # Ok
		name = zhangzhung.0155.a
		add_gold = { 5 88 }
		stress_impact = {
			zealous = minor_stress_impact_gain
			just = miniscule_stress_impact_gain
			compassionate = miniscule_stress_impact_gain
			craven = miniscule_stress_impact_gain
		}
	}

	option = { # Ok
		name = zhangzhung.0155.b
		add_piety = 50
		stress_impact = {
			greedy = minor_stress_impact_gain
			arbitrary = miniscule_stress_impact_gain
			callous = miniscule_stress_impact_gain
			cynical = miniscule_stress_impact_gain
		}		
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = zhangzhung.0155.info
		}
	}

}


# Kinnaur noble passes away
zhangzhung.0156 = {
	type = character_event
	title = zhangzhung.0156.t
	desc = zhangzhung.0156.desc
	theme = death
	override_background = { reference = RICE_background_himalayan_wilderness }
	
	left_portrait = {
		character = root
		animation = personality_zealous
	}
	
	trigger = {
		religion = religion:west_himalayan_religion
		capital_province = {
			OR = {
				terrain = mountains
				terrain = desert_mountains
				terrain = hills
			}
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = generous
		}
		modifier = {
			add = -0.2
			has_trait = greedy
		}
		modifier = {
			add = 0.2
			has_trait = compassionate
		}
		modifier = {
			add = -0.2
			has_trait = sadistic
		}
		modifier = {
			add = 0.2
			has_trait = just
		}
		modifier = {
			add = -0.2
			has_trait = arbitrary
		}
	}

	option = { # Ok
		name = zhangzhung.0156.a
		trigger = {
			OR = {
				is_ai = no
				gold >= 25
			}
		}
		remove_short_term_gold = 25
		add_piety = 25
		add_prestige = 25
		stress_impact = {
			greedy = minor_stress_impact_gain
			cynical = miniscule_stress_impact_gain
			callous = miniscule_stress_impact_gain
			arbitrary = miniscule_stress_impact_gain
		}
	}

	option = { # Ok
		name = zhangzhung.0156.b
		stress_impact = {
			zealous = miniscule_stress_impact_gain
			generous = minor_stress_impact_gain
			compassionate = miniscule_stress_impact_gain
			just = miniscule_stress_impact_gain
		}		
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = zhangzhung.0156.info
		}
	}

}


# Praying to the Kimshu (Kinnaur spirit)
zhangzhung.0157 = {
	type = character_event
	title = zhangzhung.0157.t
	desc = zhangzhung.0157.desc
	theme = RICE_theme_tibet_inner_altar
	
	left_portrait = {
		character = root
		animation = prayer
	}
	
	trigger = {
		religion = religion:west_himalayan_religion
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = zealous
		}
		modifier = {
			add = -0.2
			has_trait = cynical
		}
		modifier = {
			add = 0.2
			has_trait = generous
		}
		modifier = {
			add = -0.2
			has_trait = greedy
		}
		modifier = {
			add = 0.2
			has_trait = diligent
		}
		modifier = {
			add = -0.2
			has_trait = lazy
		}
	}

	option = { # Ok
		name = zhangzhung.0157.a
		add_piety = 25
		every_close_or_extended_family_member = {
			custom = all_family_members
			add_piety = 25
			add_opinion = {
				target = root
				modifier = pious_opinion
				opinion = 5
			}
		}
		stress_impact = {
			zealous = minor_stress_impact_loss
			generous = miniscule_stress_impact_loss
			compassionate = miniscule_stress_impact_loss
			diligent = miniscule_stress_impact_loss
			just = miniscule_stress_impact_loss
		}
	}

}






# Discussing the origins of Padmasambhava
zhangzhung.0158 = {
	type = character_event
	title = zhangzhung.0158.t
	desc = zhangzhung.0158.desc
	theme = RICE_theme_tibetan_hall_religious

	
	left_portrait = {
		character = scope:courtier_1
		animation = dismissal
	}
	right_portrait = {
		character = scope:courtier_2
		animation = disapproval
	}

	lower_center_portrait = {
		character = scope:padmasambhava
		trigger = { exists = scope:padmasambhava } # In case the game prunes him for some reason, which it shouldn't since he should be saved
	}

	trigger = {	
		exists = character:RICE_buddhist_001
		culture = { has_cultural_pillar = heritage_tibetan }
		faith = { has_doctrine = rice_vajrayana_canon_doctrine }
		any_courtier = {
			is_available_ai_adult = yes
			count >= 2
			culture = { has_cultural_pillar = heritage_tibetan }
			faith = { has_doctrine = rice_vajrayana_canon_doctrine }
		}
	}
	
	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = zealous
		}
		modifier = {
			add = -0.2
			has_trait = cynical
		}
		modifier = {
			add = 0.2
			has_trait = gregarious
		}
		modifier = {
			add = -0.2
			has_trait = shy
		}
		modifier = {
			add = 0.2
			has_trait = patient
		}
		modifier = {
			add = -0.2
			has_trait = impatient
		}
	}

	immediate = {
		character:RICE_buddhist_001 = {
			save_scope_as = padmasambhava
		}
		every_courtier = {
			limit = {
				is_available_ai_adult = yes
				culture = { has_cultural_pillar = heritage_tibetan }
				faith = { has_doctrine = rice_vajrayana_canon_doctrine }
			}
			add_to_list = courtier_candidates
		}
		random_in_list = {
			list = courtier_candidates
			save_scope_as = courtier_1
		}
		random_in_list = {
			list = courtier_candidates
			limit = {
				exists = scope:courtier_1
				NOT = { this = scope:courtier_1 }
			}
			save_scope_as = courtier_2
		}
		scope:courtier_1 = {
			add_opinion = {
				target = scope:courtier_2
				modifier = RICE_zhangzhung_religious_argument_opinion
			}
		}
		scope:courtier_2 = {
			add_opinion = {
				target = scope:courtier_1
				modifier = RICE_zhangzhung_religious_argument_opinion
			}
		}
	}

	
	option = { # ok
		name = zhangzhung.0158.a
		scope:courtier_1 = {
			add_opinion = {
				target = root
				modifier = RICE_agrees_with_me_opinion
				opinion = 10
			}		
		}
		scope:courtier_2 = {
			add_opinion = {
				target = root
				modifier = RICE_disagrees_with_me_opinion
				opinion = -10
			}		
		}
	}
	
	option = { # ok
		name = zhangzhung.0158.b
		scope:courtier_2 = {
			add_opinion = {
				target = root
				modifier = RICE_agrees_with_me_opinion
				opinion = 10
			}		
		}
		scope:courtier_1 = {
			add_opinion = {
				target = root
				modifier = RICE_disagrees_with_me_opinion
				opinion = -10
			}		
		}
	}


	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = zhangzhung.0158.info
		}
	}
	


}


# Musk deer imports from Tibet
zhangzhung.0159 = {
	type = character_event
	title = zhangzhung.0159.t
	desc = zhangzhung.0159.desc
	theme = stewardship_wealth_focus
	override_background = { reference = RICE_background_himalayan_wilderness }
	
	right_portrait = {
		character = root
		animation = frontend_left_idle
	}
	
	trigger = {
		any_held_title = {
			tier = tier_county
			any_county_province = {
				geographical_region = world_tibet
			}
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = diligent
		}
		modifier = {
			add = -0.2
			has_trait = lazy
		}
		modifier = {
			add = 0.2
			has_trait = just
		}
		modifier = {
			add = -0.2
			has_trait = arbitrary
		}
		modifier = {
			add = 0.2
			has_trait = ambitious
		}
		modifier = {
			add = -0.2
			has_trait = content
		}
	}

	immediate = {
		random_held_title = {			
			limit = {
				tier = tier_county
				any_county_province = {
					geographical_region = world_tibet
				}
			}
			save_scope_as = county
			scope:county = {
				random_list = {
					10 = {
						add_county_modifier = {
							modifier = RICE_zhangzhung_musk_county_modifier
							years = 5
						}
					}
					10 = {
						add_county_modifier = {
							modifier = RICE_zhangzhung_musk_county_modifier
							years = 10
						}
					}
					10 = {
						add_county_modifier = {
							modifier = RICE_zhangzhung_musk_county_modifier
							years = 15
						}
					}
					10 = {
						add_county_modifier = {
							modifier = RICE_zhangzhung_musk_county_modifier
							years = 20
						}
					}
				}
			}	
		}
	}

	option = { # Ok
		name = zhangzhung.0159.a
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = zhangzhung.0159.info
		}
	}
}



# Dardic locals worry about merchants' purity because they are strangers
zhangzhung.0160 = {
	type = character_event
	title = zhangzhung.0160.t
	desc = zhangzhung.0160.desc
	theme = stewardship_wealth_focus
	override_background = { reference = RICE_background_pamir_valley }
	
	right_portrait = {
		character = root
		animation = worry
	}
	
	trigger = {
		religion = religion:peristani_religion
		any_held_title = {
			tier = tier_county
			faith = root.faith
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = diligent
		}
		modifier = {
			add = -0.2
			has_trait = lazy
		}
		modifier = {
			add = 0.2
			has_trait = just
		}
		modifier = {
			add = -0.2
			has_trait = arbitrary
		}
		modifier = {
			add = 0.2
			has_trait = ambitious
		}
		modifier = {
			add = -0.2
			has_trait = content
		}
	}

	immediate = {
		random_held_title = {			
			limit = {
				tier = tier_county
				faith = root.faith
			}
			save_scope_as = county	
		}
	}

	option = { # Ok
		name = zhangzhung.0160.a
		scope:county = {
			add_county_modifier = {
				modifier = RICE_zhangzhung_impure_merchants
				years = 10
			}
		}
	}

	option = { # Ok
		name = zhangzhung.0160.b
		scope:county = {
			add_county_modifier = {
				modifier = RICE_zhangzhung_xenophobic_locals
				years = 10
			}
		}
	}

	option = { # Ok
		name = zhangzhung.0160.c
		duel = {
			skills = { diplomacy stewardship }
			value = 11
			10 = {
				desc = zhangzhung.0160.c.failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1.2
				}
				send_interface_toast = {
					title = zhangzhung.0160.c.failure
					add_legitimacy = miniscule_legitimacy_loss
					scope:county = {
						add_county_modifier = {
							modifier = RICE_zhangzhung_impure_merchants
							years = 10
						}
						add_county_modifier = {
							modifier = RICE_zhangzhung_xenophobic_locals
							years = 10
						}
					}					
				}
			}
			10 = {
				desc = zhangzhung.0160.c.success
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1.2
				}
				send_interface_toast = {
					title = zhangzhung.0160.c.success	
					add_legitimacy = miniscule_legitimacy_gain			
					scope:county = {
						add_county_modifier = {
							modifier = RICE_zhangzhung_prosperous_village_trade
							years = 10
						}	
					}
				}
			}
		}
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = zhangzhung.0160.info
		}
	}
}


# Praying to a local mountain goddess in Changthang
zhangzhung.0161 = {
	type = character_event
	title = zhangzhung.0161.t
	desc = zhangzhung.0161.desc
	theme = faith
	override_background = { reference = RICE_background_himalayan_wilderness }
	
	left_portrait = {
		character = root
		animation = personality_zealous
	}
	
	trigger = {
		OR = {
			religion = religion:buddhism_religion
			religion = religion:bon_religion
			religion = religion:west_himalayan_religion
		}
		capital_county = {
			title_province = { geographical_region = RICE_upper_tibet }
			OR = {
				religion = religion:buddhism_religion
				religion = religion:bon_religion
				religion = religion:west_himalayan_religion
			}
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = diligent
		}
		modifier = {
			add = -0.2
			has_trait = lazy
		}
		modifier = {
			add = 0.2
			has_trait = just
		}
		modifier = {
			add = -0.2
			has_trait = arbitrary
		}
		modifier = {
			add = 0.2
			has_trait = ambitious
		}
		modifier = {
			add = -0.2
			has_trait = content
		}
	}

	option = { # Ok
		name = zhangzhung.0161.a		
		trigger = {
			OR = {
				is_ai = no
				gold >= 40
			}
		}
		remove_short_term_gold = 40
		add_piety = 50
		add_character_modifier = {
			modifier = RICE_zhangzhung_mountain_lake_goddess_prayer
			years = 10
		}
		stress_impact = {
			greedy = minor_stress_impact_gain
			cynical = minor_stress_impact_gain
			lazy = miniscule_stress_impact_gain
		}
	}

	option = { # Ok
		name = zhangzhung.0161.b
		stress_impact = {
			zealous = minor_stress_impact_gain
			diligent = miniscule_stress_impact_gain
		}
	}

}

# Hearing about legends of mountain lakes with sightings of giant golden fish and dragons
zhangzhung.0162 = {
	type = character_event
	title = zhangzhung.0162.t
	desc = zhangzhung.0162.desc
	theme = travel_learning
	override_background = { reference = RICE_background_himalayan_wilderness }
	
	right_portrait = {
		character = root
		animation = admiration
	}	

	trigger = {
		is_location_valid_for_travel_event_on_land = yes
		location = {
			geographical_region = world_tibet
		}
	}
	
	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = patient
		}
		modifier = {
			add = -0.2
			has_trait = impatient
		}
		modifier = {
			add = 0.2
			has_trait = gregarious
		}
		modifier = {
			add = -0.2
			has_trait = shy
		}
		modifier = {
			add = 0.2
			has_trait = humble
		}
		modifier = {
			add = -0.2
			has_trait = arrogant
		}
	}

	option = { # Ok
		name = zhangzhung.0162.a
		add_piety = 25
		stress_impact = {
			cynical = minor_stress_impact_gain
		}
	}

	option = { # Ok
		name = zhangzhung.0162.b
		add_prestige = 25
		stress_impact = {
			zealous = minor_stress_impact_gain
		}
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = zhangzhung.0162.info
		}
	}

}


# Villagers warn of a lake ahead with brackish waters aka demons
zhangzhung.0163 = {
	type = character_event
	title = zhangzhung.0163.t
	desc = zhangzhung.0163.desc
	theme = travel_danger
	override_background = { reference = RICE_background_himalayan_wilderness }
	
	right_portrait = {
		character = root
		animation = thinking
	}	

	trigger = {
		is_location_valid_for_travel_event_on_land = yes
		location = {
			geographical_region = world_tibet
		}
	}
	
	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = patient
		}
		modifier = {
			add = -0.2
			has_trait = impatient
		}
		modifier = {
			add = 0.2
			has_trait = gregarious
		}
		modifier = {
			add = -0.2
			has_trait = shy
		}
		modifier = {
			add = 0.2
			has_trait = humble
		}
		modifier = {
			add = -0.2
			has_trait = arrogant
		}
	}

	option = { # Ok
		name = zhangzhung.0163.a
		stress_impact = {
			impatient = minor_stress_impact_gain
			wrathful = miniscule_stress_impact_gain
			lazy = miniscule_stress_impact_gain
		}
		current_travel_plan = {
			delay_travel_plan = { days = 8 }
		}
	}

	option = { # Ok
		name = zhangzhung.0163.b
		trigger = {
			OR = {
				is_ai = no
				gold >= 25
			}
		}
		remove_short_term_gold = 25
		add_piety = 25
		stress_impact = {
			cynical = minor_stress_impact_gain
			greedy = minor_stress_impact_gain
			paranoid = miniscule_stress_impact_gain
		}
	}

	option = { # Ok
		name = zhangzhung.0163.c
		add_prestige = 25
		stress_impact = {
			craven = medium_stress_impact_gain
			zealous = minor_stress_impact_gain
			humble = miniscule_stress_impact_gain
		}
		random = {
			chance = 45			
			send_interface_toast = {
				type = event_toast_effect_bad
				left_icon = ROOT
				title = zhangzhung.0163.c.message
				add_character_modifier = {
					modifier = RICE_zhangzhung_brackish_lake_demons
					years = 10
				}
			}
		}
	}


}


# Had a dream where you saw a Khyung, the Tibetan mythological horned eagle
zhangzhung.0164 = {
	type = character_event
	title = zhangzhung.0164.t
	desc = zhangzhung.0164.desc
	theme = memory_positive
	override_background = { reference = RICE_background_tibetan_hall }
	
	right_portrait = {
		character = root
		animation = personality_zealous
	}
	
	trigger = {
		culture = { has_cultural_pillar = heritage_tibetan }
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 0.2
			has_trait = compassionate
		}
		modifier = {
			add = -0.2
			has_trait = sadistic
		}
		modifier = {
			add = 0.2
			has_trait = just
		}
		modifier = {
			add = -0.2
			has_trait = arbitrary
		}
		modifier = {
			add = 0.2
			has_trait = content
		}
		modifier = {
			add = -0.2
			has_trait = ambitious
		}
	}

	option = { # Ok
		name = zhangzhung.0164.a
		add_character_modifier = {
			modifier = RICE_zhangzhung_khyung_royal
			years = 8
		}
		stress_impact = {
			just = minor_stress_impact_loss
			generous = miniscule_stress_impact_loss
			ambitious = miniscule_stress_impact_loss
			gregarious = miniscule_stress_impact_loss
		}
	}

	option = { # Ok
		name = zhangzhung.0164.b
		add_character_modifier = {
			modifier = RICE_zhangzhung_khyung_spiritual
			years = 8
		}
		stress_impact = {
			zealous = minor_stress_impact_loss
			humble = miniscule_stress_impact_loss
			diligent = miniscule_stress_impact_loss
			content = miniscule_stress_impact_loss
		}
	}

	after = {
		if = {
			limit = {
				has_game_rule = RICE_historical_context_on
			}
			custom_tooltip = zhangzhung.0164.info
		}
	}

}